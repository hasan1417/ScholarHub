var OA=Object.defineProperty;var my=t=>{throw TypeError(t)};var IA=(t,e,n)=>e in t?OA(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Rt=(t,e,n)=>IA(t,typeof e!="symbol"?e+"":e,n),vf=(t,e,n)=>e.has(t)||my("Cannot "+n);var U=(t,e,n)=>(vf(t,e,"read from private field"),n?n.call(t):e.get(t)),Me=(t,e,n)=>e.has(t)?my("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),be=(t,e,n,r)=>(vf(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n),$e=(t,e,n)=>(vf(t,e,"access private method"),n);var uu=(t,e,n,r)=>({set _(s){be(t,e,s,n)},get _(){return U(t,e,r)}});function FA(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const i=Object.getOwnPropertyDescriptor(r,s);i&&Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var _d=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ox(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var K1={exports:{}},Nh={},Q1={exports:{}},qe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vc=Symbol.for("react.element"),BA=Symbol.for("react.portal"),zA=Symbol.for("react.fragment"),$A=Symbol.for("react.strict_mode"),UA=Symbol.for("react.profiler"),HA=Symbol.for("react.provider"),qA=Symbol.for("react.context"),VA=Symbol.for("react.forward_ref"),WA=Symbol.for("react.suspense"),KA=Symbol.for("react.memo"),QA=Symbol.for("react.lazy"),gy=Symbol.iterator;function GA(t){return t===null||typeof t!="object"?null:(t=gy&&t[gy]||t["@@iterator"],typeof t=="function"?t:null)}var G1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},X1=Object.assign,J1={};function Ja(t,e,n){this.props=t,this.context=e,this.refs=J1,this.updater=n||G1}Ja.prototype.isReactComponent={};Ja.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ja.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Y1(){}Y1.prototype=Ja.prototype;function cx(t,e,n){this.props=t,this.context=e,this.refs=J1,this.updater=n||G1}var ux=cx.prototype=new Y1;ux.constructor=cx;X1(ux,Ja.prototype);ux.isPureReactComponent=!0;var xy=Array.isArray,Z1=Object.prototype.hasOwnProperty,dx={current:null},ek={key:!0,ref:!0,__self:!0,__source:!0};function tk(t,e,n){var r,s={},i=null,l=null;if(e!=null)for(r in e.ref!==void 0&&(l=e.ref),e.key!==void 0&&(i=""+e.key),e)Z1.call(e,r)&&!ek.hasOwnProperty(r)&&(s[r]=e[r]);var o=arguments.length-2;if(o===1)s.children=n;else if(1<o){for(var c=Array(o),u=0;u<o;u++)c[u]=arguments[u+2];s.children=c}if(t&&t.defaultProps)for(r in o=t.defaultProps,o)s[r]===void 0&&(s[r]=o[r]);return{$$typeof:Vc,type:t,key:i,ref:l,props:s,_owner:dx.current}}function XA(t,e){return{$$typeof:Vc,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function hx(t){return typeof t=="object"&&t!==null&&t.$$typeof===Vc}function JA(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var yy=/\/+/g;function wf(t,e){return typeof t=="object"&&t!==null&&t.key!=null?JA(""+t.key):e.toString(36)}function rd(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var l=!1;if(t===null)l=!0;else switch(i){case"string":case"number":l=!0;break;case"object":switch(t.$$typeof){case Vc:case BA:l=!0}}if(l)return l=t,s=s(l),t=r===""?"."+wf(l,0):r,xy(s)?(n="",t!=null&&(n=t.replace(yy,"$&/")+"/"),rd(s,e,n,"",function(u){return u})):s!=null&&(hx(s)&&(s=XA(s,n+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(yy,"$&/")+"/")+t)),e.push(s)),1;if(l=0,r=r===""?".":r+":",xy(t))for(var o=0;o<t.length;o++){i=t[o];var c=r+wf(i,o);l+=rd(i,e,n,c,s)}else if(c=GA(t),typeof c=="function")for(t=c.call(t),o=0;!(i=t.next()).done;)i=i.value,c=r+wf(i,o++),l+=rd(i,e,n,c,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return l}function du(t,e,n){if(t==null)return t;var r=[],s=0;return rd(t,r,"","",function(i){return e.call(n,i,s++)}),r}function YA(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Rn={current:null},sd={transition:null},ZA={ReactCurrentDispatcher:Rn,ReactCurrentBatchConfig:sd,ReactCurrentOwner:dx};function nk(){throw Error("act(...) is not supported in production builds of React.")}qe.Children={map:du,forEach:function(t,e,n){du(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return du(t,function(){e++}),e},toArray:function(t){return du(t,function(e){return e})||[]},only:function(t){if(!hx(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};qe.Component=Ja;qe.Fragment=zA;qe.Profiler=UA;qe.PureComponent=cx;qe.StrictMode=$A;qe.Suspense=WA;qe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ZA;qe.act=nk;qe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=X1({},t.props),s=t.key,i=t.ref,l=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,l=dx.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var o=t.type.defaultProps;for(c in e)Z1.call(e,c)&&!ek.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&o!==void 0?o[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){o=Array(c);for(var u=0;u<c;u++)o[u]=arguments[u+2];r.children=o}return{$$typeof:Vc,type:t.type,key:s,ref:i,props:r,_owner:l}};qe.createContext=function(t){return t={$$typeof:qA,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:HA,_context:t},t.Consumer=t};qe.createElement=tk;qe.createFactory=function(t){var e=tk.bind(null,t);return e.type=t,e};qe.createRef=function(){return{current:null}};qe.forwardRef=function(t){return{$$typeof:VA,render:t}};qe.isValidElement=hx;qe.lazy=function(t){return{$$typeof:QA,_payload:{_status:-1,_result:t},_init:YA}};qe.memo=function(t,e){return{$$typeof:KA,type:t,compare:e===void 0?null:e}};qe.startTransition=function(t){var e=sd.transition;sd.transition={};try{t()}finally{sd.transition=e}};qe.unstable_act=nk;qe.useCallback=function(t,e){return Rn.current.useCallback(t,e)};qe.useContext=function(t){return Rn.current.useContext(t)};qe.useDebugValue=function(){};qe.useDeferredValue=function(t){return Rn.current.useDeferredValue(t)};qe.useEffect=function(t,e){return Rn.current.useEffect(t,e)};qe.useId=function(){return Rn.current.useId()};qe.useImperativeHandle=function(t,e,n){return Rn.current.useImperativeHandle(t,e,n)};qe.useInsertionEffect=function(t,e){return Rn.current.useInsertionEffect(t,e)};qe.useLayoutEffect=function(t,e){return Rn.current.useLayoutEffect(t,e)};qe.useMemo=function(t,e){return Rn.current.useMemo(t,e)};qe.useReducer=function(t,e,n){return Rn.current.useReducer(t,e,n)};qe.useRef=function(t){return Rn.current.useRef(t)};qe.useState=function(t){return Rn.current.useState(t)};qe.useSyncExternalStore=function(t,e,n){return Rn.current.useSyncExternalStore(t,e,n)};qe.useTransition=function(){return Rn.current.useTransition()};qe.version="18.3.1";Q1.exports=qe;var w=Q1.exports;const Wc=ox(w),eE=FA({__proto__:null,default:Wc},[w]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tE=w,nE=Symbol.for("react.element"),rE=Symbol.for("react.fragment"),sE=Object.prototype.hasOwnProperty,iE=tE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,lE={key:!0,ref:!0,__self:!0,__source:!0};function rk(t,e,n){var r,s={},i=null,l=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(l=e.ref);for(r in e)sE.call(e,r)&&!lE.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:nE,type:t,key:i,ref:l,props:s,_owner:iE.current}}Nh.Fragment=rE;Nh.jsx=rk;Nh.jsxs=rk;K1.exports=Nh;var a=K1.exports,zp={},sk={exports:{}},ar={},ik={exports:{}},lk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(F,V){var P=F.length;F.push(V);e:for(;0<P;){var H=P-1>>>1,Y=F[H];if(0<s(Y,V))F[H]=V,F[P]=Y,P=H;else break e}}function n(F){return F.length===0?null:F[0]}function r(F){if(F.length===0)return null;var V=F[0],P=F.pop();if(P!==V){F[0]=P;e:for(var H=0,Y=F.length,L=Y>>>1;H<L;){var Se=2*(H+1)-1,we=F[Se],ge=Se+1,Ce=F[ge];if(0>s(we,P))ge<Y&&0>s(Ce,we)?(F[H]=Ce,F[ge]=P,H=ge):(F[H]=we,F[Se]=P,H=Se);else if(ge<Y&&0>s(Ce,P))F[H]=Ce,F[ge]=P,H=ge;else break e}}return V}function s(F,V){var P=F.sortIndex-V.sortIndex;return P!==0?P:F.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var l=Date,o=l.now();t.unstable_now=function(){return l.now()-o}}var c=[],u=[],h=1,d=null,f=3,p=!1,m=!1,x=!1,v=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(F){for(var V=n(u);V!==null;){if(V.callback===null)r(u);else if(V.startTime<=F)r(u),V.sortIndex=V.expirationTime,e(c,V);else break;V=n(u)}}function k(F){if(x=!1,b(F),!m)if(n(c)!==null)m=!0,z(S);else{var V=n(u);V!==null&&q(k,V.startTime-F)}}function S(F,V){m=!1,x&&(x=!1,g(A),A=-1),p=!0;var P=f;try{for(b(V),d=n(c);d!==null&&(!(d.expirationTime>V)||F&&!I());){var H=d.callback;if(typeof H=="function"){d.callback=null,f=d.priorityLevel;var Y=H(d.expirationTime<=V);V=t.unstable_now(),typeof Y=="function"?d.callback=Y:d===n(c)&&r(c),b(V)}else r(c);d=n(c)}if(d!==null)var L=!0;else{var Se=n(u);Se!==null&&q(k,Se.startTime-V),L=!1}return L}finally{d=null,f=P,p=!1}}var j=!1,E=null,A=-1,T=5,N=-1;function I(){return!(t.unstable_now()-N<T)}function R(){if(E!==null){var F=t.unstable_now();N=F;var V=!0;try{V=E(!0,F)}finally{V?C():(j=!1,E=null)}}else j=!1}var C;if(typeof y=="function")C=function(){y(R)};else if(typeof MessageChannel<"u"){var _=new MessageChannel,M=_.port2;_.port1.onmessage=R,C=function(){M.postMessage(null)}}else C=function(){v(R,0)};function z(F){E=F,j||(j=!0,C())}function q(F,V){A=v(function(){F(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(F){F.callback=null},t.unstable_continueExecution=function(){m||p||(m=!0,z(S))},t.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<F?Math.floor(1e3/F):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(F){switch(f){case 1:case 2:case 3:var V=3;break;default:V=f}var P=f;f=V;try{return F()}finally{f=P}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(F,V){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var P=f;f=F;try{return V()}finally{f=P}},t.unstable_scheduleCallback=function(F,V,P){var H=t.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?H+P:H):P=H,F){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=P+Y,F={id:h++,callback:V,priorityLevel:F,startTime:P,expirationTime:Y,sortIndex:-1},P>H?(F.sortIndex=P,e(u,F),n(c)===null&&F===n(u)&&(x?(g(A),A=-1):x=!0,q(k,P-H))):(F.sortIndex=Y,e(c,F),m||p||(m=!0,z(S))),F},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(F){var V=f;return function(){var P=f;f=V;try{return F.apply(this,arguments)}finally{f=P}}}})(lk);ik.exports=lk;var aE=ik.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oE=w,lr=aE;function oe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var ak=new Set,lc={};function _l(t,e){Ra(t,e),Ra(t+"Capture",e)}function Ra(t,e){for(lc[t]=e,t=0;t<e.length;t++)ak.add(e[t])}var Os=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),$p=Object.prototype.hasOwnProperty,cE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,by={},vy={};function uE(t){return $p.call(vy,t)?!0:$p.call(by,t)?!1:cE.test(t)?vy[t]=!0:(by[t]=!0,!1)}function dE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function hE(t,e,n,r){if(e===null||typeof e>"u"||dE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Dn(t,e,n,r,s,i,l){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=l}var on={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){on[t]=new Dn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];on[e]=new Dn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){on[t]=new Dn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){on[t]=new Dn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){on[t]=new Dn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){on[t]=new Dn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){on[t]=new Dn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){on[t]=new Dn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){on[t]=new Dn(t,5,!1,t.toLowerCase(),null,!1,!1)});var fx=/[\-:]([a-z])/g;function px(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(fx,px);on[e]=new Dn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(fx,px);on[e]=new Dn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(fx,px);on[e]=new Dn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){on[t]=new Dn(t,1,!1,t.toLowerCase(),null,!1,!1)});on.xlinkHref=new Dn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){on[t]=new Dn(t,1,!1,t.toLowerCase(),null,!0,!0)});function mx(t,e,n,r){var s=on.hasOwnProperty(e)?on[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(hE(e,n,s,r)&&(n=null),r||s===null?uE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var $s=oE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,hu=Symbol.for("react.element"),Wl=Symbol.for("react.portal"),Kl=Symbol.for("react.fragment"),gx=Symbol.for("react.strict_mode"),Up=Symbol.for("react.profiler"),ok=Symbol.for("react.provider"),ck=Symbol.for("react.context"),xx=Symbol.for("react.forward_ref"),Hp=Symbol.for("react.suspense"),qp=Symbol.for("react.suspense_list"),yx=Symbol.for("react.memo"),Ys=Symbol.for("react.lazy"),uk=Symbol.for("react.offscreen"),wy=Symbol.iterator;function ho(t){return t===null||typeof t!="object"?null:(t=wy&&t[wy]||t["@@iterator"],typeof t=="function"?t:null)}var St=Object.assign,kf;function To(t){if(kf===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);kf=e&&e[1]||""}return`
`+kf+t}var jf=!1;function Sf(t,e){if(!t||jf)return"";jf=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),i=r.stack.split(`
`),l=s.length-1,o=i.length-1;1<=l&&0<=o&&s[l]!==i[o];)o--;for(;1<=l&&0<=o;l--,o--)if(s[l]!==i[o]){if(l!==1||o!==1)do if(l--,o--,0>o||s[l]!==i[o]){var c=`
`+s[l].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=l&&0<=o);break}}}finally{jf=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?To(t):""}function fE(t){switch(t.tag){case 5:return To(t.type);case 16:return To("Lazy");case 13:return To("Suspense");case 19:return To("SuspenseList");case 0:case 2:case 15:return t=Sf(t.type,!1),t;case 11:return t=Sf(t.type.render,!1),t;case 1:return t=Sf(t.type,!0),t;default:return""}}function Vp(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Kl:return"Fragment";case Wl:return"Portal";case Up:return"Profiler";case gx:return"StrictMode";case Hp:return"Suspense";case qp:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case ck:return(t.displayName||"Context")+".Consumer";case ok:return(t._context.displayName||"Context")+".Provider";case xx:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case yx:return e=t.displayName||null,e!==null?e:Vp(t.type)||"Memo";case Ys:e=t._payload,t=t._init;try{return Vp(t(e))}catch{}}return null}function pE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Vp(e);case 8:return e===gx?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Mi(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function dk(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function mE(t){var e=dk(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(l){r=""+l,i.call(this,l)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(l){r=""+l},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function fu(t){t._valueTracker||(t._valueTracker=mE(t))}function hk(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=dk(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Md(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Wp(t,e){var n=e.checked;return St({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function ky(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Mi(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function fk(t,e){e=e.checked,e!=null&&mx(t,"checked",e,!1)}function Kp(t,e){fk(t,e);var n=Mi(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Qp(t,e.type,n):e.hasOwnProperty("defaultValue")&&Qp(t,e.type,Mi(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function jy(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Qp(t,e,n){(e!=="number"||Md(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ro=Array.isArray;function ca(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Mi(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Gp(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(oe(91));return St({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Sy(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(oe(92));if(Ro(n)){if(1<n.length)throw Error(oe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Mi(n)}}function pk(t,e){var n=Mi(e.value),r=Mi(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Ny(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function mk(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Xp(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?mk(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var pu,gk=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(pu=pu||document.createElement("div"),pu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=pu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function ac(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Uo={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},gE=["Webkit","ms","Moz","O"];Object.keys(Uo).forEach(function(t){gE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Uo[e]=Uo[t]})});function xk(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Uo.hasOwnProperty(t)&&Uo[t]?(""+e).trim():e+"px"}function yk(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=xk(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var xE=St({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jp(t,e){if(e){if(xE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(oe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(oe(62))}}function Yp(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zp=null;function bx(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var em=null,ua=null,da=null;function Cy(t){if(t=Gc(t)){if(typeof em!="function")throw Error(oe(280));var e=t.stateNode;e&&(e=_h(e),em(t.stateNode,t.type,e))}}function bk(t){ua?da?da.push(t):da=[t]:ua=t}function vk(){if(ua){var t=ua,e=da;if(da=ua=null,Cy(t),e)for(t=0;t<e.length;t++)Cy(e[t])}}function wk(t,e){return t(e)}function kk(){}var Nf=!1;function jk(t,e,n){if(Nf)return t(e,n);Nf=!0;try{return wk(t,e,n)}finally{Nf=!1,(ua!==null||da!==null)&&(kk(),vk())}}function oc(t,e){var n=t.stateNode;if(n===null)return null;var r=_h(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(oe(231,e,typeof n));return n}var tm=!1;if(Os)try{var fo={};Object.defineProperty(fo,"passive",{get:function(){tm=!0}}),window.addEventListener("test",fo,fo),window.removeEventListener("test",fo,fo)}catch{tm=!1}function yE(t,e,n,r,s,i,l,o,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(h){this.onError(h)}}var Ho=!1,Td=null,Rd=!1,nm=null,bE={onError:function(t){Ho=!0,Td=t}};function vE(t,e,n,r,s,i,l,o,c){Ho=!1,Td=null,yE.apply(bE,arguments)}function wE(t,e,n,r,s,i,l,o,c){if(vE.apply(this,arguments),Ho){if(Ho){var u=Td;Ho=!1,Td=null}else throw Error(oe(198));Rd||(Rd=!0,nm=u)}}function Ml(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function Sk(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Ay(t){if(Ml(t)!==t)throw Error(oe(188))}function kE(t){var e=t.alternate;if(!e){if(e=Ml(t),e===null)throw Error(oe(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return Ay(s),t;if(i===r)return Ay(s),e;i=i.sibling}throw Error(oe(188))}if(n.return!==r.return)n=s,r=i;else{for(var l=!1,o=s.child;o;){if(o===n){l=!0,n=s,r=i;break}if(o===r){l=!0,r=s,n=i;break}o=o.sibling}if(!l){for(o=i.child;o;){if(o===n){l=!0,n=i,r=s;break}if(o===r){l=!0,r=i,n=s;break}o=o.sibling}if(!l)throw Error(oe(189))}}if(n.alternate!==r)throw Error(oe(190))}if(n.tag!==3)throw Error(oe(188));return n.stateNode.current===n?t:e}function Nk(t){return t=kE(t),t!==null?Ck(t):null}function Ck(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Ck(t);if(e!==null)return e;t=t.sibling}return null}var Ak=lr.unstable_scheduleCallback,Ey=lr.unstable_cancelCallback,jE=lr.unstable_shouldYield,SE=lr.unstable_requestPaint,Mt=lr.unstable_now,NE=lr.unstable_getCurrentPriorityLevel,vx=lr.unstable_ImmediatePriority,Ek=lr.unstable_UserBlockingPriority,Dd=lr.unstable_NormalPriority,CE=lr.unstable_LowPriority,Pk=lr.unstable_IdlePriority,Ch=null,us=null;function AE(t){if(us&&typeof us.onCommitFiberRoot=="function")try{us.onCommitFiberRoot(Ch,t,void 0,(t.current.flags&128)===128)}catch{}}var Fr=Math.clz32?Math.clz32:_E,EE=Math.log,PE=Math.LN2;function _E(t){return t>>>=0,t===0?32:31-(EE(t)/PE|0)|0}var mu=64,gu=4194304;function Do(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ld(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,l=n&268435455;if(l!==0){var o=l&~s;o!==0?r=Do(o):(i&=l,i!==0&&(r=Do(i)))}else l=n&~s,l!==0?r=Do(l):i!==0&&(r=Do(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Fr(e),s=1<<n,r|=t[n],e&=~s;return r}function ME(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function TE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var l=31-Fr(i),o=1<<l,c=s[l];c===-1?(!(o&n)||o&r)&&(s[l]=ME(o,e)):c<=e&&(t.expiredLanes|=o),i&=~o}}function rm(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function _k(){var t=mu;return mu<<=1,!(mu&4194240)&&(mu=64),t}function Cf(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Kc(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fr(e),t[e]=n}function RE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Fr(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function wx(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Fr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var st=0;function Mk(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Tk,kx,Rk,Dk,Lk,sm=!1,xu=[],vi=null,wi=null,ki=null,cc=new Map,uc=new Map,ni=[],DE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Py(t,e){switch(t){case"focusin":case"focusout":vi=null;break;case"dragenter":case"dragleave":wi=null;break;case"mouseover":case"mouseout":ki=null;break;case"pointerover":case"pointerout":cc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":uc.delete(e.pointerId)}}function po(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Gc(e),e!==null&&kx(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function LE(t,e,n,r,s){switch(e){case"focusin":return vi=po(vi,t,e,n,r,s),!0;case"dragenter":return wi=po(wi,t,e,n,r,s),!0;case"mouseover":return ki=po(ki,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return cc.set(i,po(cc.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,uc.set(i,po(uc.get(i)||null,t,e,n,r,s)),!0}return!1}function Ok(t){var e=Ji(t.target);if(e!==null){var n=Ml(e);if(n!==null){if(e=n.tag,e===13){if(e=Sk(n),e!==null){t.blockedOn=e,Lk(t.priority,function(){Rk(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function id(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=im(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Zp=r,n.target.dispatchEvent(r),Zp=null}else return e=Gc(n),e!==null&&kx(e),t.blockedOn=n,!1;e.shift()}return!0}function _y(t,e,n){id(t)&&n.delete(e)}function OE(){sm=!1,vi!==null&&id(vi)&&(vi=null),wi!==null&&id(wi)&&(wi=null),ki!==null&&id(ki)&&(ki=null),cc.forEach(_y),uc.forEach(_y)}function mo(t,e){t.blockedOn===e&&(t.blockedOn=null,sm||(sm=!0,lr.unstable_scheduleCallback(lr.unstable_NormalPriority,OE)))}function dc(t){function e(s){return mo(s,t)}if(0<xu.length){mo(xu[0],t);for(var n=1;n<xu.length;n++){var r=xu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(vi!==null&&mo(vi,t),wi!==null&&mo(wi,t),ki!==null&&mo(ki,t),cc.forEach(e),uc.forEach(e),n=0;n<ni.length;n++)r=ni[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<ni.length&&(n=ni[0],n.blockedOn===null);)Ok(n),n.blockedOn===null&&ni.shift()}var ha=$s.ReactCurrentBatchConfig,Od=!0;function IE(t,e,n,r){var s=st,i=ha.transition;ha.transition=null;try{st=1,jx(t,e,n,r)}finally{st=s,ha.transition=i}}function FE(t,e,n,r){var s=st,i=ha.transition;ha.transition=null;try{st=4,jx(t,e,n,r)}finally{st=s,ha.transition=i}}function jx(t,e,n,r){if(Od){var s=im(t,e,n,r);if(s===null)Of(t,e,r,Id,n),Py(t,r);else if(LE(s,t,e,n,r))r.stopPropagation();else if(Py(t,r),e&4&&-1<DE.indexOf(t)){for(;s!==null;){var i=Gc(s);if(i!==null&&Tk(i),i=im(t,e,n,r),i===null&&Of(t,e,r,Id,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Of(t,e,r,null,n)}}var Id=null;function im(t,e,n,r){if(Id=null,t=bx(r),t=Ji(t),t!==null)if(e=Ml(t),e===null)t=null;else if(n=e.tag,n===13){if(t=Sk(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Id=t,null}function Ik(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(NE()){case vx:return 1;case Ek:return 4;case Dd:case CE:return 16;case Pk:return 536870912;default:return 16}default:return 16}}var pi=null,Sx=null,ld=null;function Fk(){if(ld)return ld;var t,e=Sx,n=e.length,r,s="value"in pi?pi.value:pi.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var l=n-t;for(r=1;r<=l&&e[n-r]===s[i-r];r++);return ld=s.slice(t,1<r?1-r:void 0)}function ad(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function yu(){return!0}function My(){return!1}function or(t){function e(n,r,s,i,l){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=l,this.currentTarget=null;for(var o in t)t.hasOwnProperty(o)&&(n=t[o],this[o]=n?n(i):i[o]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?yu:My,this.isPropagationStopped=My,this}return St(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=yu)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=yu)},persist:function(){},isPersistent:yu}),e}var Ya={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Nx=or(Ya),Qc=St({},Ya,{view:0,detail:0}),BE=or(Qc),Af,Ef,go,Ah=St({},Qc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cx,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==go&&(go&&t.type==="mousemove"?(Af=t.screenX-go.screenX,Ef=t.screenY-go.screenY):Ef=Af=0,go=t),Af)},movementY:function(t){return"movementY"in t?t.movementY:Ef}}),Ty=or(Ah),zE=St({},Ah,{dataTransfer:0}),$E=or(zE),UE=St({},Qc,{relatedTarget:0}),Pf=or(UE),HE=St({},Ya,{animationName:0,elapsedTime:0,pseudoElement:0}),qE=or(HE),VE=St({},Ya,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),WE=or(VE),KE=St({},Ya,{data:0}),Ry=or(KE),QE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},GE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},XE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function JE(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=XE[t])?!!e[t]:!1}function Cx(){return JE}var YE=St({},Qc,{key:function(t){if(t.key){var e=QE[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ad(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?GE[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cx,charCode:function(t){return t.type==="keypress"?ad(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ad(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ZE=or(YE),e3=St({},Ah,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Dy=or(e3),t3=St({},Qc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cx}),n3=or(t3),r3=St({},Ya,{propertyName:0,elapsedTime:0,pseudoElement:0}),s3=or(r3),i3=St({},Ah,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),l3=or(i3),a3=[9,13,27,32],Ax=Os&&"CompositionEvent"in window,qo=null;Os&&"documentMode"in document&&(qo=document.documentMode);var o3=Os&&"TextEvent"in window&&!qo,Bk=Os&&(!Ax||qo&&8<qo&&11>=qo),Ly=" ",Oy=!1;function zk(t,e){switch(t){case"keyup":return a3.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $k(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ql=!1;function c3(t,e){switch(t){case"compositionend":return $k(e);case"keypress":return e.which!==32?null:(Oy=!0,Ly);case"textInput":return t=e.data,t===Ly&&Oy?null:t;default:return null}}function u3(t,e){if(Ql)return t==="compositionend"||!Ax&&zk(t,e)?(t=Fk(),ld=Sx=pi=null,Ql=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Bk&&e.locale!=="ko"?null:e.data;default:return null}}var d3={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Iy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!d3[t.type]:e==="textarea"}function Uk(t,e,n,r){bk(r),e=Fd(e,"onChange"),0<e.length&&(n=new Nx("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Vo=null,hc=null;function h3(t){Zk(t,0)}function Eh(t){var e=Jl(t);if(hk(e))return t}function f3(t,e){if(t==="change")return e}var Hk=!1;if(Os){var _f;if(Os){var Mf="oninput"in document;if(!Mf){var Fy=document.createElement("div");Fy.setAttribute("oninput","return;"),Mf=typeof Fy.oninput=="function"}_f=Mf}else _f=!1;Hk=_f&&(!document.documentMode||9<document.documentMode)}function By(){Vo&&(Vo.detachEvent("onpropertychange",qk),hc=Vo=null)}function qk(t){if(t.propertyName==="value"&&Eh(hc)){var e=[];Uk(e,hc,t,bx(t)),jk(h3,e)}}function p3(t,e,n){t==="focusin"?(By(),Vo=e,hc=n,Vo.attachEvent("onpropertychange",qk)):t==="focusout"&&By()}function m3(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Eh(hc)}function g3(t,e){if(t==="click")return Eh(e)}function x3(t,e){if(t==="input"||t==="change")return Eh(e)}function y3(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var $r=typeof Object.is=="function"?Object.is:y3;function fc(t,e){if($r(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!$p.call(e,s)||!$r(t[s],e[s]))return!1}return!0}function zy(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function $y(t,e){var n=zy(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=zy(n)}}function Vk(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Vk(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Wk(){for(var t=window,e=Md();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Md(t.document)}return e}function Ex(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function b3(t){var e=Wk(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Vk(n.ownerDocument.documentElement,n)){if(r!==null&&Ex(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=$y(n,i);var l=$y(n,r);s&&l&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==l.node||t.focusOffset!==l.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(l.node,l.offset)):(e.setEnd(l.node,l.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var v3=Os&&"documentMode"in document&&11>=document.documentMode,Gl=null,lm=null,Wo=null,am=!1;function Uy(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;am||Gl==null||Gl!==Md(r)||(r=Gl,"selectionStart"in r&&Ex(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Wo&&fc(Wo,r)||(Wo=r,r=Fd(lm,"onSelect"),0<r.length&&(e=new Nx("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Gl)))}function bu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Xl={animationend:bu("Animation","AnimationEnd"),animationiteration:bu("Animation","AnimationIteration"),animationstart:bu("Animation","AnimationStart"),transitionend:bu("Transition","TransitionEnd")},Tf={},Kk={};Os&&(Kk=document.createElement("div").style,"AnimationEvent"in window||(delete Xl.animationend.animation,delete Xl.animationiteration.animation,delete Xl.animationstart.animation),"TransitionEvent"in window||delete Xl.transitionend.transition);function Ph(t){if(Tf[t])return Tf[t];if(!Xl[t])return t;var e=Xl[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Kk)return Tf[t]=e[n];return t}var Qk=Ph("animationend"),Gk=Ph("animationiteration"),Xk=Ph("animationstart"),Jk=Ph("transitionend"),Yk=new Map,Hy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fi(t,e){Yk.set(t,e),_l(e,[t])}for(var Rf=0;Rf<Hy.length;Rf++){var Df=Hy[Rf],w3=Df.toLowerCase(),k3=Df[0].toUpperCase()+Df.slice(1);Fi(w3,"on"+k3)}Fi(Qk,"onAnimationEnd");Fi(Gk,"onAnimationIteration");Fi(Xk,"onAnimationStart");Fi("dblclick","onDoubleClick");Fi("focusin","onFocus");Fi("focusout","onBlur");Fi(Jk,"onTransitionEnd");Ra("onMouseEnter",["mouseout","mouseover"]);Ra("onMouseLeave",["mouseout","mouseover"]);Ra("onPointerEnter",["pointerout","pointerover"]);Ra("onPointerLeave",["pointerout","pointerover"]);_l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_l("onBeforeInput",["compositionend","keypress","textInput","paste"]);_l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lo="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),j3=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lo));function qy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,wE(r,e,void 0,t),t.currentTarget=null}function Zk(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var l=r.length-1;0<=l;l--){var o=r[l],c=o.instance,u=o.currentTarget;if(o=o.listener,c!==i&&s.isPropagationStopped())break e;qy(s,o,u),i=c}else for(l=0;l<r.length;l++){if(o=r[l],c=o.instance,u=o.currentTarget,o=o.listener,c!==i&&s.isPropagationStopped())break e;qy(s,o,u),i=c}}}if(Rd)throw t=nm,Rd=!1,nm=null,t}function pt(t,e){var n=e[hm];n===void 0&&(n=e[hm]=new Set);var r=t+"__bubble";n.has(r)||(ej(e,t,2,!1),n.add(r))}function Lf(t,e,n){var r=0;e&&(r|=4),ej(n,t,r,e)}var vu="_reactListening"+Math.random().toString(36).slice(2);function pc(t){if(!t[vu]){t[vu]=!0,ak.forEach(function(n){n!=="selectionchange"&&(j3.has(n)||Lf(n,!1,t),Lf(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[vu]||(e[vu]=!0,Lf("selectionchange",!1,e))}}function ej(t,e,n,r){switch(Ik(e)){case 1:var s=IE;break;case 4:s=FE;break;default:s=jx}n=s.bind(null,e,n,t),s=void 0,!tm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Of(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var l=r.tag;if(l===3||l===4){var o=r.stateNode.containerInfo;if(o===s||o.nodeType===8&&o.parentNode===s)break;if(l===4)for(l=r.return;l!==null;){var c=l.tag;if((c===3||c===4)&&(c=l.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;l=l.return}for(;o!==null;){if(l=Ji(o),l===null)return;if(c=l.tag,c===5||c===6){r=i=l;continue e}o=o.parentNode}}r=r.return}jk(function(){var u=i,h=bx(n),d=[];e:{var f=Yk.get(t);if(f!==void 0){var p=Nx,m=t;switch(t){case"keypress":if(ad(n)===0)break e;case"keydown":case"keyup":p=ZE;break;case"focusin":m="focus",p=Pf;break;case"focusout":m="blur",p=Pf;break;case"beforeblur":case"afterblur":p=Pf;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Ty;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=$E;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=n3;break;case Qk:case Gk:case Xk:p=qE;break;case Jk:p=s3;break;case"scroll":p=BE;break;case"wheel":p=l3;break;case"copy":case"cut":case"paste":p=WE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Dy}var x=(e&4)!==0,v=!x&&t==="scroll",g=x?f!==null?f+"Capture":null:f;x=[];for(var y=u,b;y!==null;){b=y;var k=b.stateNode;if(b.tag===5&&k!==null&&(b=k,g!==null&&(k=oc(y,g),k!=null&&x.push(mc(y,k,b)))),v)break;y=y.return}0<x.length&&(f=new p(f,m,null,n,h),d.push({event:f,listeners:x}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",p=t==="mouseout"||t==="pointerout",f&&n!==Zp&&(m=n.relatedTarget||n.fromElement)&&(Ji(m)||m[Is]))break e;if((p||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,p?(m=n.relatedTarget||n.toElement,p=u,m=m?Ji(m):null,m!==null&&(v=Ml(m),m!==v||m.tag!==5&&m.tag!==6)&&(m=null)):(p=null,m=u),p!==m)){if(x=Ty,k="onMouseLeave",g="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(x=Dy,k="onPointerLeave",g="onPointerEnter",y="pointer"),v=p==null?f:Jl(p),b=m==null?f:Jl(m),f=new x(k,y+"leave",p,n,h),f.target=v,f.relatedTarget=b,k=null,Ji(h)===u&&(x=new x(g,y+"enter",m,n,h),x.target=b,x.relatedTarget=v,k=x),v=k,p&&m)t:{for(x=p,g=m,y=0,b=x;b;b=Bl(b))y++;for(b=0,k=g;k;k=Bl(k))b++;for(;0<y-b;)x=Bl(x),y--;for(;0<b-y;)g=Bl(g),b--;for(;y--;){if(x===g||g!==null&&x===g.alternate)break t;x=Bl(x),g=Bl(g)}x=null}else x=null;p!==null&&Vy(d,f,p,x,!1),m!==null&&v!==null&&Vy(d,v,m,x,!0)}}e:{if(f=u?Jl(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var S=f3;else if(Iy(f))if(Hk)S=x3;else{S=m3;var j=p3}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(S=g3);if(S&&(S=S(t,u))){Uk(d,S,n,h);break e}j&&j(t,f,u),t==="focusout"&&(j=f._wrapperState)&&j.controlled&&f.type==="number"&&Qp(f,"number",f.value)}switch(j=u?Jl(u):window,t){case"focusin":(Iy(j)||j.contentEditable==="true")&&(Gl=j,lm=u,Wo=null);break;case"focusout":Wo=lm=Gl=null;break;case"mousedown":am=!0;break;case"contextmenu":case"mouseup":case"dragend":am=!1,Uy(d,n,h);break;case"selectionchange":if(v3)break;case"keydown":case"keyup":Uy(d,n,h)}var E;if(Ax)e:{switch(t){case"compositionstart":var A="onCompositionStart";break e;case"compositionend":A="onCompositionEnd";break e;case"compositionupdate":A="onCompositionUpdate";break e}A=void 0}else Ql?zk(t,n)&&(A="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(A="onCompositionStart");A&&(Bk&&n.locale!=="ko"&&(Ql||A!=="onCompositionStart"?A==="onCompositionEnd"&&Ql&&(E=Fk()):(pi=h,Sx="value"in pi?pi.value:pi.textContent,Ql=!0)),j=Fd(u,A),0<j.length&&(A=new Ry(A,t,null,n,h),d.push({event:A,listeners:j}),E?A.data=E:(E=$k(n),E!==null&&(A.data=E)))),(E=o3?c3(t,n):u3(t,n))&&(u=Fd(u,"onBeforeInput"),0<u.length&&(h=new Ry("onBeforeInput","beforeinput",null,n,h),d.push({event:h,listeners:u}),h.data=E))}Zk(d,e)})}function mc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Fd(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=oc(t,n),i!=null&&r.unshift(mc(t,i,s)),i=oc(t,e),i!=null&&r.push(mc(t,i,s))),t=t.return}return r}function Bl(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Vy(t,e,n,r,s){for(var i=e._reactName,l=[];n!==null&&n!==r;){var o=n,c=o.alternate,u=o.stateNode;if(c!==null&&c===r)break;o.tag===5&&u!==null&&(o=u,s?(c=oc(n,i),c!=null&&l.unshift(mc(n,c,o))):s||(c=oc(n,i),c!=null&&l.push(mc(n,c,o)))),n=n.return}l.length!==0&&t.push({event:e,listeners:l})}var S3=/\r\n?/g,N3=/\u0000|\uFFFD/g;function Wy(t){return(typeof t=="string"?t:""+t).replace(S3,`
`).replace(N3,"")}function wu(t,e,n){if(e=Wy(e),Wy(t)!==e&&n)throw Error(oe(425))}function Bd(){}var om=null,cm=null;function um(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var dm=typeof setTimeout=="function"?setTimeout:void 0,C3=typeof clearTimeout=="function"?clearTimeout:void 0,Ky=typeof Promise=="function"?Promise:void 0,A3=typeof queueMicrotask=="function"?queueMicrotask:typeof Ky<"u"?function(t){return Ky.resolve(null).then(t).catch(E3)}:dm;function E3(t){setTimeout(function(){throw t})}function If(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),dc(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);dc(e)}function ji(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Qy(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Za=Math.random().toString(36).slice(2),ss="__reactFiber$"+Za,gc="__reactProps$"+Za,Is="__reactContainer$"+Za,hm="__reactEvents$"+Za,P3="__reactListeners$"+Za,_3="__reactHandles$"+Za;function Ji(t){var e=t[ss];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Is]||n[ss]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Qy(t);t!==null;){if(n=t[ss])return n;t=Qy(t)}return e}t=n,n=t.parentNode}return null}function Gc(t){return t=t[ss]||t[Is],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Jl(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(oe(33))}function _h(t){return t[gc]||null}var fm=[],Yl=-1;function Bi(t){return{current:t}}function xt(t){0>Yl||(t.current=fm[Yl],fm[Yl]=null,Yl--)}function ft(t,e){Yl++,fm[Yl]=t.current,t.current=e}var Ti={},vn=Bi(Ti),qn=Bi(!1),ml=Ti;function Da(t,e){var n=t.type.contextTypes;if(!n)return Ti;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Vn(t){return t=t.childContextTypes,t!=null}function zd(){xt(qn),xt(vn)}function Gy(t,e,n){if(vn.current!==Ti)throw Error(oe(168));ft(vn,e),ft(qn,n)}function tj(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(oe(108,pE(t)||"Unknown",s));return St({},n,r)}function $d(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ti,ml=vn.current,ft(vn,t),ft(qn,qn.current),!0}function Xy(t,e,n){var r=t.stateNode;if(!r)throw Error(oe(169));n?(t=tj(t,e,ml),r.__reactInternalMemoizedMergedChildContext=t,xt(qn),xt(vn),ft(vn,t)):xt(qn),ft(qn,n)}var js=null,Mh=!1,Ff=!1;function nj(t){js===null?js=[t]:js.push(t)}function M3(t){Mh=!0,nj(t)}function zi(){if(!Ff&&js!==null){Ff=!0;var t=0,e=st;try{var n=js;for(st=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}js=null,Mh=!1}catch(s){throw js!==null&&(js=js.slice(t+1)),Ak(vx,zi),s}finally{st=e,Ff=!1}}return null}var Zl=[],ea=0,Ud=null,Hd=0,fr=[],pr=0,gl=null,Es=1,Ps="";function Ki(t,e){Zl[ea++]=Hd,Zl[ea++]=Ud,Ud=t,Hd=e}function rj(t,e,n){fr[pr++]=Es,fr[pr++]=Ps,fr[pr++]=gl,gl=t;var r=Es;t=Ps;var s=32-Fr(r)-1;r&=~(1<<s),n+=1;var i=32-Fr(e)+s;if(30<i){var l=s-s%5;i=(r&(1<<l)-1).toString(32),r>>=l,s-=l,Es=1<<32-Fr(e)+s|n<<s|r,Ps=i+t}else Es=1<<i|n<<s|r,Ps=t}function Px(t){t.return!==null&&(Ki(t,1),rj(t,1,0))}function _x(t){for(;t===Ud;)Ud=Zl[--ea],Zl[ea]=null,Hd=Zl[--ea],Zl[ea]=null;for(;t===gl;)gl=fr[--pr],fr[pr]=null,Ps=fr[--pr],fr[pr]=null,Es=fr[--pr],fr[pr]=null}var rr=null,tr=null,bt=!1,Or=null;function sj(t,e){var n=br(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Jy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,rr=t,tr=ji(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,rr=t,tr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=gl!==null?{id:Es,overflow:Ps}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=br(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,rr=t,tr=null,!0):!1;default:return!1}}function pm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function mm(t){if(bt){var e=tr;if(e){var n=e;if(!Jy(t,e)){if(pm(t))throw Error(oe(418));e=ji(n.nextSibling);var r=rr;e&&Jy(t,e)?sj(r,n):(t.flags=t.flags&-4097|2,bt=!1,rr=t)}}else{if(pm(t))throw Error(oe(418));t.flags=t.flags&-4097|2,bt=!1,rr=t}}}function Yy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;rr=t}function ku(t){if(t!==rr)return!1;if(!bt)return Yy(t),bt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!um(t.type,t.memoizedProps)),e&&(e=tr)){if(pm(t))throw ij(),Error(oe(418));for(;e;)sj(t,e),e=ji(e.nextSibling)}if(Yy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(oe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){tr=ji(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}tr=null}}else tr=rr?ji(t.stateNode.nextSibling):null;return!0}function ij(){for(var t=tr;t;)t=ji(t.nextSibling)}function La(){tr=rr=null,bt=!1}function Mx(t){Or===null?Or=[t]:Or.push(t)}var T3=$s.ReactCurrentBatchConfig;function xo(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(oe(309));var r=n.stateNode}if(!r)throw Error(oe(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(l){var o=s.refs;l===null?delete o[i]:o[i]=l},e._stringRef=i,e)}if(typeof t!="string")throw Error(oe(284));if(!n._owner)throw Error(oe(290,t))}return t}function ju(t,e){throw t=Object.prototype.toString.call(e),Error(oe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Zy(t){var e=t._init;return e(t._payload)}function lj(t){function e(g,y){if(t){var b=g.deletions;b===null?(g.deletions=[y],g.flags|=16):b.push(y)}}function n(g,y){if(!t)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function r(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function s(g,y){return g=Ai(g,y),g.index=0,g.sibling=null,g}function i(g,y,b){return g.index=b,t?(b=g.alternate,b!==null?(b=b.index,b<y?(g.flags|=2,y):b):(g.flags|=2,y)):(g.flags|=1048576,y)}function l(g){return t&&g.alternate===null&&(g.flags|=2),g}function o(g,y,b,k){return y===null||y.tag!==6?(y=Vf(b,g.mode,k),y.return=g,y):(y=s(y,b),y.return=g,y)}function c(g,y,b,k){var S=b.type;return S===Kl?h(g,y,b.props.children,k,b.key):y!==null&&(y.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ys&&Zy(S)===y.type)?(k=s(y,b.props),k.ref=xo(g,y,b),k.return=g,k):(k=pd(b.type,b.key,b.props,null,g.mode,k),k.ref=xo(g,y,b),k.return=g,k)}function u(g,y,b,k){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=Wf(b,g.mode,k),y.return=g,y):(y=s(y,b.children||[]),y.return=g,y)}function h(g,y,b,k,S){return y===null||y.tag!==7?(y=hl(b,g.mode,k,S),y.return=g,y):(y=s(y,b),y.return=g,y)}function d(g,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=Vf(""+y,g.mode,b),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case hu:return b=pd(y.type,y.key,y.props,null,g.mode,b),b.ref=xo(g,null,y),b.return=g,b;case Wl:return y=Wf(y,g.mode,b),y.return=g,y;case Ys:var k=y._init;return d(g,k(y._payload),b)}if(Ro(y)||ho(y))return y=hl(y,g.mode,b,null),y.return=g,y;ju(g,y)}return null}function f(g,y,b,k){var S=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return S!==null?null:o(g,y,""+b,k);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case hu:return b.key===S?c(g,y,b,k):null;case Wl:return b.key===S?u(g,y,b,k):null;case Ys:return S=b._init,f(g,y,S(b._payload),k)}if(Ro(b)||ho(b))return S!==null?null:h(g,y,b,k,null);ju(g,b)}return null}function p(g,y,b,k,S){if(typeof k=="string"&&k!==""||typeof k=="number")return g=g.get(b)||null,o(y,g,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case hu:return g=g.get(k.key===null?b:k.key)||null,c(y,g,k,S);case Wl:return g=g.get(k.key===null?b:k.key)||null,u(y,g,k,S);case Ys:var j=k._init;return p(g,y,b,j(k._payload),S)}if(Ro(k)||ho(k))return g=g.get(b)||null,h(y,g,k,S,null);ju(y,k)}return null}function m(g,y,b,k){for(var S=null,j=null,E=y,A=y=0,T=null;E!==null&&A<b.length;A++){E.index>A?(T=E,E=null):T=E.sibling;var N=f(g,E,b[A],k);if(N===null){E===null&&(E=T);break}t&&E&&N.alternate===null&&e(g,E),y=i(N,y,A),j===null?S=N:j.sibling=N,j=N,E=T}if(A===b.length)return n(g,E),bt&&Ki(g,A),S;if(E===null){for(;A<b.length;A++)E=d(g,b[A],k),E!==null&&(y=i(E,y,A),j===null?S=E:j.sibling=E,j=E);return bt&&Ki(g,A),S}for(E=r(g,E);A<b.length;A++)T=p(E,g,A,b[A],k),T!==null&&(t&&T.alternate!==null&&E.delete(T.key===null?A:T.key),y=i(T,y,A),j===null?S=T:j.sibling=T,j=T);return t&&E.forEach(function(I){return e(g,I)}),bt&&Ki(g,A),S}function x(g,y,b,k){var S=ho(b);if(typeof S!="function")throw Error(oe(150));if(b=S.call(b),b==null)throw Error(oe(151));for(var j=S=null,E=y,A=y=0,T=null,N=b.next();E!==null&&!N.done;A++,N=b.next()){E.index>A?(T=E,E=null):T=E.sibling;var I=f(g,E,N.value,k);if(I===null){E===null&&(E=T);break}t&&E&&I.alternate===null&&e(g,E),y=i(I,y,A),j===null?S=I:j.sibling=I,j=I,E=T}if(N.done)return n(g,E),bt&&Ki(g,A),S;if(E===null){for(;!N.done;A++,N=b.next())N=d(g,N.value,k),N!==null&&(y=i(N,y,A),j===null?S=N:j.sibling=N,j=N);return bt&&Ki(g,A),S}for(E=r(g,E);!N.done;A++,N=b.next())N=p(E,g,A,N.value,k),N!==null&&(t&&N.alternate!==null&&E.delete(N.key===null?A:N.key),y=i(N,y,A),j===null?S=N:j.sibling=N,j=N);return t&&E.forEach(function(R){return e(g,R)}),bt&&Ki(g,A),S}function v(g,y,b,k){if(typeof b=="object"&&b!==null&&b.type===Kl&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case hu:e:{for(var S=b.key,j=y;j!==null;){if(j.key===S){if(S=b.type,S===Kl){if(j.tag===7){n(g,j.sibling),y=s(j,b.props.children),y.return=g,g=y;break e}}else if(j.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ys&&Zy(S)===j.type){n(g,j.sibling),y=s(j,b.props),y.ref=xo(g,j,b),y.return=g,g=y;break e}n(g,j);break}else e(g,j);j=j.sibling}b.type===Kl?(y=hl(b.props.children,g.mode,k,b.key),y.return=g,g=y):(k=pd(b.type,b.key,b.props,null,g.mode,k),k.ref=xo(g,y,b),k.return=g,g=k)}return l(g);case Wl:e:{for(j=b.key;y!==null;){if(y.key===j)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){n(g,y.sibling),y=s(y,b.children||[]),y.return=g,g=y;break e}else{n(g,y);break}else e(g,y);y=y.sibling}y=Wf(b,g.mode,k),y.return=g,g=y}return l(g);case Ys:return j=b._init,v(g,y,j(b._payload),k)}if(Ro(b))return m(g,y,b,k);if(ho(b))return x(g,y,b,k);ju(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(n(g,y.sibling),y=s(y,b),y.return=g,g=y):(n(g,y),y=Vf(b,g.mode,k),y.return=g,g=y),l(g)):n(g,y)}return v}var Oa=lj(!0),aj=lj(!1),qd=Bi(null),Vd=null,ta=null,Tx=null;function Rx(){Tx=ta=Vd=null}function Dx(t){var e=qd.current;xt(qd),t._currentValue=e}function gm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function fa(t,e){Vd=t,Tx=ta=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Hn=!0),t.firstContext=null)}function Cr(t){var e=t._currentValue;if(Tx!==t)if(t={context:t,memoizedValue:e,next:null},ta===null){if(Vd===null)throw Error(oe(308));ta=t,Vd.dependencies={lanes:0,firstContext:t}}else ta=ta.next=t;return e}var Yi=null;function Lx(t){Yi===null?Yi=[t]:Yi.push(t)}function oj(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,Lx(e)):(n.next=s.next,s.next=n),e.interleaved=n,Fs(t,r)}function Fs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Zs=!1;function Ox(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function cj(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Ms(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Si(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Xe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Fs(t,n)}return s=r.interleaved,s===null?(e.next=e,Lx(r)):(e.next=s.next,s.next=e),r.interleaved=e,Fs(t,n)}function od(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,wx(t,n)}}function eb(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var l={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=l:i=i.next=l,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Wd(t,e,n,r){var s=t.updateQueue;Zs=!1;var i=s.firstBaseUpdate,l=s.lastBaseUpdate,o=s.shared.pending;if(o!==null){s.shared.pending=null;var c=o,u=c.next;c.next=null,l===null?i=u:l.next=u,l=c;var h=t.alternate;h!==null&&(h=h.updateQueue,o=h.lastBaseUpdate,o!==l&&(o===null?h.firstBaseUpdate=u:o.next=u,h.lastBaseUpdate=c))}if(i!==null){var d=s.baseState;l=0,h=u=c=null,o=i;do{var f=o.lane,p=o.eventTime;if((r&f)===f){h!==null&&(h=h.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=t,x=o;switch(f=e,p=n,x.tag){case 1:if(m=x.payload,typeof m=="function"){d=m.call(p,d,f);break e}d=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=x.payload,f=typeof m=="function"?m.call(p,d,f):m,f==null)break e;d=St({},d,f);break e;case 2:Zs=!0}}o.callback!==null&&o.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[o]:f.push(o))}else p={eventTime:p,lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},h===null?(u=h=p,c=d):h=h.next=p,l|=f;if(o=o.next,o===null){if(o=s.shared.pending,o===null)break;f=o,o=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(h===null&&(c=d),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do l|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);yl|=l,t.lanes=l,t.memoizedState=d}}function tb(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(oe(191,s));s.call(r)}}}var Xc={},ds=Bi(Xc),xc=Bi(Xc),yc=Bi(Xc);function Zi(t){if(t===Xc)throw Error(oe(174));return t}function Ix(t,e){switch(ft(yc,e),ft(xc,t),ft(ds,Xc),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Xp(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Xp(e,t)}xt(ds),ft(ds,e)}function Ia(){xt(ds),xt(xc),xt(yc)}function uj(t){Zi(yc.current);var e=Zi(ds.current),n=Xp(e,t.type);e!==n&&(ft(xc,t),ft(ds,n))}function Fx(t){xc.current===t&&(xt(ds),xt(xc))}var wt=Bi(0);function Kd(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Bf=[];function Bx(){for(var t=0;t<Bf.length;t++)Bf[t]._workInProgressVersionPrimary=null;Bf.length=0}var cd=$s.ReactCurrentDispatcher,zf=$s.ReactCurrentBatchConfig,xl=0,jt=null,zt=null,Gt=null,Qd=!1,Ko=!1,bc=0,R3=0;function cn(){throw Error(oe(321))}function zx(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!$r(t[n],e[n]))return!1;return!0}function $x(t,e,n,r,s,i){if(xl=i,jt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,cd.current=t===null||t.memoizedState===null?I3:F3,t=n(r,s),Ko){i=0;do{if(Ko=!1,bc=0,25<=i)throw Error(oe(301));i+=1,Gt=zt=null,e.updateQueue=null,cd.current=B3,t=n(r,s)}while(Ko)}if(cd.current=Gd,e=zt!==null&&zt.next!==null,xl=0,Gt=zt=jt=null,Qd=!1,e)throw Error(oe(300));return t}function Ux(){var t=bc!==0;return bc=0,t}function Zr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Gt===null?jt.memoizedState=Gt=t:Gt=Gt.next=t,Gt}function Ar(){if(zt===null){var t=jt.alternate;t=t!==null?t.memoizedState:null}else t=zt.next;var e=Gt===null?jt.memoizedState:Gt.next;if(e!==null)Gt=e,zt=t;else{if(t===null)throw Error(oe(310));zt=t,t={memoizedState:zt.memoizedState,baseState:zt.baseState,baseQueue:zt.baseQueue,queue:zt.queue,next:null},Gt===null?jt.memoizedState=Gt=t:Gt=Gt.next=t}return Gt}function vc(t,e){return typeof e=="function"?e(t):e}function $f(t){var e=Ar(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var r=zt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var l=s.next;s.next=i.next,i.next=l}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var o=l=null,c=null,u=i;do{var h=u.lane;if((xl&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(o=c=d,l=r):c=c.next=d,jt.lanes|=h,yl|=h}u=u.next}while(u!==null&&u!==i);c===null?l=r:c.next=o,$r(r,e.memoizedState)||(Hn=!0),e.memoizedState=r,e.baseState=l,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,jt.lanes|=i,yl|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Uf(t){var e=Ar(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var l=s=s.next;do i=t(i,l.action),l=l.next;while(l!==s);$r(i,e.memoizedState)||(Hn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function dj(){}function hj(t,e){var n=jt,r=Ar(),s=e(),i=!$r(r.memoizedState,s);if(i&&(r.memoizedState=s,Hn=!0),r=r.queue,Hx(mj.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||Gt!==null&&Gt.memoizedState.tag&1){if(n.flags|=2048,wc(9,pj.bind(null,n,r,s,e),void 0,null),Yt===null)throw Error(oe(349));xl&30||fj(n,e,s)}return s}function fj(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function pj(t,e,n,r){e.value=n,e.getSnapshot=r,gj(e)&&xj(t)}function mj(t,e,n){return n(function(){gj(e)&&xj(t)})}function gj(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!$r(t,n)}catch{return!0}}function xj(t){var e=Fs(t,1);e!==null&&Br(e,t,1,-1)}function nb(t){var e=Zr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:vc,lastRenderedState:t},e.queue=t,t=t.dispatch=O3.bind(null,jt,t),[e.memoizedState,t]}function wc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function yj(){return Ar().memoizedState}function ud(t,e,n,r){var s=Zr();jt.flags|=t,s.memoizedState=wc(1|e,n,void 0,r===void 0?null:r)}function Th(t,e,n,r){var s=Ar();r=r===void 0?null:r;var i=void 0;if(zt!==null){var l=zt.memoizedState;if(i=l.destroy,r!==null&&zx(r,l.deps)){s.memoizedState=wc(e,n,i,r);return}}jt.flags|=t,s.memoizedState=wc(1|e,n,i,r)}function rb(t,e){return ud(8390656,8,t,e)}function Hx(t,e){return Th(2048,8,t,e)}function bj(t,e){return Th(4,2,t,e)}function vj(t,e){return Th(4,4,t,e)}function wj(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function kj(t,e,n){return n=n!=null?n.concat([t]):null,Th(4,4,wj.bind(null,e,t),n)}function qx(){}function jj(t,e){var n=Ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&zx(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Sj(t,e){var n=Ar();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&zx(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Nj(t,e,n){return xl&21?($r(n,e)||(n=_k(),jt.lanes|=n,yl|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Hn=!0),t.memoizedState=n)}function D3(t,e){var n=st;st=n!==0&&4>n?n:4,t(!0);var r=zf.transition;zf.transition={};try{t(!1),e()}finally{st=n,zf.transition=r}}function Cj(){return Ar().memoizedState}function L3(t,e,n){var r=Ci(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Aj(t))Ej(e,n);else if(n=oj(t,e,n,r),n!==null){var s=_n();Br(n,t,r,s),Pj(n,e,r)}}function O3(t,e,n){var r=Ci(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Aj(t))Ej(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var l=e.lastRenderedState,o=i(l,n);if(s.hasEagerState=!0,s.eagerState=o,$r(o,l)){var c=e.interleaved;c===null?(s.next=s,Lx(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=oj(t,e,s,r),n!==null&&(s=_n(),Br(n,t,r,s),Pj(n,e,r))}}function Aj(t){var e=t.alternate;return t===jt||e!==null&&e===jt}function Ej(t,e){Ko=Qd=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Pj(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,wx(t,n)}}var Gd={readContext:Cr,useCallback:cn,useContext:cn,useEffect:cn,useImperativeHandle:cn,useInsertionEffect:cn,useLayoutEffect:cn,useMemo:cn,useReducer:cn,useRef:cn,useState:cn,useDebugValue:cn,useDeferredValue:cn,useTransition:cn,useMutableSource:cn,useSyncExternalStore:cn,useId:cn,unstable_isNewReconciler:!1},I3={readContext:Cr,useCallback:function(t,e){return Zr().memoizedState=[t,e===void 0?null:e],t},useContext:Cr,useEffect:rb,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ud(4194308,4,wj.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ud(4194308,4,t,e)},useInsertionEffect:function(t,e){return ud(4,2,t,e)},useMemo:function(t,e){var n=Zr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Zr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=L3.bind(null,jt,t),[r.memoizedState,t]},useRef:function(t){var e=Zr();return t={current:t},e.memoizedState=t},useState:nb,useDebugValue:qx,useDeferredValue:function(t){return Zr().memoizedState=t},useTransition:function(){var t=nb(!1),e=t[0];return t=D3.bind(null,t[1]),Zr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=jt,s=Zr();if(bt){if(n===void 0)throw Error(oe(407));n=n()}else{if(n=e(),Yt===null)throw Error(oe(349));xl&30||fj(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,rb(mj.bind(null,r,i,t),[t]),r.flags|=2048,wc(9,pj.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=Zr(),e=Yt.identifierPrefix;if(bt){var n=Ps,r=Es;n=(r&~(1<<32-Fr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=bc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=R3++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},F3={readContext:Cr,useCallback:jj,useContext:Cr,useEffect:Hx,useImperativeHandle:kj,useInsertionEffect:bj,useLayoutEffect:vj,useMemo:Sj,useReducer:$f,useRef:yj,useState:function(){return $f(vc)},useDebugValue:qx,useDeferredValue:function(t){var e=Ar();return Nj(e,zt.memoizedState,t)},useTransition:function(){var t=$f(vc)[0],e=Ar().memoizedState;return[t,e]},useMutableSource:dj,useSyncExternalStore:hj,useId:Cj,unstable_isNewReconciler:!1},B3={readContext:Cr,useCallback:jj,useContext:Cr,useEffect:Hx,useImperativeHandle:kj,useInsertionEffect:bj,useLayoutEffect:vj,useMemo:Sj,useReducer:Uf,useRef:yj,useState:function(){return Uf(vc)},useDebugValue:qx,useDeferredValue:function(t){var e=Ar();return zt===null?e.memoizedState=t:Nj(e,zt.memoizedState,t)},useTransition:function(){var t=Uf(vc)[0],e=Ar().memoizedState;return[t,e]},useMutableSource:dj,useSyncExternalStore:hj,useId:Cj,unstable_isNewReconciler:!1};function Tr(t,e){if(t&&t.defaultProps){e=St({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function xm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:St({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Rh={isMounted:function(t){return(t=t._reactInternals)?Ml(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=_n(),s=Ci(t),i=Ms(r,s);i.payload=e,n!=null&&(i.callback=n),e=Si(t,i,s),e!==null&&(Br(e,t,s,r),od(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=_n(),s=Ci(t),i=Ms(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=Si(t,i,s),e!==null&&(Br(e,t,s,r),od(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=_n(),r=Ci(t),s=Ms(n,r);s.tag=2,e!=null&&(s.callback=e),e=Si(t,s,r),e!==null&&(Br(e,t,r,n),od(e,t,r))}};function sb(t,e,n,r,s,i,l){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,l):e.prototype&&e.prototype.isPureReactComponent?!fc(n,r)||!fc(s,i):!0}function _j(t,e,n){var r=!1,s=Ti,i=e.contextType;return typeof i=="object"&&i!==null?i=Cr(i):(s=Vn(e)?ml:vn.current,r=e.contextTypes,i=(r=r!=null)?Da(t,s):Ti),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Rh,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function ib(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Rh.enqueueReplaceState(e,e.state,null)}function ym(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},Ox(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Cr(i):(i=Vn(e)?ml:vn.current,s.context=Da(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(xm(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Rh.enqueueReplaceState(s,s.state,null),Wd(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Fa(t,e){try{var n="",r=e;do n+=fE(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Hf(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function bm(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var z3=typeof WeakMap=="function"?WeakMap:Map;function Mj(t,e,n){n=Ms(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Jd||(Jd=!0,Pm=r),bm(t,e)},n}function Tj(t,e,n){n=Ms(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){bm(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){bm(t,e),typeof r!="function"&&(Ni===null?Ni=new Set([this]):Ni.add(this));var l=e.stack;this.componentDidCatch(e.value,{componentStack:l!==null?l:""})}),n}function lb(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new z3;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=eP.bind(null,t,e,n),e.then(t,t))}function ab(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function ob(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Ms(-1,1),e.tag=2,Si(n,e,1))),n.lanes|=1),t)}var $3=$s.ReactCurrentOwner,Hn=!1;function Nn(t,e,n,r){e.child=t===null?aj(e,null,n,r):Oa(e,t.child,n,r)}function cb(t,e,n,r,s){n=n.render;var i=e.ref;return fa(e,s),r=$x(t,e,n,r,i,s),n=Ux(),t!==null&&!Hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Bs(t,e,s)):(bt&&n&&Px(e),e.flags|=1,Nn(t,e,r,s),e.child)}function ub(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!Yx(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,Rj(t,e,i,r,s)):(t=pd(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var l=i.memoizedProps;if(n=n.compare,n=n!==null?n:fc,n(l,r)&&t.ref===e.ref)return Bs(t,e,s)}return e.flags|=1,t=Ai(i,r),t.ref=e.ref,t.return=e,e.child=t}function Rj(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(fc(i,r)&&t.ref===e.ref)if(Hn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Hn=!0);else return e.lanes=t.lanes,Bs(t,e,s)}return vm(t,e,n,r,s)}function Dj(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ft(ra,Yn),Yn|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ft(ra,Yn),Yn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,ft(ra,Yn),Yn|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,ft(ra,Yn),Yn|=r;return Nn(t,e,s,n),e.child}function Lj(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function vm(t,e,n,r,s){var i=Vn(n)?ml:vn.current;return i=Da(e,i),fa(e,s),n=$x(t,e,n,r,i,s),r=Ux(),t!==null&&!Hn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Bs(t,e,s)):(bt&&r&&Px(e),e.flags|=1,Nn(t,e,n,s),e.child)}function db(t,e,n,r,s){if(Vn(n)){var i=!0;$d(e)}else i=!1;if(fa(e,s),e.stateNode===null)dd(t,e),_j(e,n,r),ym(e,n,r,s),r=!0;else if(t===null){var l=e.stateNode,o=e.memoizedProps;l.props=o;var c=l.context,u=n.contextType;typeof u=="object"&&u!==null?u=Cr(u):(u=Vn(n)?ml:vn.current,u=Da(e,u));var h=n.getDerivedStateFromProps,d=typeof h=="function"||typeof l.getSnapshotBeforeUpdate=="function";d||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==r||c!==u)&&ib(e,l,r,u),Zs=!1;var f=e.memoizedState;l.state=f,Wd(e,r,l,s),c=e.memoizedState,o!==r||f!==c||qn.current||Zs?(typeof h=="function"&&(xm(e,n,h,r),c=e.memoizedState),(o=Zs||sb(e,n,o,r,f,c,u))?(d||typeof l.UNSAFE_componentWillMount!="function"&&typeof l.componentWillMount!="function"||(typeof l.componentWillMount=="function"&&l.componentWillMount(),typeof l.UNSAFE_componentWillMount=="function"&&l.UNSAFE_componentWillMount()),typeof l.componentDidMount=="function"&&(e.flags|=4194308)):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),l.props=r,l.state=c,l.context=u,r=o):(typeof l.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{l=e.stateNode,cj(t,e),o=e.memoizedProps,u=e.type===e.elementType?o:Tr(e.type,o),l.props=u,d=e.pendingProps,f=l.context,c=n.contextType,typeof c=="object"&&c!==null?c=Cr(c):(c=Vn(n)?ml:vn.current,c=Da(e,c));var p=n.getDerivedStateFromProps;(h=typeof p=="function"||typeof l.getSnapshotBeforeUpdate=="function")||typeof l.UNSAFE_componentWillReceiveProps!="function"&&typeof l.componentWillReceiveProps!="function"||(o!==d||f!==c)&&ib(e,l,r,c),Zs=!1,f=e.memoizedState,l.state=f,Wd(e,r,l,s);var m=e.memoizedState;o!==d||f!==m||qn.current||Zs?(typeof p=="function"&&(xm(e,n,p,r),m=e.memoizedState),(u=Zs||sb(e,n,u,r,f,m,c)||!1)?(h||typeof l.UNSAFE_componentWillUpdate!="function"&&typeof l.componentWillUpdate!="function"||(typeof l.componentWillUpdate=="function"&&l.componentWillUpdate(r,m,c),typeof l.UNSAFE_componentWillUpdate=="function"&&l.UNSAFE_componentWillUpdate(r,m,c)),typeof l.componentDidUpdate=="function"&&(e.flags|=4),typeof l.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=m),l.props=r,l.state=m,l.context=c,r=u):(typeof l.componentDidUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof l.getSnapshotBeforeUpdate!="function"||o===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return wm(t,e,n,r,i,s)}function wm(t,e,n,r,s,i){Lj(t,e);var l=(e.flags&128)!==0;if(!r&&!l)return s&&Xy(e,n,!1),Bs(t,e,i);r=e.stateNode,$3.current=e;var o=l&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&l?(e.child=Oa(e,t.child,null,i),e.child=Oa(e,null,o,i)):Nn(t,e,o,i),e.memoizedState=r.state,s&&Xy(e,n,!0),e.child}function Oj(t){var e=t.stateNode;e.pendingContext?Gy(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Gy(t,e.context,!1),Ix(t,e.containerInfo)}function hb(t,e,n,r,s){return La(),Mx(s),e.flags|=256,Nn(t,e,n,r),e.child}var km={dehydrated:null,treeContext:null,retryLane:0};function jm(t){return{baseLanes:t,cachePool:null,transitions:null}}function Ij(t,e,n){var r=e.pendingProps,s=wt.current,i=!1,l=(e.flags&128)!==0,o;if((o=l)||(o=t!==null&&t.memoizedState===null?!1:(s&2)!==0),o?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),ft(wt,s&1),t===null)return mm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(l=r.children,t=r.fallback,i?(r=e.mode,i=e.child,l={mode:"hidden",children:l},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=l):i=Oh(l,r,0,null),t=hl(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=jm(n),e.memoizedState=km,t):Vx(e,l));if(s=t.memoizedState,s!==null&&(o=s.dehydrated,o!==null))return U3(t,e,l,r,o,s,n);if(i){i=r.fallback,l=e.mode,s=t.child,o=s.sibling;var c={mode:"hidden",children:r.children};return!(l&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Ai(s,c),r.subtreeFlags=s.subtreeFlags&14680064),o!==null?i=Ai(o,i):(i=hl(i,l,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,l=t.child.memoizedState,l=l===null?jm(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},i.memoizedState=l,i.childLanes=t.childLanes&~n,e.memoizedState=km,r}return i=t.child,t=i.sibling,r=Ai(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Vx(t,e){return e=Oh({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Su(t,e,n,r){return r!==null&&Mx(r),Oa(e,t.child,null,n),t=Vx(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function U3(t,e,n,r,s,i,l){if(n)return e.flags&256?(e.flags&=-257,r=Hf(Error(oe(422))),Su(t,e,l,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Oh({mode:"visible",children:r.children},s,0,null),i=hl(i,s,l,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&Oa(e,t.child,null,l),e.child.memoizedState=jm(l),e.memoizedState=km,i);if(!(e.mode&1))return Su(t,e,l,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var o=r.dgst;return r=o,i=Error(oe(419)),r=Hf(i,r,void 0),Su(t,e,l,r)}if(o=(l&t.childLanes)!==0,Hn||o){if(r=Yt,r!==null){switch(l&-l){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|l)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Fs(t,s),Br(r,t,s,-1))}return Jx(),r=Hf(Error(oe(421))),Su(t,e,l,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=tP.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,tr=ji(s.nextSibling),rr=e,bt=!0,Or=null,t!==null&&(fr[pr++]=Es,fr[pr++]=Ps,fr[pr++]=gl,Es=t.id,Ps=t.overflow,gl=e),e=Vx(e,r.children),e.flags|=4096,e)}function fb(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),gm(t.return,e,n)}function qf(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function Fj(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Nn(t,e,r.children,n),r=wt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&fb(t,n,e);else if(t.tag===19)fb(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ft(wt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Kd(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),qf(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Kd(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}qf(e,!0,n,null,i);break;case"together":qf(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function dd(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Bs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),yl|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(oe(153));if(e.child!==null){for(t=e.child,n=Ai(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Ai(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function H3(t,e,n){switch(e.tag){case 3:Oj(e),La();break;case 5:uj(e);break;case 1:Vn(e.type)&&$d(e);break;case 4:Ix(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ft(qd,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ft(wt,wt.current&1),e.flags|=128,null):n&e.child.childLanes?Ij(t,e,n):(ft(wt,wt.current&1),t=Bs(t,e,n),t!==null?t.sibling:null);ft(wt,wt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Fj(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ft(wt,wt.current),r)break;return null;case 22:case 23:return e.lanes=0,Dj(t,e,n)}return Bs(t,e,n)}var Bj,Sm,zj,$j;Bj=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Sm=function(){};zj=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Zi(ds.current);var i=null;switch(n){case"input":s=Wp(t,s),r=Wp(t,r),i=[];break;case"select":s=St({},s,{value:void 0}),r=St({},r,{value:void 0}),i=[];break;case"textarea":s=Gp(t,s),r=Gp(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Bd)}Jp(n,r);var l;n=null;for(u in s)if(!r.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var o=s[u];for(l in o)o.hasOwnProperty(l)&&(n||(n={}),n[l]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(lc.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in r){var c=r[u];if(o=s!=null?s[u]:void 0,r.hasOwnProperty(u)&&c!==o&&(c!=null||o!=null))if(u==="style")if(o){for(l in o)!o.hasOwnProperty(l)||c&&c.hasOwnProperty(l)||(n||(n={}),n[l]="");for(l in c)c.hasOwnProperty(l)&&o[l]!==c[l]&&(n||(n={}),n[l]=c[l])}else n||(i||(i=[]),i.push(u,n)),n=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,o=o?o.__html:void 0,c!=null&&o!==c&&(i=i||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(i=i||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(lc.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&pt("scroll",t),i||o===c||(i=[])):(i=i||[]).push(u,c))}n&&(i=i||[]).push("style",n);var u=i;(e.updateQueue=u)&&(e.flags|=4)}};$j=function(t,e,n,r){n!==r&&(e.flags|=4)};function yo(t,e){if(!bt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function un(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function q3(t,e,n){var r=e.pendingProps;switch(_x(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return un(e),null;case 1:return Vn(e.type)&&zd(),un(e),null;case 3:return r=e.stateNode,Ia(),xt(qn),xt(vn),Bx(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ku(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Or!==null&&(Tm(Or),Or=null))),Sm(t,e),un(e),null;case 5:Fx(e);var s=Zi(yc.current);if(n=e.type,t!==null&&e.stateNode!=null)zj(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(oe(166));return un(e),null}if(t=Zi(ds.current),ku(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[ss]=e,r[gc]=i,t=(e.mode&1)!==0,n){case"dialog":pt("cancel",r),pt("close",r);break;case"iframe":case"object":case"embed":pt("load",r);break;case"video":case"audio":for(s=0;s<Lo.length;s++)pt(Lo[s],r);break;case"source":pt("error",r);break;case"img":case"image":case"link":pt("error",r),pt("load",r);break;case"details":pt("toggle",r);break;case"input":ky(r,i),pt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},pt("invalid",r);break;case"textarea":Sy(r,i),pt("invalid",r)}Jp(n,i),s=null;for(var l in i)if(i.hasOwnProperty(l)){var o=i[l];l==="children"?typeof o=="string"?r.textContent!==o&&(i.suppressHydrationWarning!==!0&&wu(r.textContent,o,t),s=["children",o]):typeof o=="number"&&r.textContent!==""+o&&(i.suppressHydrationWarning!==!0&&wu(r.textContent,o,t),s=["children",""+o]):lc.hasOwnProperty(l)&&o!=null&&l==="onScroll"&&pt("scroll",r)}switch(n){case"input":fu(r),jy(r,i,!0);break;case"textarea":fu(r),Ny(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Bd)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{l=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=mk(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=l.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=l.createElement(n,{is:r.is}):(t=l.createElement(n),n==="select"&&(l=t,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):t=l.createElementNS(t,n),t[ss]=e,t[gc]=r,Bj(t,e,!1,!1),e.stateNode=t;e:{switch(l=Yp(n,r),n){case"dialog":pt("cancel",t),pt("close",t),s=r;break;case"iframe":case"object":case"embed":pt("load",t),s=r;break;case"video":case"audio":for(s=0;s<Lo.length;s++)pt(Lo[s],t);s=r;break;case"source":pt("error",t),s=r;break;case"img":case"image":case"link":pt("error",t),pt("load",t),s=r;break;case"details":pt("toggle",t),s=r;break;case"input":ky(t,r),s=Wp(t,r),pt("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=St({},r,{value:void 0}),pt("invalid",t);break;case"textarea":Sy(t,r),s=Gp(t,r),pt("invalid",t);break;default:s=r}Jp(n,s),o=s;for(i in o)if(o.hasOwnProperty(i)){var c=o[i];i==="style"?yk(t,c):i==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&gk(t,c)):i==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&ac(t,c):typeof c=="number"&&ac(t,""+c):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(lc.hasOwnProperty(i)?c!=null&&i==="onScroll"&&pt("scroll",t):c!=null&&mx(t,i,c,l))}switch(n){case"input":fu(t),jy(t,r,!1);break;case"textarea":fu(t),Ny(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Mi(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?ca(t,!!r.multiple,i,!1):r.defaultValue!=null&&ca(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Bd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return un(e),null;case 6:if(t&&e.stateNode!=null)$j(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(oe(166));if(n=Zi(yc.current),Zi(ds.current),ku(e)){if(r=e.stateNode,n=e.memoizedProps,r[ss]=e,(i=r.nodeValue!==n)&&(t=rr,t!==null))switch(t.tag){case 3:wu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&wu(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ss]=e,e.stateNode=r}return un(e),null;case 13:if(xt(wt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(bt&&tr!==null&&e.mode&1&&!(e.flags&128))ij(),La(),e.flags|=98560,i=!1;else if(i=ku(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(oe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(oe(317));i[ss]=e}else La(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;un(e),i=!1}else Or!==null&&(Tm(Or),Or=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||wt.current&1?Ut===0&&(Ut=3):Jx())),e.updateQueue!==null&&(e.flags|=4),un(e),null);case 4:return Ia(),Sm(t,e),t===null&&pc(e.stateNode.containerInfo),un(e),null;case 10:return Dx(e.type._context),un(e),null;case 17:return Vn(e.type)&&zd(),un(e),null;case 19:if(xt(wt),i=e.memoizedState,i===null)return un(e),null;if(r=(e.flags&128)!==0,l=i.rendering,l===null)if(r)yo(i,!1);else{if(Ut!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(l=Kd(t),l!==null){for(e.flags|=128,yo(i,!1),r=l.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,l=i.alternate,l===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=l.childLanes,i.lanes=l.lanes,i.child=l.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=l.memoizedProps,i.memoizedState=l.memoizedState,i.updateQueue=l.updateQueue,i.type=l.type,t=l.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ft(wt,wt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Mt()>Ba&&(e.flags|=128,r=!0,yo(i,!1),e.lanes=4194304)}else{if(!r)if(t=Kd(l),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),yo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!l.alternate&&!bt)return un(e),null}else 2*Mt()-i.renderingStartTime>Ba&&n!==1073741824&&(e.flags|=128,r=!0,yo(i,!1),e.lanes=4194304);i.isBackwards?(l.sibling=e.child,e.child=l):(n=i.last,n!==null?n.sibling=l:e.child=l,i.last=l)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Mt(),e.sibling=null,n=wt.current,ft(wt,r?n&1|2:n&1),e):(un(e),null);case 22:case 23:return Xx(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Yn&1073741824&&(un(e),e.subtreeFlags&6&&(e.flags|=8192)):un(e),null;case 24:return null;case 25:return null}throw Error(oe(156,e.tag))}function V3(t,e){switch(_x(e),e.tag){case 1:return Vn(e.type)&&zd(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ia(),xt(qn),xt(vn),Bx(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Fx(e),null;case 13:if(xt(wt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(oe(340));La()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return xt(wt),null;case 4:return Ia(),null;case 10:return Dx(e.type._context),null;case 22:case 23:return Xx(),null;case 24:return null;default:return null}}var Nu=!1,pn=!1,W3=typeof WeakSet=="function"?WeakSet:Set,ke=null;function na(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){At(t,e,r)}else n.current=null}function Nm(t,e,n){try{n()}catch(r){At(t,e,r)}}var pb=!1;function K3(t,e){if(om=Od,t=Wk(),Ex(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var l=0,o=-1,c=-1,u=0,h=0,d=t,f=null;t:for(;;){for(var p;d!==n||s!==0&&d.nodeType!==3||(o=l+s),d!==i||r!==0&&d.nodeType!==3||(c=l+r),d.nodeType===3&&(l+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===t)break t;if(f===n&&++u===s&&(o=l),f===i&&++h===r&&(c=l),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}n=o===-1||c===-1?null:{start:o,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(cm={focusedElem:t,selectionRange:n},Od=!1,ke=e;ke!==null;)if(e=ke,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ke=t;else for(;ke!==null;){e=ke;try{var m=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var x=m.memoizedProps,v=m.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?x:Tr(e.type,x),v);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(k){At(e,e.return,k)}if(t=e.sibling,t!==null){t.return=e.return,ke=t;break}ke=e.return}return m=pb,pb=!1,m}function Qo(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Nm(e,n,i)}s=s.next}while(s!==r)}}function Dh(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Cm(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function Uj(t){var e=t.alternate;e!==null&&(t.alternate=null,Uj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ss],delete e[gc],delete e[hm],delete e[P3],delete e[_3])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function Hj(t){return t.tag===5||t.tag===3||t.tag===4}function mb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||Hj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Am(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Bd));else if(r!==4&&(t=t.child,t!==null))for(Am(t,e,n),t=t.sibling;t!==null;)Am(t,e,n),t=t.sibling}function Em(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Em(t,e,n),t=t.sibling;t!==null;)Em(t,e,n),t=t.sibling}var en=null,Lr=!1;function Ws(t,e,n){for(n=n.child;n!==null;)qj(t,e,n),n=n.sibling}function qj(t,e,n){if(us&&typeof us.onCommitFiberUnmount=="function")try{us.onCommitFiberUnmount(Ch,n)}catch{}switch(n.tag){case 5:pn||na(n,e);case 6:var r=en,s=Lr;en=null,Ws(t,e,n),en=r,Lr=s,en!==null&&(Lr?(t=en,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):en.removeChild(n.stateNode));break;case 18:en!==null&&(Lr?(t=en,n=n.stateNode,t.nodeType===8?If(t.parentNode,n):t.nodeType===1&&If(t,n),dc(t)):If(en,n.stateNode));break;case 4:r=en,s=Lr,en=n.stateNode.containerInfo,Lr=!0,Ws(t,e,n),en=r,Lr=s;break;case 0:case 11:case 14:case 15:if(!pn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,l=i.destroy;i=i.tag,l!==void 0&&(i&2||i&4)&&Nm(n,e,l),s=s.next}while(s!==r)}Ws(t,e,n);break;case 1:if(!pn&&(na(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(o){At(n,e,o)}Ws(t,e,n);break;case 21:Ws(t,e,n);break;case 22:n.mode&1?(pn=(r=pn)||n.memoizedState!==null,Ws(t,e,n),pn=r):Ws(t,e,n);break;default:Ws(t,e,n)}}function gb(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new W3),e.forEach(function(r){var s=nP.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Mr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,l=e,o=l;e:for(;o!==null;){switch(o.tag){case 5:en=o.stateNode,Lr=!1;break e;case 3:en=o.stateNode.containerInfo,Lr=!0;break e;case 4:en=o.stateNode.containerInfo,Lr=!0;break e}o=o.return}if(en===null)throw Error(oe(160));qj(i,l,s),en=null,Lr=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){At(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)Vj(e,t),e=e.sibling}function Vj(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Mr(e,t),Qr(t),r&4){try{Qo(3,t,t.return),Dh(3,t)}catch(x){At(t,t.return,x)}try{Qo(5,t,t.return)}catch(x){At(t,t.return,x)}}break;case 1:Mr(e,t),Qr(t),r&512&&n!==null&&na(n,n.return);break;case 5:if(Mr(e,t),Qr(t),r&512&&n!==null&&na(n,n.return),t.flags&32){var s=t.stateNode;try{ac(s,"")}catch(x){At(t,t.return,x)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,l=n!==null?n.memoizedProps:i,o=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{o==="input"&&i.type==="radio"&&i.name!=null&&fk(s,i),Yp(o,l);var u=Yp(o,i);for(l=0;l<c.length;l+=2){var h=c[l],d=c[l+1];h==="style"?yk(s,d):h==="dangerouslySetInnerHTML"?gk(s,d):h==="children"?ac(s,d):mx(s,h,d,u)}switch(o){case"input":Kp(s,i);break;case"textarea":pk(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?ca(s,!!i.multiple,p,!1):f!==!!i.multiple&&(i.defaultValue!=null?ca(s,!!i.multiple,i.defaultValue,!0):ca(s,!!i.multiple,i.multiple?[]:"",!1))}s[gc]=i}catch(x){At(t,t.return,x)}}break;case 6:if(Mr(e,t),Qr(t),r&4){if(t.stateNode===null)throw Error(oe(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(x){At(t,t.return,x)}}break;case 3:if(Mr(e,t),Qr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{dc(e.containerInfo)}catch(x){At(t,t.return,x)}break;case 4:Mr(e,t),Qr(t);break;case 13:Mr(e,t),Qr(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(Qx=Mt())),r&4&&gb(t);break;case 22:if(h=n!==null&&n.memoizedState!==null,t.mode&1?(pn=(u=pn)||h,Mr(e,t),pn=u):Mr(e,t),Qr(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!h&&t.mode&1)for(ke=t,h=t.child;h!==null;){for(d=ke=h;ke!==null;){switch(f=ke,p=f.child,f.tag){case 0:case 11:case 14:case 15:Qo(4,f,f.return);break;case 1:na(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(x){At(r,n,x)}}break;case 5:na(f,f.return);break;case 22:if(f.memoizedState!==null){yb(d);continue}}p!==null?(p.return=f,ke=p):yb(d)}h=h.sibling}e:for(h=null,d=t;;){if(d.tag===5){if(h===null){h=d;try{s=d.stateNode,u?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(o=d.stateNode,c=d.memoizedProps.style,l=c!=null&&c.hasOwnProperty("display")?c.display:null,o.style.display=xk("display",l))}catch(x){At(t,t.return,x)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(x){At(t,t.return,x)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Mr(e,t),Qr(t),r&4&&gb(t);break;case 21:break;default:Mr(e,t),Qr(t)}}function Qr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(Hj(n)){var r=n;break e}n=n.return}throw Error(oe(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(ac(s,""),r.flags&=-33);var i=mb(t);Em(t,i,s);break;case 3:case 4:var l=r.stateNode.containerInfo,o=mb(t);Am(t,o,l);break;default:throw Error(oe(161))}}catch(c){At(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Q3(t,e,n){ke=t,Wj(t)}function Wj(t,e,n){for(var r=(t.mode&1)!==0;ke!==null;){var s=ke,i=s.child;if(s.tag===22&&r){var l=s.memoizedState!==null||Nu;if(!l){var o=s.alternate,c=o!==null&&o.memoizedState!==null||pn;o=Nu;var u=pn;if(Nu=l,(pn=c)&&!u)for(ke=s;ke!==null;)l=ke,c=l.child,l.tag===22&&l.memoizedState!==null?bb(s):c!==null?(c.return=l,ke=c):bb(s);for(;i!==null;)ke=i,Wj(i),i=i.sibling;ke=s,Nu=o,pn=u}xb(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,ke=i):xb(t)}}function xb(t){for(;ke!==null;){var e=ke;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:pn||Dh(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!pn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Tr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&tb(e,i,r);break;case 3:var l=e.updateQueue;if(l!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}tb(e,l,n)}break;case 5:var o=e.stateNode;if(n===null&&e.flags&4){n=o;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&dc(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}pn||e.flags&512&&Cm(e)}catch(f){At(e,e.return,f)}}if(e===t){ke=null;break}if(n=e.sibling,n!==null){n.return=e.return,ke=n;break}ke=e.return}}function yb(t){for(;ke!==null;){var e=ke;if(e===t){ke=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ke=n;break}ke=e.return}}function bb(t){for(;ke!==null;){var e=ke;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Dh(4,e)}catch(c){At(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){At(e,s,c)}}var i=e.return;try{Cm(e)}catch(c){At(e,i,c)}break;case 5:var l=e.return;try{Cm(e)}catch(c){At(e,l,c)}}}catch(c){At(e,e.return,c)}if(e===t){ke=null;break}var o=e.sibling;if(o!==null){o.return=e.return,ke=o;break}ke=e.return}}var G3=Math.ceil,Xd=$s.ReactCurrentDispatcher,Wx=$s.ReactCurrentOwner,wr=$s.ReactCurrentBatchConfig,Xe=0,Yt=null,Ot=null,an=0,Yn=0,ra=Bi(0),Ut=0,kc=null,yl=0,Lh=0,Kx=0,Go=null,$n=null,Qx=0,Ba=1/0,ks=null,Jd=!1,Pm=null,Ni=null,Cu=!1,mi=null,Yd=0,Xo=0,_m=null,hd=-1,fd=0;function _n(){return Xe&6?Mt():hd!==-1?hd:hd=Mt()}function Ci(t){return t.mode&1?Xe&2&&an!==0?an&-an:T3.transition!==null?(fd===0&&(fd=_k()),fd):(t=st,t!==0||(t=window.event,t=t===void 0?16:Ik(t.type)),t):1}function Br(t,e,n,r){if(50<Xo)throw Xo=0,_m=null,Error(oe(185));Kc(t,n,r),(!(Xe&2)||t!==Yt)&&(t===Yt&&(!(Xe&2)&&(Lh|=n),Ut===4&&ri(t,an)),Wn(t,r),n===1&&Xe===0&&!(e.mode&1)&&(Ba=Mt()+500,Mh&&zi()))}function Wn(t,e){var n=t.callbackNode;TE(t,e);var r=Ld(t,t===Yt?an:0);if(r===0)n!==null&&Ey(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Ey(n),e===1)t.tag===0?M3(vb.bind(null,t)):nj(vb.bind(null,t)),A3(function(){!(Xe&6)&&zi()}),n=null;else{switch(Mk(r)){case 1:n=vx;break;case 4:n=Ek;break;case 16:n=Dd;break;case 536870912:n=Pk;break;default:n=Dd}n=e2(n,Kj.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Kj(t,e){if(hd=-1,fd=0,Xe&6)throw Error(oe(327));var n=t.callbackNode;if(pa()&&t.callbackNode!==n)return null;var r=Ld(t,t===Yt?an:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Zd(t,r);else{e=r;var s=Xe;Xe|=2;var i=Gj();(Yt!==t||an!==e)&&(ks=null,Ba=Mt()+500,dl(t,e));do try{Y3();break}catch(o){Qj(t,o)}while(!0);Rx(),Xd.current=i,Xe=s,Ot!==null?e=0:(Yt=null,an=0,e=Ut)}if(e!==0){if(e===2&&(s=rm(t),s!==0&&(r=s,e=Mm(t,s))),e===1)throw n=kc,dl(t,0),ri(t,r),Wn(t,Mt()),n;if(e===6)ri(t,r);else{if(s=t.current.alternate,!(r&30)&&!X3(s)&&(e=Zd(t,r),e===2&&(i=rm(t),i!==0&&(r=i,e=Mm(t,i))),e===1))throw n=kc,dl(t,0),ri(t,r),Wn(t,Mt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(oe(345));case 2:Qi(t,$n,ks);break;case 3:if(ri(t,r),(r&130023424)===r&&(e=Qx+500-Mt(),10<e)){if(Ld(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){_n(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=dm(Qi.bind(null,t,$n,ks),e);break}Qi(t,$n,ks);break;case 4:if(ri(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var l=31-Fr(r);i=1<<l,l=e[l],l>s&&(s=l),r&=~i}if(r=s,r=Mt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*G3(r/1960))-r,10<r){t.timeoutHandle=dm(Qi.bind(null,t,$n,ks),r);break}Qi(t,$n,ks);break;case 5:Qi(t,$n,ks);break;default:throw Error(oe(329))}}}return Wn(t,Mt()),t.callbackNode===n?Kj.bind(null,t):null}function Mm(t,e){var n=Go;return t.current.memoizedState.isDehydrated&&(dl(t,e).flags|=256),t=Zd(t,e),t!==2&&(e=$n,$n=n,e!==null&&Tm(e)),t}function Tm(t){$n===null?$n=t:$n.push.apply($n,t)}function X3(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!$r(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ri(t,e){for(e&=~Kx,e&=~Lh,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fr(e),r=1<<n;t[n]=-1,e&=~r}}function vb(t){if(Xe&6)throw Error(oe(327));pa();var e=Ld(t,0);if(!(e&1))return Wn(t,Mt()),null;var n=Zd(t,e);if(t.tag!==0&&n===2){var r=rm(t);r!==0&&(e=r,n=Mm(t,r))}if(n===1)throw n=kc,dl(t,0),ri(t,e),Wn(t,Mt()),n;if(n===6)throw Error(oe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Qi(t,$n,ks),Wn(t,Mt()),null}function Gx(t,e){var n=Xe;Xe|=1;try{return t(e)}finally{Xe=n,Xe===0&&(Ba=Mt()+500,Mh&&zi())}}function bl(t){mi!==null&&mi.tag===0&&!(Xe&6)&&pa();var e=Xe;Xe|=1;var n=wr.transition,r=st;try{if(wr.transition=null,st=1,t)return t()}finally{st=r,wr.transition=n,Xe=e,!(Xe&6)&&zi()}}function Xx(){Yn=ra.current,xt(ra)}function dl(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,C3(n)),Ot!==null)for(n=Ot.return;n!==null;){var r=n;switch(_x(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&zd();break;case 3:Ia(),xt(qn),xt(vn),Bx();break;case 5:Fx(r);break;case 4:Ia();break;case 13:xt(wt);break;case 19:xt(wt);break;case 10:Dx(r.type._context);break;case 22:case 23:Xx()}n=n.return}if(Yt=t,Ot=t=Ai(t.current,null),an=Yn=e,Ut=0,kc=null,Kx=Lh=yl=0,$n=Go=null,Yi!==null){for(e=0;e<Yi.length;e++)if(n=Yi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var l=i.next;i.next=s,r.next=l}n.pending=r}Yi=null}return t}function Qj(t,e){do{var n=Ot;try{if(Rx(),cd.current=Gd,Qd){for(var r=jt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Qd=!1}if(xl=0,Gt=zt=jt=null,Ko=!1,bc=0,Wx.current=null,n===null||n.return===null){Ut=1,kc=e,Ot=null;break}e:{var i=t,l=n.return,o=n,c=e;if(e=an,o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=o,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=ab(l);if(p!==null){p.flags&=-257,ob(p,l,o,i,e),p.mode&1&&lb(i,u,e),e=p,c=u;var m=e.updateQueue;if(m===null){var x=new Set;x.add(c),e.updateQueue=x}else m.add(c);break e}else{if(!(e&1)){lb(i,u,e),Jx();break e}c=Error(oe(426))}}else if(bt&&o.mode&1){var v=ab(l);if(v!==null){!(v.flags&65536)&&(v.flags|=256),ob(v,l,o,i,e),Mx(Fa(c,o));break e}}i=c=Fa(c,o),Ut!==4&&(Ut=2),Go===null?Go=[i]:Go.push(i),i=l;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var g=Mj(i,c,e);eb(i,g);break e;case 1:o=c;var y=i.type,b=i.stateNode;if(!(i.flags&128)&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Ni===null||!Ni.has(b)))){i.flags|=65536,e&=-e,i.lanes|=e;var k=Tj(i,o,e);eb(i,k);break e}}i=i.return}while(i!==null)}Jj(n)}catch(S){e=S,Ot===n&&n!==null&&(Ot=n=n.return);continue}break}while(!0)}function Gj(){var t=Xd.current;return Xd.current=Gd,t===null?Gd:t}function Jx(){(Ut===0||Ut===3||Ut===2)&&(Ut=4),Yt===null||!(yl&268435455)&&!(Lh&268435455)||ri(Yt,an)}function Zd(t,e){var n=Xe;Xe|=2;var r=Gj();(Yt!==t||an!==e)&&(ks=null,dl(t,e));do try{J3();break}catch(s){Qj(t,s)}while(!0);if(Rx(),Xe=n,Xd.current=r,Ot!==null)throw Error(oe(261));return Yt=null,an=0,Ut}function J3(){for(;Ot!==null;)Xj(Ot)}function Y3(){for(;Ot!==null&&!jE();)Xj(Ot)}function Xj(t){var e=Zj(t.alternate,t,Yn);t.memoizedProps=t.pendingProps,e===null?Jj(t):Ot=e,Wx.current=null}function Jj(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=V3(n,e),n!==null){n.flags&=32767,Ot=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ut=6,Ot=null;return}}else if(n=q3(n,e,Yn),n!==null){Ot=n;return}if(e=e.sibling,e!==null){Ot=e;return}Ot=e=t}while(e!==null);Ut===0&&(Ut=5)}function Qi(t,e,n){var r=st,s=wr.transition;try{wr.transition=null,st=1,Z3(t,e,n,r)}finally{wr.transition=s,st=r}return null}function Z3(t,e,n,r){do pa();while(mi!==null);if(Xe&6)throw Error(oe(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(oe(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(RE(t,i),t===Yt&&(Ot=Yt=null,an=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Cu||(Cu=!0,e2(Dd,function(){return pa(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=wr.transition,wr.transition=null;var l=st;st=1;var o=Xe;Xe|=4,Wx.current=null,K3(t,n),Vj(n,t),b3(cm),Od=!!om,cm=om=null,t.current=n,Q3(n),SE(),Xe=o,st=l,wr.transition=i}else t.current=n;if(Cu&&(Cu=!1,mi=t,Yd=s),i=t.pendingLanes,i===0&&(Ni=null),AE(n.stateNode),Wn(t,Mt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(Jd)throw Jd=!1,t=Pm,Pm=null,t;return Yd&1&&t.tag!==0&&pa(),i=t.pendingLanes,i&1?t===_m?Xo++:(Xo=0,_m=t):Xo=0,zi(),null}function pa(){if(mi!==null){var t=Mk(Yd),e=wr.transition,n=st;try{if(wr.transition=null,st=16>t?16:t,mi===null)var r=!1;else{if(t=mi,mi=null,Yd=0,Xe&6)throw Error(oe(331));var s=Xe;for(Xe|=4,ke=t.current;ke!==null;){var i=ke,l=i.child;if(ke.flags&16){var o=i.deletions;if(o!==null){for(var c=0;c<o.length;c++){var u=o[c];for(ke=u;ke!==null;){var h=ke;switch(h.tag){case 0:case 11:case 15:Qo(8,h,i)}var d=h.child;if(d!==null)d.return=h,ke=d;else for(;ke!==null;){h=ke;var f=h.sibling,p=h.return;if(Uj(h),h===u){ke=null;break}if(f!==null){f.return=p,ke=f;break}ke=p}}}var m=i.alternate;if(m!==null){var x=m.child;if(x!==null){m.child=null;do{var v=x.sibling;x.sibling=null,x=v}while(x!==null)}}ke=i}}if(i.subtreeFlags&2064&&l!==null)l.return=i,ke=l;else e:for(;ke!==null;){if(i=ke,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Qo(9,i,i.return)}var g=i.sibling;if(g!==null){g.return=i.return,ke=g;break e}ke=i.return}}var y=t.current;for(ke=y;ke!==null;){l=ke;var b=l.child;if(l.subtreeFlags&2064&&b!==null)b.return=l,ke=b;else e:for(l=y;ke!==null;){if(o=ke,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Dh(9,o)}}catch(S){At(o,o.return,S)}if(o===l){ke=null;break e}var k=o.sibling;if(k!==null){k.return=o.return,ke=k;break e}ke=o.return}}if(Xe=s,zi(),us&&typeof us.onPostCommitFiberRoot=="function")try{us.onPostCommitFiberRoot(Ch,t)}catch{}r=!0}return r}finally{st=n,wr.transition=e}}return!1}function wb(t,e,n){e=Fa(n,e),e=Mj(t,e,1),t=Si(t,e,1),e=_n(),t!==null&&(Kc(t,1,e),Wn(t,e))}function At(t,e,n){if(t.tag===3)wb(t,t,n);else for(;e!==null;){if(e.tag===3){wb(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Ni===null||!Ni.has(r))){t=Fa(n,t),t=Tj(e,t,1),e=Si(e,t,1),t=_n(),e!==null&&(Kc(e,1,t),Wn(e,t));break}}e=e.return}}function eP(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=_n(),t.pingedLanes|=t.suspendedLanes&n,Yt===t&&(an&n)===n&&(Ut===4||Ut===3&&(an&130023424)===an&&500>Mt()-Qx?dl(t,0):Kx|=n),Wn(t,e)}function Yj(t,e){e===0&&(t.mode&1?(e=gu,gu<<=1,!(gu&130023424)&&(gu=4194304)):e=1);var n=_n();t=Fs(t,e),t!==null&&(Kc(t,e,n),Wn(t,n))}function tP(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),Yj(t,n)}function nP(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(oe(314))}r!==null&&r.delete(e),Yj(t,n)}var Zj;Zj=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||qn.current)Hn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Hn=!1,H3(t,e,n);Hn=!!(t.flags&131072)}else Hn=!1,bt&&e.flags&1048576&&rj(e,Hd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;dd(t,e),t=e.pendingProps;var s=Da(e,vn.current);fa(e,n),s=$x(null,e,r,t,s,n);var i=Ux();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Vn(r)?(i=!0,$d(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Ox(e),s.updater=Rh,e.stateNode=s,s._reactInternals=e,ym(e,r,t,n),e=wm(null,e,r,!0,i,n)):(e.tag=0,bt&&i&&Px(e),Nn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(dd(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=sP(r),t=Tr(r,t),s){case 0:e=vm(null,e,r,t,n);break e;case 1:e=db(null,e,r,t,n);break e;case 11:e=cb(null,e,r,t,n);break e;case 14:e=ub(null,e,r,Tr(r.type,t),n);break e}throw Error(oe(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),vm(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),db(t,e,r,s,n);case 3:e:{if(Oj(e),t===null)throw Error(oe(387));r=e.pendingProps,i=e.memoizedState,s=i.element,cj(t,e),Wd(e,r,null,n);var l=e.memoizedState;if(r=l.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:l.cache,pendingSuspenseBoundaries:l.pendingSuspenseBoundaries,transitions:l.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=Fa(Error(oe(423)),e),e=hb(t,e,r,n,s);break e}else if(r!==s){s=Fa(Error(oe(424)),e),e=hb(t,e,r,n,s);break e}else for(tr=ji(e.stateNode.containerInfo.firstChild),rr=e,bt=!0,Or=null,n=aj(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(La(),r===s){e=Bs(t,e,n);break e}Nn(t,e,r,n)}e=e.child}return e;case 5:return uj(e),t===null&&mm(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,l=s.children,um(r,s)?l=null:i!==null&&um(r,i)&&(e.flags|=32),Lj(t,e),Nn(t,e,l,n),e.child;case 6:return t===null&&mm(e),null;case 13:return Ij(t,e,n);case 4:return Ix(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Oa(e,null,r,n):Nn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),cb(t,e,r,s,n);case 7:return Nn(t,e,e.pendingProps,n),e.child;case 8:return Nn(t,e,e.pendingProps.children,n),e.child;case 12:return Nn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,l=s.value,ft(qd,r._currentValue),r._currentValue=l,i!==null)if($r(i.value,l)){if(i.children===s.children&&!qn.current){e=Bs(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var o=i.dependencies;if(o!==null){l=i.child;for(var c=o.firstContext;c!==null;){if(c.context===r){if(i.tag===1){c=Ms(-1,n&-n),c.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}i.lanes|=n,c=i.alternate,c!==null&&(c.lanes|=n),gm(i.return,n,e),o.lanes|=n;break}c=c.next}}else if(i.tag===10)l=i.type===e.type?null:i.child;else if(i.tag===18){if(l=i.return,l===null)throw Error(oe(341));l.lanes|=n,o=l.alternate,o!==null&&(o.lanes|=n),gm(l,n,e),l=i.sibling}else l=i.child;if(l!==null)l.return=i;else for(l=i;l!==null;){if(l===e){l=null;break}if(i=l.sibling,i!==null){i.return=l.return,l=i;break}l=l.return}i=l}Nn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,fa(e,n),s=Cr(s),r=r(s),e.flags|=1,Nn(t,e,r,n),e.child;case 14:return r=e.type,s=Tr(r,e.pendingProps),s=Tr(r.type,s),ub(t,e,r,s,n);case 15:return Rj(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),dd(t,e),e.tag=1,Vn(r)?(t=!0,$d(e)):t=!1,fa(e,n),_j(e,r,s),ym(e,r,s,n),wm(null,e,r,!0,t,n);case 19:return Fj(t,e,n);case 22:return Dj(t,e,n)}throw Error(oe(156,e.tag))};function e2(t,e){return Ak(t,e)}function rP(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function br(t,e,n,r){return new rP(t,e,n,r)}function Yx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function sP(t){if(typeof t=="function")return Yx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===xx)return 11;if(t===yx)return 14}return 2}function Ai(t,e){var n=t.alternate;return n===null?(n=br(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function pd(t,e,n,r,s,i){var l=2;if(r=t,typeof t=="function")Yx(t)&&(l=1);else if(typeof t=="string")l=5;else e:switch(t){case Kl:return hl(n.children,s,i,e);case gx:l=8,s|=8;break;case Up:return t=br(12,n,e,s|2),t.elementType=Up,t.lanes=i,t;case Hp:return t=br(13,n,e,s),t.elementType=Hp,t.lanes=i,t;case qp:return t=br(19,n,e,s),t.elementType=qp,t.lanes=i,t;case uk:return Oh(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case ok:l=10;break e;case ck:l=9;break e;case xx:l=11;break e;case yx:l=14;break e;case Ys:l=16,r=null;break e}throw Error(oe(130,t==null?t:typeof t,""))}return e=br(l,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function hl(t,e,n,r){return t=br(7,t,r,e),t.lanes=n,t}function Oh(t,e,n,r){return t=br(22,t,r,e),t.elementType=uk,t.lanes=n,t.stateNode={isHidden:!1},t}function Vf(t,e,n){return t=br(6,t,null,e),t.lanes=n,t}function Wf(t,e,n){return e=br(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function iP(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cf(0),this.expirationTimes=Cf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cf(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Zx(t,e,n,r,s,i,l,o,c){return t=new iP(t,e,n,o,c),e===1?(e=1,i===!0&&(e|=8)):e=0,i=br(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ox(i),t}function lP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wl,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function t2(t){if(!t)return Ti;t=t._reactInternals;e:{if(Ml(t)!==t||t.tag!==1)throw Error(oe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Vn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(oe(171))}if(t.tag===1){var n=t.type;if(Vn(n))return tj(t,n,e)}return e}function n2(t,e,n,r,s,i,l,o,c){return t=Zx(n,r,!0,t,s,i,l,o,c),t.context=t2(null),n=t.current,r=_n(),s=Ci(n),i=Ms(r,s),i.callback=e??null,Si(n,i,s),t.current.lanes=s,Kc(t,s,r),Wn(t,r),t}function Ih(t,e,n,r){var s=e.current,i=_n(),l=Ci(s);return n=t2(n),e.context===null?e.context=n:e.pendingContext=n,e=Ms(i,l),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Si(s,e,l),t!==null&&(Br(t,s,l,i),od(t,s,l)),l}function eh(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function kb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function e0(t,e){kb(t,e),(t=t.alternate)&&kb(t,e)}function aP(){return null}var r2=typeof reportError=="function"?reportError:function(t){console.error(t)};function t0(t){this._internalRoot=t}Fh.prototype.render=t0.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(oe(409));Ih(t,e,null,null)};Fh.prototype.unmount=t0.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;bl(function(){Ih(null,t,null,null)}),e[Is]=null}};function Fh(t){this._internalRoot=t}Fh.prototype.unstable_scheduleHydration=function(t){if(t){var e=Dk();t={blockedOn:null,target:t,priority:e};for(var n=0;n<ni.length&&e!==0&&e<ni[n].priority;n++);ni.splice(n,0,t),n===0&&Ok(t)}};function n0(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Bh(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function jb(){}function oP(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var u=eh(l);i.call(u)}}var l=n2(e,r,t,0,null,!1,!1,"",jb);return t._reactRootContainer=l,t[Is]=l.current,pc(t.nodeType===8?t.parentNode:t),bl(),l}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var o=r;r=function(){var u=eh(c);o.call(u)}}var c=Zx(t,0,!1,null,null,!1,!1,"",jb);return t._reactRootContainer=c,t[Is]=c.current,pc(t.nodeType===8?t.parentNode:t),bl(function(){Ih(e,c,n,r)}),c}function zh(t,e,n,r,s){var i=n._reactRootContainer;if(i){var l=i;if(typeof s=="function"){var o=s;s=function(){var c=eh(l);o.call(c)}}Ih(e,l,t,s)}else l=oP(n,e,t,s,r);return eh(l)}Tk=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Do(e.pendingLanes);n!==0&&(wx(e,n|1),Wn(e,Mt()),!(Xe&6)&&(Ba=Mt()+500,zi()))}break;case 13:bl(function(){var r=Fs(t,1);if(r!==null){var s=_n();Br(r,t,1,s)}}),e0(t,1)}};kx=function(t){if(t.tag===13){var e=Fs(t,134217728);if(e!==null){var n=_n();Br(e,t,134217728,n)}e0(t,134217728)}};Rk=function(t){if(t.tag===13){var e=Ci(t),n=Fs(t,e);if(n!==null){var r=_n();Br(n,t,e,r)}e0(t,e)}};Dk=function(){return st};Lk=function(t,e){var n=st;try{return st=t,e()}finally{st=n}};em=function(t,e,n){switch(e){case"input":if(Kp(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=_h(r);if(!s)throw Error(oe(90));hk(r),Kp(r,s)}}}break;case"textarea":pk(t,n);break;case"select":e=n.value,e!=null&&ca(t,!!n.multiple,e,!1)}};wk=Gx;kk=bl;var cP={usingClientEntryPoint:!1,Events:[Gc,Jl,_h,bk,vk,Gx]},bo={findFiberByHostInstance:Ji,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},uP={bundleType:bo.bundleType,version:bo.version,rendererPackageName:bo.rendererPackageName,rendererConfig:bo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:$s.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Nk(t),t===null?null:t.stateNode},findFiberByHostInstance:bo.findFiberByHostInstance||aP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Au=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Au.isDisabled&&Au.supportsFiber)try{Ch=Au.inject(uP),us=Au}catch{}}ar.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=cP;ar.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!n0(e))throw Error(oe(200));return lP(t,e,null,n)};ar.createRoot=function(t,e){if(!n0(t))throw Error(oe(299));var n=!1,r="",s=r2;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Zx(t,1,!1,null,null,n,!1,r,s),t[Is]=e.current,pc(t.nodeType===8?t.parentNode:t),new t0(e)};ar.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(oe(188)):(t=Object.keys(t).join(","),Error(oe(268,t)));return t=Nk(e),t=t===null?null:t.stateNode,t};ar.flushSync=function(t){return bl(t)};ar.hydrate=function(t,e,n){if(!Bh(e))throw Error(oe(200));return zh(null,t,e,!0,n)};ar.hydrateRoot=function(t,e,n){if(!n0(t))throw Error(oe(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",l=r2;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(l=n.onRecoverableError)),e=n2(e,null,t,1,n??null,s,!1,i,l),t[Is]=e.current,pc(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Fh(e)};ar.render=function(t,e,n){if(!Bh(e))throw Error(oe(200));return zh(null,t,e,!1,n)};ar.unmountComponentAtNode=function(t){if(!Bh(t))throw Error(oe(40));return t._reactRootContainer?(bl(function(){zh(null,null,t,!1,function(){t._reactRootContainer=null,t[Is]=null})}),!0):!1};ar.unstable_batchedUpdates=Gx;ar.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Bh(n))throw Error(oe(200));if(t==null||t._reactInternals===void 0)throw Error(oe(38));return zh(t,e,n,!1,r)};ar.version="18.3.1-next-f1338f8080-20240426";function s2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s2)}catch(t){console.error(t)}}s2(),sk.exports=ar;var dP=sk.exports,Sb=dP;zp.createRoot=Sb.createRoot,zp.hydrateRoot=Sb.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function jc(){return jc=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},jc.apply(this,arguments)}var el;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(el||(el={}));const Nb="popstate";function hP(t){t===void 0&&(t={});function e(r,s){let{pathname:i,search:l,hash:o}=r.location;return Rm("",{pathname:i,search:l,hash:o},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function n(r,s){return typeof s=="string"?s:th(s)}return pP(e,n,null,t)}function qt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function i2(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function fP(){return Math.random().toString(36).substr(2,8)}function Cb(t,e){return{usr:t.state,key:t.key,idx:e}}function Rm(t,e,n,r){return n===void 0&&(n=null),jc({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?Jc(e):e,{state:n,key:e&&e.key||r||fP()})}function th(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function Jc(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function pP(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:i=!1}=r,l=s.history,o=el.Pop,c=null,u=h();u==null&&(u=0,l.replaceState(jc({},l.state,{idx:u}),""));function h(){return(l.state||{idx:null}).idx}function d(){o=el.Pop;let v=h(),g=v==null?null:v-u;u=v,c&&c({action:o,location:x.location,delta:g})}function f(v,g){o=el.Push;let y=Rm(x.location,v,g);u=h()+1;let b=Cb(y,u),k=x.createHref(y);try{l.pushState(b,"",k)}catch(S){if(S instanceof DOMException&&S.name==="DataCloneError")throw S;s.location.assign(k)}i&&c&&c({action:o,location:x.location,delta:1})}function p(v,g){o=el.Replace;let y=Rm(x.location,v,g);u=h();let b=Cb(y,u),k=x.createHref(y);l.replaceState(b,"",k),i&&c&&c({action:o,location:x.location,delta:0})}function m(v){let g=s.location.origin!=="null"?s.location.origin:s.location.href,y=typeof v=="string"?v:th(v);return y=y.replace(/ $/,"%20"),qt(g,"No window.location.(origin|href) available to create URL for href: "+y),new URL(y,g)}let x={get action(){return o},get location(){return t(s,l)},listen(v){if(c)throw new Error("A history only accepts one active listener");return s.addEventListener(Nb,d),c=v,()=>{s.removeEventListener(Nb,d),c=null}},createHref(v){return e(s,v)},createURL:m,encodeLocation(v){let g=m(v);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:p,go(v){return l.go(v)}};return x}var Ab;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Ab||(Ab={}));function mP(t,e,n){return n===void 0&&(n="/"),gP(t,e,n)}function gP(t,e,n,r){let s=typeof e=="string"?Jc(e):e,i=za(s.pathname||"/",n);if(i==null)return null;let l=l2(t);xP(l);let o=null;for(let c=0;o==null&&c<l.length;++c){let u=EP(i);o=CP(l[c],u)}return o}function l2(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(i,l,o)=>{let c={relativePath:o===void 0?i.path||"":o,caseSensitive:i.caseSensitive===!0,childrenIndex:l,route:i};c.relativePath.startsWith("/")&&(qt(c.relativePath.startsWith(r),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(r.length));let u=Ei([r,c.relativePath]),h=n.concat(c);i.children&&i.children.length>0&&(qt(i.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+u+'".')),l2(i.children,e,h,u)),!(i.path==null&&!i.index)&&e.push({path:u,score:SP(u,i.index),routesMeta:h})};return t.forEach((i,l)=>{var o;if(i.path===""||!((o=i.path)!=null&&o.includes("?")))s(i,l);else for(let c of a2(i.path))s(i,l,c)}),e}function a2(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let l=a2(r.join("/")),o=[];return o.push(...l.map(c=>c===""?i:[i,c].join("/"))),s&&o.push(...l),o.map(c=>t.startsWith("/")&&c===""?"/":c)}function xP(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:NP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const yP=/^:[\w-]+$/,bP=3,vP=2,wP=1,kP=10,jP=-2,Eb=t=>t==="*";function SP(t,e){let n=t.split("/"),r=n.length;return n.some(Eb)&&(r+=jP),e&&(r+=vP),n.filter(s=>!Eb(s)).reduce((s,i)=>s+(yP.test(i)?bP:i===""?wP:kP),r)}function NP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function CP(t,e,n){let{routesMeta:r}=t,s={},i="/",l=[];for(let o=0;o<r.length;++o){let c=r[o],u=o===r.length-1,h=i==="/"?e:e.slice(i.length)||"/",d=Dm({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},h),f=c.route;if(!d)return null;Object.assign(s,d.params),l.push({params:s,pathname:Ei([i,d.pathname]),pathnameBase:TP(Ei([i,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(i=Ei([i,d.pathnameBase]))}return l}function Dm(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=AP(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],l=i.replace(/(.)\/+$/,"$1"),o=s.slice(1);return{params:r.reduce((u,h,d)=>{let{paramName:f,isOptional:p}=h;if(f==="*"){let x=o[d]||"";l=i.slice(0,i.length-x.length).replace(/(.)\/+$/,"$1")}const m=o[d];return p&&!m?u[f]=void 0:u[f]=(m||"").replace(/%2F/g,"/"),u},{}),pathname:i,pathnameBase:l,pattern:t}}function AP(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),i2(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,o,c)=>(r.push({paramName:o,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function EP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return i2(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function za(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function PP(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?Jc(t):t;return{pathname:n?n.startsWith("/")?n:_P(n,e):e,search:RP(r),hash:DP(s)}}function _P(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Kf(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function MP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function r0(t,e){let n=MP(t);return e?n.map((r,s)=>s===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function s0(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=Jc(t):(s=jc({},t),qt(!s.pathname||!s.pathname.includes("?"),Kf("?","pathname","search",s)),qt(!s.pathname||!s.pathname.includes("#"),Kf("#","pathname","hash",s)),qt(!s.search||!s.search.includes("#"),Kf("#","search","hash",s)));let i=t===""||s.pathname==="",l=i?"/":s.pathname,o;if(l==null)o=n;else{let d=e.length-1;if(!r&&l.startsWith("..")){let f=l.split("/");for(;f[0]==="..";)f.shift(),d-=1;s.pathname=f.join("/")}o=d>=0?e[d]:"/"}let c=PP(s,o),u=l&&l!=="/"&&l.endsWith("/"),h=(i||l===".")&&n.endsWith("/");return!c.pathname.endsWith("/")&&(u||h)&&(c.pathname+="/"),c}const Ei=t=>t.join("/").replace(/\/\/+/g,"/"),TP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),RP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,DP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function LP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const o2=["post","put","patch","delete"];new Set(o2);const OP=["get",...o2];new Set(OP);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nh(){return nh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},nh.apply(this,arguments)}const $h=w.createContext(null),c2=w.createContext(null),Us=w.createContext(null),i0=w.createContext(null),gs=w.createContext({outlet:null,matches:[],isDataRoute:!1}),u2=w.createContext(null);function IP(t,e){let{relative:n}=e===void 0?{}:e;eo()||qt(!1);let{basename:r,navigator:s}=w.useContext(Us),{hash:i,pathname:l,search:o}=Uh(t,{relative:n}),c=l;return r!=="/"&&(c=l==="/"?r:Ei([r,l])),s.createHref({pathname:c,search:o,hash:i})}function eo(){return w.useContext(i0)!=null}function Hs(){return eo()||qt(!1),w.useContext(i0).location}function d2(t){w.useContext(Us).static||w.useLayoutEffect(t)}function Qn(){let{isDataRoute:t}=w.useContext(gs);return t?YP():FP()}function FP(){eo()||qt(!1);let t=w.useContext($h),{basename:e,future:n,navigator:r}=w.useContext(Us),{matches:s}=w.useContext(gs),{pathname:i}=Hs(),l=JSON.stringify(r0(s,n.v7_relativeSplatPath)),o=w.useRef(!1);return d2(()=>{o.current=!0}),w.useCallback(function(u,h){if(h===void 0&&(h={}),!o.current)return;if(typeof u=="number"){r.go(u);return}let d=s0(u,JSON.parse(l),i,h.relative==="path");t==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Ei([e,d.pathname])),(h.replace?r.replace:r.push)(d,h.state,h)},[e,r,l,i,t])}const h2=w.createContext(null);function BP(){return w.useContext(h2)}function zP(t){let e=w.useContext(gs).outlet;return e&&w.createElement(h2.Provider,{value:t},e)}function $i(){let{matches:t}=w.useContext(gs),e=t[t.length-1];return e?e.params:{}}function Uh(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=w.useContext(Us),{matches:s}=w.useContext(gs),{pathname:i}=Hs(),l=JSON.stringify(r0(s,r.v7_relativeSplatPath));return w.useMemo(()=>s0(t,JSON.parse(l),i,n==="path"),[t,l,i,n])}function $P(t,e){return UP(t)}function UP(t,e,n,r){eo()||qt(!1);let{navigator:s}=w.useContext(Us),{matches:i}=w.useContext(gs),l=i[i.length-1],o=l?l.params:{};l&&l.pathname;let c=l?l.pathnameBase:"/";l&&l.route;let u=Hs(),h;h=u;let d=h.pathname||"/",f=d;if(c!=="/"){let x=c.replace(/^\//,"").split("/");f="/"+d.replace(/^\//,"").split("/").slice(x.length).join("/")}let p=mP(t,{pathname:f});return KP(p&&p.map(x=>Object.assign({},x,{params:Object.assign({},o,x.params),pathname:Ei([c,s.encodeLocation?s.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?c:Ei([c,s.encodeLocation?s.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),i,n,r)}function HP(){let t=JP(),e=LP(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return w.createElement(w.Fragment,null,w.createElement("h2",null,"Unexpected Application Error!"),w.createElement("h3",{style:{fontStyle:"italic"}},e),n?w.createElement("pre",{style:s},n):null,null)}const qP=w.createElement(HP,null);class VP extends w.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?w.createElement(gs.Provider,{value:this.props.routeContext},w.createElement(u2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function WP(t){let{routeContext:e,match:n,children:r}=t,s=w.useContext($h);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),w.createElement(gs.Provider,{value:e},r)}function KP(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var i;if(!n)return null;if(n.errors)t=n.matches;else if((i=r)!=null&&i.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,o=(s=n)==null?void 0:s.errors;if(o!=null){let h=l.findIndex(d=>d.route.id&&(o==null?void 0:o[d.route.id])!==void 0);h>=0||qt(!1),l=l.slice(0,Math.min(l.length,h+1))}let c=!1,u=-1;if(n&&r&&r.v7_partialHydration)for(let h=0;h<l.length;h++){let d=l[h];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(u=h),d.route.id){let{loaderData:f,errors:p}=n,m=d.route.loader&&f[d.route.id]===void 0&&(!p||p[d.route.id]===void 0);if(d.route.lazy||m){c=!0,u>=0?l=l.slice(0,u+1):l=[l[0]];break}}}return l.reduceRight((h,d,f)=>{let p,m=!1,x=null,v=null;n&&(p=o&&d.route.id?o[d.route.id]:void 0,x=d.route.errorElement||qP,c&&(u<0&&f===0?(ZP("route-fallback"),m=!0,v=null):u===f&&(m=!0,v=d.route.hydrateFallbackElement||null)));let g=e.concat(l.slice(0,f+1)),y=()=>{let b;return p?b=x:m?b=v:d.route.Component?b=w.createElement(d.route.Component,null):d.route.element?b=d.route.element:b=h,w.createElement(WP,{match:d,routeContext:{outlet:h,matches:g,isDataRoute:n!=null},children:b})};return n&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?w.createElement(VP,{location:n.location,revalidation:n.revalidation,component:x,error:p,children:y(),routeContext:{outlet:null,matches:g,isDataRoute:!0}}):y()},null)}var f2=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(f2||{}),p2=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(p2||{});function QP(t){let e=w.useContext($h);return e||qt(!1),e}function GP(t){let e=w.useContext(c2);return e||qt(!1),e}function XP(t){let e=w.useContext(gs);return e||qt(!1),e}function m2(t){let e=XP(),n=e.matches[e.matches.length-1];return n.route.id||qt(!1),n.route.id}function JP(){var t;let e=w.useContext(u2),n=GP(p2.UseRouteError),r=m2();return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function YP(){let{router:t}=QP(f2.UseNavigateStable),e=m2(),n=w.useRef(!1);return d2(()=>{n.current=!0}),w.useCallback(function(s,i){i===void 0&&(i={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,nh({fromRouteId:e},i)))},[t,e])}const Pb={};function ZP(t,e,n){Pb[t]||(Pb[t]=!0)}function e4(t,e){t==null||t.v7_startTransition,t==null||t.v7_relativeSplatPath}function l0(t){let{to:e,replace:n,state:r,relative:s}=t;eo()||qt(!1);let{future:i,static:l}=w.useContext(Us),{matches:o}=w.useContext(gs),{pathname:c}=Hs(),u=Qn(),h=s0(e,r0(o,i.v7_relativeSplatPath),c,s==="path"),d=JSON.stringify(h);return w.useEffect(()=>u(JSON.parse(d),{replace:n,state:r,relative:s}),[u,d,s,n,r]),null}function g2(t){return zP(t.context)}function t4(t){let{basename:e="/",children:n=null,location:r,navigationType:s=el.Pop,navigator:i,static:l=!1,future:o}=t;eo()&&qt(!1);let c=e.replace(/^\/*/,"/"),u=w.useMemo(()=>({basename:c,navigator:i,static:l,future:nh({v7_relativeSplatPath:!1},o)}),[c,o,i,l]);typeof r=="string"&&(r=Jc(r));let{pathname:h="/",search:d="",hash:f="",state:p=null,key:m="default"}=r,x=w.useMemo(()=>{let v=za(h,c);return v==null?null:{location:{pathname:v,search:d,hash:f,state:p,key:m},navigationType:s}},[c,h,d,f,p,m,s]);return x==null?null:w.createElement(Us.Provider,{value:u},w.createElement(i0.Provider,{children:n,value:x}))}new Promise(()=>{});/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rh(){return rh=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},rh.apply(this,arguments)}function x2(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function n4(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function r4(t,e){return t.button===0&&(!e||e==="_self")&&!n4(t)}function Lm(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(s=>[n,s]):[[n,r]])},[]))}function s4(t,e){let n=Lm(t);return e&&e.forEach((r,s)=>{n.has(s)||e.getAll(s).forEach(i=>{n.append(s,i)})}),n}const i4=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],l4=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],a4="6";try{window.__reactRouterVersion=a4}catch{}const o4=w.createContext({isTransitioning:!1}),c4="startTransition",_b=eE[c4];function u4(t){let{basename:e,children:n,future:r,window:s}=t,i=w.useRef();i.current==null&&(i.current=hP({window:s,v5Compat:!0}));let l=i.current,[o,c]=w.useState({action:l.action,location:l.location}),{v7_startTransition:u}=r||{},h=w.useCallback(d=>{u&&_b?_b(()=>c(d)):c(d)},[c,u]);return w.useLayoutEffect(()=>l.listen(h),[l,h]),w.useEffect(()=>e4(r),[r]),w.createElement(t4,{basename:e,children:n,location:o.location,navigationType:o.action,navigator:l,future:r})}const d4=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",h4=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,sr=w.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:i,replace:l,state:o,target:c,to:u,preventScrollReset:h,viewTransition:d}=e,f=x2(e,i4),{basename:p}=w.useContext(Us),m,x=!1;if(typeof u=="string"&&h4.test(u)&&(m=u,d4))try{let b=new URL(window.location.href),k=u.startsWith("//")?new URL(b.protocol+u):new URL(u),S=za(k.pathname,p);k.origin===b.origin&&S!=null?u=S+k.search+k.hash:x=!0}catch{}let v=IP(u,{relative:s}),g=m4(u,{replace:l,state:o,target:c,preventScrollReset:h,relative:s,viewTransition:d});function y(b){r&&r(b),b.defaultPrevented||g(b)}return w.createElement("a",rh({},f,{href:m||v,onClick:x||i?r:y,ref:n,target:c}))}),f4=w.forwardRef(function(e,n){let{"aria-current":r="page",caseSensitive:s=!1,className:i="",end:l=!1,style:o,to:c,viewTransition:u,children:h}=e,d=x2(e,l4),f=Uh(c,{relative:d.relative}),p=Hs(),m=w.useContext(c2),{navigator:x,basename:v}=w.useContext(Us),g=m!=null&&x4(f)&&u===!0,y=x.encodeLocation?x.encodeLocation(f).pathname:f.pathname,b=p.pathname,k=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;s||(b=b.toLowerCase(),k=k?k.toLowerCase():null,y=y.toLowerCase()),k&&v&&(k=za(k,v)||k);const S=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let j=b===y||!l&&b.startsWith(y)&&b.charAt(S)==="/",E=k!=null&&(k===y||!l&&k.startsWith(y)&&k.charAt(y.length)==="/"),A={isActive:j,isPending:E,isTransitioning:g},T=j?r:void 0,N;typeof i=="function"?N=i(A):N=[i,j?"active":null,E?"pending":null,g?"transitioning":null].filter(Boolean).join(" ");let I=typeof o=="function"?o(A):o;return w.createElement(sr,rh({},d,{"aria-current":T,className:N,ref:n,style:I,to:c,viewTransition:u}),typeof h=="function"?h(A):h)});var Om;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(Om||(Om={}));var Mb;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(Mb||(Mb={}));function p4(t){let e=w.useContext($h);return e||qt(!1),e}function m4(t,e){let{target:n,replace:r,state:s,preventScrollReset:i,relative:l,viewTransition:o}=e===void 0?{}:e,c=Qn(),u=Hs(),h=Uh(t,{relative:l});return w.useCallback(d=>{if(r4(d,n)){d.preventDefault();let f=r!==void 0?r:th(u)===th(h);c(t,{replace:f,state:s,preventScrollReset:i,relative:l,viewTransition:o})}},[u,c,h,r,s,n,t,i,l,o])}function g4(t){let e=w.useRef(Lm(t)),n=w.useRef(!1),r=Hs(),s=w.useMemo(()=>s4(r.search,n.current?null:e.current),[r.search]),i=Qn(),l=w.useCallback((o,c)=>{const u=Lm(typeof o=="function"?o(s):o);n.current=!0,i("?"+u,c)},[i,s]);return[s,l]}function x4(t,e){e===void 0&&(e={});let n=w.useContext(o4);n==null&&qt(!1);let{basename:r}=p4(Om.useViewTransitionState),s=Uh(t,{relative:e.relative});if(!n.isTransitioning)return!1;let i=za(n.currentLocation.pathname,r)||n.currentLocation.pathname,l=za(n.nextLocation.pathname,r)||n.nextLocation.pathname;return Dm(s.pathname,l)!=null||Dm(s.pathname,i)!=null}var to=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},vl=typeof window>"u"||"Deno"in globalThis;function Cn(){}function y4(t,e){return typeof t=="function"?t(e):t}function Im(t){return typeof t=="number"&&t>=0&&t!==1/0}function y2(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Pi(t,e){return typeof t=="function"?t(e):t}function hr(t,e){return typeof t=="function"?t(e):t}function Tb(t,e){const{type:n="all",exact:r,fetchStatus:s,predicate:i,queryKey:l,stale:o}=t;if(l){if(r){if(e.queryHash!==a0(l,e.options))return!1}else if(!Sc(e.queryKey,l))return!1}if(n!=="all"){const c=e.isActive();if(n==="active"&&!c||n==="inactive"&&c)return!1}return!(typeof o=="boolean"&&e.isStale()!==o||s&&s!==e.state.fetchStatus||i&&!i(e))}function Rb(t,e){const{exact:n,status:r,predicate:s,mutationKey:i}=t;if(i){if(!e.options.mutationKey)return!1;if(n){if(wl(e.options.mutationKey)!==wl(i))return!1}else if(!Sc(e.options.mutationKey,i))return!1}return!(r&&e.state.status!==r||s&&!s(e))}function a0(t,e){return((e==null?void 0:e.queryKeyHashFn)||wl)(t)}function wl(t){return JSON.stringify(t,(e,n)=>Fm(n)?Object.keys(n).sort().reduce((r,s)=>(r[s]=n[s],r),{}):n)}function Sc(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>Sc(t[n],e[n])):!1}function b2(t,e){if(t===e)return t;const n=Db(t)&&Db(e);if(n||Fm(t)&&Fm(e)){const r=n?t:Object.keys(t),s=r.length,i=n?e:Object.keys(e),l=i.length,o=n?[]:{},c=new Set(r);let u=0;for(let h=0;h<l;h++){const d=n?h:i[h];(!n&&c.has(d)||n)&&t[d]===void 0&&e[d]===void 0?(o[d]=void 0,u++):(o[d]=b2(t[d],e[d]),o[d]===t[d]&&t[d]!==void 0&&u++)}return s===l&&u===s?t:o}return e}function sh(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Db(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function Fm(t){if(!Lb(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Lb(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Lb(t){return Object.prototype.toString.call(t)==="[object Object]"}function b4(t){return new Promise(e=>{setTimeout(e,t)})}function Bm(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?b2(t,e):e}function v4(t,e,n=0){const r=[...t,e];return n&&r.length>n?r.slice(1):r}function w4(t,e,n=0){const r=[e,...t];return n&&r.length>n?r.slice(0,-1):r}var o0=Symbol();function v2(t,e){return!t.queryFn&&(e!=null&&e.initialPromise)?()=>e.initialPromise:!t.queryFn||t.queryFn===o0?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function w2(t,e){return typeof t=="function"?t(...e):!!t}var rl,ii,va,I1,k4=(I1=class extends to{constructor(){super();Me(this,rl);Me(this,ii);Me(this,va);be(this,va,e=>{if(!vl&&window.addEventListener){const n=()=>e();return window.addEventListener("visibilitychange",n,!1),()=>{window.removeEventListener("visibilitychange",n)}}})}onSubscribe(){U(this,ii)||this.setEventListener(U(this,va))}onUnsubscribe(){var e;this.hasListeners()||((e=U(this,ii))==null||e.call(this),be(this,ii,void 0))}setEventListener(e){var n;be(this,va,e),(n=U(this,ii))==null||n.call(this),be(this,ii,e(r=>{typeof r=="boolean"?this.setFocused(r):this.onFocus()}))}setFocused(e){U(this,rl)!==e&&(be(this,rl,e),this.onFocus())}onFocus(){const e=this.isFocused();this.listeners.forEach(n=>{n(e)})}isFocused(){var e;return typeof U(this,rl)=="boolean"?U(this,rl):((e=globalThis.document)==null?void 0:e.visibilityState)!=="hidden"}},rl=new WeakMap,ii=new WeakMap,va=new WeakMap,I1),c0=new k4,wa,li,ka,F1,j4=(F1=class extends to{constructor(){super();Me(this,wa,!0);Me(this,li);Me(this,ka);be(this,ka,e=>{if(!vl&&window.addEventListener){const n=()=>e(!0),r=()=>e(!1);return window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",r)}}})}onSubscribe(){U(this,li)||this.setEventListener(U(this,ka))}onUnsubscribe(){var e;this.hasListeners()||((e=U(this,li))==null||e.call(this),be(this,li,void 0))}setEventListener(e){var n;be(this,ka,e),(n=U(this,li))==null||n.call(this),be(this,li,e(this.setOnline.bind(this)))}setOnline(e){U(this,wa)!==e&&(be(this,wa,e),this.listeners.forEach(r=>{r(e)}))}isOnline(){return U(this,wa)}},wa=new WeakMap,li=new WeakMap,ka=new WeakMap,F1),ih=new j4;function zm(){let t,e;const n=new Promise((s,i)=>{t=s,e=i});n.status="pending",n.catch(()=>{});function r(s){Object.assign(n,s),delete n.resolve,delete n.reject}return n.resolve=s=>{r({status:"fulfilled",value:s}),t(s)},n.reject=s=>{r({status:"rejected",reason:s}),e(s)},n}function S4(t){return Math.min(1e3*2**t,3e4)}function k2(t){return(t??"online")==="online"?ih.isOnline():!0}var j2=class extends Error{constructor(t){super("CancelledError"),this.revert=t==null?void 0:t.revert,this.silent=t==null?void 0:t.silent}};function S2(t){let e=!1,n=0,r;const s=zm(),i=()=>s.status!=="pending",l=x=>{var v;i()||(f(new j2(x)),(v=t.abort)==null||v.call(t))},o=()=>{e=!0},c=()=>{e=!1},u=()=>c0.isFocused()&&(t.networkMode==="always"||ih.isOnline())&&t.canRun(),h=()=>k2(t.networkMode)&&t.canRun(),d=x=>{i()||(r==null||r(),s.resolve(x))},f=x=>{i()||(r==null||r(),s.reject(x))},p=()=>new Promise(x=>{var v;r=g=>{(i()||u())&&x(g)},(v=t.onPause)==null||v.call(t)}).then(()=>{var x;r=void 0,i()||(x=t.onContinue)==null||x.call(t)}),m=()=>{if(i())return;let x;const v=n===0?t.initialPromise:void 0;try{x=v??t.fn()}catch(g){x=Promise.reject(g)}Promise.resolve(x).then(d).catch(g=>{var j;if(i())return;const y=t.retry??(vl?0:3),b=t.retryDelay??S4,k=typeof b=="function"?b(n,g):b,S=y===!0||typeof y=="number"&&n<y||typeof y=="function"&&y(n,g);if(e||!S){f(g);return}n++,(j=t.onFail)==null||j.call(t,n,g),b4(k).then(()=>u()?void 0:p()).then(()=>{e?f(g):m()})})};return{promise:s,status:()=>s.status,cancel:l,continue:()=>(r==null||r(),s),cancelRetry:o,continueRetry:c,canStart:h,start:()=>(h()?m():p().then(m),s)}}var N4=t=>setTimeout(t,0);function C4(){let t=[],e=0,n=o=>{o()},r=o=>{o()},s=N4;const i=o=>{e?t.push(o):s(()=>{n(o)})},l=()=>{const o=t;t=[],o.length&&s(()=>{r(()=>{o.forEach(c=>{n(c)})})})};return{batch:o=>{let c;e++;try{c=o()}finally{e--,e||l()}return c},batchCalls:o=>(...c)=>{i(()=>{o(...c)})},schedule:i,setNotifyFunction:o=>{n=o},setBatchNotifyFunction:o=>{r=o},setScheduler:o=>{s=o}}}var $t=C4(),sl,B1,N2=(B1=class{constructor(){Me(this,sl)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),Im(this.gcTime)&&be(this,sl,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??(vl?1/0:5*60*1e3))}clearGcTimeout(){U(this,sl)&&(clearTimeout(U(this,sl)),be(this,sl,void 0))}},sl=new WeakMap,B1),ja,Sa,dr,il,Qt,$c,ll,Rr,vs,z1,A4=(z1=class extends N2{constructor(e){super();Me(this,Rr);Me(this,ja);Me(this,Sa);Me(this,dr);Me(this,il);Me(this,Qt);Me(this,$c);Me(this,ll);be(this,ll,!1),be(this,$c,e.defaultOptions),this.setOptions(e.options),this.observers=[],be(this,il,e.client),be(this,dr,U(this,il).getQueryCache()),this.queryKey=e.queryKey,this.queryHash=e.queryHash,be(this,ja,E4(this.options)),this.state=e.state??U(this,ja),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var e;return(e=U(this,Qt))==null?void 0:e.promise}setOptions(e){this.options={...U(this,$c),...e},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&U(this,dr).remove(this)}setData(e,n){const r=Bm(this.state.data,e,this.options);return $e(this,Rr,vs).call(this,{data:r,type:"success",dataUpdatedAt:n==null?void 0:n.updatedAt,manual:n==null?void 0:n.manual}),r}setState(e,n){$e(this,Rr,vs).call(this,{type:"setState",state:e,setStateOptions:n})}cancel(e){var r,s;const n=(r=U(this,Qt))==null?void 0:r.promise;return(s=U(this,Qt))==null||s.cancel(e),n?n.then(Cn).catch(Cn):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(U(this,ja))}isActive(){return this.observers.some(e=>hr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===o0||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Pi(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!y2(this.state.dataUpdatedAt,e)}onFocus(){var n;const e=this.observers.find(r=>r.shouldFetchOnWindowFocus());e==null||e.refetch({cancelRefetch:!1}),(n=U(this,Qt))==null||n.continue()}onOnline(){var n;const e=this.observers.find(r=>r.shouldFetchOnReconnect());e==null||e.refetch({cancelRefetch:!1}),(n=U(this,Qt))==null||n.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),U(this,dr).notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(U(this,Qt)&&(U(this,ll)?U(this,Qt).cancel({revert:!0}):U(this,Qt).cancelRetry()),this.scheduleGc()),U(this,dr).notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||$e(this,Rr,vs).call(this,{type:"invalidate"})}async fetch(e,n){var c,u,h,d,f,p,m,x,v,g,y,b;if(this.state.fetchStatus!=="idle"&&((c=U(this,Qt))==null?void 0:c.status())!=="rejected"){if(this.state.data!==void 0&&(n!=null&&n.cancelRefetch))this.cancel({silent:!0});else if(U(this,Qt))return U(this,Qt).continueRetry(),U(this,Qt).promise}if(e&&this.setOptions(e),!this.options.queryFn){const k=this.observers.find(S=>S.options.queryFn);k&&this.setOptions(k.options)}const r=new AbortController,s=k=>{Object.defineProperty(k,"signal",{enumerable:!0,get:()=>(be(this,ll,!0),r.signal)})},i=()=>{const k=v2(this.options,n),j=(()=>{const E={client:U(this,il),queryKey:this.queryKey,meta:this.meta};return s(E),E})();return be(this,ll,!1),this.options.persister?this.options.persister(k,j,this):k(j)},o=(()=>{const k={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:U(this,il),state:this.state,fetchFn:i};return s(k),k})();(u=this.options.behavior)==null||u.onFetch(o,this),be(this,Sa,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((h=o.fetchOptions)==null?void 0:h.meta))&&$e(this,Rr,vs).call(this,{type:"fetch",meta:(d=o.fetchOptions)==null?void 0:d.meta}),be(this,Qt,S2({initialPromise:n==null?void 0:n.initialPromise,fn:o.fetchFn,abort:r.abort.bind(r),onFail:(k,S)=>{$e(this,Rr,vs).call(this,{type:"failed",failureCount:k,error:S})},onPause:()=>{$e(this,Rr,vs).call(this,{type:"pause"})},onContinue:()=>{$e(this,Rr,vs).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0}));try{const k=await U(this,Qt).start();if(k===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(k),(p=(f=U(this,dr).config).onSuccess)==null||p.call(f,k,this),(x=(m=U(this,dr).config).onSettled)==null||x.call(m,k,this.state.error,this),k}catch(k){if(k instanceof j2){if(k.silent)return U(this,Qt).promise;if(k.revert){if(this.setState({...U(this,Sa),fetchStatus:"idle"}),this.state.data===void 0)throw k;return this.state.data}}throw $e(this,Rr,vs).call(this,{type:"error",error:k}),(g=(v=U(this,dr).config).onError)==null||g.call(v,k,this),(b=(y=U(this,dr).config).onSettled)==null||b.call(y,this.state.data,k,this),k}finally{this.scheduleGc()}}},ja=new WeakMap,Sa=new WeakMap,dr=new WeakMap,il=new WeakMap,Qt=new WeakMap,$c=new WeakMap,ll=new WeakMap,Rr=new WeakSet,vs=function(e){const n=r=>{switch(e.type){case"failed":return{...r,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...r,fetchStatus:"paused"};case"continue":return{...r,fetchStatus:"fetching"};case"fetch":return{...r,...C2(r.data,this.options),fetchMeta:e.meta??null};case"success":const s={...r,data:e.data,dataUpdateCount:r.dataUpdateCount+1,dataUpdatedAt:e.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return be(this,Sa,e.manual?s:void 0),s;case"error":const i=e.error;return{...r,error:i,errorUpdateCount:r.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:r.fetchFailureCount+1,fetchFailureReason:i,fetchStatus:"idle",status:"error"};case"invalidate":return{...r,isInvalidated:!0};case"setState":return{...r,...e.state}}};this.state=n(this.state),$t.batch(()=>{this.observers.forEach(r=>{r.onQueryUpdate()}),U(this,dr).notify({query:this,type:"updated",action:e})})},z1);function C2(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:k2(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function E4(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,r=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?r??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var ts,$1,P4=($1=class extends to{constructor(e={}){super();Me(this,ts);this.config=e,be(this,ts,new Map)}build(e,n,r){const s=n.queryKey,i=n.queryHash??a0(s,n);let l=this.get(i);return l||(l=new A4({client:e,queryKey:s,queryHash:i,options:e.defaultQueryOptions(n),state:r,defaultOptions:e.getQueryDefaults(s)}),this.add(l)),l}add(e){U(this,ts).has(e.queryHash)||(U(this,ts).set(e.queryHash,e),this.notify({type:"added",query:e}))}remove(e){const n=U(this,ts).get(e.queryHash);n&&(e.destroy(),n===e&&U(this,ts).delete(e.queryHash),this.notify({type:"removed",query:e}))}clear(){$t.batch(()=>{this.getAll().forEach(e=>{this.remove(e)})})}get(e){return U(this,ts).get(e)}getAll(){return[...U(this,ts).values()]}find(e){const n={exact:!0,...e};return this.getAll().find(r=>Tb(n,r))}findAll(e={}){const n=this.getAll();return Object.keys(e).length>0?n.filter(r=>Tb(e,r)):n}notify(e){$t.batch(()=>{this.listeners.forEach(n=>{n(e)})})}onFocus(){$t.batch(()=>{this.getAll().forEach(e=>{e.onFocus()})})}onOnline(){$t.batch(()=>{this.getAll().forEach(e=>{e.onOnline()})})}},ts=new WeakMap,$1),ns,jn,al,rs,Gs,U1,_4=(U1=class extends N2{constructor(e){super();Me(this,rs);Me(this,ns);Me(this,jn);Me(this,al);this.mutationId=e.mutationId,be(this,jn,e.mutationCache),be(this,ns,[]),this.state=e.state||A2(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){U(this,ns).includes(e)||(U(this,ns).push(e),this.clearGcTimeout(),U(this,jn).notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){be(this,ns,U(this,ns).filter(n=>n!==e)),this.scheduleGc(),U(this,jn).notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){U(this,ns).length||(this.state.status==="pending"?this.scheduleGc():U(this,jn).remove(this))}continue(){var e;return((e=U(this,al))==null?void 0:e.continue())??this.execute(this.state.variables)}async execute(e){var i,l,o,c,u,h,d,f,p,m,x,v,g,y,b,k,S,j,E,A;const n=()=>{$e(this,rs,Gs).call(this,{type:"continue"})};be(this,al,S2({fn:()=>this.options.mutationFn?this.options.mutationFn(e):Promise.reject(new Error("No mutationFn found")),onFail:(T,N)=>{$e(this,rs,Gs).call(this,{type:"failed",failureCount:T,error:N})},onPause:()=>{$e(this,rs,Gs).call(this,{type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>U(this,jn).canRun(this)}));const r=this.state.status==="pending",s=!U(this,al).canStart();try{if(r)n();else{$e(this,rs,Gs).call(this,{type:"pending",variables:e,isPaused:s}),await((l=(i=U(this,jn).config).onMutate)==null?void 0:l.call(i,e,this));const N=await((c=(o=this.options).onMutate)==null?void 0:c.call(o,e));N!==this.state.context&&$e(this,rs,Gs).call(this,{type:"pending",context:N,variables:e,isPaused:s})}const T=await U(this,al).start();return await((h=(u=U(this,jn).config).onSuccess)==null?void 0:h.call(u,T,e,this.state.context,this)),await((f=(d=this.options).onSuccess)==null?void 0:f.call(d,T,e,this.state.context)),await((m=(p=U(this,jn).config).onSettled)==null?void 0:m.call(p,T,null,this.state.variables,this.state.context,this)),await((v=(x=this.options).onSettled)==null?void 0:v.call(x,T,null,e,this.state.context)),$e(this,rs,Gs).call(this,{type:"success",data:T}),T}catch(T){try{throw await((y=(g=U(this,jn).config).onError)==null?void 0:y.call(g,T,e,this.state.context,this)),await((k=(b=this.options).onError)==null?void 0:k.call(b,T,e,this.state.context)),await((j=(S=U(this,jn).config).onSettled)==null?void 0:j.call(S,void 0,T,this.state.variables,this.state.context,this)),await((A=(E=this.options).onSettled)==null?void 0:A.call(E,void 0,T,e,this.state.context)),T}finally{$e(this,rs,Gs).call(this,{type:"error",error:T})}}finally{U(this,jn).runNext(this)}}},ns=new WeakMap,jn=new WeakMap,al=new WeakMap,rs=new WeakSet,Gs=function(e){const n=r=>{switch(e.type){case"failed":return{...r,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...r,isPaused:!0};case"continue":return{...r,isPaused:!1};case"pending":return{...r,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...r,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...r,data:void 0,error:e.error,failureCount:r.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),$t.batch(()=>{U(this,ns).forEach(r=>{r.onMutationUpdate(e)}),U(this,jn).notify({mutation:this,type:"updated",action:e})})},U1);function A2(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Ss,Dr,Uc,H1,M4=(H1=class extends to{constructor(e={}){super();Me(this,Ss);Me(this,Dr);Me(this,Uc);this.config=e,be(this,Ss,new Set),be(this,Dr,new Map),be(this,Uc,0)}build(e,n,r){const s=new _4({mutationCache:this,mutationId:++uu(this,Uc)._,options:e.defaultMutationOptions(n),state:r});return this.add(s),s}add(e){U(this,Ss).add(e);const n=Eu(e);if(typeof n=="string"){const r=U(this,Dr).get(n);r?r.push(e):U(this,Dr).set(n,[e])}this.notify({type:"added",mutation:e})}remove(e){if(U(this,Ss).delete(e)){const n=Eu(e);if(typeof n=="string"){const r=U(this,Dr).get(n);if(r)if(r.length>1){const s=r.indexOf(e);s!==-1&&r.splice(s,1)}else r[0]===e&&U(this,Dr).delete(n)}}this.notify({type:"removed",mutation:e})}canRun(e){const n=Eu(e);if(typeof n=="string"){const r=U(this,Dr).get(n),s=r==null?void 0:r.find(i=>i.state.status==="pending");return!s||s===e}else return!0}runNext(e){var r;const n=Eu(e);if(typeof n=="string"){const s=(r=U(this,Dr).get(n))==null?void 0:r.find(i=>i!==e&&i.state.isPaused);return(s==null?void 0:s.continue())??Promise.resolve()}else return Promise.resolve()}clear(){$t.batch(()=>{U(this,Ss).forEach(e=>{this.notify({type:"removed",mutation:e})}),U(this,Ss).clear(),U(this,Dr).clear()})}getAll(){return Array.from(U(this,Ss))}find(e){const n={exact:!0,...e};return this.getAll().find(r=>Rb(n,r))}findAll(e={}){return this.getAll().filter(n=>Rb(e,n))}notify(e){$t.batch(()=>{this.listeners.forEach(n=>{n(e)})})}resumePausedMutations(){const e=this.getAll().filter(n=>n.state.isPaused);return $t.batch(()=>Promise.all(e.map(n=>n.continue().catch(Cn))))}},Ss=new WeakMap,Dr=new WeakMap,Uc=new WeakMap,H1);function Eu(t){var e;return(e=t.options.scope)==null?void 0:e.id}function Ob(t){return{onFetch:(e,n)=>{var h,d,f,p,m;const r=e.options,s=(f=(d=(h=e.fetchOptions)==null?void 0:h.meta)==null?void 0:d.fetchMore)==null?void 0:f.direction,i=((p=e.state.data)==null?void 0:p.pages)||[],l=((m=e.state.data)==null?void 0:m.pageParams)||[];let o={pages:[],pageParams:[]},c=0;const u=async()=>{let x=!1;const v=b=>{Object.defineProperty(b,"signal",{enumerable:!0,get:()=>(e.signal.aborted?x=!0:e.signal.addEventListener("abort",()=>{x=!0}),e.signal)})},g=v2(e.options,e.fetchOptions),y=async(b,k,S)=>{if(x)return Promise.reject();if(k==null&&b.pages.length)return Promise.resolve(b);const E=(()=>{const I={client:e.client,queryKey:e.queryKey,pageParam:k,direction:S?"backward":"forward",meta:e.options.meta};return v(I),I})(),A=await g(E),{maxPages:T}=e.options,N=S?w4:v4;return{pages:N(b.pages,A,T),pageParams:N(b.pageParams,k,T)}};if(s&&i.length){const b=s==="backward",k=b?T4:Ib,S={pages:i,pageParams:l},j=k(r,S);o=await y(S,j,b)}else{const b=t??i.length;do{const k=c===0?l[0]??r.initialPageParam:Ib(r,o);if(c>0&&k==null)break;o=await y(o,k),c++}while(c<b)}return o};e.options.persister?e.fetchFn=()=>{var x,v;return(v=(x=e.options).persister)==null?void 0:v.call(x,u,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n)}:e.fetchFn=u}}}function Ib(t,{pages:e,pageParams:n}){const r=e.length-1;return e.length>0?t.getNextPageParam(e[r],e,n[r],n):void 0}function T4(t,{pages:e,pageParams:n}){var r;return e.length>0?(r=t.getPreviousPageParam)==null?void 0:r.call(t,e[0],e,n[0],n):void 0}var Ct,ai,oi,Na,Ca,ci,Aa,Ea,q1,R4=(q1=class{constructor(t={}){Me(this,Ct);Me(this,ai);Me(this,oi);Me(this,Na);Me(this,Ca);Me(this,ci);Me(this,Aa);Me(this,Ea);be(this,Ct,t.queryCache||new P4),be(this,ai,t.mutationCache||new M4),be(this,oi,t.defaultOptions||{}),be(this,Na,new Map),be(this,Ca,new Map),be(this,ci,0)}mount(){uu(this,ci)._++,U(this,ci)===1&&(be(this,Aa,c0.subscribe(async t=>{t&&(await this.resumePausedMutations(),U(this,Ct).onFocus())})),be(this,Ea,ih.subscribe(async t=>{t&&(await this.resumePausedMutations(),U(this,Ct).onOnline())})))}unmount(){var t,e;uu(this,ci)._--,U(this,ci)===0&&((t=U(this,Aa))==null||t.call(this),be(this,Aa,void 0),(e=U(this,Ea))==null||e.call(this),be(this,Ea,void 0))}isFetching(t){return U(this,Ct).findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return U(this,ai).findAll({...t,status:"pending"}).length}getQueryData(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=U(this,Ct).get(e.queryHash))==null?void 0:n.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=U(this,Ct).build(this,e),r=n.state.data;return r===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Pi(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(r))}getQueriesData(t){return U(this,Ct).findAll(t).map(({queryKey:e,state:n})=>{const r=n.data;return[e,r]})}setQueryData(t,e,n){const r=this.defaultQueryOptions({queryKey:t}),s=U(this,Ct).get(r.queryHash),i=s==null?void 0:s.state.data,l=y4(e,i);if(l!==void 0)return U(this,Ct).build(this,r).setData(l,{...n,manual:!0})}setQueriesData(t,e,n){return $t.batch(()=>U(this,Ct).findAll(t).map(({queryKey:r})=>[r,this.setQueryData(r,e,n)]))}getQueryState(t){var n;const e=this.defaultQueryOptions({queryKey:t});return(n=U(this,Ct).get(e.queryHash))==null?void 0:n.state}removeQueries(t){const e=U(this,Ct);$t.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=U(this,Ct);return $t.batch(()=>(n.findAll(t).forEach(r=>{r.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},r=$t.batch(()=>U(this,Ct).findAll(t).map(s=>s.cancel(n)));return Promise.all(r).then(Cn).catch(Cn)}invalidateQueries(t,e={}){return $t.batch(()=>(U(this,Ct).findAll(t).forEach(n=>{n.invalidate()}),(t==null?void 0:t.refetchType)==="none"?Promise.resolve():this.refetchQueries({...t,type:(t==null?void 0:t.refetchType)??(t==null?void 0:t.type)??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},r=$t.batch(()=>U(this,Ct).findAll(t).filter(s=>!s.isDisabled()&&!s.isStatic()).map(s=>{let i=s.fetch(void 0,n);return n.throwOnError||(i=i.catch(Cn)),s.state.fetchStatus==="paused"?Promise.resolve():i}));return Promise.all(r).then(Cn)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=U(this,Ct).build(this,e);return n.isStaleByTime(Pi(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(Cn).catch(Cn)}fetchInfiniteQuery(t){return t.behavior=Ob(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(Cn).catch(Cn)}ensureInfiniteQueryData(t){return t.behavior=Ob(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return ih.isOnline()?U(this,ai).resumePausedMutations():Promise.resolve()}getQueryCache(){return U(this,Ct)}getMutationCache(){return U(this,ai)}getDefaultOptions(){return U(this,oi)}setDefaultOptions(t){be(this,oi,t)}setQueryDefaults(t,e){U(this,Na).set(wl(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...U(this,Na).values()],n={};return e.forEach(r=>{Sc(t,r.queryKey)&&Object.assign(n,r.defaultOptions)}),n}setMutationDefaults(t,e){U(this,Ca).set(wl(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...U(this,Ca).values()],n={};return e.forEach(r=>{Sc(t,r.mutationKey)&&Object.assign(n,r.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...U(this,oi).queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=a0(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===o0&&(e.enabled=!1),e}defaultMutationOptions(t){return t!=null&&t._defaulted?t:{...U(this,oi).mutations,...(t==null?void 0:t.mutationKey)&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){U(this,Ct).clear(),U(this,ai).clear()}},Ct=new WeakMap,ai=new WeakMap,oi=new WeakMap,Na=new WeakMap,Ca=new WeakMap,ci=new WeakMap,Aa=new WeakMap,Ea=new WeakMap,q1),Bn,Ve,Hc,Sn,ol,Pa,Ns,ui,qc,_a,Ma,cl,ul,di,Ta,et,Oo,$m,Um,Hm,qm,Vm,Wm,Km,E2,V1,D4=(V1=class extends to{constructor(e,n){super();Me(this,et);Me(this,Bn);Me(this,Ve);Me(this,Hc);Me(this,Sn);Me(this,ol);Me(this,Pa);Me(this,Ns);Me(this,ui);Me(this,qc);Me(this,_a);Me(this,Ma);Me(this,cl);Me(this,ul);Me(this,di);Me(this,Ta,new Set);this.options=n,be(this,Bn,e),be(this,ui,null),be(this,Ns,zm()),this.bindMethods(),this.setOptions(n)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(U(this,Ve).addObserver(this),Fb(U(this,Ve),this.options)?$e(this,et,Oo).call(this):this.updateResult(),$e(this,et,qm).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Qm(U(this,Ve),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Qm(U(this,Ve),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,$e(this,et,Vm).call(this),$e(this,et,Wm).call(this),U(this,Ve).removeObserver(this)}setOptions(e){const n=this.options,r=U(this,Ve);if(this.options=U(this,Bn).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof hr(this.options.enabled,U(this,Ve))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");$e(this,et,Km).call(this),U(this,Ve).setOptions(this.options),n._defaulted&&!sh(this.options,n)&&U(this,Bn).getQueryCache().notify({type:"observerOptionsUpdated",query:U(this,Ve),observer:this});const s=this.hasListeners();s&&Bb(U(this,Ve),r,this.options,n)&&$e(this,et,Oo).call(this),this.updateResult(),s&&(U(this,Ve)!==r||hr(this.options.enabled,U(this,Ve))!==hr(n.enabled,U(this,Ve))||Pi(this.options.staleTime,U(this,Ve))!==Pi(n.staleTime,U(this,Ve)))&&$e(this,et,$m).call(this);const i=$e(this,et,Um).call(this);s&&(U(this,Ve)!==r||hr(this.options.enabled,U(this,Ve))!==hr(n.enabled,U(this,Ve))||i!==U(this,di))&&$e(this,et,Hm).call(this,i)}getOptimisticResult(e){const n=U(this,Bn).getQueryCache().build(U(this,Bn),e),r=this.createResult(n,e);return O4(this,r)&&(be(this,Sn,r),be(this,Pa,this.options),be(this,ol,U(this,Ve).state)),r}getCurrentResult(){return U(this,Sn)}trackResult(e,n){return new Proxy(e,{get:(r,s)=>(this.trackProp(s),n==null||n(s),s==="promise"&&!this.options.experimental_prefetchInRender&&U(this,Ns).status==="pending"&&U(this,Ns).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(r,s))})}trackProp(e){U(this,Ta).add(e)}getCurrentQuery(){return U(this,Ve)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const n=U(this,Bn).defaultQueryOptions(e),r=U(this,Bn).getQueryCache().build(U(this,Bn),n);return r.fetch().then(()=>this.createResult(r,n))}fetch(e){return $e(this,et,Oo).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),U(this,Sn)))}createResult(e,n){var T;const r=U(this,Ve),s=this.options,i=U(this,Sn),l=U(this,ol),o=U(this,Pa),u=e!==r?e.state:U(this,Hc),{state:h}=e;let d={...h},f=!1,p;if(n._optimisticResults){const N=this.hasListeners(),I=!N&&Fb(e,n),R=N&&Bb(e,r,n,s);(I||R)&&(d={...d,...C2(h.data,e.options)}),n._optimisticResults==="isRestoring"&&(d.fetchStatus="idle")}let{error:m,errorUpdatedAt:x,status:v}=d;p=d.data;let g=!1;if(n.placeholderData!==void 0&&p===void 0&&v==="pending"){let N;i!=null&&i.isPlaceholderData&&n.placeholderData===(o==null?void 0:o.placeholderData)?(N=i.data,g=!0):N=typeof n.placeholderData=="function"?n.placeholderData((T=U(this,Ma))==null?void 0:T.state.data,U(this,Ma)):n.placeholderData,N!==void 0&&(v="success",p=Bm(i==null?void 0:i.data,N,n),f=!0)}if(n.select&&p!==void 0&&!g)if(i&&p===(l==null?void 0:l.data)&&n.select===U(this,qc))p=U(this,_a);else try{be(this,qc,n.select),p=n.select(p),p=Bm(i==null?void 0:i.data,p,n),be(this,_a,p),be(this,ui,null)}catch(N){be(this,ui,N)}U(this,ui)&&(m=U(this,ui),p=U(this,_a),x=Date.now(),v="error");const y=d.fetchStatus==="fetching",b=v==="pending",k=v==="error",S=b&&y,j=p!==void 0,A={status:v,fetchStatus:d.fetchStatus,isPending:b,isSuccess:v==="success",isError:k,isInitialLoading:S,isLoading:S,data:p,dataUpdatedAt:d.dataUpdatedAt,error:m,errorUpdatedAt:x,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>u.dataUpdateCount||d.errorUpdateCount>u.errorUpdateCount,isFetching:y,isRefetching:y&&!b,isLoadingError:k&&!j,isPaused:d.fetchStatus==="paused",isPlaceholderData:f,isRefetchError:k&&j,isStale:u0(e,n),refetch:this.refetch,promise:U(this,Ns),isEnabled:hr(n.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const N=C=>{A.status==="error"?C.reject(A.error):A.data!==void 0&&C.resolve(A.data)},I=()=>{const C=be(this,Ns,A.promise=zm());N(C)},R=U(this,Ns);switch(R.status){case"pending":e.queryHash===r.queryHash&&N(R);break;case"fulfilled":(A.status==="error"||A.data!==R.value)&&I();break;case"rejected":(A.status!=="error"||A.error!==R.reason)&&I();break}}return A}updateResult(){const e=U(this,Sn),n=this.createResult(U(this,Ve),this.options);if(be(this,ol,U(this,Ve).state),be(this,Pa,this.options),U(this,ol).data!==void 0&&be(this,Ma,U(this,Ve)),sh(n,e))return;be(this,Sn,n);const r=()=>{if(!e)return!0;const{notifyOnChangeProps:s}=this.options,i=typeof s=="function"?s():s;if(i==="all"||!i&&!U(this,Ta).size)return!0;const l=new Set(i??U(this,Ta));return this.options.throwOnError&&l.add("error"),Object.keys(U(this,Sn)).some(o=>{const c=o;return U(this,Sn)[c]!==e[c]&&l.has(c)})};$e(this,et,E2).call(this,{listeners:r()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&$e(this,et,qm).call(this)}},Bn=new WeakMap,Ve=new WeakMap,Hc=new WeakMap,Sn=new WeakMap,ol=new WeakMap,Pa=new WeakMap,Ns=new WeakMap,ui=new WeakMap,qc=new WeakMap,_a=new WeakMap,Ma=new WeakMap,cl=new WeakMap,ul=new WeakMap,di=new WeakMap,Ta=new WeakMap,et=new WeakSet,Oo=function(e){$e(this,et,Km).call(this);let n=U(this,Ve).fetch(this.options,e);return e!=null&&e.throwOnError||(n=n.catch(Cn)),n},$m=function(){$e(this,et,Vm).call(this);const e=Pi(this.options.staleTime,U(this,Ve));if(vl||U(this,Sn).isStale||!Im(e))return;const r=y2(U(this,Sn).dataUpdatedAt,e)+1;be(this,cl,setTimeout(()=>{U(this,Sn).isStale||this.updateResult()},r))},Um=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(U(this,Ve)):this.options.refetchInterval)??!1},Hm=function(e){$e(this,et,Wm).call(this),be(this,di,e),!(vl||hr(this.options.enabled,U(this,Ve))===!1||!Im(U(this,di))||U(this,di)===0)&&be(this,ul,setInterval(()=>{(this.options.refetchIntervalInBackground||c0.isFocused())&&$e(this,et,Oo).call(this)},U(this,di)))},qm=function(){$e(this,et,$m).call(this),$e(this,et,Hm).call(this,$e(this,et,Um).call(this))},Vm=function(){U(this,cl)&&(clearTimeout(U(this,cl)),be(this,cl,void 0))},Wm=function(){U(this,ul)&&(clearInterval(U(this,ul)),be(this,ul,void 0))},Km=function(){const e=U(this,Bn).getQueryCache().build(U(this,Bn),this.options);if(e===U(this,Ve))return;const n=U(this,Ve);be(this,Ve,e),be(this,Hc,e.state),this.hasListeners()&&(n==null||n.removeObserver(this),e.addObserver(this))},E2=function(e){$t.batch(()=>{e.listeners&&this.listeners.forEach(n=>{n(U(this,Sn))}),U(this,Bn).getQueryCache().notify({query:U(this,Ve),type:"observerResultsUpdated"})})},V1);function L4(t,e){return hr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Fb(t,e){return L4(t,e)||t.state.data!==void 0&&Qm(t,e,e.refetchOnMount)}function Qm(t,e,n){if(hr(e.enabled,t)!==!1&&Pi(e.staleTime,t)!=="static"){const r=typeof n=="function"?n(t):n;return r==="always"||r!==!1&&u0(t,e)}return!1}function Bb(t,e,n,r){return(t!==e||hr(r.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&u0(t,n)}function u0(t,e){return hr(e.enabled,t)!==!1&&t.isStaleByTime(Pi(e.staleTime,t))}function O4(t,e){return!sh(t.getCurrentResult(),e)}var hi,fi,zn,Cs,Ls,md,Gm,W1,I4=(W1=class extends to{constructor(n,r){super();Me(this,Ls);Me(this,hi);Me(this,fi);Me(this,zn);Me(this,Cs);be(this,hi,n),this.setOptions(r),this.bindMethods(),$e(this,Ls,md).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(n){var s;const r=this.options;this.options=U(this,hi).defaultMutationOptions(n),sh(this.options,r)||U(this,hi).getMutationCache().notify({type:"observerOptionsUpdated",mutation:U(this,zn),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&wl(r.mutationKey)!==wl(this.options.mutationKey)?this.reset():((s=U(this,zn))==null?void 0:s.state.status)==="pending"&&U(this,zn).setOptions(this.options)}onUnsubscribe(){var n;this.hasListeners()||(n=U(this,zn))==null||n.removeObserver(this)}onMutationUpdate(n){$e(this,Ls,md).call(this),$e(this,Ls,Gm).call(this,n)}getCurrentResult(){return U(this,fi)}reset(){var n;(n=U(this,zn))==null||n.removeObserver(this),be(this,zn,void 0),$e(this,Ls,md).call(this),$e(this,Ls,Gm).call(this)}mutate(n,r){var s;return be(this,Cs,r),(s=U(this,zn))==null||s.removeObserver(this),be(this,zn,U(this,hi).getMutationCache().build(U(this,hi),this.options)),U(this,zn).addObserver(this),U(this,zn).execute(n)}},hi=new WeakMap,fi=new WeakMap,zn=new WeakMap,Cs=new WeakMap,Ls=new WeakSet,md=function(){var r;const n=((r=U(this,zn))==null?void 0:r.state)??A2();be(this,fi,{...n,isPending:n.status==="pending",isSuccess:n.status==="success",isError:n.status==="error",isIdle:n.status==="idle",mutate:this.mutate,reset:this.reset})},Gm=function(n){$t.batch(()=>{var r,s,i,l,o,c,u,h;if(U(this,Cs)&&this.hasListeners()){const d=U(this,fi).variables,f=U(this,fi).context;(n==null?void 0:n.type)==="success"?((s=(r=U(this,Cs)).onSuccess)==null||s.call(r,n.data,d,f),(l=(i=U(this,Cs)).onSettled)==null||l.call(i,n.data,null,d,f)):(n==null?void 0:n.type)==="error"&&((c=(o=U(this,Cs)).onError)==null||c.call(o,n.error,d,f),(h=(u=U(this,Cs)).onSettled)==null||h.call(u,void 0,n.error,d,f))}this.listeners.forEach(d=>{d(U(this,fi))})})},W1),P2=w.createContext(void 0),qs=t=>{const e=w.useContext(P2);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},F4=({client:t,children:e})=>(w.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),a.jsx(P2.Provider,{value:t,children:e})),_2=w.createContext(!1),B4=()=>w.useContext(_2);_2.Provider;function z4(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var $4=w.createContext(z4()),U4=()=>w.useContext($4),H4=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},q4=t=>{w.useEffect(()=>{t.clearReset()},[t])},V4=({result:t,errorResetBoundary:e,throwOnError:n,query:r,suspense:s})=>t.isError&&!e.isReset()&&!t.isFetching&&r&&(s&&t.data===void 0||w2(n,[t.error,r])),W4=t=>{if(t.suspense){const e=r=>r==="static"?r:Math.max(r??1e3,1e3),n=t.staleTime;t.staleTime=typeof n=="function"?(...r)=>e(n(...r)):e(n),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},K4=(t,e)=>t.isLoading&&t.isFetching&&!e,Q4=(t,e)=>(t==null?void 0:t.suspense)&&e.isPending,zb=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function G4(t,e,n){var d,f,p,m,x;const r=B4(),s=U4(),i=qs(),l=i.defaultQueryOptions(t);(f=(d=i.getDefaultOptions().queries)==null?void 0:d._experimental_beforeQuery)==null||f.call(d,l),l._optimisticResults=r?"isRestoring":"optimistic",W4(l),H4(l,s),q4(s);const o=!i.getQueryCache().get(l.queryHash),[c]=w.useState(()=>new e(i,l)),u=c.getOptimisticResult(l),h=!r&&t.subscribed!==!1;if(w.useSyncExternalStore(w.useCallback(v=>{const g=h?c.subscribe($t.batchCalls(v)):Cn;return c.updateResult(),g},[c,h]),()=>c.getCurrentResult(),()=>c.getCurrentResult()),w.useEffect(()=>{c.setOptions(l)},[l,c]),Q4(l,u))throw zb(l,c,s);if(V4({result:u,errorResetBoundary:s,throwOnError:l.throwOnError,query:i.getQueryCache().get(l.queryHash),suspense:l.suspense}))throw u.error;if((m=(p=i.getDefaultOptions().queries)==null?void 0:p._experimental_afterQuery)==null||m.call(p,l,u),l.experimental_prefetchInRender&&!vl&&K4(u,r)){const v=o?zb(l,c,s):(x=i.getQueryCache().get(l.queryHash))==null?void 0:x.promise;v==null||v.catch(Cn).finally(()=>{c.updateResult()})}return l.notifyOnChangeProps?u:c.trackResult(u)}function Tt(t,e){return G4(t,D4)}function at(t,e){const n=qs(),[r]=w.useState(()=>new I4(n,t));w.useEffect(()=>{r.setOptions(t)},[r,t]);const s=w.useSyncExternalStore(w.useCallback(l=>r.subscribe($t.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),i=w.useCallback((l,o)=>{r.mutate(l,o).catch(Cn)},[r]);if(s.error&&w2(r.options.throwOnError,[s.error]))throw s.error;return{...s,mutate:i,mutateAsync:s.mutate}}function M2(t,e){return function(){return t.apply(e,arguments)}}const{toString:X4}=Object.prototype,{getPrototypeOf:d0}=Object,Hh=(t=>e=>{const n=X4.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),xs=t=>(t=t.toLowerCase(),e=>Hh(e)===t),qh=t=>e=>typeof e===t,{isArray:no}=Array,Nc=qh("undefined");function J4(t){return t!==null&&!Nc(t)&&t.constructor!==null&&!Nc(t.constructor)&&kr(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const T2=xs("ArrayBuffer");function Y4(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&T2(t.buffer),e}const Z4=qh("string"),kr=qh("function"),R2=qh("number"),Vh=t=>t!==null&&typeof t=="object",e_=t=>t===!0||t===!1,gd=t=>{if(Hh(t)!=="object")return!1;const e=d0(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},t_=xs("Date"),n_=xs("File"),r_=xs("Blob"),s_=xs("FileList"),i_=t=>Vh(t)&&kr(t.pipe),l_=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||kr(t.append)&&((e=Hh(t))==="formdata"||e==="object"&&kr(t.toString)&&t.toString()==="[object FormData]"))},a_=xs("URLSearchParams"),o_=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Yc(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let r,s;if(typeof t!="object"&&(t=[t]),no(t))for(r=0,s=t.length;r<s;r++)e.call(null,t[r],r,t);else{const i=n?Object.getOwnPropertyNames(t):Object.keys(t),l=i.length;let o;for(r=0;r<l;r++)o=i[r],e.call(null,t[o],o,t)}}function D2(t,e){e=e.toLowerCase();const n=Object.keys(t);let r=n.length,s;for(;r-- >0;)if(s=n[r],e===s.toLowerCase())return s;return null}const L2=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,O2=t=>!Nc(t)&&t!==L2;function Xm(){const{caseless:t}=O2(this)&&this||{},e={},n=(r,s)=>{const i=t&&D2(e,s)||s;gd(e[i])&&gd(r)?e[i]=Xm(e[i],r):gd(r)?e[i]=Xm({},r):no(r)?e[i]=r.slice():e[i]=r};for(let r=0,s=arguments.length;r<s;r++)arguments[r]&&Yc(arguments[r],n);return e}const c_=(t,e,n,{allOwnKeys:r}={})=>(Yc(e,(s,i)=>{n&&kr(s)?t[i]=M2(s,n):t[i]=s},{allOwnKeys:r}),t),u_=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),d_=(t,e,n,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},h_=(t,e,n,r)=>{let s,i,l;const o={};if(e=e||{},t==null)return e;do{for(s=Object.getOwnPropertyNames(t),i=s.length;i-- >0;)l=s[i],(!r||r(l,t,e))&&!o[l]&&(e[l]=t[l],o[l]=!0);t=n!==!1&&d0(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},f_=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const r=t.indexOf(e,n);return r!==-1&&r===n},p_=t=>{if(!t)return null;if(no(t))return t;let e=t.length;if(!R2(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},m_=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&d0(Uint8Array)),g_=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let s;for(;(s=r.next())&&!s.done;){const i=s.value;e.call(t,i[0],i[1])}},x_=(t,e)=>{let n;const r=[];for(;(n=t.exec(e))!==null;)r.push(n);return r},y_=xs("HTMLFormElement"),b_=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,r,s){return r.toUpperCase()+s}),$b=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),v_=xs("RegExp"),I2=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),r={};Yc(n,(s,i)=>{let l;(l=e(s,i,t))!==!1&&(r[i]=l||s)}),Object.defineProperties(t,r)},w_=t=>{I2(t,(e,n)=>{if(kr(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const r=t[n];if(kr(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},k_=(t,e)=>{const n={},r=s=>{s.forEach(i=>{n[i]=!0})};return no(t)?r(t):r(String(t).split(e)),n},j_=()=>{},S_=(t,e)=>(t=+t,Number.isFinite(t)?t:e),Qf="abcdefghijklmnopqrstuvwxyz",Ub="0123456789",F2={DIGIT:Ub,ALPHA:Qf,ALPHA_DIGIT:Qf+Qf.toUpperCase()+Ub},N_=(t=16,e=F2.ALPHA_DIGIT)=>{let n="";const{length:r}=e;for(;t--;)n+=e[Math.random()*r|0];return n};function C_(t){return!!(t&&kr(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const A_=t=>{const e=new Array(10),n=(r,s)=>{if(Vh(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[s]=r;const i=no(r)?[]:{};return Yc(r,(l,o)=>{const c=n(l,s+1);!Nc(c)&&(i[o]=c)}),e[s]=void 0,i}}return r};return n(t,0)},E_=xs("AsyncFunction"),P_=t=>t&&(Vh(t)||kr(t))&&kr(t.then)&&kr(t.catch),ie={isArray:no,isArrayBuffer:T2,isBuffer:J4,isFormData:l_,isArrayBufferView:Y4,isString:Z4,isNumber:R2,isBoolean:e_,isObject:Vh,isPlainObject:gd,isUndefined:Nc,isDate:t_,isFile:n_,isBlob:r_,isRegExp:v_,isFunction:kr,isStream:i_,isURLSearchParams:a_,isTypedArray:m_,isFileList:s_,forEach:Yc,merge:Xm,extend:c_,trim:o_,stripBOM:u_,inherits:d_,toFlatObject:h_,kindOf:Hh,kindOfTest:xs,endsWith:f_,toArray:p_,forEachEntry:g_,matchAll:x_,isHTMLForm:y_,hasOwnProperty:$b,hasOwnProp:$b,reduceDescriptors:I2,freezeMethods:w_,toObjectSet:k_,toCamelCase:b_,noop:j_,toFiniteNumber:S_,findKey:D2,global:L2,isContextDefined:O2,ALPHABET:F2,generateString:N_,isSpecCompliantForm:C_,toJSONObject:A_,isAsyncFn:E_,isThenable:P_};function Ke(t,e,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s)}ie.inherits(Ke,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ie.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const B2=Ke.prototype,z2={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{z2[t]={value:t}});Object.defineProperties(Ke,z2);Object.defineProperty(B2,"isAxiosError",{value:!0});Ke.from=(t,e,n,r,s,i)=>{const l=Object.create(B2);return ie.toFlatObject(t,l,function(c){return c!==Error.prototype},o=>o!=="isAxiosError"),Ke.call(l,t.message,e,n,r,s),l.cause=t,l.name=t.name,i&&Object.assign(l,i),l};const __=null;function Jm(t){return ie.isPlainObject(t)||ie.isArray(t)}function $2(t){return ie.endsWith(t,"[]")?t.slice(0,-2):t}function Hb(t,e,n){return t?t.concat(e).map(function(s,i){return s=$2(s),!n&&i?"["+s+"]":s}).join(n?".":""):e}function M_(t){return ie.isArray(t)&&!t.some(Jm)}const T_=ie.toFlatObject(ie,{},null,function(e){return/^is[A-Z]/.test(e)});function Wh(t,e,n){if(!ie.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=ie.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,v){return!ie.isUndefined(v[x])});const r=n.metaTokens,s=n.visitor||h,i=n.dots,l=n.indexes,c=(n.Blob||typeof Blob<"u"&&Blob)&&ie.isSpecCompliantForm(e);if(!ie.isFunction(s))throw new TypeError("visitor must be a function");function u(m){if(m===null)return"";if(ie.isDate(m))return m.toISOString();if(!c&&ie.isBlob(m))throw new Ke("Blob is not supported. Use a Buffer instead.");return ie.isArrayBuffer(m)||ie.isTypedArray(m)?c&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function h(m,x,v){let g=m;if(m&&!v&&typeof m=="object"){if(ie.endsWith(x,"{}"))x=r?x:x.slice(0,-2),m=JSON.stringify(m);else if(ie.isArray(m)&&M_(m)||(ie.isFileList(m)||ie.endsWith(x,"[]"))&&(g=ie.toArray(m)))return x=$2(x),g.forEach(function(b,k){!(ie.isUndefined(b)||b===null)&&e.append(l===!0?Hb([x],k,i):l===null?x:x+"[]",u(b))}),!1}return Jm(m)?!0:(e.append(Hb(v,x,i),u(m)),!1)}const d=[],f=Object.assign(T_,{defaultVisitor:h,convertValue:u,isVisitable:Jm});function p(m,x){if(!ie.isUndefined(m)){if(d.indexOf(m)!==-1)throw Error("Circular reference detected in "+x.join("."));d.push(m),ie.forEach(m,function(g,y){(!(ie.isUndefined(g)||g===null)&&s.call(e,g,ie.isString(y)?y.trim():y,x,f))===!0&&p(g,x?x.concat(y):[y])}),d.pop()}}if(!ie.isObject(t))throw new TypeError("data must be an object");return p(t),e}function qb(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function h0(t,e){this._pairs=[],t&&Wh(t,this,e)}const U2=h0.prototype;U2.append=function(e,n){this._pairs.push([e,n])};U2.toString=function(e){const n=e?function(r){return e.call(this,r,qb)}:qb;return this._pairs.map(function(s){return n(s[0])+"="+n(s[1])},"").join("&")};function R_(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function H2(t,e,n){if(!e)return t;const r=n&&n.encode||R_,s=n&&n.serialize;let i;if(s?i=s(e,n):i=ie.isURLSearchParams(e)?e.toString():new h0(e,n).toString(r),i){const l=t.indexOf("#");l!==-1&&(t=t.slice(0,l)),t+=(t.indexOf("?")===-1?"?":"&")+i}return t}class Vb{constructor(){this.handlers=[]}use(e,n,r){return this.handlers.push({fulfilled:e,rejected:n,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ie.forEach(this.handlers,function(r){r!==null&&e(r)})}}const q2={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},D_=typeof URLSearchParams<"u"?URLSearchParams:h0,L_=typeof FormData<"u"?FormData:null,O_=typeof Blob<"u"?Blob:null,I_={isBrowser:!0,classes:{URLSearchParams:D_,FormData:L_,Blob:O_},protocols:["http","https","file","blob","url","data"]},V2=typeof window<"u"&&typeof document<"u",F_=(t=>V2&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),B_=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",z_=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:V2,hasStandardBrowserEnv:F_,hasStandardBrowserWebWorkerEnv:B_},Symbol.toStringTag,{value:"Module"})),os={...z_,...I_};function $_(t,e){return Wh(t,new os.classes.URLSearchParams,Object.assign({visitor:function(n,r,s,i){return os.isNode&&ie.isBuffer(n)?(this.append(r,n.toString("base64")),!1):i.defaultVisitor.apply(this,arguments)}},e))}function U_(t){return ie.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function H_(t){const e={},n=Object.keys(t);let r;const s=n.length;let i;for(r=0;r<s;r++)i=n[r],e[i]=t[i];return e}function W2(t){function e(n,r,s,i){let l=n[i++];if(l==="__proto__")return!0;const o=Number.isFinite(+l),c=i>=n.length;return l=!l&&ie.isArray(s)?s.length:l,c?(ie.hasOwnProp(s,l)?s[l]=[s[l],r]:s[l]=r,!o):((!s[l]||!ie.isObject(s[l]))&&(s[l]=[]),e(n,r,s[l],i)&&ie.isArray(s[l])&&(s[l]=H_(s[l])),!o)}if(ie.isFormData(t)&&ie.isFunction(t.entries)){const n={};return ie.forEachEntry(t,(r,s)=>{e(U_(r),s,n,0)}),n}return null}function q_(t,e,n){if(ie.isString(t))try{return(e||JSON.parse)(t),ie.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(n||JSON.stringify)(t)}const Zc={transitional:q2,adapter:["xhr","http"],transformRequest:[function(e,n){const r=n.getContentType()||"",s=r.indexOf("application/json")>-1,i=ie.isObject(e);if(i&&ie.isHTMLForm(e)&&(e=new FormData(e)),ie.isFormData(e))return s?JSON.stringify(W2(e)):e;if(ie.isArrayBuffer(e)||ie.isBuffer(e)||ie.isStream(e)||ie.isFile(e)||ie.isBlob(e))return e;if(ie.isArrayBufferView(e))return e.buffer;if(ie.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return $_(e,this.formSerializer).toString();if((o=ie.isFileList(e))||r.indexOf("multipart/form-data")>-1){const c=this.env&&this.env.FormData;return Wh(o?{"files[]":e}:e,c&&new c,this.formSerializer)}}return i||s?(n.setContentType("application/json",!1),q_(e)):e}],transformResponse:[function(e){const n=this.transitional||Zc.transitional,r=n&&n.forcedJSONParsing,s=this.responseType==="json";if(e&&ie.isString(e)&&(r&&!this.responseType||s)){const l=!(n&&n.silentJSONParsing)&&s;try{return JSON.parse(e)}catch(o){if(l)throw o.name==="SyntaxError"?Ke.from(o,Ke.ERR_BAD_RESPONSE,this,null,this.response):o}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:os.classes.FormData,Blob:os.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ie.forEach(["delete","get","head","post","put","patch"],t=>{Zc.headers[t]={}});const V_=ie.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),W_=t=>{const e={};let n,r,s;return t&&t.split(`
`).forEach(function(l){s=l.indexOf(":"),n=l.substring(0,s).trim().toLowerCase(),r=l.substring(s+1).trim(),!(!n||e[n]&&V_[n])&&(n==="set-cookie"?e[n]?e[n].push(r):e[n]=[r]:e[n]=e[n]?e[n]+", "+r:r)}),e},Wb=Symbol("internals");function vo(t){return t&&String(t).trim().toLowerCase()}function xd(t){return t===!1||t==null?t:ie.isArray(t)?t.map(xd):String(t)}function K_(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(t);)e[r[1]]=r[2];return e}const Q_=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Gf(t,e,n,r,s){if(ie.isFunction(r))return r.call(this,e,n);if(s&&(e=n),!!ie.isString(e)){if(ie.isString(r))return e.indexOf(r)!==-1;if(ie.isRegExp(r))return r.test(e)}}function G_(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,r)=>n.toUpperCase()+r)}function X_(t,e){const n=ie.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+n,{value:function(s,i,l){return this[r].call(this,e,s,i,l)},configurable:!0})})}let jr=class{constructor(e){e&&this.set(e)}set(e,n,r){const s=this;function i(o,c,u){const h=vo(c);if(!h)throw new Error("header name must be a non-empty string");const d=ie.findKey(s,h);(!d||s[d]===void 0||u===!0||u===void 0&&s[d]!==!1)&&(s[d||c]=xd(o))}const l=(o,c)=>ie.forEach(o,(u,h)=>i(u,h,c));return ie.isPlainObject(e)||e instanceof this.constructor?l(e,n):ie.isString(e)&&(e=e.trim())&&!Q_(e)?l(W_(e),n):e!=null&&i(n,e,r),this}get(e,n){if(e=vo(e),e){const r=ie.findKey(this,e);if(r){const s=this[r];if(!n)return s;if(n===!0)return K_(s);if(ie.isFunction(n))return n.call(this,s,r);if(ie.isRegExp(n))return n.exec(s);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=vo(e),e){const r=ie.findKey(this,e);return!!(r&&this[r]!==void 0&&(!n||Gf(this,this[r],r,n)))}return!1}delete(e,n){const r=this;let s=!1;function i(l){if(l=vo(l),l){const o=ie.findKey(r,l);o&&(!n||Gf(r,r[o],o,n))&&(delete r[o],s=!0)}}return ie.isArray(e)?e.forEach(i):i(e),s}clear(e){const n=Object.keys(this);let r=n.length,s=!1;for(;r--;){const i=n[r];(!e||Gf(this,this[i],i,e,!0))&&(delete this[i],s=!0)}return s}normalize(e){const n=this,r={};return ie.forEach(this,(s,i)=>{const l=ie.findKey(r,i);if(l){n[l]=xd(s),delete n[i];return}const o=e?G_(i):String(i).trim();o!==i&&delete n[i],n[o]=xd(s),r[o]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return ie.forEach(this,(r,s)=>{r!=null&&r!==!1&&(n[s]=e&&ie.isArray(r)?r.join(", "):r)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const r=new this(e);return n.forEach(s=>r.set(s)),r}static accessor(e){const r=(this[Wb]=this[Wb]={accessors:{}}).accessors,s=this.prototype;function i(l){const o=vo(l);r[o]||(X_(s,l),r[o]=!0)}return ie.isArray(e)?e.forEach(i):i(e),this}};jr.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);ie.reduceDescriptors(jr.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[n]=r}}});ie.freezeMethods(jr);function Xf(t,e){const n=this||Zc,r=e||n,s=jr.from(r.headers);let i=r.data;return ie.forEach(t,function(o){i=o.call(n,i,s.normalize(),e?e.status:void 0)}),s.normalize(),i}function K2(t){return!!(t&&t.__CANCEL__)}function eu(t,e,n){Ke.call(this,t??"canceled",Ke.ERR_CANCELED,e,n),this.name="CanceledError"}ie.inherits(eu,Ke,{__CANCEL__:!0});function J_(t,e,n){const r=n.config.validateStatus;!n.status||!r||r(n.status)?t(n):e(new Ke("Request failed with status code "+n.status,[Ke.ERR_BAD_REQUEST,Ke.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}const Y_=os.hasStandardBrowserEnv?{write(t,e,n,r,s,i){const l=[t+"="+encodeURIComponent(e)];ie.isNumber(n)&&l.push("expires="+new Date(n).toGMTString()),ie.isString(r)&&l.push("path="+r),ie.isString(s)&&l.push("domain="+s),i===!0&&l.push("secure"),document.cookie=l.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Z_(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function eM(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Q2(t,e){return t&&!Z_(e)?eM(t,e):e}const tM=os.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");let r;function s(i){let l=i;return e&&(n.setAttribute("href",l),l=n.href),n.setAttribute("href",l),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return r=s(window.location.href),function(l){const o=ie.isString(l)?s(l):l;return o.protocol===r.protocol&&o.host===r.host}}():function(){return function(){return!0}}();function nM(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function rM(t,e){t=t||10;const n=new Array(t),r=new Array(t);let s=0,i=0,l;return e=e!==void 0?e:1e3,function(c){const u=Date.now(),h=r[i];l||(l=u),n[s]=c,r[s]=u;let d=i,f=0;for(;d!==s;)f+=n[d++],d=d%t;if(s=(s+1)%t,s===i&&(i=(i+1)%t),u-l<e)return;const p=h&&u-h;return p?Math.round(f*1e3/p):void 0}}function Kb(t,e){let n=0;const r=rM(50,250);return s=>{const i=s.loaded,l=s.lengthComputable?s.total:void 0,o=i-n,c=r(o),u=i<=l;n=i;const h={loaded:i,total:l,progress:l?i/l:void 0,bytes:o,rate:c||void 0,estimated:c&&l&&u?(l-i)/c:void 0,event:s};h[e?"download":"upload"]=!0,t(h)}}const sM=typeof XMLHttpRequest<"u",iM=sM&&function(t){return new Promise(function(n,r){let s=t.data;const i=jr.from(t.headers).normalize();let{responseType:l,withXSRFToken:o}=t,c;function u(){t.cancelToken&&t.cancelToken.unsubscribe(c),t.signal&&t.signal.removeEventListener("abort",c)}let h;if(ie.isFormData(s)){if(os.hasStandardBrowserEnv||os.hasStandardBrowserWebWorkerEnv)i.setContentType(!1);else if((h=i.getContentType())!==!1){const[x,...v]=h?h.split(";").map(g=>g.trim()).filter(Boolean):[];i.setContentType([x||"multipart/form-data",...v].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const x=t.auth.username||"",v=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";i.set("Authorization","Basic "+btoa(x+":"+v))}const f=Q2(t.baseURL,t.url);d.open(t.method.toUpperCase(),H2(f,t.params,t.paramsSerializer),!0),d.timeout=t.timeout;function p(){if(!d)return;const x=jr.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),g={data:!l||l==="text"||l==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:x,config:t,request:d};J_(function(b){n(b),u()},function(b){r(b),u()},g),d=null}if("onloadend"in d?d.onloadend=p:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(p)},d.onabort=function(){d&&(r(new Ke("Request aborted",Ke.ECONNABORTED,t,d)),d=null)},d.onerror=function(){r(new Ke("Network Error",Ke.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let v=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const g=t.transitional||q2;t.timeoutErrorMessage&&(v=t.timeoutErrorMessage),r(new Ke(v,g.clarifyTimeoutError?Ke.ETIMEDOUT:Ke.ECONNABORTED,t,d)),d=null},os.hasStandardBrowserEnv&&(o&&ie.isFunction(o)&&(o=o(t)),o||o!==!1&&tM(f))){const x=t.xsrfHeaderName&&t.xsrfCookieName&&Y_.read(t.xsrfCookieName);x&&i.set(t.xsrfHeaderName,x)}s===void 0&&i.setContentType(null),"setRequestHeader"in d&&ie.forEach(i.toJSON(),function(v,g){d.setRequestHeader(g,v)}),ie.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),l&&l!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",Kb(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",Kb(t.onUploadProgress)),(t.cancelToken||t.signal)&&(c=x=>{d&&(r(!x||x.type?new eu(null,t,d):x),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(c),t.signal&&(t.signal.aborted?c():t.signal.addEventListener("abort",c)));const m=nM(f);if(m&&os.protocols.indexOf(m)===-1){r(new Ke("Unsupported protocol "+m+":",Ke.ERR_BAD_REQUEST,t));return}d.send(s||null)})},Ym={http:__,xhr:iM};ie.forEach(Ym,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Qb=t=>`- ${t}`,lM=t=>ie.isFunction(t)||t===null||t===!1,G2={getAdapter:t=>{t=ie.isArray(t)?t:[t];const{length:e}=t;let n,r;const s={};for(let i=0;i<e;i++){n=t[i];let l;if(r=n,!lM(n)&&(r=Ym[(l=String(n)).toLowerCase()],r===void 0))throw new Ke(`Unknown adapter '${l}'`);if(r)break;s[l||"#"+i]=r}if(!r){const i=Object.entries(s).map(([o,c])=>`adapter ${o} `+(c===!1?"is not supported by the environment":"is not available in the build"));let l=e?i.length>1?`since :
`+i.map(Qb).join(`
`):" "+Qb(i[0]):"as no adapter specified";throw new Ke("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return r},adapters:Ym};function Jf(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new eu(null,t)}function Gb(t){return Jf(t),t.headers=jr.from(t.headers),t.data=Xf.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),G2.getAdapter(t.adapter||Zc.adapter)(t).then(function(r){return Jf(t),r.data=Xf.call(t,t.transformResponse,r),r.headers=jr.from(r.headers),r},function(r){return K2(r)||(Jf(t),r&&r.response&&(r.response.data=Xf.call(t,t.transformResponse,r.response),r.response.headers=jr.from(r.response.headers))),Promise.reject(r)})}const Xb=t=>t instanceof jr?{...t}:t;function $a(t,e){e=e||{};const n={};function r(u,h,d){return ie.isPlainObject(u)&&ie.isPlainObject(h)?ie.merge.call({caseless:d},u,h):ie.isPlainObject(h)?ie.merge({},h):ie.isArray(h)?h.slice():h}function s(u,h,d){if(ie.isUndefined(h)){if(!ie.isUndefined(u))return r(void 0,u,d)}else return r(u,h,d)}function i(u,h){if(!ie.isUndefined(h))return r(void 0,h)}function l(u,h){if(ie.isUndefined(h)){if(!ie.isUndefined(u))return r(void 0,u)}else return r(void 0,h)}function o(u,h,d){if(d in e)return r(u,h);if(d in t)return r(void 0,u)}const c={url:i,method:i,data:i,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:o,headers:(u,h)=>s(Xb(u),Xb(h),!0)};return ie.forEach(Object.keys(Object.assign({},t,e)),function(h){const d=c[h]||s,f=d(t[h],e[h],h);ie.isUndefined(f)&&d!==o||(n[h]=f)}),n}const X2="1.6.8",f0={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{f0[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const Jb={};f0.transitional=function(e,n,r){function s(i,l){return"[Axios v"+X2+"] Transitional option '"+i+"'"+l+(r?". "+r:"")}return(i,l,o)=>{if(e===!1)throw new Ke(s(l," has been removed"+(n?" in "+n:"")),Ke.ERR_DEPRECATED);return n&&!Jb[l]&&(Jb[l]=!0,console.warn(s(l," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(i,l,o):!0}};function aM(t,e,n){if(typeof t!="object")throw new Ke("options must be an object",Ke.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let s=r.length;for(;s-- >0;){const i=r[s],l=e[i];if(l){const o=t[i],c=o===void 0||l(o,i,t);if(c!==!0)throw new Ke("option "+i+" must be "+c,Ke.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Ke("Unknown option "+i,Ke.ERR_BAD_OPTION)}}const Zm={assertOptions:aM,validators:f0},Ks=Zm.validators;let fl=class{constructor(e){this.defaults=e,this.interceptors={request:new Vb,response:new Vb}}async request(e,n){try{return await this._request(e,n)}catch(r){if(r instanceof Error){let s;Error.captureStackTrace?Error.captureStackTrace(s={}):s=new Error;const i=s.stack?s.stack.replace(/^.+\n/,""):"";r.stack?i&&!String(r.stack).endsWith(i.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+i):r.stack=i}throw r}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=$a(this.defaults,n);const{transitional:r,paramsSerializer:s,headers:i}=n;r!==void 0&&Zm.assertOptions(r,{silentJSONParsing:Ks.transitional(Ks.boolean),forcedJSONParsing:Ks.transitional(Ks.boolean),clarifyTimeoutError:Ks.transitional(Ks.boolean)},!1),s!=null&&(ie.isFunction(s)?n.paramsSerializer={serialize:s}:Zm.assertOptions(s,{encode:Ks.function,serialize:Ks.function},!0)),n.method=(n.method||this.defaults.method||"get").toLowerCase();let l=i&&ie.merge(i.common,i[n.method]);i&&ie.forEach(["delete","get","head","post","put","patch","common"],m=>{delete i[m]}),n.headers=jr.concat(l,i);const o=[];let c=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(n)===!1||(c=c&&x.synchronous,o.unshift(x.fulfilled,x.rejected))});const u=[];this.interceptors.response.forEach(function(x){u.push(x.fulfilled,x.rejected)});let h,d=0,f;if(!c){const m=[Gb.bind(this),void 0];for(m.unshift.apply(m,o),m.push.apply(m,u),f=m.length,h=Promise.resolve(n);d<f;)h=h.then(m[d++],m[d++]);return h}f=o.length;let p=n;for(d=0;d<f;){const m=o[d++],x=o[d++];try{p=m(p)}catch(v){x.call(this,v);break}}try{h=Gb.call(this,p)}catch(m){return Promise.reject(m)}for(d=0,f=u.length;d<f;)h=h.then(u[d++],u[d++]);return h}getUri(e){e=$a(this.defaults,e);const n=Q2(e.baseURL,e.url);return H2(n,e.params,e.paramsSerializer)}};ie.forEach(["delete","get","head","options"],function(e){fl.prototype[e]=function(n,r){return this.request($a(r||{},{method:e,url:n,data:(r||{}).data}))}});ie.forEach(["post","put","patch"],function(e){function n(r){return function(i,l,o){return this.request($a(o||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:i,data:l}))}}fl.prototype[e]=n(),fl.prototype[e+"Form"]=n(!0)});let oM=class J2{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(i){n=i});const r=this;this.promise.then(s=>{if(!r._listeners)return;let i=r._listeners.length;for(;i-- >0;)r._listeners[i](s);r._listeners=null}),this.promise.then=s=>{let i;const l=new Promise(o=>{r.subscribe(o),i=o}).then(s);return l.cancel=function(){r.unsubscribe(i)},l},e(function(i,l,o){r.reason||(r.reason=new eu(i,l,o),n(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}static source(){let e;return{token:new J2(function(s){e=s}),cancel:e}}};function cM(t){return function(n){return t.apply(null,n)}}function uM(t){return ie.isObject(t)&&t.isAxiosError===!0}const eg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(eg).forEach(([t,e])=>{eg[e]=t});function Y2(t){const e=new fl(t),n=M2(fl.prototype.request,e);return ie.extend(n,fl.prototype,e,{allOwnKeys:!0}),ie.extend(n,e,null,{allOwnKeys:!0}),n.create=function(s){return Y2($a(t,s))},n}const Pt=Y2(Zc);Pt.Axios=fl;Pt.CanceledError=eu;Pt.CancelToken=oM;Pt.isCancel=K2;Pt.VERSION=X2;Pt.toFormData=Wh;Pt.AxiosError=Ke;Pt.Cancel=Pt.CanceledError;Pt.all=function(e){return Promise.all(e)};Pt.spread=cM;Pt.isAxiosError=uM;Pt.mergeConfig=$a;Pt.AxiosHeaders=jr;Pt.formToJSON=t=>W2(ie.isHTMLForm(t)?new FormData(t):t);Pt.getAdapter=G2.getAdapter;Pt.HttpStatusCode=eg;Pt.default=Pt;const{Axios:uU,AxiosError:dU,CanceledError:hU,isCancel:fU,CancelToken:pU,VERSION:mU,all:gU,Cancel:xU,isAxiosError:yU,spread:bU,toFormData:vU,AxiosHeaders:wU,HttpStatusCode:kU,formToJSON:jU,getAdapter:SU,mergeConfig:NU}=Pt,dM=()=>typeof window<"u"&&(window!=null&&window.location)?window.location.origin:"",hM=typeof import.meta<"u"&&"http://localhost:8000"||dM(),kl=hM.replace(/\/$/,""),Z2=`${kl}/api/v1`.replace(/^\/api\//,"/api/"),sn=t=>{const e=t.startsWith("/")?t:`/${t}`;return`${Z2}${e}`},X=Pt.create({baseURL:Z2||"/api/v1",timeout:6e4,headers:{"Content-Type":"application/json"}});let Yf=!1,tg=[];const Yb=(t,e=null)=>{tg.forEach(({resolve:n,reject:r})=>{t?r(t):n(e)}),tg=[]},lh=async()=>{const t=localStorage.getItem("refresh_token");if(!t)throw new Error("No refresh token available");try{const e=await Pt.post(sn("/refresh"),{refresh_token:t}),{access_token:n,refresh_token:r}=e.data;return localStorage.setItem("access_token",n),localStorage.setItem("refresh_token",r),n}catch(e){throw localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),e}},fM=t=>{if(typeof atob=="function")return atob(t);if(typeof globalThis<"u"){const e=globalThis.Buffer;if(e)return e.from(t,"base64").toString("utf-8")}throw new Error("No base64 decoder available")},pM=t=>{const e=t.split(".");if(e.length<2)throw new Error("Invalid JWT structure");const n=e[1].replace(/-/g,"+").replace(/_/g,"/"),r=(4-(n.length%4||4))%4,s=n+"=".repeat(r),i=fM(s);return JSON.parse(i)},ah=()=>{const t=localStorage.getItem("access_token");if(t){if(!t.includes(".")||t.split(".").length<3){console.warn("Removing malformed access token from storage (token refresh timer)"),localStorage.removeItem("access_token");return}try{const n=pM(t).exp,r=typeof n=="number"?n:Number(n);if(!r||Number.isNaN(r))throw new Error("Missing exp claim");const s=r*1e3,i=Date.now(),o=s-i-5*60*1e3;o>0&&setTimeout(async()=>{try{await lh(),console.log("Proactive token refresh successful"),ah()}catch(c){console.error("Proactive token refresh failed:",c)}},o)}catch(e){console.error("Error setting up token refresh timer:",e),localStorage.removeItem("access_token")}}};typeof window<"u"&&ah();X.interceptors.request.use(t=>{const e=localStorage.getItem("access_token");return e&&(t.headers={...t.headers??{},Authorization:`Bearer ${e}`}),t},t=>Promise.reject(t));X.interceptors.response.use(t=>t,async t=>{var n;const e=(t==null?void 0:t.config)||{};if(((n=t==null?void 0:t.response)==null?void 0:n.status)===401&&!e._retry){if(Yf)return new Promise((r,s)=>{tg.push({resolve:r,reject:s})}).then(r=>(r&&(e.headers={...e.headers??{},Authorization:`Bearer ${r}`}),X(e))).catch(r=>Promise.reject(r));e._retry=!0,Yf=!0;try{const r=await lh();return X.defaults.headers.common.Authorization=`Bearer ${r}`,e.headers={...e.headers??{},Authorization:`Bearer ${r}`},Yb(null,r),X(e)}catch(r){return Yb(r,null),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),window.location.href="/login",Promise.reject(r)}finally{Yf=!1}}return Promise.reject(t)});const Zf={register:t=>X.post("/register",t),login:t=>X.post("/login",{email:t.email,password:t.password},{headers:{"Content-Type":"application/json"}}),refresh:t=>X.post("/refresh",{refresh_token:t}),getCurrentUser:()=>X.get("/me")},oh={getUsers:()=>X.get("/users"),getUser:t=>X.get(`/users/${t}`),updateUser:(t,e)=>X.put(`/users/${t}`,e),changePassword:t=>X.post("/change-password",t),lookupByEmail:t=>X.get("/users/lookup-by-email",{params:{email:t}})},mr={list:({skip:t=0,limit:e=50}={})=>X.get("/projects/",{params:{skip:t,limit:e}}),create:t=>X.post("/projects/",t),get:t=>X.get(`/projects/${t}`),update:(t,e)=>X.put(`/projects/${t}`,e),delete:t=>X.delete(`/projects/${t}`),addMember:(t,e)=>X.post(`/projects/${t}/members`,e),updateMember:(t,e,n)=>X.patch(`/projects/${t}/members/${e}`,n),removeMember:(t,e)=>X.delete(`/projects/${t}/members/${e}`),listPendingInvitations:()=>X.get("/projects/pending/invitations"),acceptInvitation:(t,e)=>X.post(`/projects/${t}/members/${e}/accept`,null),declineInvitation:(t,e)=>X.post(`/projects/${t}/members/${e}/decline`,null)},An={listSuggestions:t=>X.get(`/projects/${t}/references/suggestions`),list:(t,e)=>X.get(`/projects/${t}/references`,{params:e!=null&&e.status?{status:e.status}:void 0}),refreshSuggestions:t=>X.post(`/projects/${t}/references/suggestions/refresh`),createSuggestion:(t,e,n)=>X.post(`/projects/${t}/references/suggestions`,null,{params:{reference_id:e,confidence:n}}),approveSuggestion:(t,e,n)=>X.post(`/projects/${t}/references/${e}/approve`,null,{params:n?{paper_id:n}:void 0}),rejectSuggestion:(t,e)=>X.post(`/projects/${t}/references/${e}/reject`,null),attachToPaper:(t,e,n)=>X.post(`/projects/${t}/references/${e}/attach`,{paper_id:n}),detachFromPaper:(t,e,n)=>X.delete(`/projects/${t}/references/${e}/papers/${n}`),remove:(t,e)=>X.delete(`/projects/${t}/references/${e}`),listPaperReferences:(t,e)=>X.get(`/projects/${t}/papers/${e}/references`)},ws={getSettings:t=>X.get(`/projects/${t}/discovery/settings`),updateSettings:(t,e)=>X.put(`/projects/${t}/discovery/settings`,e),runDiscovery:(t,e)=>X.post(`/projects/${t}/discovery/run`,e,{timeout:12e4}),listResults:(t,e)=>X.get(`/projects/${t}/discovery/results`,{params:{status:e==null?void 0:e.status,skip:e==null?void 0:e.skip,limit:e==null?void 0:e.limit}}),getPendingCount:t=>X.get(`/projects/${t}/discovery/results/pending/count`),promoteResult:(t,e)=>X.post(`/projects/${t}/discovery/results/${e}/promote`,null),dismissResult:(t,e)=>X.post(`/projects/${t}/discovery/results/${e}/dismiss`,null),deleteResult:(t,e)=>X.delete(`/projects/${t}/discovery/results/${e}`),clearDismissedResults:t=>X.delete(`/projects/${t}/discovery/results/dismissed`),streamDiscovery:(t,e)=>fetch(sn(`/projects/${t}/discovery/stream`),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify(e)})},Hl={listMeetings:(t,e)=>X.get(`/projects/${t}/meetings`,{params:e!=null&&e.status?{status_filter:e.status}:void 0}),listSyncSessions:t=>X.get(`/projects/${t}/sync-sessions`),createSyncSession:(t,e)=>X.post(`/projects/${t}/sync-sessions`,e),endSyncSession:(t,e,n)=>X.post(`/projects/${t}/sync-sessions/${e}/end`,n),listSyncMessages:(t,e)=>X.get(`/projects/${t}/sync-sessions/${e}/messages`),createSyncMessage:(t,e,n)=>X.post(`/projects/${t}/sync-sessions/${e}/messages`,n),attachRecording:(t,e,n)=>X.post(`/projects/${t}/sync-sessions/${e}/recording`,n),uploadRecording:(t,e,n)=>{const r=new FormData;return r.append("file",n),X.post(`/projects/${t}/sync-sessions/${e}/recording/upload`,r,{headers:{"Content-Type":"multipart/form-data"}})},createCallToken:(t,e)=>X.post(`/projects/${t}/sync-sessions/${e}/token`,{}),deleteSyncSession:(t,e)=>X.delete(`/projects/${t}/sync-sessions/${e}`)},mM={listProjectNotifications:(t,e)=>X.get(`/projects/${t}/notifications`,{params:{unread_only:(e==null?void 0:e.unreadOnly)??!1}}),markNotificationAsRead:t=>X.post(`/notifications/${t}/read`,null)},dn={listMessages:(t,e)=>X.get(`/projects/${t}/discussion/messages`,{params:{limit:(e==null?void 0:e.limit)??100,offset:(e==null?void 0:e.offset)??0,parent_id:e==null?void 0:e.parentId,channel_id:e==null?void 0:e.channelId}}),listThreads:(t,e)=>X.get(`/projects/${t}/discussion/threads`,{params:{limit:(e==null?void 0:e.limit)??50,offset:(e==null?void 0:e.offset)??0,channel_id:e==null?void 0:e.channelId}}),createMessage:(t,e)=>X.post(`/projects/${t}/discussion/messages`,e),updateMessage:(t,e,n)=>X.put(`/projects/${t}/discussion/messages/${e}`,n),deleteMessage:(t,e)=>X.delete(`/projects/${t}/discussion/messages/${e}`),getStats:(t,e)=>X.get(`/projects/${t}/discussion/stats`,{params:{channel_id:e==null?void 0:e.channelId}}),listChannels:(t,e)=>X.get(`/projects/${t}/discussion/channels`,{params:{include_archived:(e==null?void 0:e.includeArchived)??!1}}),createChannel:(t,e)=>X.post(`/projects/${t}/discussion/channels`,e),updateChannel:(t,e,n)=>X.put(`/projects/${t}/discussion/channels/${e}`,n),listAssistantHistory:(t,e)=>X.get(`/projects/${t}/discussion/channels/${e}/assistant-history`),listChannelResources:(t,e)=>X.get(`/projects/${t}/discussion/channels/${e}/resources`),createChannelResource:(t,e,n)=>X.post(`/projects/${t}/discussion/channels/${e}/resources`,n),deleteChannelResource:(t,e,n)=>X.delete(`/projects/${t}/discussion/channels/${e}/resources/${n}`),listTasks:(t,e)=>X.get(`/projects/${t}/discussion/tasks`,{params:{channel_id:e==null?void 0:e.channelId,status_filter:e==null?void 0:e.status}}),createTask:(t,e,n)=>X.post(`/projects/${t}/discussion/channels/${e}/tasks`,n),updateTask:(t,e,n)=>X.put(`/projects/${t}/discussion/tasks/${e}`,n),deleteTask:(t,e)=>X.delete(`/projects/${t}/discussion/tasks/${e}`),invokeAssistant:(t,e,n)=>X.post(`/projects/${t}/discussion/channels/${e}/assistant`,n)},rt={createPaper:t=>X.post("/research-papers/",t),getPapers:(t=0,e=100)=>{let n=0,r=e,s;typeof t=="object"&&t!==null?(n=t.skip??0,r=t.limit??e,s=t.projectId):(n=t,r=e);const i=new URLSearchParams;return i.set("skip",String(n)),i.set("limit",String(r)),s&&i.set("project_id",s),X.get(`/research-papers/?${i.toString()}`)},getPaper:t=>X.get(`/research-papers/${t}`),updatePaper:(t,e)=>X.put(`/research-papers/${t}`,e),deletePaper:t=>X.delete(`/research-papers/${t}`),updatePaperContent:(t,e)=>X.put(`/research-papers/${t}/content`,e),getPaperVersions:t=>X.get(`/research-papers/${t}/versions`),getPaperVersion:(t,e)=>X.get(`/research-papers/${t}/versions/${e}`),createPaperVersion:(t,e)=>X.post(`/research-papers/${t}/versions`,e),restorePaperVersion:(t,e)=>X.put(`/research-papers/${t}/versions/${e}/restore`),_getOrCreateBranchId:async(t,e)=>{const n=await X.get(`/branches/paper/${t}`);let s=(Array.isArray(n.data)?n.data:[]).find(i=>((i==null?void 0:i.name)||"").toLowerCase()===(e||"").toLowerCase());return s||(s=(await X.post("/branches/",{name:e,paper_id:t})).data),s==null?void 0:s.id},saveVersion:async(t,e,n,r="main",s,i)=>{const l=await rt._getOrCreateBranchId(t,r),o={message:n||"Update",content:e,content_json:s};return i&&(i.compilation_status&&(o.compilation_status=i.compilation_status),i.pdf_url&&(o.pdf_url=i.pdf_url),i.compile_logs&&(o.compile_logs=i.compile_logs)),(await X.post(`/branches/${l}/commit`,o)).data},getVersionHistory:async(t,e="main",n=50,r)=>{const s=await rt._getOrCreateBranchId(t,e),i=new URLSearchParams;r!=null&&r.state&&i.set("state",r.state);const l=i.toString()?`/branches/${s}/commits?${i}`:`/branches/${s}/commits`,o=await X.get(l);return(Array.isArray(o.data)?o.data:[]).slice(0,n)},updateCommitState:async(t,e)=>(await X.put(`/branches/commit/${t}`,{state:e})).data,switchBranch:async(t,e="main")=>{const n=await rt._getOrCreateBranchId(t,e),r=await X.post(`/branches/${n}/switch`,{paper_id:t}),s=await X.get(`/branches/${n}/commits`),i=Array.isArray(s.data)&&s.data.length>0?s.data[0]:null;return{...r.data,headCommit:i}},mergeBranches:async(t,e,n="auto")=>(await X.post("/branches/merge",{source_branch_id:t,target_branch_id:e,strategy:n})).data,addPaperMember:(t,e)=>X.post(`/research-papers/${t}/members`,e),getPendingInvitations:()=>X.get("/research-papers/invitations/pending"),addReference:(t,e)=>X.post(`/research-papers/${t}/references`,e),listReferences:t=>X.get(`/research-papers/${t}/references`),deleteReference:(t,e)=>X.delete(`/research-papers/${t}/references/${e}`)},gM={uploadDocument:t=>X.post("/documents/upload",t,{headers:{"Content-Type":"multipart/form-data"}}),getDocuments:(t,e=0,n=100)=>{const r=new URLSearchParams;return t&&r.append("paper_id",t),r.append("skip",e.toString()),r.append("limit",n.toString()),X.get(`/documents/list?${r.toString()}`)},getDocument:t=>X.get(`/documents/${t}`),createDocument:t=>X.post("/documents/",t),updateDocument:(t,e)=>X.put(`/documents/${t}`,e),deleteDocument:t=>X.delete(`/documents/${t}`),getDocumentChunks:(t,e=0,n=100)=>X.get(`/documents/${t}/chunks?skip=${e}&limit=${n}`),analyzeDocument:t=>X.post(`/documents/${t}/analyze`),chatWithDocument:(t,e)=>X.post(`/documents/${t}/chat`,{question:e}),ingestRemote:t=>X.post("/documents/ingest-remote",t,{headers:{"Content-Type":"multipart/form-data"}})},xM={getTeamMembers:t=>X.get(`/team/papers/${t}/members`),inviteTeamMember:(t,e,n)=>X.post(`/team/papers/${t}/invite`,{email:e,role:n}),acceptInvitation:(t,e)=>X.post(`/team/papers/${t}/members/${e}/accept`),declineInvitation:(t,e)=>X.post(`/team/papers/${t}/members/${e}/decline`),removeTeamMember:(t,e)=>X.delete(`/team/papers/${t}/members/${e}`),updateMemberRole:(t,e,n)=>X.patch(`/team/papers/${t}/members/${e}`,{role:n})},ur={chatWithReferences:(t,e)=>X.post("/ai/chat-with-references",{query:t,paper_id:e||null}),ingestReference:(t,e)=>X.post(`/ai/references/${t}/ingest`,{},{params:{force_reprocess:e||!1}}),ingestPaperReferences:(t,e)=>X.post(`/ai/papers/${t}/ingest-references`,{},{params:{force_reprocess:e||!1}}),getReferenceChatStatus:t=>X.get(`/ai/references/${t}/chat-status`),getPaperReferencesChatStatus:t=>X.get(`/ai/papers/${t}/references/chat-status`),chatWithDocuments:t=>X.post("/ai/chat-with-documents",{query:t}),processDocumentForAI:t=>X.post(`/ai/documents/${t}/process`),getDocumentChunks:t=>X.get(`/ai/documents/${t}/chunks`),getChatHistory:(t=20)=>X.get(`/ai/chat-history?limit=${t}`),getAIStatus:()=>X.get("/ai/status"),getModelConfiguration:()=>X.get("/ai/models"),updateModelConfiguration:(t,e,n)=>X.put("/ai/models",{provider:t,embedding_model:e,chat_model:n}),generateText:(t,e,n,r=500)=>X.post("/ai/writing/generate",{text:t,instruction:e,context:n,max_length:r}),checkGrammarAndStyle:(t,e=!0,n=!0,r=!0)=>X.post("/ai/writing/grammar-check",{text:t,check_grammar:e,check_style:n,check_clarity:r}),enhanceWithResearchContext:(t,e,n)=>X.post("/ai/writing/research-context",{text:t,paper_ids:e,query_type:n}),summarizeText:(t,e=150)=>X.post("/ai/summarize",{text:t,max_length:e}),rephraseText:(t,e="academic")=>X.post("/ai/rephrase",{text:t,style:e}),generateOutline:(t,e)=>X.post("/ai/generate-outline",{topic:t,content:e}),extractKeywords:(t,e=10)=>X.post("/ai/extract-keywords",{text:t,max_keywords:e})},gr={listMy:t=>{const e=new URLSearchParams;return t!=null&&t.skip&&e.set("skip",String(t.skip)),t!=null&&t.limit&&e.set("limit",String(t.limit)),t!=null&&t.q&&e.set("q",t.q),X.get(`/references/?${e.toString()}`)},create:t=>X.post("/references/",t),uploadPdf:(t,e)=>{const n=new FormData;return n.append("file",e),X.post(`/references/${t}/upload-pdf`,n,{headers:{"Content-Type":"multipart/form-data"}})},ingestPdf:t=>X.post(`/references/${t}/ingest-pdf`,null),attachToPaper:(t,e)=>{const n=new FormData;return n.append("paper_id",e),X.post(`/references/${t}/attach-to-paper`,n,{headers:{"Content-Type":"multipart/form-data"}})},delete:t=>X.delete(`/references/${t}`)},eS=w.createContext(void 0),Ln=()=>{const t=w.useContext(eS);if(t===void 0)throw new Error("useAuth must be used within an AuthProvider");return t},yM=({children:t})=>{const[e,n]=w.useState(null),[r,s]=w.useState(!0),i=!!e;w.useEffect(()=>{localStorage.getItem("access_token")?u():s(!1)},[]);const l=async(f,p)=>{try{const x=(await Zf.login({email:f,password:p})).data,{access_token:v,refresh_token:g}=x;localStorage.setItem("access_token",v),localStorage.setItem("refresh_token",g),ah(),await u()}catch(m){throw console.error("Login failed:",m),m}},o=async f=>{try{await Zf.register(f),await l(f.email,f.password)}catch(p){throw console.error("Registration failed:",p),p}},c=()=>{localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),n(null)},u=async()=>{var f;try{const m=(await Zf.getCurrentUser()).data;n(m),localStorage.setItem("user",JSON.stringify(m)),ah()}catch(p){if(console.error("Failed to refresh user:",p),((f=p.response)==null?void 0:f.status)===401){c();return}}finally{s(!1)}},d={user:e,isAuthenticated:i,isLoading:r,login:l,register:o,logout:c,refreshUser:u,updateUser:f=>{if(e){const p={...e,...f};n(p),localStorage.setItem("user",JSON.stringify(p))}}};return a.jsx(eS.Provider,{value:d,children:t})},tS=w.createContext(void 0),bM=()=>{const t=w.useContext(tS);if(t===void 0)throw new Error("usePapers must be used within a PapersProvider");return t},vM=({children:t})=>{const[e,n]=w.useState([]),[r,s]=w.useState(!1),[i,l]=w.useState(null),{user:o}=Ln(),c=w.useCallback(async()=>{try{s(!0),l(null);const m=await rt.getPapers(0,100);n(m.data.papers||[])}catch(m){console.error("Error loading papers:",m),l("Failed to load papers")}finally{s(!1)}},[o]),u=w.useCallback(async m=>{try{const v=(await rt.createPaper(m)).data;return n(g=>[v,...g]),v}catch(x){throw console.error("Error creating paper:",x),x}},[]),h=w.useCallback(async(m,x)=>{try{const g=(await rt.updatePaper(m,x)).data;return n(y=>y.map(b=>b.id===m?g:b)),g}catch(v){throw console.error("Error updating paper:",v),v}},[]),d=w.useCallback(async m=>{try{await rt.deletePaper(m),n(x=>x.filter(v=>v.id!==m))}catch(x){throw console.error("Error deleting paper:",x),x}},[]),f=w.useCallback(async()=>{await c()},[c]);w.useEffect(()=>{o?c():(n([]),l(null))},[o,c]);const p={papers:e,isLoading:r,error:i,loadPapers:c,createPaper:u,updatePaper:h,deletePaper:d,refreshPapers:f};return a.jsx(tS.Provider,{value:p,children:t})},wM=({children:t})=>{const{isAuthenticated:e,isLoading:n}=Ln();return n?a.jsx("div",{className:"min-h-screen flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e?a.jsx(a.Fragment,{children:t}):a.jsx(l0,{to:"/login",replace:!0})};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kM=t=>t.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),jM=t=>t.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,n,r)=>r?r.toUpperCase():n.toLowerCase()),Zb=t=>{const e=jM(t);return e.charAt(0).toUpperCase()+e.slice(1)},nS=(...t)=>t.filter((e,n,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===n).join(" ").trim(),SM=t=>{for(const e in t)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var NM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CM=w.forwardRef(({color:t="currentColor",size:e=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:s="",children:i,iconNode:l,...o},c)=>w.createElement("svg",{ref:c,...NM,width:e,height:e,stroke:t,strokeWidth:r?Number(n)*24/Number(e):n,className:nS("lucide",s),...!i&&!SM(o)&&{"aria-hidden":"true"},...o},[...l.map(([u,h])=>w.createElement(u,h)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=(t,e)=>{const n=w.forwardRef(({className:r,...s},i)=>w.createElement(CM,{ref:i,iconNode:e,className:nS(`lucide-${kM(Zb(t))}`,`lucide-${t}`,r),...s}));return n.displayName=Zb(t),n};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AM=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],EM=me("archive",AM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PM=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],p0=me("arrow-left",PM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _M=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],MM=me("arrow-right",_M);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TM=[["path",{d:"m21 16-4 4-4-4",key:"f6ql7i"}],["path",{d:"M17 20V4",key:"1ejh1v"}],["path",{d:"m3 8 4-4 4 4",key:"11wl7u"}],["path",{d:"M7 4v16",key:"1glfcx"}]],RM=me("arrow-up-down",TM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DM=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],LM=me("bell",DM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OM=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],hs=me("book-open",OM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IM=[["path",{d:"m19 21-7-4-7 4V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16z",key:"1fy3hk"}]],FM=me("bookmark",IM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BM=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],rS=me("bot",BM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zM=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],ep=me("brain",zM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $M=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],UM=me("calendar-days",$M);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HM=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],Kh=me("calendar",HM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ql=me("check",qM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VM=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Qh=me("chevron-down",VM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WM=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],KM=me("chevron-right",WM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QM=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],GM=me("chevron-up",QM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Cc=me("circle-alert",XM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JM=[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]],sS=me("circle-check-big",JM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ZM=me("circle-check",YM);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e5=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}],["path",{d:"M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662",key:"154egf"}]],t5=me("circle-user",e5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const n5=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],iS=me("circle-x",n5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const r5=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],s5=me("circle",r5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const i5=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],l5=me("clock-4",i5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const a5=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],mn=me("clock",a5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const o5=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],Xs=me("copy",o5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const c5=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],lS=me("crown",c5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const u5=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],d5=me("download",u5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const h5=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],f5=me("ellipsis-vertical",h5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const p5=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]],m5=me("ellipsis",p5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g5=[["path",{d:"m15 15 6 6",key:"1s409w"}],["path",{d:"m15 9 6-6",key:"ko1vev"}],["path",{d:"M21 16v5h-5",key:"1ck2sf"}],["path",{d:"M21 8V3h-5",key:"1qoq8a"}],["path",{d:"M3 16v5h5",key:"1t08am"}],["path",{d:"m3 21 6-6",key:"wwnumi"}],["path",{d:"M3 8V3h5",key:"1ln10m"}],["path",{d:"M9 9 3 3",key:"v551iv"}]],x5=me("expand",g5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y5=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Io=me("external-link",y5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const b5=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ac=me("eye",b5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v5=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 18v-6",key:"17g6i2"}],["path",{d:"m9 15 3 3 3-3",key:"1npd3o"}]],Pu=me("file-down",v5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w5=[["path",{d:"m18 5-2.414-2.414A2 2 0 0 0 14.172 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2",key:"142zxg"}],["path",{d:"M21.378 12.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z",key:"2t3380"}],["path",{d:"M8 18h1",key:"13wk12"}]],ev=me("file-pen-line",w5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k5=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M9 15h6",key:"cctwl0"}],["path",{d:"M12 18v-6",key:"17g6i2"}]],j5=me("file-plus",k5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S5=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],ln=me("file-text",S5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N5=[["path",{d:"M4 20h16a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.93a2 2 0 0 1-1.66-.9l-.82-1.2A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13c0 1.1.9 2 2 2Z",key:"1fr9dc"}],["path",{d:"M8 10v4",key:"tgpxqk"}],["path",{d:"M12 10v2",key:"hh53o1"}],["path",{d:"M16 10v6",key:"1d6xys"}]],C5=me("folder-kanban",N5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const A5=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],E5=me("funnel",A5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P5=[["line",{x1:"6",x2:"6",y1:"3",y2:"15",key:"17qcm7"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["path",{d:"M18 9a9 9 0 0 1-9 9",key:"n2h4wq"}]],tv=me("git-branch",P5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _5=[["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}],["line",{x1:"3",x2:"9",y1:"12",y2:"12",key:"1dyftd"}],["line",{x1:"15",x2:"21",y1:"12",y2:"12",key:"oup4p8"}]],_u=me("git-commit-horizontal",_5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M5=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["path",{d:"M11 18H8a2 2 0 0 1-2-2V9",key:"19pyzm"}]],T5=me("git-compare",M5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R5=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M6 21V9a9 9 0 0 0 9 9",key:"7kw0sc"}]],D5=me("git-merge",R5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L5=[["circle",{cx:"18",cy:"18",r:"3",key:"1xkwt0"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["path",{d:"M13 6h3a2 2 0 0 1 2 2v7",key:"1yeb86"}],["line",{x1:"6",x2:"6",y1:"9",y2:"21",key:"rroup"}]],O5=me("git-pull-request",L5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I5=[["rect",{width:"7",height:"7",x:"3",y:"3",rx:"1",key:"1g98yp"}],["rect",{width:"7",height:"7",x:"14",y:"3",rx:"1",key:"6d4xhi"}],["rect",{width:"7",height:"7",x:"14",y:"14",rx:"1",key:"nxv5o0"}],["rect",{width:"7",height:"7",x:"3",y:"14",rx:"1",key:"1bb6yr"}]],F5=me("layout-grid",I5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B5=[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]],Ec=me("lightbulb",B5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z5=[["path",{d:"M9 17H7A5 5 0 0 1 7 7h2",key:"8i5ue5"}],["path",{d:"M15 7h2a5 5 0 1 1 0 10h-2",key:"1b9ql8"}],["line",{x1:"8",x2:"16",y1:"12",y2:"12",key:"1jonct"}]],$5=me("link-2",z5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U5=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],H5=me("list",U5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q5=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],gt=me("loader-circle",q5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V5=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 9.9-1",key:"1mm8w8"}]],W5=me("lock-open",V5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K5=[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]],nv=me("lock",K5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q5=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],G5=me("mail",Q5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X5=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],ma=me("message-circle",X5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J5=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],Y5=me("message-square",J5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z5=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],tp=me("mic",Z5);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eT=[["path",{d:"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401",key:"kfwtm"}]],tT=me("moon",eT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nT=[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]],rv=me("pen-tool",nT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],sT=me("pen",rT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iT=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],lT=me("pencil",iT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aT=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],xn=me("plus",aT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oT=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],cT=me("refresh-ccw",oT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uT=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],dT=me("refresh-cw",uT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hT=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],fT=me("reply",hT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pT=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]],Jo=me("rotate-ccw",pT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mT=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],aS=me("save",mT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gT=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Ts=me("search",gT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xT=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],oS=me("send",xT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yT=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],m0=me("settings",yT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bT=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],vT=me("share-2",bT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],ng=me("shield-check",wT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kT=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],g0=me("shield",kT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jT=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],vr=me("sparkles",jT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ST=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],Gh=me("square-pen",ST);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NT=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],CT=me("star",NT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AT=[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]],ET=me("sun",AT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PT=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],rg=me("target",PT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _T=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2",key:"125lnx"}],["path",{d:"M8.5 2h7",key:"csnxdl"}],["path",{d:"M14.5 16h-5",key:"1ox875"}]],MT=me("test-tube",_T);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TT=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],nr=me("trash-2",TT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RT=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ch=me("trending-up",RT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DT=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],LT=me("triangle-alert",DT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OT=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],IT=me("upload",OT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FT=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],BT=me("user-plus",FT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zT=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],$T=me("user",zT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UT=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],tu=me("users",UT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HT=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],sg=me("video",HT);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qT=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Jt=me("x",qT),VT=({isOpen:t,onClose:e,onLogout:n,children:r})=>t?a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx("div",{className:"absolute inset-0 bg-gray-900/40","aria-hidden":"true",onClick:e}),a.jsxs("div",{className:"relative w-full max-w-md rounded-2xl bg-white shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 px-6 py-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Workspace Settings"}),a.jsx("p",{className:"text-sm text-gray-500",children:"Adjust your appearance and AI preferences."})]}),a.jsx("button",{onClick:e,className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100","aria-label":"Close settings",children:a.jsx(Jt,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"px-6 py-5 space-y-6",children:[r||a.jsx("p",{className:"text-sm text-gray-500",children:"Settings configuration is coming soon. You'll be able to toggle themes and update AI provider details here."}),a.jsx("div",{className:"pt-4 border-t border-gray-100",children:a.jsx("button",{onClick:n,className:"w-full inline-flex items-center justify-center rounded-md border border-transparent bg-red-50 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-100",children:"Sign out"})})]})]})]}):null,WT=({isOpen:t,onClose:e})=>{var v,g,y;const[n,r]=w.useState(null),[s,i]=w.useState(!1),[l,o]=w.useState(""),[c,u]=w.useState(""),[h,d]=w.useState(""),[f,p]=w.useState(!1);w.useEffect(()=>{t&&m()},[t]);const m=async()=>{try{i(!0);const b=await ur.getModelConfiguration();r(b.data),o(b.data.current_provider),u(b.data.embedding_model),d(b.data.chat_model)}catch(b){console.error("Error loading model configuration:",b)}finally{i(!1)}},x=async()=>{try{p(!0),await ur.updateModelConfiguration(l,c,h),e(),await m()}catch(b){console.error("Error updating model configuration:",b)}finally{p(!1)}};return t?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex justify-between items-center mb-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"AI Model Configuration"}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),s?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):n?a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"AI Provider"}),a.jsx("select",{value:l,onChange:b=>{o(b.target.value),u(""),d("")},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.entries(n.available_providers).map(([b,k])=>a.jsx("option",{value:b,children:k.name},b))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Embedding Model"}),a.jsxs("select",{value:c,onChange:b=>u(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select an embedding model"}),(v=n.available_providers[l])==null?void 0:v.embedding_models.map(b=>a.jsx("option",{value:b,children:b},b))]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chat Model"}),a.jsxs("select",{value:h,onChange:b=>d(b.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"",children:"Select a chat model"}),(g=n.available_providers[l])==null?void 0:g.chat_models.map(b=>a.jsx("option",{value:b,children:b},b))]}),h&&((y=n.model_descriptions)==null?void 0:y[h])&&a.jsx("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-md",children:a.jsxs("div",{className:"text-sm text-blue-800",children:[a.jsx("span",{className:"font-medium",children:"Description:"})," ",n.model_descriptions[h]]})})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Current Configuration"}),a.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Provider:"})," ",n.provider_name]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Embedding Model:"})," ",n.embedding_model]}),a.jsxs("div",{children:[a.jsx("span",{className:"font-medium",children:"Chat Model:"})," ",n.chat_model]})]})]}),a.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[a.jsx("button",{onClick:e,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500",children:"Cancel"}),a.jsx("button",{onClick:x,disabled:f||!l||!c||!h,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:f?"Saving...":"Save Configuration"})]})]}):a.jsx("div",{className:"text-center py-8 text-gray-500",children:"Failed to load model configuration"})]})}):null},KT=()=>{const{user:t,logout:e}=Ln(),n=Qn(),r=Hs(),[s,i]=w.useState(!1),[l,o]=w.useState(!1),c="scholarhub.theme",u=()=>{if(typeof window>"u")return"light";const x=window.localStorage.getItem(c);return x==="dark"||x==="light"?x:window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"},[h,d]=w.useState(u);w.useEffect(()=>{if(typeof document>"u")return;const x=document.documentElement;x.classList.toggle("dark",h==="dark"),x.setAttribute("data-theme",h);try{window.localStorage.setItem(c,h)}catch(v){console.warn("Unable to persist theme preference",v)}},[h]);const f=()=>{i(!1),e(),n("/login")},p=[{to:"/projects",label:"Projects",icon:C5,isActive:r.pathname==="/"||r.pathname.startsWith("/projects")},{to:"/profile",label:"Profile",icon:t5,isActive:r.pathname.startsWith("/profile")}],m=w.useMemo(()=>a.jsxs("div",{className:"space-y-6",children:[a.jsxs("section",{children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Appearance"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Switch between light and dark modes for the UI shell."}),a.jsxs("div",{className:"mt-4 flex gap-3",children:[a.jsxs("button",{type:"button",onClick:()=>d("light"),className:`flex flex-1 items-center gap-2 rounded-lg border px-3 py-2 text-sm transition ${h==="light"?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 text-gray-600 hover:border-gray-300"}`,children:[a.jsx(ET,{className:"h-4 w-4"})," Light"]}),a.jsxs("button",{type:"button",onClick:()=>d("dark"),className:`flex flex-1 items-center gap-2 rounded-lg border px-3 py-2 text-sm transition ${h==="dark"?"border-indigo-500 bg-indigo-50 text-indigo-700":"border-gray-200 text-gray-600 hover:border-gray-300"}`,children:[a.jsx(tT,{className:"h-4 w-4"})," Dark"]})]})]}),a.jsxs("section",{children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"AI configuration"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Update the provider, model, and embeddings used across assistants and writing tools."}),a.jsxs("button",{type:"button",onClick:()=>o(!0),className:"mt-4 inline-flex items-center gap-2 rounded-lg border border-indigo-200 bg-indigo-50 px-3 py-2 text-sm font-medium text-indigo-700 hover:border-indigo-300 hover:bg-indigo-100",children:[a.jsx(vr,{className:"h-4 w-4"})," Configure AI models"]})]}),a.jsxs("section",{children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Profile"}),a.jsxs("div",{className:"mt-2 rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-600",children:[a.jsx("div",{className:"font-medium text-gray-900",children:t!=null&&t.first_name?`${t.first_name} ${t.last_name??""}`.trim():t==null?void 0:t.email}),a.jsx("div",{className:"text-xs text-gray-500",children:t==null?void 0:t.email})]})]})]}),[h,t]);return a.jsxs("div",{className:"min-h-screen bg-slate-50",children:[a.jsx("header",{className:"bg-white border-b border-gray-200",children:a.jsxs("div",{className:"mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8",children:[a.jsx(sr,{to:"/projects",className:"text-lg font-semibold tracking-tight text-gray-900 hover:text-gray-700",children:"ScholarHub"}),a.jsxs("div",{className:"flex items-center space-x-2",children:[p.map(({to:x,label:v,icon:g,isActive:y})=>a.jsx(sr,{to:x,"aria-label":v,className:`inline-flex h-10 w-10 items-center justify-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 ${y?"bg-indigo-600 text-white":"text-gray-500 hover:bg-gray-100"}`,children:a.jsx(g,{className:"h-5 w-5"})},v)),a.jsx("button",{type:"button",onClick:()=>i(!0),"aria-label":"Open settings",className:"inline-flex h-10 w-10 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2",children:a.jsx(m0,{className:"h-5 w-5"})})]})]})}),a.jsx("main",{className:"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8",children:a.jsx(g2,{})}),a.jsx(VT,{isOpen:s,onClose:()=>i(!1),onLogout:f,children:m}),a.jsx(WT,{isOpen:l,onClose:()=>o(!1)})]})},QT=()=>{const[t,e]=w.useState(""),[n,r]=w.useState(""),[s,i]=w.useState(!1),[l,o]=w.useState(""),{login:c}=Ln(),u=Qn(),h=async d=>{var f,p;d.preventDefault(),i(!0),o("");try{await c(t,n),u("/")}catch(m){console.error("Login error:",m);let x="Login failed. Please try again.";(p=(f=m.response)==null?void 0:f.data)!=null&&p.detail&&(typeof m.response.data.detail=="string"?x=m.response.data.detail:Array.isArray(m.response.data.detail)?x=m.response.data.detail.map(v=>v.msg||v.message||"Validation error").join(", "):typeof m.response.data.detail=="object"&&(x=m.response.data.detail.msg||m.response.data.detail.message||"Validation error")),o(x)}finally{i(!1)}};return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"max-w-md w-full space-y-8",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to ScholarHub"}),a.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Access your AI-powered research workspace"})]}),a.jsxs("form",{className:"mt-8 space-y-6",onSubmit:h,children:[l&&a.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm",children:["Error: ",l," (Debug: error state is set)"]}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email address"}),a.jsx("input",{id:"email",type:"email",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors",placeholder:"Enter your email",value:t,onChange:d=>e(d.target.value),disabled:s})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),a.jsx("input",{id:"password",type:"password",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors",placeholder:"Enter your password",value:n,onChange:d=>r(d.target.value),disabled:s})]})]}),a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx("input",{id:"remember-me",name:"remember-me",type:"checkbox",className:"h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded"}),a.jsx("label",{htmlFor:"remember-me",className:"ml-2 block text-sm text-gray-900",children:"Remember me"})]}),a.jsx("div",{className:"text-sm",children:a.jsx("a",{href:"#",className:"font-medium text-indigo-600 hover:text-indigo-500",children:"Forgot your password?"})})]}),a.jsx("div",{children:a.jsx("button",{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base",disabled:s,children:s?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Signing in..."]}):"Sign in"})}),a.jsx("div",{className:"text-center",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",a.jsx(sr,{to:"/register",className:"font-medium text-indigo-600 hover:text-indigo-500 transition-colors",children:"Sign up"})]})})]})]})})},GT=()=>{const[t,e]=w.useState({email:"",password:"",confirmPassword:"",firstName:"",lastName:""}),[n,r]=w.useState(!1),[s,i]=w.useState(""),{register:l}=Ln(),o=Qn(),c=async h=>{var d,f;if(h.preventDefault(),t.password!==t.confirmPassword){i("Passwords do not match");return}r(!0),i("");try{await l({email:t.email,password:t.password,first_name:t.firstName,last_name:t.lastName}),o("/")}catch(p){i(((f=(d=p.response)==null?void 0:d.data)==null?void 0:f.detail)||"Registration failed. Please try again.")}finally{r(!1)}},u=h=>{e({...t,[h.target.name]:h.target.value})};return a.jsx("div",{className:"min-h-screen flex items-center justify-center bg-slate-50 py-12 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"max-w-md w-full space-y-8",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Create your ScholarHub account"}),a.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Join the AI-powered research platform"})]}),a.jsxs("form",{className:"mt-8 space-y-6",onSubmit:c,children:[s&&a.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm",children:s}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"firstName",className:"block text-sm font-medium text-gray-700 mb-2",children:"First name"}),a.jsx("input",{id:"firstName",type:"text",name:"firstName",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors",placeholder:"Enter first name",value:t.firstName,onChange:u,disabled:n})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"lastName",className:"block text-sm font-medium text-gray-700 mb-2",children:"Last name"}),a.jsx("input",{id:"lastName",type:"text",name:"lastName",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors",placeholder:"Enter last name",value:t.lastName,onChange:u,disabled:n})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email address"}),a.jsx("input",{id:"email",type:"email",name:"email",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors",placeholder:"Enter your email",value:t.email,onChange:u,disabled:n})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Password"}),a.jsx("input",{id:"password",type:"password",name:"password",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors",placeholder:"Create a password",value:t.password,onChange:u,disabled:n})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm password"}),a.jsx("input",{id:"confirmPassword",type:"password",name:"confirmPassword",required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-colors",placeholder:"Confirm your password",value:t.confirmPassword,onChange:u,disabled:n})]})]}),a.jsx("div",{children:a.jsx("button",{type:"submit",className:"w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed text-base",disabled:n,children:n?a.jsxs("div",{className:"flex items-center justify-center",children:[a.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[a.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),a.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Creating account..."]}):"Create account"})}),a.jsx("div",{className:"text-center",children:a.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",a.jsx(sr,{to:"/login",className:"font-medium text-indigo-600 hover:text-indigo-500 transition-colors",children:"Sign in"})]})})]})]})})},XT=[{path:"/login",element:a.jsx(QT,{})},{path:"/register",element:a.jsx(GT,{})}],JT=()=>{var _;const[t,e]=w.useState([]),[n,r]=w.useState(0),[s,i]=w.useState(""),[l,o]=w.useState(!0),[c,u]=w.useState(null),[h,d]=w.useState(null),[f,p]=w.useState([]),[m,x]=w.useState(null),[v,g]=w.useState({}),[y,b]=w.useState(!1),[k,S]=w.useState({title:"",authors:[],authorsText:"",year:void 0,doi:"",url:"",source:"manual",journal:"",abstract:"",is_open_access:!1,pdf_url:""}),[j,E]=w.useState(null),[A,T]=w.useState(!1),N=async()=>{o(!0);try{const z=(await gr.listMy({q:s,limit:100})).data,q=Array.isArray(z)?z:Array.isArray(z==null?void 0:z.references)?z.references:[],F=Array.isArray(z)?z.length:Number((z==null?void 0:z.total)??q.length);e(q),r(F)}finally{o(!1)}};w.useEffect(()=>{N()},[]),w.useEffect(()=>{(async()=>{try{const z=(await rt.getPapers(0,500)).data,q=Array.isArray(z==null?void 0:z.papers)?z.papers:[];p(q);const F={};q.forEach(V=>{F[V.id]=V.title}),g(F)}catch{p([]),g({})}})()},[]),w.useEffect(()=>{const M=t.filter(z=>z.pdf_url&&!z.document_id);if(M.length>0){x(`Autoingesting ${M.length} PDF${M.length>1?"s":""} Content will appear shortly.`);const z=window.setTimeout(()=>{N().catch(()=>{})},8e3);return()=>window.clearTimeout(z)}else x(null)},[t]);const I=async(M,z)=>{try{u(M.id),await gr.uploadPdf(M.id,z),await N()}catch{alert("Failed to upload PDF")}finally{u(null)}},R=async M=>{d(M);try{const q=(await rt.getPapers(0,100)).data,F=Array.isArray(q==null?void 0:q.papers)?q.papers:[];p(F)}catch{p([])}},C=async M=>{if(h)try{await gr.attachToPaper(h,M),d(null),await N()}catch{alert("Failed to attach to paper")}};return a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6",children:a.jsxs("div",{className:"flex items-end justify-between",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"My References"}),a.jsx("p",{className:"text-gray-600 mt-1",children:"Manage references discovered or uploaded, with optional PDFs for AI chat."})]}),a.jsxs("div",{className:"text-sm text-gray-500",children:["Total: ",n]})]})})}),a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 space-y-4",children:[m&&a.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-800 px-4 py-3 rounded",children:m}),a.jsxs("div",{className:"bg-white p-4 rounded-md shadow-sm border flex items-center gap-3",children:[a.jsx("input",{placeholder:"Search references (title)",value:s,onChange:M=>i(M.target.value),className:"flex-1 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"}),a.jsx("button",{onClick:N,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Search"}),a.jsx(sr,{to:"/discovery",className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700",children:"Discover"}),a.jsx("button",{onClick:()=>b(!0),className:"px-4 py-2 bg-gray-100 border rounded hover:bg-gray-200",children:"Add Reference"})]}),l?a.jsx("div",{className:"text-center text-gray-600 py-12",children:"Loading"}):t.length===0?a.jsx("div",{className:"text-center text-gray-600 py-12",children:"No references yet. Use Discovery or upload PDFs."}):a.jsx("div",{className:"bg-white border rounded-md shadow-sm",children:a.jsx("div",{className:"divide-y",children:t.map(M=>a.jsxs("div",{className:"p-4 flex flex-col md:flex-row md:items-center md:justify-between gap-3",children:[a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"text-sm text-gray-500",children:M.source||"manual"}),a.jsx("div",{className:"font-medium text-gray-900 truncate",children:M.title}),a.jsx("div",{className:"text-sm text-gray-600 truncate",children:(M.authors||[]).join(", ")}),a.jsxs("div",{className:"text-xs text-gray-500 flex gap-3 mt-1 items-center",children:[M.year&&a.jsx("span",{children:M.year}),M.doi&&a.jsx("a",{className:"text-blue-600",href:`https://doi.org/${M.doi}`,target:"_blank",rel:"noreferrer",children:"DOI"}),M.pdf_url&&(M.pdf_url.startsWith("/api/")?a.jsx("button",{className:"text-blue-600 underline",onClick:async()=>{try{const z=localStorage.getItem("access_token");if(!z){alert("Please login again to download the PDF");return}const q=await fetch(M.pdf_url,{headers:{Authorization:`Bearer ${z}`}});if(!q.ok)throw new Error("Download failed");const F=await q.blob(),V=URL.createObjectURL(F);window.open(V,"_blank"),setTimeout(()=>URL.revokeObjectURL(V),3e4)}catch{alert("Failed to open PDF")}},children:"PDF"}):a.jsx("a",{className:"text-blue-600",href:M.pdf_url,target:"_blank",rel:"noreferrer",children:"PDF"})),M.document_id&&a.jsx("span",{className:"px-2 py-0.5 rounded bg-blue-100 text-blue-800",children:"Content uploaded"}),a.jsx("span",{className:"uppercase text-gray-600",children:M.status})]}),a.jsxs("div",{className:"text-xs text-gray-600 mt-2 flex flex-wrap gap-2 items-center",children:[M.paper_id?a.jsxs(a.Fragment,{children:[a.jsx("span",{className:"text-gray-500",children:"Attached to:"}),a.jsx(sr,{className:"text-blue-600 hover:underline",to:`/papers/${M.paper_id}`,children:v[M.paper_id]||M.paper_id})]}):a.jsx("span",{className:"text-gray-500",children:"Not attached"}),M.doi&&(()=>{const q=t.filter(F=>F.id!==M.id&&F.doi===M.doi&&F.paper_id).map(F=>v[F.paper_id]).filter(Boolean);return q.length>0?a.jsxs("span",{className:"text-gray-500",children:[" Also in: ",q.join(", ")]}):null})()]})]}),a.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[!M.document_id&&!(M.is_open_access&&M.pdf_url&&M.status==="pending")&&a.jsxs("label",{className:"px-3 py-1 border rounded cursor-pointer bg-gray-50 hover:bg-gray-100 text-sm",children:[c===M.id?"Uploading":"Upload PDF",a.jsx("input",{type:"file",accept:"application/pdf",className:"hidden",onChange:z=>{var F;const q=(F=z.target.files)==null?void 0:F[0];q&&I(M,q)}})]}),!M.document_id&&M.is_open_access&&M.pdf_url&&M.status==="pending"&&a.jsx("span",{className:"px-3 py-1 border rounded bg-yellow-50 text-yellow-800 text-sm",children:"Autoingesting PDF"}),a.jsx("button",{className:"px-3 py-1 border rounded bg-gray-50 hover:bg-gray-100 text-sm",onClick:()=>R(M.id),children:"Attach to Paper"}),a.jsx("button",{className:"px-3 py-1 border rounded bg-red-50 text-red-700 hover:bg-red-100 text-sm",onClick:async()=>{await gr.delete(M.id),await N()},children:"Delete"})]})]},M.id))})}),h&&a.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center",children:a.jsxs("div",{className:"bg-white rounded-md shadow-lg p-6 w-full max-w-md",children:[a.jsx("div",{className:"font-semibold mb-3",children:"Attach to Paper"}),a.jsx("div",{className:"max-h-64 overflow-y-auto divide-y",children:f.map(M=>a.jsx("button",{className:"w-full text-left p-2 hover:bg-gray-50",onClick:()=>C(M.id),children:M.title},M.id))}),a.jsx("div",{className:"mt-4 text-right",children:a.jsx("button",{onClick:()=>d(null),className:"px-4 py-2 border rounded",children:"Cancel"})})]})})]}),y&&a.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-md shadow-lg w-full max-w-2xl",children:[a.jsx("div",{className:"px-4 py-3 border-b font-semibold",children:"Add Reference"}),a.jsxs("div",{className:"p-4 grid grid-cols-2 gap-4 text-sm",children:[a.jsxs("div",{className:"col-span-2",children:[a.jsxs("label",{className:"block text-gray-600 mb-1",children:["Title ",a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:k.title||"",onChange:M=>S({...k,title:M.target.value}),placeholder:"Paper title"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"Authors"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:k.authorsText||"",onChange:M=>S({...k,authorsText:M.target.value}),placeholder:"Comma-separated (e.g., Jane Doe, John Smith)"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"Year"}),a.jsx("input",{type:"number",className:"w-full border rounded px-3 py-2",value:k.year||"",onChange:M=>S({...k,year:M.target.value?parseInt(M.target.value,10):void 0}),placeholder:"2023"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"Journal"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:k.journal||"",onChange:M=>S({...k,journal:M.target.value}),placeholder:"Journal name"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"DOI"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:k.doi||"",onChange:M=>S({...k,doi:M.target.value}),placeholder:"10.xxxx/xxxxx"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"URL"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:k.url||"",onChange:M=>S({...k,url:M.target.value}),placeholder:"https://..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"Source"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:k.source||"manual",onChange:M=>S({...k,source:M.target.value}),placeholder:"semantic_scholar / openalex / manual"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"Open Access"}),a.jsx("input",{type:"checkbox",checked:!!k.is_open_access,onChange:M=>S({...k,is_open_access:M.target.checked})})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"Abstract"}),a.jsx("textarea",{className:"w-full border rounded px-3 py-2 h-24",value:k.abstract||"",onChange:M=>S({...k,abstract:M.target.value}),placeholder:"Short abstract (optional)"})]}),a.jsxs("div",{className:"col-span-2",children:[a.jsx("label",{className:"block text-gray-600 mb-1",children:"Attach PDF (optional)"}),a.jsx("input",{type:"file",accept:"application/pdf",onChange:M=>{var z;return E(((z=M.target.files)==null?void 0:z[0])||null)}})]})]}),a.jsxs("div",{className:"px-4 py-3 border-t flex justify-end gap-2",children:[a.jsx("button",{className:"px-3 py-2 border rounded",onClick:()=>{b(!1),E(null)},children:"Cancel"}),a.jsx("button",{className:"px-3 py-2 rounded bg-blue-600 text-white disabled:opacity-50",disabled:A||!((_=k.title)!=null&&_.trim()),onClick:async()=>{var M;if((M=k.title)!=null&&M.trim()){T(!0);try{const z={title:k.title,authors:(k.authorsText||"").split(",").map(P=>P.trim()).filter(Boolean),year:k.year,doi:k.doi||void 0,url:k.url||void 0,source:k.source||"manual",journal:k.journal||void 0,abstract:k.abstract||void 0,is_open_access:!!k.is_open_access,pdf_url:void 0},F=(await gr.create(z)).data,V=F==null?void 0:F.id;if(!V)throw new Error("Failed to determine created reference ID");j&&await gr.uploadPdf(V,j),b(!1),E(null),S({title:"",authors:[],authorsText:"",year:void 0,doi:"",url:"",source:"manual",journal:"",abstract:"",is_open_access:!1,pdf_url:""}),await N()}catch{alert("Failed to create reference")}finally{T(!1)}}},children:A?"Saving":"Save Reference"})]})]})})]})},YT=[{path:"my-references",element:a.jsx(JT,{})}],ZT=({onAddPaper:t,onClose:e,paperId:n,forcePaperMode:r})=>{const{isAuthenticated:s}=Ln(),[i,l]=w.useState(null),o=(K,ce="info",Le=3500)=>{l({type:ce,message:K}),window.setTimeout(()=>l(null),Le)},[c,u]=w.useState(""),[h,d]=w.useState(""),[f,p]=w.useState([]),[m,x]=w.useState(!1),[v,g]=w.useState(0),[y,b]=w.useState(["crossref"]);console.log(" PaperDiscovery initialized with selectedSources:",y);const[k,S]=w.useState(20),[j,E]=w.useState("relevance"),[A,T]=w.useState(null),[N,I]=w.useState(!1),[R,C]=w.useState(!1),[_,M]=w.useState(null),[z,q]=w.useState(new Set),[F,V]=w.useState(new Set),[P,H]=w.useState(!1),[Y,L]=w.useState(null),[Se,we]=w.useState({}),[ge,Ce]=w.useState(r||n?"paper":"query");console.log(" PaperDiscovery mode:",ge,"forcePaperMode:",r,"paperIdProp:",n);const Ie=!!n,[re,J]=w.useState("current"),[Q,he]=w.useState(!0),[Re,De]=w.useState(!1),[D,G]=w.useState([]),[ae,je]=w.useState(new Set),[de,Ae]=w.useState(null),[Je,Ye]=w.useState(!1),[dt,It]=w.useState(null),Ft=w.useRef(null),[$,W]=w.useState(!1),[te,fe]=w.useState([]),[O,Z]=w.useState(null),[ne,ye]=w.useState(null),[B,se]=w.useState(!1),[ee,le]=w.useState(null),[Pe,Fe]=w.useState(""),[Ee,Ue]=w.useState(null),[it,tt]=w.useState(null),lt=async()=>{try{const K=await fetch(sn("/research-papers/?skip=0&limit=100"),{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(K.ok){const Le=((await K.json()).papers||[]).map(Be=>({id:Be.id,title:Be.title}));G(Le),De(!0)}else G([]),De(!0)}catch{G([]),De(!0)}},Xn=async K=>{const ce=`${K.title}-${K.source}`;q(Le=>new Set([...Le,ce]));try{const Le={title:K.title,authors:K.authors,abstract:K.abstract,year:K.year,doi:K.doi,url:K.url,source:K.source,journal:K.journal,is_open_access:K.is_open_access||!1,pdf_url:K.pdf_url||void 0},Be=await gr.create(Le),yt=Be.data;if(Be.status===201||yt!=null&&yt.reference||yt!=null&&yt.id){V(Kt=>new Set([...Kt,ce]));const cr=!!Le.pdf_url;o(cr?"Added to My References. PDF detected  ingesting now.":"Added to My References.","success")}else o("Failed to add to My References.","error")}catch(Le){console.error("Error adding to My References",Le),o("Failed to add to My References.","error")}finally{q(Le=>{const Be=new Set(Le);return Be.delete(ce),Be})}},On=K=>{const ce=`${K.title}-${K.source}`;we(Le=>({...Le,[ce]:{error:"Content preview is not available in the current build. Please open the original source."}})),L(K)},ao=[{id:"semantic_scholar",name:"Semantic Scholar",description:"AI-powered academic search"},{id:"sciencedirect",name:"ScienceDirect",description:"Elsevier articles (API key)"},{id:"openalex",name:"OpenAlex",description:"Open scholarly index"},{id:"arxiv",name:"arXiv",description:"Preprint repository"},{id:"crossref",name:"Crossref",description:"DOI database"},{id:"pubmed",name:"PubMed",description:"Medical literature"}],In=()=>s?!r&&ge==="query"?c.trim().length>=3:!!(n||O):!1,vt=K=>{const ce={mode:ge,research_topic:h.trim()||null,max_results:K??k,sources:y};return console.log(" buildPayload called, returning:",ce),ge==="query"&&c.trim()&&(ce.query=c.trim()),ge==="paper"&&((re==="current"||r)&&n?(ce.paper_id=n,ce.use_content=Q):O&&(ce.paper_id=O,ce.use_content=Q)),ce},[Bt,Zt]=w.useState(!1),Wr=w.useRef(0),Dl=w.useRef(null),oo=async(K,ce)=>{var cr,Kt;const Le=!!(ce!=null&&ce.append);Le&&Zt(!0),Le||x(!0);const Be=Date.now();let yt=Wr.current;if(!Le){try{(cr=Dl.current)==null||cr.abort()}catch{}Dl.current=new AbortController,Wr.current+=1,yt=Wr.current}try{Le||p([]);const Nt=await fetch(sn("/discovery/papers/discover/stream"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify(K),signal:(Kt=Dl.current)==null?void 0:Kt.signal});if(!Nt.ok||!Nt.body)throw new Error(`Search failed: ${Nt.status} ${Nt.statusText}`);const Kr=Nt.body.getReader(),Ol=new TextDecoder;let uo="";for(;;){const{value:yf,done:bf}=await Kr.read();if(bf)break;if(yt!==Wr.current){try{Kr.cancel()}catch{}break}uo+=Ol.decode(yf,{stream:!0});const uy=uo.split(`

`);uo=uy.pop()||"";for(const DA of uy){const dy=DA.trim();if(!dy.startsWith("data:"))continue;const LA=dy.replace(/^data:\s*/,"");try{const _r=JSON.parse(LA);if(_r.type==="final"&&Array.isArray(_r.papers)){if(yt!==Wr.current)return Il=>Il;console.log(`Received ${_r.papers.length} papers from sources:`,_r.papers.map(Il=>Il.source)),p(Le?Il=>{const hy=new Set(Il.map(Fl=>Fl.title+"|"+Fl.source)),fy=[...Il];for(const Fl of _r.papers){const py=Fl.title+"|"+Fl.source;hy.has(py)||(hy.add(py),fy.push(Fl))}return fy}:_r.papers),yt===Wr.current&&g((Date.now()-Be)/1e3)}else if(_r.type==="done")yt===Wr.current&&g((Date.now()-Be)/1e3);else if(_r.type==="error")throw new Error(_r.message||"Search failed")}catch(_r){console.error("Error parsing stream event:",_r)}}}}catch(Nt){if((Nt==null?void 0:Nt.name)==="AbortError")return;console.error("Error searching papers:",Nt),alert(Nt instanceof Error?Nt.message:"Search failed. Please try again.")}finally{Le&&Zt(!1),!Le&&yt===Wr.current&&x(!1)}},Wt=async()=>{if(!In()){alert(s?ge==="query"?"Please enter at least 3 characters for your search query.":re==="current"?"Open discovery from a paper to use current paper context.":"Please paste at least 10 characters for paper context.":"Please login to search for papers.");return}H(!0);const K=vt();console.log("Sending search with payload:",K),await oo(K)},Ll=async()=>{const K=f.length+20;await oo(vt(K),{append:!0})},xf=async()=>{try{C(!0);const K={mode:ge,query:ge==="query"&&c.trim()||null,paper_id:ge==="paper"?n||O:null,use_content:Q,items:cu().slice(0,20).map(Be=>({title:Be.title,authors:Array.isArray(Be.authors)?Be.authors:[],abstract:Be.abstract,year:Be.year,doi:Be.doi,url:Be.url,source:Be.source,pdf_url:Be.pdf_url,relevance_score:Be.relevance_score,citations_count:Be.citations_count,journal:Be.journal,keywords:Be.keywords})),top_n:10},ce=await fetch(sn("/discovery/papers/deep-rescore"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify(K)});if(!ce.ok)throw new Error("Deep rescore failed");const Le=await ce.json();Array.isArray(Le.items)?(p(Le.items),o(`Deep rescored ${Le.rescored} paper(s) using ${Le.method}.`,"success")):o("Deep rescore returned no items.","info")}catch(K){console.error("Deep rescore error",K),o("Deep rescore failed.","error")}finally{C(!1)}},co=async K=>{if(n){try{await rt.addReference(n,{title:K.title,authors:K.authors||[],year:K.year,doi:K.doi,url:K.url,source:K.source,is_open_access:K.is_open_access||!1,pdf_url:K.pdf_url||void 0}),alert("Reference added to this paper."),t&&t(K)}catch(ce){console.error("Failed to add reference",ce),alert("Failed to add reference.")}return}Ae(K),je(new Set),await lt()},MA=K=>{b(ce=>{const Le=ce.includes(K)?ce.filter(Be=>Be!==K):[...ce,K];return console.log(" Source toggled:",K,"New selectedSources:",Le),Le})},cu=()=>{let K=f;return _&&(K=K.filter(ce=>ce.year&&ce.year>=_)),A!==null&&(K=K.filter(ce=>(ce.relevance_score??0)>=A)),N&&(K=K.filter(ce=>!!ce.pdf_url)),K.sort((ce,Le)=>{switch(j){case"relevance":return Le.relevance_score-ce.relevance_score;case"year":return(Le.year||0)-(ce.year||0);case"citations":return(Le.citations_count||0)-(ce.citations_count||0);default:return 0}}),K},TA=K=>({semantic_scholar:"",arxiv:"",crossref:"",pubmed:""})[K]||"",RA=K=>!Array.isArray(K)||K.length===0?"Unknown Authors":K.length<=3?K.join(", "):`${K[0]} et al. (${K.length} authors)`;return a.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-6xl mx-auto relative",children:[a.jsxs("div",{className:"p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Discover Research Papers"}),e&&a.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),!r&&a.jsxs("div",{className:"mb-3 flex items-center gap-2",children:[a.jsx("button",{className:`px-3 py-1.5 rounded ${ge==="query"?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"}`,onClick:()=>Ce("query"),children:"Query"}),a.jsx("button",{className:`px-3 py-1.5 rounded ${ge==="paper"?"bg-blue-600 text-white":"bg-gray-200 text-gray-800"}`,onClick:()=>Ce("paper"),children:"Paper"})]}),a.jsxs("div",{className:"space-y-4",children:[!r&&ge==="query"?a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx("input",{type:"text",value:c,onChange:K=>u(K.target.value),onKeyPress:K=>K.key==="Enter"&&Wt(),placeholder:"Search for research papers...",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})}),a.jsxs("button",{onClick:Wt,disabled:m||!In(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center space-x-2",children:[a.jsx(Ts,{size:16}),a.jsx("span",{children:m?"Searching...":"Search"})]})]}):a.jsxs("div",{className:"space-y-3",children:[n?a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"radio",checked:re==="current",onChange:()=>J("current")})," Use current paper context"]}),re==="current"&&a.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:Q,onChange:K=>he(K.target.checked)})," Include full content"]})]}):a.jsx("div",{className:"space-y-2",children:a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:async()=>{le(null),se(!0),W(!0),Ue(O),tt(ne);try{const K=await fetch(sn("/research-papers/?skip=0&limit=100"),{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(K.ok){const Le=((await K.json()).papers||[]).map(Be=>({id:Be.id,title:Be.title,year:Be.year,status:Be.status}));fe(Le)}else fe([]),le("Failed to load your papers.")}catch{le("Failed to load your papers."),fe([])}finally{se(!1)}},className:"px-3 py-1.5 bg-blue-600 text-white rounded hover:bg-blue-700 text-sm",children:O?"Change Paper":"Choose Paper"}),O&&a.jsxs("span",{className:"text-sm text-gray-700 truncate max-w-[60%]",title:ne||"",children:["Using: ",ne||"selected paper"]}),a.jsxs("label",{className:"ml-auto flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:Q,onChange:K=>he(K.target.checked)})," Include full content"]})]})}),ge==="query"&&a.jsx("input",{type:"text",value:c,onChange:K=>u(K.target.value),onKeyPress:K=>K.key==="Enter"&&Wt(),placeholder:"Optional keywords to bias search",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),a.jsx("div",{children:a.jsxs("button",{onClick:Wt,disabled:m||!In(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center space-x-2",children:[a.jsx(Ts,{size:16}),a.jsx("span",{children:m?"Searching...":"Find similar papers"})]})})]}),a.jsxs("div",{className:"flex space-x-2",children:[a.jsx("div",{className:"flex-1",children:a.jsx("input",{type:"text",value:h,onChange:K=>d(K.target.value),placeholder:"Research topic/context (optional - improves relevance)",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})}),a.jsxs("button",{onClick:Wt,disabled:m||!In(),className:"px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:bg-gray-400 flex items-center space-x-2",children:[a.jsx(Ts,{size:16}),a.jsx("span",{children:m?"Searching...":"Run Discovery"})]})]}),a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sources"}),a.jsx("div",{className:"space-y-1",children:ao.map(K=>a.jsxs("label",{className:"flex items-center",children:[a.jsx("input",{type:"checkbox",checked:y.includes(K.id),onChange:()=>MA(K.id),className:"mr-2 rounded"}),a.jsx("span",{className:"text-sm",children:K.name})]},K.id))})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Results"}),a.jsxs("select",{value:k,onChange:K=>S(Number(K.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:10,children:"10"}),a.jsx("option",{value:20,children:"20"}),a.jsx("option",{value:30,children:"30"}),a.jsx("option",{value:50,children:"50"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Year Filter"}),a.jsxs("select",{value:_||"",onChange:K=>M(K.target.value?Number(K.target.value):null),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:"",children:"All years"}),a.jsx("option",{value:2024,children:"2024+"}),a.jsx("option",{value:2020,children:"2020+"}),a.jsx("option",{value:2015,children:"2015+"}),a.jsx("option",{value:2010,children:"2010+"})]})]})]})})]})]}),f.length>0&&a.jsx("div",{className:"p-4 bg-gray-50 border-b border-gray-200",children:a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Found ",cu().length," / ",f.length," papers in ",v.toFixed(2),"s",A!==null?` ( ${A.toFixed(1)} relevance)`:""]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx(RM,{size:16,className:"text-gray-400"}),a.jsxs("select",{value:j,onChange:K=>E(K.target.value),className:"rounded-md border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",children:[a.jsx("option",{value:"relevance",children:"Relevance"}),a.jsx("option",{value:"year",children:"Year"}),a.jsx("option",{value:"citations",children:"Citations"})]}),a.jsxs("select",{value:A===null?"":String(A),onChange:K=>{const ce=K.target.value;T(ce===""?null:parseFloat(ce))},className:"rounded-md border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-700 shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500",title:"Filter by minimum relevance score",children:[a.jsx("option",{value:"",children:"All relevance"}),a.jsx("option",{value:"0.3",children:" 0.3"}),a.jsx("option",{value:"0.5",children:" 0.5"}),a.jsx("option",{value:"0.7",children:" 0.7"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{id:"pdfOnly",type:"checkbox",checked:N,onChange:K=>I(K.target.checked),className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),a.jsx("label",{htmlFor:"pdfOnly",className:"text-sm text-gray-700",children:"PDF only"})]}),a.jsxs("button",{onClick:Ll,disabled:Bt,className:`inline-flex items-center rounded-md px-3 py-1.5 text-sm font-medium shadow-sm ring-1 ring-inset ${Bt?"bg-gray-100 text-gray-500 ring-gray-200 cursor-not-allowed":"bg-white text-gray-700 ring-gray-300 hover:bg-gray-50"}`,children:[Bt&&a.jsx(mn,{className:"animate-spin h-4 w-4 text-blue-600 mr-2"}),"More papers"]}),a.jsx("button",{onClick:xf,disabled:R,className:`inline-flex items-center rounded-md px-3 py-1.5 text-sm font-medium shadow-sm focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 ${R?"bg-gray-300 text-gray-600 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 focus-visible:outline-blue-600"}`,title:"Use PDF content (when available) to refine top results",children:R?"Rescoring":"Deep Rescore PDFs"})]})]})}),a.jsx("div",{className:"overflow-visible",children:m&&f.length===0?a.jsx("div",{className:"flex items-center justify-center p-12",children:a.jsxs("div",{className:"text-center",children:[a.jsx(mn,{className:"animate-spin h-8 w-8 text-blue-600 mx-auto mb-2"}),a.jsx("p",{className:"text-gray-600",children:"Searching multiple academic databases..."})]})}):f.length===0?a.jsxs("div",{className:"text-center p-12",children:[a.jsx(hs,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("p",{className:"text-gray-600",children:P?"No papers found. Try different keywords or sources.":"Enter a search query to discover papers"})]}):a.jsxs("div",{className:"divide-y divide-gray-200",children:[cu().map((K,ce)=>{const Le=`${K.title}-${K.source}`,Be=z.has(Le),yt=F.has(Le);return a.jsx("div",{className:"p-6 hover:bg-gray-50",children:a.jsxs("div",{className:"flex justify-between items-start",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-start justify-between mb-2",children:[a.jsxs("div",{className:"pr-4",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 leading-tight",children:K.title}),a.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[K.is_open_access&&a.jsx("span",{className:"px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded",children:"OA"}),!K.pdf_url&&a.jsx("span",{className:"px-2 py-0.5 text-xs bg-gray-100 text-gray-600 rounded",children:"No PDF found"})]})]}),a.jsxs("div",{className:"flex items-center space-x-1 text-xs text-gray-500 flex-shrink-0",children:[a.jsx("span",{children:TA(K.source)}),a.jsx("span",{className:"capitalize",children:K.source.replace("_"," ")})]})]}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2 space-x-4",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(tu,{size:14,className:"mr-1"}),RA(K.authors)]}),K.year&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(Kh,{size:14,className:"mr-1"}),K.year]}),K.citations_count!==null&&K.citations_count!==void 0&&a.jsxs("div",{className:"flex items-center",children:[a.jsx(ch,{size:14,className:"mr-1"}),K.citations_count," citations"]})]}),a.jsx("div",{className:"flex items-center mb-3",children:(()=>{const Kt=cu().reduce((yf,bf)=>Math.max(yf,bf.relevance_score??0),0),Nt=K.relevance_score??0,Kr=Kt>0?.9*(Nt/Kt):Nt,Ol=Math.round(Kr*100),uo=Math.max(2,Math.min(100,Ol));return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(CT,{size:14,className:"text-yellow-500 mr-1"}),a.jsxs("span",{className:"text-sm font-medium text-gray-700",children:["Relevance: ",Ol,"%"]})]}),a.jsx("div",{className:"ml-2 flex-1 bg-gray-200 rounded-full h-2 max-w-20",children:a.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${uo}%`}})})]})})()}),a.jsx("p",{className:"text-sm text-gray-600 mb-3 leading-relaxed",children:K.abstract.length>300?`${K.abstract.substring(0,300)}...`:K.abstract}),K.keywords&&K.keywords.length>0&&a.jsx("div",{className:"flex flex-wrap gap-1 mb-3",children:K.keywords.slice(0,5).map((cr,Kt)=>a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:cr},Kt))}),K.journal&&a.jsx("p",{className:"text-sm text-gray-500 italic mb-3",children:K.journal})]}),a.jsxs("div",{className:"flex flex-col space-y-2 ml-4",children:[a.jsx("button",{onClick:()=>Xn(K),disabled:Be||yt,className:`flex items-center px-3 py-2 rounded-lg text-sm font-medium transition-colors ${yt?"bg-green-100 text-green-800 cursor-not-allowed":Be?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-blue-100 text-blue-800 hover:bg-blue-200"}`,children:yt?a.jsxs(a.Fragment,{children:[a.jsx(sS,{size:14,className:"mr-1"}),"Added"]}):Be?a.jsxs(a.Fragment,{children:[a.jsx(mn,{size:14,className:"mr-1 animate-spin"}),"Adding..."]}):a.jsxs(a.Fragment,{children:[a.jsx(xn,{size:14,className:"mr-1"}),"Add to My References"]})}),a.jsxs("button",{onClick:()=>co(K),className:"flex items-center px-3 py-2 bg-indigo-100 text-indigo-800 rounded-lg text-sm font-medium hover:bg-indigo-200 transition-colors",children:[a.jsx(xn,{size:14,className:"mr-1"}),"Attach to Paper"]}),K.pdf_url&&a.jsxs("button",{onClick:()=>window.open(K.pdf_url,"_blank","noopener,noreferrer"),className:"flex items-center px-3 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm font-medium hover:bg-blue-200 transition-colors",children:[a.jsx(Io,{size:14,className:"mr-1"}),"View PDF"]}),a.jsx("div",{className:"text-xs text-gray-600 max-w-[16rem]",children:K.pdf_url?"Attach to Paper for improved relevance using the PDF content.":"Upload a PDF to improve relevance scoring and enable chat."}),K.url&&a.jsxs("a",{href:K.url,target:"_blank",rel:"noopener noreferrer",className:"flex items-center px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200 transition-colors",children:[a.jsx(Io,{size:14,className:"mr-1"}),"View"]})]})]})},ce)}),Bt&&a.jsxs("div",{className:"py-6 flex items-center justify-center text-sm text-gray-600",children:[a.jsx(mn,{className:"animate-spin h-5 w-5 text-blue-600 mr-2"}),"Searching for more papers..."]})]})}),f.length>0&&a.jsxs("button",{onClick:Ll,disabled:Bt,className:`fixed bottom-6 right-6 z-50 inline-flex items-center rounded-full px-4 py-2 text-sm font-medium shadow-lg focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 ${Bt?"bg-gray-200 text-gray-600 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 focus-visible:outline-blue-600"}`,title:"Load more papers",children:[Bt&&a.jsx(mn,{className:"animate-spin h-4 w-4 mr-2"}),"More papers"]}),Re&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg w-full max-w-lg overflow-hidden",children:[a.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Add to Paper"}),a.jsx("button",{className:"text-gray-400 hover:text-gray-600 text-xl",onClick:()=>De(!1),children:""})]}),a.jsxs("div",{className:"p-4 space-y-3 max-h-[60vh] overflow-y-auto",children:[D.length===0?a.jsx("p",{className:"text-sm text-gray-600",children:"No papers found. Create a paper first."}):D.map(K=>a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:ae.has(K.id),onChange:ce=>{je(Le=>{const Be=new Set(Le);return ce.target.checked?Be.add(K.id):Be.delete(K.id),Be})}}),a.jsx("span",{className:"text-sm",children:K.title})]},K.id)),de&&a.jsxs("div",{className:"mt-3 text-xs text-gray-500",children:["Adding reference: ",a.jsx("span",{className:"font-medium",children:de.title})]}),a.jsx("div",{className:"text-xs text-gray-600 mt-2",children:de!=null&&de.pdf_url?a.jsx("span",{className:"text-green-700",children:"PDF available  a verified PDF will be attached."}):a.jsxs("div",{className:"space-y-2",children:[a.jsx("p",{className:"text-gray-700",children:"No verified PDF found. You can attach this reference now and optionally upload a PDF to improve relevance score and enable knowledgebase answers for the selected paper."}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"px-3 py-1.5 bg-purple-600 text-white rounded disabled:opacity-50",disabled:Je||ae.size!==1,onClick:()=>{var K;if(It(null),ae.size!==1){alert("Select exactly one paper to upload a PDF to its knowledge base.");return}(K=Ft.current)==null||K.click()},children:Je?"Uploading":"Upload PDF to selected paper"}),a.jsx("span",{className:"text-[11px] text-gray-500",children:"Select exactly one paper to upload."})]}),dt&&a.jsx("div",{className:"text-[11px] text-gray-700",children:dt})]})})]}),a.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[a.jsx("button",{className:"px-3 py-1 bg-gray-200 rounded",onClick:()=>De(!1),children:"Cancel"}),a.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded disabled:opacity-50",disabled:ae.size===0,onClick:async()=>{if(de)try{const K=Array.from(ae),ce={title:de.title,authors:de.authors||[],year:de.year,doi:de.doi,url:de.url,source:de.source,journal:de.journal,abstract:de.abstract,is_open_access:de.is_open_access||!1,pdf_url:de.pdf_url||void 0};for(const Le of K)await gr.create({...ce,paper_id:Le});alert(`Attached to ${K.length} paper(s) and saved in My References.`),De(!1),je(new Set),Ae(null)}catch(K){console.error("Failed to attach references",K),alert("Failed to attach references.")}},children:"Attach Reference(s)"})]})]})}),$&&a.jsx("div",{className:"fixed inset-0 z-50 bg-black/40 flex items-center justify-center p-4",children:a.jsxs("div",{className:"bg-white max-w-3xl w-full rounded-lg shadow-xl",children:[a.jsxs("div",{className:"p-4 border-b flex items-center justify-between",children:[a.jsx("h3",{className:"text-lg font-semibold",children:"Choose a Paper"}),a.jsx("button",{className:"text-gray-500",onClick:()=>W(!1),children:""})]}),a.jsxs("div",{className:"p-4 space-y-3 max-h-[70vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"text",value:Pe,onChange:K=>Fe(K.target.value),placeholder:"Search by title or year...",className:"w-full px-3 py-2 border border-gray-300 rounded"}),Ee&&a.jsx("button",{className:"px-2 py-1 text-sm text-gray-600 hover:text-gray-800",onClick:()=>{Ue(null),tt(null)},children:"Clear"})]}),B?a.jsx("div",{className:"py-12 text-center text-gray-600",children:"Loading your papers..."}):ee?a.jsx("div",{className:"py-8 text-center text-red-600 text-sm",children:ee}):te.length===0?a.jsx("div",{className:"py-12 text-center text-gray-600",children:"No papers found. Create a paper first from the Projects page."}):a.jsx("ul",{className:"divide-y",children:te.filter(K=>{const ce=Pe.trim().toLowerCase();return ce?(K.title||"").toLowerCase().includes(ce)||String(K.year||"").includes(ce):!0}).map(K=>a.jsx("li",{className:`p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer ${Ee===K.id?"bg-blue-50":""}`,onClick:()=>{Ue(K.id),tt(K.title)},children:a.jsxs("div",{className:"flex items-center gap-3 pr-4 min-w-0",children:[a.jsx("input",{type:"radio",checked:Ee===K.id,onChange:()=>{Ue(K.id),tt(K.title)}}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("div",{className:"truncate font-medium text-gray-900",title:K.title,children:K.title}),a.jsxs("div",{className:"mt-1 text-xs text-gray-600 flex items-center gap-2",children:[K.year&&a.jsx("span",{className:"px-1.5 py-0.5 bg-gray-100 rounded",children:K.year}),K.status&&a.jsx("span",{className:"px-1.5 py-0.5 bg-blue-100 text-blue-700 rounded capitalize",children:K.status.replace("_"," ")})]})]})]})},K.id))})]}),a.jsxs("div",{className:"p-4 border-t flex justify-end gap-2",children:[a.jsx("button",{className:"px-3 py-1 text-gray-600",onClick:()=>W(!1),children:"Cancel"}),a.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white rounded disabled:opacity-50",disabled:!Ee,onClick:()=>{Ee&&(Z(Ee),ye(it||null),W(!1))},children:"Use selected"})]})]})}),a.jsx("input",{ref:Ft,type:"file",accept:"application/pdf",hidden:!0,onChange:async K=>{var yt,cr;const ce=(yt=K.target.files)==null?void 0:yt[0];if(!ce||!de)return;const Le=Array.from(ae);if(Le.length!==1){alert("Please select exactly one target paper.");return}const Be=Le[0];Ye(!0),It(null);try{const Kt=new FormData;Kt.append("file",ce),Kt.append("title",de.title||ce.name),Kt.append("paper_id",Be);const Nt=await fetch(sn("/documents/upload"),{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:Kt});if(Nt.status===409){const Kr=await Nt.json().catch(()=>({})),Ol=((cr=Kr==null?void 0:Kr.duplicate_document)==null?void 0:cr.title)||"existing document";It(`A matching PDF already exists (${Ol}). It is already usable for relevance and knowledgebase answers.`);return}if(!Nt.ok){const Kr=await Nt.text();throw new Error(`${Nt.status} ${Nt.statusText}: ${Kr}`)}It("PDF uploaded and processing. It will improve relevance and enable knowledgebase answers for this paper.")}catch(Kt){console.error("Upload failed",Kt),It("Upload failed. Please try again or attach reference without a PDF.")}finally{Ye(!1),Ft.current&&(Ft.current.value="")}}}),Y&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg max-w-4xl max-h-[90vh] w-full overflow-hidden",children:[a.jsxs("div",{className:"p-6 border-b border-gray-200 flex justify-between items-start",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:Y.title}),a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsxs("span",{className:"mr-4",children:["Source: ",Y.source]}),Y.year&&a.jsxs("span",{children:["Year: ",Y.year]})]})]}),a.jsx("button",{onClick:()=>{L(null),we({})},className:"text-gray-400 hover:text-gray-600 text-2xl font-bold",children:""})]}),a.jsx("div",{className:"p-6 overflow-y-auto max-h-[70vh]",children:(()=>{const K=`${Y.title}-${Y.source}`,ce=Se[K];if(ce==="loading")return a.jsxs("div",{className:"flex items-center justify-center py-12",children:[a.jsx(mn,{size:24,className:"animate-spin mr-3"}),"Loading content..."]});if(!ce||ce!=null&&ce.error)return a.jsxs("div",{className:"text-center py-12",children:[a.jsx("p",{className:"text-red-600 mb-4",children:"Failed to load content"}),a.jsx("button",{onClick:()=>On(Y),className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:"Try Again"})]});if(Array.isArray(ce.chunks)){const yt=ce.chunks;return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ingested content (",yt.length," chunks)"]}),a.jsxs("div",{className:"bg-gray-50 p-4 rounded border max-h-[60vh] overflow-y-auto",children:[yt.slice(0,20).map((cr,Kt)=>a.jsx("p",{className:"mb-3 text-gray-800 whitespace-pre-wrap",children:cr.text},Kt)),yt.length>20&&a.jsx("div",{className:"text-xs text-gray-500",children:"Showing first 20 chunks"})]})]})}const Le=ce==null?void 0:ce.content_type;if(Le==="pdf"||Le==="authenticated_access")return a.jsxs("div",{className:"text-center space-y-4",children:[a.jsx(hs,{size:48,className:"mx-auto text-blue-600"}),a.jsx("p",{className:"text-gray-600",children:"This is a PDF document"}),(ce==null?void 0:ce.error)&&ce.error.includes("demonstration only")&&a.jsxs("div",{className:"p-3 bg-orange-100 border border-orange-300 rounded-lg text-sm text-orange-800",children:[a.jsx("strong",{children:" Alternative Access:"})," ",ce.error]}),Le==="authenticated_access"&&a.jsx("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm text-left space-y-3",children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("span",{className:"text-2xl",children:""}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("h4",{className:"font-semibold text-blue-900",children:"KFUPM University Access Available"}),a.jsx("p",{className:"text-blue-800",children:"This paper is available through your KFUPM subscription. Access it using your university credentials:"}),a.jsx("div",{className:"space-y-2",children:ce!=null&&ce.sso_url&&ce.sso_url.includes("kfupm.edu.sa")?a.jsx("button",{onClick:()=>window.open(ce.sso_url,"_blank","noopener,noreferrer"),className:"px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:" Open KFUPM Library Portal"}):ce!=null&&ce.sso_url?a.jsxs("div",{className:"space-x-2",children:[a.jsx("button",{onClick:()=>window.open(ce.sso_url,"_blank","noopener,noreferrer"),className:"px-4 py-2 bg-green-600 text-white text-sm rounded hover:bg-green-700",children:" Direct KFUPM Access"}),a.jsx("button",{onClick:()=>window.open("https://library-web.kfupm.edu.sa/e-resources/online-databases/","_blank","noopener,noreferrer"),className:"px-4 py-2 bg-blue-600 text-white text-sm rounded hover:bg-blue-700",children:" KFUPM Library Portal"})]}):null}),a.jsxs("div",{className:"text-xs text-blue-700 space-y-1",children:[a.jsx("p",{children:a.jsx("strong",{children:"Steps:"})}),a.jsx("p",{children:"1. Click the button above to access through KFUPM"}),a.jsx("p",{children:"2. Login with your KFUPM credentials (g202403940@kfupm.edu.sa)"}),a.jsx("p",{children:"3. Search for the paper or navigate to the publisher's database"})]})]})]})}),a.jsxs("a",{href:ce.pdf_url||Y.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[a.jsx(Io,{size:16,className:"mr-2"}),"Open PDF"]}),(ce==null?void 0:ce.error)&&ce.error.includes("demonstration only")&&a.jsx("p",{className:"text-xs text-gray-500",children:"This link is for demonstration purposes only. In production, use legal institutional access."})]});const Be=ce==null?void 0:ce.full_text;return a.jsxs("div",{className:"prose max-w-none",children:[Be&&a.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[a.jsx("h4",{className:"font-semibold mb-2",children:"Content Preview:"}),a.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:Be})]}),a.jsx("div",{className:"mt-4 pt-4 border-t",children:a.jsxs("a",{href:Y.url,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700",children:[a.jsx(Io,{size:16,className:"mr-2"}),"View Full Paper"]})})]})})()})]})}),i&&a.jsx("div",{className:`fixed bottom-6 right-6 z-50 rounded shadow-lg px-4 py-3 text-sm ${i.type==="success"?"bg-green-600 text-white":i.type==="error"?"bg-red-600 text-white":"bg-gray-900 text-white"}`,children:i.message})]})},eR=({selectedPaperIds:t=[],onClose:e,onSave:n})=>{const{papers:r}=bM(),[s,i]=w.useState(t),[l,o]=w.useState(""),[c,u]=w.useState("systematic"),[h,d]=w.useState(6),[f,p]=w.useState(!1),[m,x]=w.useState(null),[v,g]=w.useState("preview"),[y,b]=w.useState(null);w.useEffect(()=>{t.length>0&&i(t)},[t]);const k=r||[],S=R=>{i(C=>C.includes(R)?C.filter(_=>_!==R):[...C,R])},j=async()=>{if(s.length<2){alert("Please select at least 2 papers for literature review generation");return}if(!l.trim()){alert("Please enter a review topic");return}p(!0);try{const R=await fetch(sn("/discovery/literature-review/generate"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({paper_ids:s,review_topic:l.trim(),review_type:c,max_sections:h})});if(!R.ok)throw new Error(`Review generation failed: ${R.statusText}`);const C=await R.json();x(C),b(C)}catch(R){console.error("Error generating literature review:",R),alert("Literature review generation failed. Please try again.")}finally{p(!1)}},E=R=>{navigator.clipboard.writeText(R),alert("Content copied to clipboard!")},A=()=>{y&&n&&n(y)},T=(R,C)=>{if(y){const _=[...y.sections];_[R]={..._[R],content:C},b({...y,sections:_})}},N=R=>{let C=`# ${R.title}

`;return C+=`## Abstract
${R.abstract}

`,C+=`## Introduction
${R.introduction}

`,C+=`## Methodology
${R.methodology}

`,R.sections.forEach(_=>{C+=`## ${_.title}
${_.content}

`}),C+=`## Synthesis
${R.synthesis}

`,R.research_gaps.length>0&&(C+=`## Research Gaps
`,R.research_gaps.forEach(_=>{C+=`- ${_}
`}),C+=`
`),R.future_directions.length>0&&(C+=`## Future Directions
`,R.future_directions.forEach(_=>{C+=`- ${_}
`}),C+=`
`),C+=`## Conclusion
${R.conclusion}

`,R.references.length>0&&(C+=`## References
`,R.references.forEach((_,M)=>{C+=`${M+1}. ${_}
`})),C},I=()=>{if(y){const R=N(y),C=new Blob([R],{type:"text/markdown"}),_=URL.createObjectURL(C),M=document.createElement("a");M.href=_,M.download=`${y.title.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.md`,document.body.appendChild(M),M.click(),document.body.removeChild(M),URL.revokeObjectURL(_)}};return a.jsxs("div",{className:"bg-white rounded-lg shadow-lg max-w-6xl mx-auto h-[90vh] flex flex-col",children:[a.jsxs("div",{className:"p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex justify-between items-center mb-4",children:[a.jsxs("h2",{className:"text-2xl font-bold text-gray-900 flex items-center",children:[a.jsx(ln,{className:"mr-2",size:24}),"Literature Review Generator"]}),e&&a.jsx("button",{onClick:e,className:"text-gray-500 hover:text-gray-700",children:""})]}),m?a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Generated from ",m.total_papers," papers in ",m.generation_time.toFixed(1),"s"]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsxs("div",{className:"flex bg-gray-100 rounded-lg p-1",children:[a.jsxs("button",{onClick:()=>g("preview"),className:`px-3 py-1 text-sm rounded ${v==="preview"?"bg-white shadow-sm":"text-gray-600"}`,children:[a.jsx(Ac,{size:14,className:"mr-1 inline"}),"Preview"]}),a.jsxs("button",{onClick:()=>g("edit"),className:`px-3 py-1 text-sm rounded ${v==="edit"?"bg-white shadow-sm":"text-gray-600"}`,children:[a.jsx(Gh,{size:14,className:"mr-1 inline"}),"Edit"]})]}),a.jsxs("button",{onClick:I,className:"px-3 py-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 flex items-center space-x-1",children:[a.jsx(d5,{size:14}),a.jsx("span",{children:"Download"})]}),n&&a.jsxs("button",{onClick:A,className:"px-3 py-2 bg-green-100 text-green-800 rounded-lg hover:bg-green-200 flex items-center space-x-1",children:[a.jsx(aS,{size:14}),a.jsx("span",{children:"Save"})]})]})]}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Review Topic/Research Question"}),a.jsx("textarea",{value:l,onChange:R=>o(R.target.value),placeholder:"e.g., 'The impact of artificial intelligence on academic research methodologies'",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Review Type"}),a.jsxs("select",{value:c,onChange:R=>u(R.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:"systematic",children:"Systematic Review"}),a.jsx("option",{value:"narrative",children:"Narrative Review"}),a.jsx("option",{value:"scoping",children:"Scoping Review"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Sections"}),a.jsxs("select",{value:h,onChange:R=>d(Number(R.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg",children:[a.jsx("option",{value:4,children:"4 sections"}),a.jsx("option",{value:5,children:"5 sections"}),a.jsx("option",{value:6,children:"6 sections"}),a.jsx("option",{value:8,children:"8 sections"}),a.jsx("option",{value:10,children:"10 sections"})]})]}),a.jsx("div",{className:"flex items-end",children:a.jsx("button",{onClick:j,disabled:f||s.length<2||!l.trim(),className:"w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center justify-center space-x-2",children:f?a.jsxs(a.Fragment,{children:[a.jsx(mn,{className:"animate-spin",size:16}),a.jsx("span",{children:"Generating..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(ch,{size:16}),a.jsx("span",{children:"Generate Review"})]})})})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex justify-between items-center mb-3",children:[a.jsxs("label",{className:"block text-sm font-medium text-gray-700",children:["Select Papers (",s.length," selected)"]}),a.jsx("span",{className:"text-xs text-gray-500",children:"Minimum 2 papers required"})]}),a.jsx("div",{className:"border border-gray-300 rounded-lg max-h-64 overflow-y-auto",children:k.length===0?a.jsxs("div",{className:"p-4 text-center text-gray-500",children:[a.jsx(hs,{className:"mx-auto mb-2",size:24}),a.jsx("p",{children:"No papers available. Add some papers to your library first."})]}):a.jsx("div",{className:"divide-y divide-gray-200",children:k.map(R=>{var C;return a.jsxs("label",{className:"flex items-start p-3 hover:bg-gray-50 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:s.includes(R.id),onChange:()=>S(R.id),className:"mt-1 mr-3 rounded"}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:R.title}),a.jsxs("p",{className:"text-sm text-gray-600",children:[(C=R.description)==null?void 0:C.substring(0,120),"..."]}),a.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[R.year&&`${R.year}  `,R.status&&a.jsx("span",{className:"capitalize",children:R.status})]})]})]},R.id)})})})]})]})]}),f?a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsx(mn,{className:"animate-spin h-12 w-12 text-blue-600 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Generating Literature Review"}),a.jsxs("p",{className:"text-gray-600 mb-4",children:["AI is analyzing ",s.length," papers, identifying themes, and synthesizing findings..."]}),a.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:a.jsx("div",{className:"bg-blue-600 h-2 rounded-full animate-pulse",style:{width:"70%"}})})]})}):m?a.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:a.jsxs("div",{className:"prose max-w-none",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 mb-6 flex items-center justify-between",children:[y==null?void 0:y.title,a.jsx("button",{onClick:()=>E((y==null?void 0:y.title)||""),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Xs,{size:20})})]}),a.jsxs("section",{className:"mb-8",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-3 flex items-center justify-between",children:["Abstract",a.jsx("button",{onClick:()=>E((y==null?void 0:y.abstract)||""),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Xs,{size:16})})]}),v==="edit"?a.jsx("textarea",{value:y==null?void 0:y.abstract,onChange:R=>b(C=>C?{...C,abstract:R.target.value}:null),className:"w-full p-3 border border-gray-300 rounded-lg",rows:4}):a.jsx("p",{className:"text-gray-700 bg-gray-50 p-4 rounded-lg",children:y==null?void 0:y.abstract})]}),a.jsxs("section",{className:"mb-8",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-3 flex items-center justify-between",children:["Introduction",a.jsx("button",{onClick:()=>E((y==null?void 0:y.introduction)||""),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Xs,{size:16})})]}),v==="edit"?a.jsx("textarea",{value:y==null?void 0:y.introduction,onChange:R=>b(C=>C?{...C,introduction:R.target.value}:null),className:"w-full p-3 border border-gray-300 rounded-lg",rows:6}):a.jsx("div",{className:"text-gray-700 whitespace-pre-line bg-gray-50 p-4 rounded-lg",children:y==null?void 0:y.introduction})]}),a.jsxs("section",{className:"mb-8",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-3 flex items-center justify-between",children:["Methodology",a.jsx("button",{onClick:()=>E((y==null?void 0:y.methodology)||""),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Xs,{size:16})})]}),a.jsx("div",{className:"text-gray-700 whitespace-pre-line bg-gray-50 p-4 rounded-lg",children:y==null?void 0:y.methodology})]}),y==null?void 0:y.sections.map((R,C)=>a.jsxs("section",{className:"mb-8",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-3 flex items-center justify-between",children:[R.title,a.jsx("button",{onClick:()=>E(R.content),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Xs,{size:16})})]}),v==="edit"?a.jsx("textarea",{value:R.content,onChange:_=>T(C,_.target.value),className:"w-full p-3 border border-gray-300 rounded-lg",rows:8}):a.jsx("div",{className:"text-gray-700 whitespace-pre-line bg-gray-50 p-4 rounded-lg",children:R.content}),R.themes.length>0&&a.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:R.themes.map((_,M)=>a.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:_},M))})]},C)),a.jsxs("section",{className:"mb-8",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-3 flex items-center justify-between",children:["Synthesis",a.jsx("button",{onClick:()=>E((y==null?void 0:y.synthesis)||""),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Xs,{size:16})})]}),v==="edit"?a.jsx("textarea",{value:y==null?void 0:y.synthesis,onChange:R=>b(C=>C?{...C,synthesis:R.target.value}:null),className:"w-full p-3 border border-gray-300 rounded-lg",rows:6}):a.jsx("div",{className:"text-gray-700 whitespace-pre-line bg-gray-50 p-4 rounded-lg",children:y==null?void 0:y.synthesis})]}),(y==null?void 0:y.research_gaps)&&y.research_gaps.length>0&&a.jsxs("section",{className:"mb-8",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Research Gaps"}),a.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:a.jsx("ul",{className:"list-disc list-inside space-y-2",children:y.research_gaps.map((R,C)=>a.jsx("li",{className:"text-red-800",children:R},C))})})]}),(y==null?void 0:y.future_directions)&&y.future_directions.length>0&&a.jsxs("section",{className:"mb-8",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Future Directions"}),a.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:a.jsx("ul",{className:"list-disc list-inside space-y-2",children:y.future_directions.map((R,C)=>a.jsx("li",{className:"text-green-800",children:R},C))})})]}),a.jsxs("section",{className:"mb-8",children:[a.jsxs("h2",{className:"text-xl font-semibold text-gray-900 mb-3 flex items-center justify-between",children:["Conclusion",a.jsx("button",{onClick:()=>E((y==null?void 0:y.conclusion)||""),className:"text-gray-400 hover:text-gray-600",children:a.jsx(Xs,{size:16})})]}),v==="edit"?a.jsx("textarea",{value:y==null?void 0:y.conclusion,onChange:R=>b(C=>C?{...C,conclusion:R.target.value}:null),className:"w-full p-3 border border-gray-300 rounded-lg",rows:6}):a.jsx("div",{className:"text-gray-700 whitespace-pre-line bg-gray-50 p-4 rounded-lg",children:y==null?void 0:y.conclusion})]}),(y==null?void 0:y.references)&&y.references.length>0&&a.jsxs("section",{className:"mb-8",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-3",children:"References"}),a.jsx("div",{className:"bg-gray-50 p-4 rounded-lg",children:a.jsx("ol",{className:"list-decimal list-inside space-y-1",children:y.references.map((R,C)=>a.jsx("li",{className:"text-sm text-gray-700",children:R},C))})})]})]})}):a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsx(ln,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Ready to Generate Literature Review"}),a.jsx("p",{className:"text-gray-600",children:"Configure your review settings and select papers to generate an AI-powered literature review."})]})})]})},tR=()=>{const[t,e]=w.useState(!1),[n,r]=w.useState(!1),s=[{id:"discover",title:"Discover Papers",description:"Search multiple academic databases with AI-powered relevance ranking",icon:a.jsx(Ts,{size:24,className:"text-blue-600"}),features:["Search arXiv, Semantic Scholar, Crossref, PubMed","AI-enhanced query generation","Relevance scoring and ranking","One-click add to library"],action:()=>e(!0)},{id:"review",title:"Generate Literature Review",description:"Create comprehensive literature reviews from your papers using AI",icon:a.jsx(ln,{size:24,className:"text-green-600"}),features:["Automated theme identification","Multi-section review generation","Research gap analysis","Editable and downloadable output"],action:()=>r(!0)}];return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"py-6",children:[a.jsxs("h1",{className:"text-3xl font-bold text-gray-900 flex items-center",children:[a.jsx(ch,{className:"mr-3",size:32}),"Discovery Hub"]}),a.jsx("p",{className:"mt-2 text-gray-600",children:"AI-powered paper discovery and automated literature review generation"})]})})}),a.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[!t&&!n?a.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:s.map(i=>a.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-6",children:[a.jsxs("div",{className:"flex items-center mb-4",children:[i.icon,a.jsx("h2",{className:"ml-3 text-xl font-semibold text-gray-900",children:i.title})]}),a.jsx("p",{className:"text-gray-600 mb-6",children:i.description}),a.jsx("div",{className:"space-y-2 mb-6",children:i.features.map((l,o)=>a.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[a.jsx("div",{className:"w-1.5 h-1.5 bg-blue-600 rounded-full mr-2"}),l]},o))}),a.jsx("button",{onClick:i.action,className:`w-full px-4 py-2 rounded-lg font-medium transition-colors ${i.id==="discover"?"bg-blue-600 hover:bg-blue-700 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:i.id==="discover"?"Start Discovering":"Generate Review"})]},i.id))}):t?a.jsx(ZT,{onClose:()=>e(!1),onAddPaper:i=>{console.log("Paper added:",i)}}):a.jsx(eR,{onClose:()=>r(!1),onSave:i=>{console.log("Review saved:",i)}}),!t&&!n&&a.jsxs("div",{className:"mt-12 bg-white rounded-lg shadow-lg p-6",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Phase 6: Literature Discovery & Automated Review Generation"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[a.jsxs("div",{className:"text-center p-4 bg-blue-50 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-blue-600",children:"4"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Data Sources"}),a.jsx("div",{className:"text-xs text-gray-500",children:"arXiv, Semantic Scholar, Crossref, PubMed"})]}),a.jsxs("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-green-600",children:"AI"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Powered Ranking"}),a.jsx("div",{className:"text-xs text-gray-500",children:"GPT relevance scoring"})]}),a.jsxs("div",{className:"text-center p-4 bg-purple-50 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-purple-600",children:"Auto"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Review Generation"}),a.jsx("div",{className:"text-xs text-gray-500",children:"Comprehensive synthesis"})]}),a.jsxs("div",{className:"text-center p-4 bg-orange-50 rounded-lg",children:[a.jsx("div",{className:"text-2xl font-bold text-orange-600",children:""}),a.jsx("div",{className:"text-sm text-gray-600",children:"Papers Available"}),a.jsx("div",{className:"text-xs text-gray-500",children:"Millions of research papers"})]})]})]}),!t&&!n&&a.jsxs("div",{className:"mt-8 bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-8",children:[a.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-6 text-center",children:"How Phase 6 Works"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(Ts,{size:24,className:"text-blue-600"})}),a.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"1. Intelligent Discovery"}),a.jsx("p",{className:"text-sm text-gray-600",children:"AI enhances your queries and searches multiple academic databases simultaneously"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(ch,{size:24,className:"text-green-600"})}),a.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"2. Smart Relevance Ranking"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Papers are ranked by AI-powered relevance scoring based on your research context"})]}),a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mb-4",children:a.jsx(ln,{size:24,className:"text-purple-600"})}),a.jsx("h4",{className:"font-semibold text-gray-900 mb-2",children:"3. Automated Review"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Generate comprehensive literature reviews with themes, gaps, and future directions"})]})]})]})]})]})})},nR=()=>{const[t,e]=w.useState(""),[n,r]=w.useState(["openalex","sciencedirect","arxiv","crossref"]),[s,i]=w.useState(!1),[l,o]=w.useState(null),[c,u]=w.useState({}),[h,d]=w.useState(null),f=[{id:"openalex",label:"OpenAlex"},{id:"sciencedirect",label:"ScienceDirect"},{id:"scopus",label:"Scopus"},{id:"arxiv",label:"arXiv"},{id:"crossref",label:"Crossref"},{id:"pubmed",label:"PubMed"},{id:"semantic_scholar",label:"Semantic Scholar"}],p=g=>{r(y=>y.includes(g)?y.filter(b=>b!==g):[...y,g])},m=async()=>{if(t.trim()){i(!0),d(null),o(null);try{const g=await fetch(sn("/discovery/papers/discover"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({query:t.trim(),research_topic:null,max_results:20,sources:n,include_breakdown:!0})});if(!g.ok){const b=await g.text();throw new Error(`${g.status} ${g.statusText}: ${b}`)}const y=await g.json();o(y)}catch(g){d((g==null?void 0:g.message)||"Request failed")}finally{i(!1)}}},x=async g=>{if(t.trim())try{const b=await(await fetch(sn("/discovery/debug/test-source"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({source:g,query:t.trim(),limit:5})})).json();u(k=>({...k,[g]:b}))}catch{u(b=>({...b,[g]:{error:"Request failed"}}))}},v=((l==null?void 0:l.papers)||[]).reduce((g,y)=>(g[y.source]=g[y.source]||[],g[y.source].push(y),g),{});return a.jsxs("div",{className:"p-6 max-w-6xl mx-auto",children:[a.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Discovery Debug"}),a.jsxs("div",{className:"bg-white rounded border p-4 mb-6",children:[a.jsxs("div",{className:"flex gap-2 mb-3",children:[a.jsx("input",{className:"flex-1 border rounded px-3 py-2",placeholder:"Enter query...",value:t,onChange:g=>e(g.target.value),onKeyDown:g=>g.key==="Enter"&&m()}),a.jsx("button",{onClick:m,disabled:s||!t.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-400",children:s?"Running...":"Run"})]}),a.jsx("div",{className:"flex flex-wrap gap-3",children:f.map(g=>a.jsxs("label",{className:"flex items-center gap-2",children:[a.jsx("input",{type:"checkbox",checked:n.includes(g.id),onChange:()=>p(g.id)}),a.jsx("span",{children:g.label})]},g.id))})]}),h&&a.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded mb-4",children:h}),l&&a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"bg-white rounded border p-4",children:[a.jsxs("div",{className:"text-sm text-gray-600",children:["Query: ",a.jsx("span",{className:"font-mono",children:l.query}),"  Time: ",l.search_time.toFixed(2),"s  Total: ",l.total_found]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-3",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Raw Counts"}),a.jsx("pre",{className:"bg-gray-50 p-2 rounded text-sm overflow-auto",children:JSON.stringify(l.sources_raw_counts||{},null,2)})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Unique Counts"}),a.jsx("pre",{className:"bg-gray-50 p-2 rounded text-sm overflow-auto",children:JSON.stringify(l.sources_unique_counts||{},null,2)})]})]})]}),a.jsxs("div",{className:"bg-white rounded border p-4",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Results by Source"}),a.jsx("div",{className:"space-y-4",children:Object.keys(v).sort().map(g=>a.jsxs("div",{children:[a.jsxs("div",{className:"font-medium text-gray-800 mb-2",children:[g," (",v[g].length,")"]}),a.jsx("ul",{className:"list-disc ml-5 space-y-1",children:v[g].slice(0,10).map((y,b)=>{const k=y;return a.jsxs("li",{children:[a.jsx("span",{className:"font-semibold",children:y.title}),y.year?` (${y.year})`:"","  ",a.jsx("span",{className:"text-gray-600",children:y.journal||"n/a"}),y.doi?a.jsxs("span",{className:"ml-2 text-xs text-gray-500",children:["DOI: ",y.doi]}):null,k.is_open_access?a.jsx("span",{className:"ml-2 px-2 py-0.5 text-xs bg-green-100 text-green-800 rounded",children:"OA"}):null,k.pdf_url?a.jsx("a",{className:"ml-2 text-xs text-blue-600",href:k.pdf_url,target:"_blank",rel:"noreferrer",children:"PDF"}):null]},b)})})]},g))})]})]}),a.jsxs("div",{className:"bg-white rounded border p-4 mt-6",children:[a.jsx("h3",{className:"font-semibold mb-3",children:"Endpoint Tests"}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:f.map(g=>a.jsxs("div",{className:"border rounded p-3",children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"font-medium",children:g.label}),a.jsx("button",{className:"px-3 py-1 text-sm bg-gray-800 text-white rounded",onClick:()=>x(g.id),children:"Test"})]}),a.jsx("pre",{className:"bg-gray-50 p-2 rounded text-xs overflow-auto",style:{maxHeight:200},children:JSON.stringify(c[g.id]||{},null,2)})]},g.id))})]})]})},rR=[{path:"discovery",element:a.jsx(tR,{})},{path:"discovery-debug",element:a.jsx(nR,{})}],sR=()=>{const[t,e]=w.useState(""),[n,r]=w.useState(""),[s,i]=w.useState(""),[l,o]=w.useState(!0),[c,u]=w.useState(!1),[h,d]=w.useState(null),[f,p]=w.useState(()=>localStorage.getItem("kfupm_user")||""),[m,x]=w.useState(()=>localStorage.getItem("kfupm_pass")||""),v=()=>{localStorage.setItem("kfupm_user",f),localStorage.setItem("kfupm_pass",m),alert("Saved locally (not sent to server).")},g=()=>{localStorage.removeItem("kfupm_user"),localStorage.removeItem("kfupm_pass"),p(""),x("")},y=async()=>{u(!0),d(null);try{const k=await(await fetch(sn("/discovery/debug/probe-publisher"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({url:n||null,doi:t||null,title:s||null,with_unpaywall:l})})).json();d(k)}catch{d({target:t||n||"",proxy_fetch:{error:"Request failed"}})}finally{u(!1)}};return a.jsxs("div",{className:"p-6 max-w-6xl mx-auto space-y-6",children:[a.jsx("h1",{className:"text-2xl font-bold",children:"Publisher Probe (OA-only)"}),a.jsxs("div",{className:"bg-white border rounded p-4 space-y-3",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"DOI"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:t,onChange:b=>e(b.target.value),placeholder:"10.xxxx/xxxxx"})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"URL"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:n,onChange:b=>r(b.target.value),placeholder:"https://publisher/article"})]})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title (for provider search)"}),a.jsx("input",{className:"w-full border rounded px-3 py-2",value:s,onChange:b=>i(b.target.value),placeholder:"Paper title (optional)"})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("label",{className:"flex items-center gap-2 text-sm",children:[a.jsx("input",{type:"checkbox",checked:l,onChange:b=>o(b.target.checked)}),"Include Unpaywall (OA) lookup"]}),a.jsx("button",{onClick:y,disabled:c||!t&&!n,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-400",children:c?"Probing":"Run Probe"})]})]}),a.jsxs("div",{className:"bg-white border rounded p-4 space-y-3",children:[a.jsx("h2",{className:"font-semibold",children:"Optional: KFUPM Credentials (Local Only)"}),a.jsx("p",{className:"text-sm text-gray-600",children:"Stored only in your browser for convenience. Not sent to our servers."}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[a.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"KFUPM username/email",value:f,onChange:b=>p(b.target.value)}),a.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"KFUPM password",type:"password",value:m,onChange:b=>x(b.target.value)})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx("button",{onClick:v,className:"px-3 py-1 bg-gray-800 text-white rounded",children:"Save Locally"}),a.jsx("button",{onClick:g,className:"px-3 py-1 bg-gray-200 rounded",children:"Clear"})]})]}),h&&a.jsxs("div",{className:"bg-white border rounded p-4 space-y-4",children:[a.jsxs("div",{className:"text-sm text-gray-700",children:["Target: ",a.jsx("span",{className:"font-mono",children:h.target})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Resolution & OA"}),a.jsxs("ul",{className:"text-sm space-y-1",children:[a.jsxs("li",{children:["Resolved URL: ",a.jsx("a",{className:"text-blue-600",href:h.resolved_url,target:"_blank",rel:"noreferrer",children:h.resolved_url})]}),a.jsxs("li",{children:["Proxied URL: ",a.jsx("a",{className:"text-blue-600",href:h.proxied_url,target:"_blank",rel:"noreferrer",children:h.proxied_url})]}),h.unpaywall&&a.jsxs("li",{children:["Unpaywall: ",h.unpaywall.is_oa?"Open Access":"Not OA"," ",h.unpaywall.oa_url&&a.jsx("a",{className:"text-blue-600 ml-2",href:h.unpaywall.oa_url||"",target:"_blank",rel:"noreferrer",children:"OA Link"})]})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Provider Search (Proxied)"}),a.jsx("ul",{className:"text-sm space-y-1",children:(h.provider_search_urls||[]).map(b=>a.jsx("li",{children:a.jsx("a",{className:"text-blue-600",href:b.url,target:"_blank",rel:"noreferrer",children:b.provider})},b.url))})]})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-2",children:"Proxied Page Summary"}),a.jsx("pre",{className:"bg-gray-50 p-2 rounded text-xs overflow-auto",style:{maxHeight:300},children:JSON.stringify(h.proxy_fetch||{},null,2)})]})]})]})},iR=()=>{const[t,e]=w.useState(""),[n,r]=w.useState(!1),[s,i]=w.useState(null),[l,o]=w.useState(null),c=async()=>{r(!0),o(null),i(null);try{const u=await fetch(sn("/references/debug/resolve-pdf"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")}`},body:JSON.stringify({url:t})}),h=await u.json();if(!u.ok)throw new Error((h==null?void 0:h.detail)||"Failed to resolve");i(h)}catch(u){o((u==null?void 0:u.message)||"Request failed")}finally{r(!1)}};return a.jsxs("div",{className:"p-6 max-w-3xl mx-auto space-y-4",children:[a.jsx("h1",{className:"text-2xl font-bold",children:"PDF Resolver Debug"}),a.jsxs("div",{className:"bg-white border rounded p-4 space-y-3",children:[a.jsx("input",{className:"w-full border rounded px-3 py-2",placeholder:"Enter PubMed/PMC/publisher URL",value:t,onChange:u=>e(u.target.value),onKeyDown:u=>u.key==="Enter"&&c()}),a.jsx("button",{onClick:c,disabled:!t||n,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-400",children:n?"Resolving":"Resolve PDF"})]}),l&&a.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 p-3 rounded",children:l}),s&&a.jsxs("div",{className:"bg-white border rounded p-4 space-y-3",children:[a.jsxs("div",{className:"text-sm",children:["URL: ",a.jsx("span",{className:"font-mono",children:s.url})]}),s.pmc_url&&a.jsxs("div",{className:"text-sm",children:["PMC URL: ",a.jsx("a",{className:"text-blue-600",href:s.pmc_url,target:"_blank",rel:"noreferrer",children:s.pmc_url})]}),s.pmcid&&a.jsxs("div",{className:"text-sm",children:["PMCID: ",a.jsx("span",{className:"font-mono",children:s.pmcid})]}),s.chosen_pdf&&a.jsxs("div",{className:"text-sm",children:["Chosen PDF: ",a.jsx("a",{className:"text-blue-600",href:s.chosen_pdf,target:"_blank",rel:"noreferrer",children:"Open"})]}),a.jsxs("div",{children:[a.jsx("h3",{className:"font-semibold mb-1",children:"Candidates"}),a.jsx("ul",{className:"list-disc ml-5 text-sm space-y-1",children:(s.pdf_candidates||[]).map((u,h)=>a.jsx("li",{children:a.jsx("a",{className:"text-blue-600",href:u,target:"_blank",rel:"noreferrer",children:u})},h))})]}),a.jsx("pre",{className:"bg-gray-50 p-2 rounded text-xs overflow-auto",children:JSON.stringify(s,null,2)})]})]})},lR=[{path:"publisher-probe",element:a.jsx(sR,{})},{path:"pdf-resolver-debug",element:a.jsx(iR,{})}];class aR{constructor(){Rt(this,"ws",null);Rt(this,"sessionId",null);Rt(this,"connectionId",null);Rt(this,"listeners",new Map);Rt(this,"reconnectAttempts",0);Rt(this,"maxReconnectAttempts",5);Rt(this,"reconnectDelay",3e3);Rt(this,"isConnecting",!1);Rt(this,"lastToken")}async connect(e,n){return this.isConnecting?(console.log("Already connecting, skipping duplicate request"),!1):new Promise((r,s)=>{try{this.isConnecting=!0,this.sessionId=e,this.lastToken=n;const i=this.lastToken?encodeURIComponent(this.lastToken):"demo",l=typeof window<"u"?window.location.origin:"http://localhost:3000",c=(kl||l).replace(/^http/,"ws"),u=l.replace(/^http/,"ws"),h=Array.from(new Set([`${c}/api/v1/collaboration/ws/${e}?token=${i}`,`${u}/api/v1/collaboration/ws/${e}?token=${i}`,`ws://localhost:8000/api/v1/collaboration/ws/${e}?token=${i}`]));let d=0;const f=()=>{const p=h[d];console.log("Connecting to WebSocket:",p),this.ws=new WebSocket(p),this.ws.onopen=()=>{console.log("WebSocket connected to session:",e),this.reconnectAttempts=0,this.isConnecting=!1,r(!0)},this.ws.onmessage=m=>{try{const x=JSON.parse(m.data);this.handleMessage(x)}catch(x){console.error("Error parsing WebSocket message:",x)}},this.ws.onclose=m=>{console.warn("WebSocket closed:",m.code,m.reason);try{this.handleMessage({type:"ws_closed",code:m.code,reason:m.reason})}catch{}d>=h.length-1&&this.handleDisconnect()},this.ws.onerror=m=>{console.error("WebSocket error:",m);try{this.handleMessage({type:"ws_error",error:"socket_error"})}catch{}d<h.length-1?(d+=1,f()):(this.isConnecting=!1,s(new Error("WebSocket connection failed")))}};f()}catch(i){this.isConnecting=!1,s(i)}})}disconnect(){this.ws&&(this.ws.close(),this.ws=null),this.sessionId=null,this.connectionId=null,this.isConnecting=!1,this.reconnectAttempts=0}sendDocumentChange(e,n=[]){this.sendMessage({type:"document_change",content:e,changes:n,timestamp:Date.now()})}sendCursorUpdate(e){this.sendMessage({type:"cursor_update",cursor:e,timestamp:Date.now()})}sendMessage(e){var n;((n=this.ws)==null?void 0:n.readyState)===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):console.warn("WebSocket not connected, cannot send message:",e)}on(e,n){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(n)}off(e,n){if(this.listeners.has(e)){const r=this.listeners.get(e),s=r.indexOf(n);s>-1&&r.splice(s,1)}}isConnected(){var e;return((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN}getSessionInfo(){return{sessionId:this.sessionId,connectionId:this.connectionId,connected:this.isConnected()}}handleMessage(e){console.log("Received WebSocket message:",e),e.type==="connection_established"&&(this.connectionId=e.connection_id),(this.listeners.get(e.type)||[]).forEach(s=>{try{s(e)}catch(i){console.error("Error in event callback:",i)}}),(this.listeners.get("message")||[]).forEach(s=>{try{s(e)}catch(i){console.error("Error in message callback:",i)}})}handleDisconnect(){this.reconnectAttempts<this.maxReconnectAttempts&&this.sessionId&&(this.reconnectAttempts++,console.log(`Attempting to reconnect (${this.reconnectAttempts}/${this.maxReconnectAttempts})...`),setTimeout(()=>{this.sessionId&&this.connect(this.sessionId,this.lastToken)},this.reconnectDelay*this.reconnectAttempts))}}const hn=new aR,cS=({isOpen:t,projectId:e,paperId:n,attachedProjectReferenceIds:r,onClose:s,onUpdated:i})=>{const[l,o]=w.useState(!1),[c,u]=w.useState(!1),[h,d]=w.useState([]),[f,p]=w.useState(new Set),[m,x]=w.useState(new Set),[v,g]=w.useState(""),[y,b]=w.useState(null);w.useEffect(()=>{if(!t)return;let E=!1;return(async()=>{var T;try{o(!0),b(null);const N=await An.list(e,{status:"approved"});if(E)return;const I=((T=N.data)==null?void 0:T.references)||[];d(I);const R=new Set(I.filter(C=>(C.papers||[]).some(_=>_.paper_id===n)).map(C=>C.id));for(const C of r)R.add(C);p(R),x(new Set(R))}catch(N){console.error("Failed to load project references",N),E||(d([]),b("Unable to load project references right now."))}finally{E||o(!1)}})(),()=>{E=!0}},[t,e,n,r]),w.useEffect(()=>{t||g("")},[t]);const k=w.useMemo(()=>{if(!v.trim())return h;const E=v.toLowerCase();return h.filter(A=>{const T=A.reference;return[(T==null?void 0:T.title)||"",((T==null?void 0:T.authors)||[]).join(" "),(T==null?void 0:T.journal)||"",(T==null?void 0:T.doi)||""].join(" ").toLowerCase().includes(E)})},[h,v]),S=E=>{p(A=>{const T=new Set(A);return T.has(E)?T.delete(E):T.add(E),T})},j=async()=>{try{u(!0),b(null);const E=Array.from(f).filter(T=>!m.has(T)),A=Array.from(m).filter(T=>!f.has(T));for(const T of E)await An.attachToPaper(e,T,n);for(const T of A)await An.detachFromPaper(e,T,n);await(i==null?void 0:i())}catch(E){console.error("Failed to update reference attachments",E),b("Unable to update attachments. Please try again.")}finally{u(!1)}};return t?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 p-4",children:a.jsxs("div",{className:"w-full max-w-3xl rounded-lg bg-white shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Attach Related Papers"}),a.jsx("p",{className:"text-xs text-gray-500",children:"Select approved project references to link them to this paper."})]}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",title:"Close",disabled:c,children:a.jsx(Jt,{className:"h-5 w-5"})})]}),a.jsxs("div",{className:"px-5 py-4 space-y-4",children:[a.jsxs("div",{className:"relative",children:[a.jsx(Ts,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),a.jsx("input",{type:"text",className:"w-full rounded-md border border-gray-200 py-2 pl-9 pr-3 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Search by title, author, journal, or DOI",value:v,onChange:E=>g(E.target.value)})]}),y&&a.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",children:y}),a.jsx("div",{className:"max-h-80 overflow-y-auto rounded-md border border-gray-200",children:l?a.jsxs("div",{className:"flex items-center justify-center py-12 text-sm text-gray-500",children:[a.jsx(gt,{className:"mr-2 h-4 w-4 animate-spin text-indigo-600"}),"Loading project references"]}):k.length===0?a.jsx("div",{className:"py-12 text-center text-sm text-gray-500",children:h.length===0?"No approved project references are available yet.":"No references match your search."}):a.jsx("ul",{className:"divide-y divide-gray-100 text-sm",children:k.map(E=>{const A=E.reference,T=f.has(E.id),N=(E.papers||[]).filter(I=>I.paper_id!==n);return a.jsxs("li",{className:"flex items-start gap-3 px-4 py-3",children:[a.jsx("input",{type:"checkbox",className:"mt-1",checked:T,onChange:()=>S(E.id)}),a.jsxs("div",{className:"flex-1",children:[a.jsx("div",{className:"font-medium text-gray-900",children:(A==null?void 0:A.title)||"Untitled reference"}),a.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-gray-600",children:[(A==null?void 0:A.authors)&&A.authors.length>0&&a.jsx("span",{children:A.authors.join(", ")}),(A==null?void 0:A.year)&&a.jsxs("span",{children:["Year: ",A.year]}),(A==null?void 0:A.journal)&&a.jsx("span",{children:A.journal}),(A==null?void 0:A.doi)&&a.jsx("a",{href:`https://doi.org/${A.doi}`,target:"_blank",rel:"noreferrer",className:"text-indigo-600 hover:underline",children:"DOI"})]}),N.length>0&&a.jsxs("p",{className:"mt-2 text-xs text-gray-500",children:["Also attached to ",N.length," other paper",N.length===1?"":"s"," in this project."]})]})]},E.id)})})})]}),a.jsxs("div",{className:"flex items-center justify-between border-t border-gray-100 bg-gray-50 px-5 py-4 text-sm",children:[a.jsxs("span",{className:"text-gray-500",children:[f.size," reference",f.size===1?"":"s"," selected"]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("button",{onClick:s,className:"rounded-full border border-gray-200 px-4 py-2 text-gray-600 hover:bg-gray-100",disabled:c,children:"Cancel"}),a.jsxs("button",{onClick:j,className:"inline-flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 font-medium text-white hover:bg-indigo-700 disabled:opacity-60",disabled:c||l,children:[c&&a.jsx(gt,{className:"h-4 w-4 animate-spin"}),"Save attachments"]})]})]})]})}):null};function np(t){try{const r=((Array.isArray(t.authors)&&t.authors.length>0?String(t.authors[0]):"").split(/\s+/).filter(Boolean).slice(-1)[0]||"").toLowerCase(),s=t.year?String(t.year):"",o=(t.title||"").toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/\s+/).filter(Boolean).slice(0,3).join("").slice(0,12);return r+s+o||"ref"+s}catch{return"ref"}}const oR=({paperId:t,projectId:e,paperTitle:n,isOpen:r,onClose:s,onToggle:i,collaboration:l,onInsertContent:o,onInsertBibliography:c,latexMode:u=!1,paperRole:h="viewer"})=>{const{user:d}=Ln(),[f,p]=w.useState("references"),[m,x]=w.useState([]),[v,g]=w.useState(!0),[y,b]=w.useState(""),[k,S]=w.useState("apa"),[j,E]=w.useState(!1),[A,T]=w.useState(!1),[N,I]=w.useState(!1),R=h==="reviewer"?"viewer":h,C=["admin","editor"].includes(R),[_,M]=w.useState([]),[z,q]=w.useState(""),[F,V]=w.useState(!1),P=w.useRef(null),H=l||{isConnected:!1,isConnecting:!1,users:[]};w.useEffect(()=>{t&&Y()},[t,e]),w.useEffect(()=>{!C&&N&&I(!1)},[C,N]),w.useEffect(()=>{J()},[_]),w.useEffect(()=>{const D=G=>{var ae,je;if(console.log(" Handling chat message:",G),G.type==="chat_message"&&G.user&&G.content){const de={id:G.id||`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"user",content:G.content,user:G.user,timestamp:G.ts||Date.now()};M(Ae=>Ae.some(Je=>Je.id===de.id)?Ae:[...Ae,de])}else if(G.type==="ai_response"&&G.content){const de={id:G.in_reply_to||`ai_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"ai",content:G.content,timestamp:G.ts||Date.now()};M(Ae=>Ae.some(Ye=>Ye.id===de.id&&Ye.type==="ai")?Ae:[...Ae.filter(Ye=>!(Ye.type==="system"&&Ye.content==="AI is typing...")),de])}else if(G.type==="chat_history"&&G.messages){const de=G.messages.map((Ae,Je)=>({id:Ae.id||`msg_${Date.now()}_${Je}_${Math.random().toString(36).substr(2,9)}`,type:Ae.message_type==="ai"?"ai":"user",content:Ae.content,user:Ae.user,timestamp:Ae.ts||Date.now()}));M(de),console.log(" Loaded chat history:",de.length,"messages")}else if(G.type==="user_joined"||G.type==="user_left"){const de={id:`system_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"system",content:G.type==="user_joined"?`${((ae=G.user)==null?void 0:ae.name)||"Someone"} joined the chat`:`${((je=G.user)==null?void 0:je.name)||"Someone"} left the chat`,timestamp:Date.now()};M(Ae=>[...Ae,de])}};return hn.on("message",D),hn.on("chat_message",D),hn.on("ai_response",D),hn.on("chat_history",D),hn.on("user_joined",D),hn.on("user_left",D),()=>{hn.off("message",D),hn.off("chat_message",D),hn.off("ai_response",D),hn.off("chat_history",D),hn.off("user_joined",D),hn.off("user_left",D)}},[]);const Y=async()=>{try{if(g(!0),e){const G=(await An.listPaperReferences(e,t)).data.references||[];x(G.map(ae=>({...ae,id:ae.id||ae.paper_reference_id||ae.reference_id})))}else{const G=(await rt.listReferences(t)).data.references||[];x(G.map(ae=>({...ae,id:ae.id||ae.reference_id})))}}catch(D){console.error("Error loading references:",D),x([])}finally{g(!1)}},L=D=>{if(!D||D.length===0)return"";const G=D.map(ae=>{const je=ae.split(" "),de=je[je.length-1],Ae=je.slice(0,-1).map(Je=>{var Ye;return((Ye=Je[0])==null?void 0:Ye.toUpperCase())+"."}).join(" ");return`${de}, ${Ae}`.trim()});return G.length===1?G[0]:G.slice(0,-1).join(", ")+", & "+G[G.length-1]},Se=D=>{const G=L(D.authors),ae=D.year?` (${D.year}).`:"",je=D.title?` ${D.title}.`:"",de=D.journal?` <i>${D.journal}</i>.`:"",Ae=D.doi?` https://doi.org/${D.doi}`:D.url?` ${D.url}`:"";return`${G}.${ae}${je}${de}${Ae}`.trim()},we=D=>{const G=D.authors&&D.authors.length?D.authors.length===1?D.authors[0]:`${D.authors[0]} et al.`:"",ae=D.title?` "${D.title}."`:"",je=D.journal?` <i>${D.journal}</i>`:"",de=D.year?`, ${D.year}`:"",Ae=D.doi?`. https://doi.org/${D.doi}`:D.url?`. ${D.url}`:".";return`${G}.${ae}${je}${de}${Ae}`.trim()},ge=D=>{const G=(D.authors||[]).join(", "),ae=D.year?` ${D.year}.`:"",je=D.title?` "${D.title}."`:"",de=D.journal?` <i>${D.journal}</i>`:"",Ae=D.doi?`. https://doi.org/${D.doi}`:D.url?`. ${D.url}`:".";return`${G}.${ae}${je}${de}${Ae}`.trim()},Ce=D=>{const G=de=>k==="apa"?Se(de):k==="mla"?we(de):ge(de),ae=D.map(de=>`<li>${G(de)}</li>`).join(""),je=k==="mla"?"Works Cited":"References";return{html:`<ol>${ae}</ol>`,heading:je}},Ie=async D=>{try{const ae=await(async()=>{try{return await import("citation-js")}catch{try{return await import("https://cdn.skypack.dev/citation-js@0.7.17")}catch{return null}}})();if(!ae)return null;const je=ae.default||ae,de=D.map($=>{const W=($.authors||[]).map(fe=>{const O=fe.trim().split(" "),Z=O.pop()||"";return{given:O.join(" "),family:Z}}),te=$.year?{"date-parts":[[$.year]]}:void 0;return{type:"article-journal",title:$.title,author:W,issued:te,DOI:$.doi||void 0,URL:$.url||void 0,"container-title":$.journal||void 0}}),Ae=new je(de),Ye={apa:"apa",mla:"modern-language-association",chicago:"chicago-author-date",ieee:"ieee",acm:"association-for-computing-machinery"}[k]||"apa",dt=Ae.format("bibliography",{format:"html",template:Ye});return{html:Array.isArray(dt)?dt.join(""):String(dt),heading:k==="mla"?"Works Cited":"References"}}catch(G){return console.warn("CSL formatting failed, falling back:",G),null}},re=async()=>{if(!(!z.trim()||F||!H.isConnected))try{V(!0);const D=z,G=`msg_${Date.now()}_${d==null?void 0:d.id}`,ae=D.startsWith("/"),je=[d==null?void 0:d.first_name,d==null?void 0:d.last_name].filter(Boolean).join(" ")||(d==null?void 0:d.email)||"User",de={id:G,type:"user",content:D,user:d?{id:d.id,name:je,email:d.email}:{name:"User"},timestamp:Date.now()};if(M(Ae=>[...Ae,de]),hn.sendMessage({type:"chat_message",id:G,content:D,paper_id:t}),ae){const Ae={id:`typing_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:"system",content:"AI is typing...",timestamp:Date.now()};M(Je=>[...Je,Ae]),J()}q(""),J(),console.log("Sent chat message:",D)}catch(D){console.error("Error sending message:",D)}finally{V(!1)}},J=()=>{var D;(D=P.current)==null||D.scrollIntoView({behavior:"smooth"})},[Q,he]=w.useState(new Set),Re=m.filter(D=>[D.title||"",(D.authors||[]).join(" ")].join(" ").toLowerCase().includes(y.toLowerCase())),De=(()=>{if(Q.size===0)return m;const D=new Set(Q);return m.filter(G=>D.has(G.id))})();return r?a.jsxs("div",{className:"fixed right-0 top-0 h-full w-96 bg-white border-l border-gray-200 shadow-xl z-50 flex flex-col",children:[a.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 bg-gray-50",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 truncate",children:n}),a.jsx("button",{onClick:s,className:"text-gray-400 hover:text-gray-600 p-1",title:"Close sidebar",children:a.jsx(Jt,{size:20})})]}),a.jsxs("div",{className:"flex border-b border-gray-200",children:[a.jsx("button",{onClick:()=>p("references"),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${f==="references"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(ln,{size:16}),a.jsx("span",{children:"References"}),a.jsx("span",{className:"bg-gray-200 text-gray-600 px-2 py-0.5 rounded-full text-xs",children:m.length})]})}),a.jsx("button",{onClick:()=>p("chat"),className:`flex-1 px-4 py-3 text-sm font-medium border-b-2 transition-colors ${f==="chat"?"border-blue-500 text-blue-600 bg-blue-50":"border-transparent text-gray-500 hover:text-gray-700 hover:bg-gray-50"}`,children:a.jsxs("div",{className:"flex items-center justify-center gap-2",children:[a.jsx(ma,{size:16}),a.jsx("span",{children:"Chat"}),H.users.length>0&&a.jsx("span",{className:"bg-green-200 text-green-600 px-2 py-0.5 rounded-full text-xs",children:H.users.length+1})]})})]}),a.jsx("div",{className:"flex-1 overflow-hidden",children:f==="references"?a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Attached References"}),a.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600",children:[a.jsx("input",{type:"checkbox",checked:A,onChange:D=>T(D.target.checked)}),"Use CSL (Zotero)"]}),a.jsxs("select",{value:k,onChange:D=>S(D.target.value),className:"border border-gray-200 rounded-md text-sm px-2 py-1",title:"Bibliography Style",children:[a.jsx("option",{value:"apa",children:"APA"}),a.jsx("option",{value:"mla",children:"MLA"}),a.jsx("option",{value:"chicago",children:"Chicago"})]}),e&&C&&a.jsxs("button",{onClick:()=>I(!0),className:"flex items-center gap-1 px-3 py-1.5 bg-gray-100 text-gray-800 text-sm rounded-md hover:bg-gray-200 transition-colors",title:"Manage attached references",children:[a.jsx(xn,{size:14}),a.jsx("span",{children:"Manage attachments"})]}),!u&&a.jsxs("label",{className:"flex items-center gap-1 text-xs text-gray-600",children:[a.jsx("input",{type:"checkbox",checked:j,onChange:D=>E(D.target.checked)}),"Selected only"]}),u?a.jsxs("button",{onClick:()=>{try{window.dispatchEvent(new CustomEvent("SH_LATEX_INSERT_BIB"));const D=De.map(G=>np(G));D.length>0&&window.dispatchEvent(new CustomEvent("SH_LATEX_INSERT_NOCITE",{detail:{keys:D}}))}catch{}},className:"flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors",title:"Insert LaTeX bibliography (adds commands; selected refs via \\\\nocite)",children:[a.jsx(xn,{size:14}),a.jsx("span",{children:"Insert Bibliography"})]}):a.jsxs("button",{onClick:async()=>{const D=j?m.filter(ae=>Q.has(ae.id)):De;if(D.length===0){alert("No references selected or available");return}if(A){const ae=await Ie(D);if(ae){c&&c(ae.html,ae.heading);return}}const G=Ce(D);c&&c(G.html,G.heading)},className:"flex items-center gap-1 px-3 py-1.5 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700 transition-colors",title:"Insert bibliography into editor",children:[a.jsx(xn,{size:14}),a.jsx("span",{children:"Insert Bibliography"})]})]})]}),a.jsxs("div",{className:"relative",children:[a.jsx(Ts,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),a.jsx("input",{type:"text",placeholder:"Search references...",value:y,onChange:D=>b(D.target.value),className:"w-full pl-9 pr-3 py-2 border border-gray-200 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto p-4 relative",children:v?a.jsx("div",{className:"flex items-center justify-center py-8",children:a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-blue-600 border-t-transparent"})}):Re.length===0?a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(ln,{size:48,className:"mx-auto mb-4 text-gray-300"}),a.jsx("p",{className:"text-sm",children:y?"No references match your search.":"No references attached yet."})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-600",children:[a.jsxs("div",{children:[a.jsx("button",{className:"underline mr-3",onClick:()=>he(new Set(Re.map(D=>D.id))),children:"Select All"}),a.jsx("button",{className:"underline",onClick:()=>he(new Set),children:"Clear"})]}),a.jsx("div",{children:Q.size>0?`${Q.size} selected`:"None selected"})]}),Re.map(D=>a.jsx("div",{className:"border border-gray-200 rounded-lg p-3 hover:bg-gray-50 transition-colors",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("input",{type:"checkbox",checked:Q.has(D.id),onChange:G=>{he(ae=>{const je=new Set(ae);return G.target.checked?je.add(D.id):je.delete(D.id),je})},className:"mt-1.5"})}),a.jsx("div",{className:"flex items-center gap-1",children:a.jsx("button",{onClick:()=>{if(u)try{const G=np(D);window.dispatchEvent(new CustomEvent("SH_LATEX_INSERT_CITE",{detail:{key:G}}))}catch{}else try{const ae=(Array.isArray(D.authors)&&D.authors.length>0?String(D.authors[0]):"").split(/\s+/).filter(Boolean).slice(-1)[0]||"Author",je=D.year?String(D.year):"n.d.",de=`(${ae}, ${je})`;o&&o(de)}catch{}},className:"px-2 py-1 text-xs bg-gray-100 rounded hover:bg-gray-200",title:u?"Insert \\cite{key} at cursor":"Insert (Author, Year)",children:"Insert Citation"})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("h4",{className:"text-sm font-medium text-gray-900 truncate",children:D.title}),a.jsxs("div",{className:"flex flex-col gap-1 mt-2 text-xs text-gray-600",children:[D.authors&&D.authors.length>0&&a.jsx("span",{children:D.authors.join(", ")}),a.jsxs("div",{className:"flex items-center gap-3 text-gray-400",children:[D.year&&a.jsxs("span",{className:"flex items-center gap-1",children:[a.jsx(Kh,{size:12}),D.year]}),D.journal&&a.jsx("span",{children:D.journal}),D.doi&&a.jsx("a",{href:`https://doi.org/${D.doi}`,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:"DOI"})]})]})]})]})},D.id))]}),a.jsx("div",{className:"sticky bottom-0 left-0 right-0 bg-white/95 backdrop-blur border-t border-gray-200 mt-4 pt-2 pb-2",children:a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsx("div",{className:"text-xs text-gray-500",children:Q.size>0?`${Q.size} selected`:"All references"}),u?a.jsx("button",{onClick:()=>{try{window.dispatchEvent(new CustomEvent("SH_LATEX_INSERT_BIB"));const D=De.map(G=>np(G));D.length>0&&window.dispatchEvent(new CustomEvent("SH_LATEX_INSERT_NOCITE",{detail:{keys:D}}))}catch{}},className:"px-3 py-1.5 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",children:"Insert Bibliography"}):a.jsx("button",{onClick:async()=>{const D=j?m.filter(ae=>Q.has(ae.id)):De;if(D.length===0){alert("No references selected or available");return}if(A){const ae=await Ie(D);if(ae){c&&c(ae.html,ae.heading);return}}const G=Ce(D);c&&c(G.html,G.heading)},className:"px-3 py-1.5 bg-blue-600 text-white text-sm rounded-md hover:bg-blue-700",children:"Insert Bibliography"})]})})]})})]}):a.jsxs("div",{className:"h-full flex flex-col",children:[a.jsxs("div",{className:"p-4 border-b border-gray-100",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-700",children:"Team Chat"}),a.jsx("div",{className:"flex items-center gap-2",children:a.jsxs("div",{className:`flex items-center gap-1 text-xs px-2 py-1 rounded-full ${H.isConnected?"bg-green-100 text-green-700":H.isConnecting?"bg-yellow-100 text-yellow-700":"bg-red-100 text-red-700"}`,children:[a.jsx("div",{className:`w-2 h-2 rounded-full ${H.isConnected?"bg-green-500":H.isConnecting?"bg-yellow-500":"bg-red-500"}`}),a.jsx("span",{children:H.isConnected?`${H.users.length+1} online`:H.isConnecting?"Connecting...":"Offline"})]})})]}),H.users.length>0&&a.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Active: ",H.users.map(D=>D.name).join(", ")," + You"]}),a.jsx("div",{className:"mt-3 p-2 bg-blue-50 rounded-md",children:a.jsxs("p",{className:"text-xs text-blue-700",children:[" ",a.jsx("strong",{children:"Tip:"}),' Start your message with "/" to ask the AI assistant']})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[_.length===0?a.jsxs("div",{className:"text-center py-8 text-gray-500",children:[a.jsx(ma,{size:48,className:"mx-auto mb-4 text-gray-300"}),a.jsx("p",{className:"text-sm",children:"Start a conversation with your team!"}),a.jsx("p",{className:"text-xs mt-1",children:'Ask questions, share ideas, or use "/" for AI help.'})]}):_.map(D=>{var G;return a.jsx("div",{className:`flex gap-3 ${D.type==="system"?"justify-center":""}`,children:D.type==="system"?a.jsxs("div",{className:`text-xs px-3 py-1 rounded-full ${D.content==="AI is typing..."?"text-purple-600 bg-purple-50 border border-purple-200 flex items-center gap-2":"text-gray-500 bg-gray-100"}`,children:[D.content==="AI is typing..."&&a.jsxs("div",{className:"flex gap-1",children:[a.jsx("div",{className:"w-1 h-1 bg-purple-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),a.jsx("div",{className:"w-1 h-1 bg-purple-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),a.jsx("div",{className:"w-1 h-1 bg-purple-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),D.content]}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex-shrink-0",children:D.type==="ai"?a.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:a.jsx(rS,{size:16,className:"text-purple-600"})}):a.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:a.jsx($T,{size:16,className:"text-blue-600"})})}),a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:D.type==="ai"?"AI Assistant":((G=D.user)==null?void 0:G.name)||"Unknown"}),a.jsx("span",{className:"text-xs text-gray-500",children:new Date(D.timestamp).toLocaleTimeString()})]}),a.jsx("div",{className:`text-sm p-3 rounded-lg ${D.type==="ai"?"bg-purple-50 text-purple-900 border border-purple-200":"bg-gray-100 text-gray-900"}`,children:D.type==="ai"?a.jsx("div",{className:"whitespace-pre-wrap leading-relaxed",children:D.content}):D.content})]})]})},D.id)}),a.jsx("div",{ref:P})]}),a.jsx("div",{className:"p-4 border-t border-gray-100",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx("input",{type:"text",placeholder:H.isConnected?"Type a message... (start with / for AI)":"Connecting to chat...",value:z,onChange:D=>q(D.target.value),onKeyPress:D=>{D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),re())},disabled:!H.isConnected||F,className:"flex-1 px-3 py-2 border border-gray-200 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent disabled:bg-gray-50 disabled:cursor-not-allowed"}),a.jsx("button",{onClick:re,disabled:!z.trim()||!H.isConnected||F,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:F?a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):a.jsx(oS,{size:16})})]})})]})}),e&&a.jsx(cS,{isOpen:N,projectId:e,paperId:t,attachedProjectReferenceIds:m.map(D=>D.project_reference_id).filter(D=>!!D),onClose:()=>I(!1),onUpdated:async()=>{I(!1),await Y()}})]}):a.jsx("button",{onClick:i,className:"fixed right-4 top-1/2 -translate-y-1/2 z-40 bg-blue-600 text-white p-3 rounded-l-lg shadow-lg hover:bg-blue-700 transition-colors",title:"Open sidebar",children:a.jsx(ln,{size:20})})};class cR{constructor(){Rt(this,"baseUrl","/branches");Rt(this,"isDemoMode",!1);Rt(this,"mockBranches",[]);Rt(this,"mockCommits",[]);Rt(this,"mockMergeRequests",[])}shouldUseDemoMode(){return this.isDemoMode||!localStorage.getItem("access_token")}htmlToText(e){const n=document.createElement("div");return n.innerHTML=e,(n.textContent||n.innerText||"").replace(/\s+/g," ").replace(/\n\s*\n/g,`
`).trim()}extractSections(e){const n=document.createElement("div");n.innerHTML=e;const r=[];if(n.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(l=>{var o;r.push({type:`Heading (${l.tagName})`,content:((o=l.textContent)==null?void 0:o.trim())||""})}),n.querySelectorAll("p").forEach((l,o)=>{var u;const c=(u=l.textContent)==null?void 0:u.trim();c&&c.length>10&&r.push({type:`Paragraph ${o+1}`,content:c.length>150?c.substring(0,150)+"...":c})}),r.length===0){const l=this.htmlToText(e);l.trim()&&r.push({type:"Content",content:l.length>200?l.substring(0,200)+"...":l})}return r}calculateChanges(e,n){const r=this.mockCommits.filter(o=>o.branchId===e),s=r.length>0?r[r.length-1]:null,i=(s==null?void 0:s.content)||"",l=[];if(i!==n){const o=this.extractSections(i),c=this.extractSections(n);if(o.length===0&&c.length>0)c.forEach((u,h)=>{l.push({type:"insert",section:u.type,newContent:u.content,position:h})});else if(o.length>0&&c.length===0)o.forEach((u,h)=>{l.push({type:"delete",section:u.type,oldContent:u.content,position:h})});else{const u=Math.max(o.length,c.length);for(let h=0;h<u;h++){const d=o[h],f=c[h];!d&&f?l.push({type:"insert",section:f.type,newContent:f.content,position:h}):d&&!f?l.push({type:"delete",section:d.type,oldContent:d.content,position:h}):d&&f&&d.content!==f.content&&l.push({type:"update",section:f.type,oldContent:d.content,newContent:f.content,position:h})}}if(l.length===0){const u=this.htmlToText(i),h=this.htmlToText(n);l.push({type:"update",section:"Document Content",oldContent:u.length>100?u.substring(0,100)+"...":u,newContent:h.length>100?h.substring(0,100)+"...":h,position:0})}}return l.length>0?l:[{type:"insert",section:"Initial Content",newContent:"Document created with initial content",position:0}]}async createBranch(e,n,r){if(this.shouldUseDemoMode()){const i={id:`branch-${Date.now()}`,name:n,paperId:e,parentBranchId:r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"active",authorId:"demo-user",authorName:"Demo User",lastCommitMessage:"Branch created",isMain:!1};return this.mockBranches.push(i),i}return(await X.post(this.baseUrl,{paperId:e,name:n,parentBranchId:r})).data}async getBranches(e){if(this.shouldUseDemoMode()){const n=this.mockBranches.filter(r=>r.paperId===e);if(n.length===0){const r={id:`main-${e}`,name:"main",paperId:e,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),status:"active",authorId:"demo-user",authorName:"Demo User",lastCommitMessage:"Initial commit",isMain:!0};this.mockBranches.push(r);const s={id:`commit-${Date.now()}`,branchId:r.id,message:"Initial commit",content:"",authorId:"demo-user",authorName:"Demo User",timestamp:new Date().toISOString(),changes:[{type:"insert",section:"content",newContent:"Initial paper created (blank)",position:0}]};return this.mockCommits.push(s),[r]}return n}try{return(await X.get(`${this.baseUrl}/paper/${e}`)).data}catch(n){return console.warn("API call failed, falling back to demo mode:",n==null?void 0:n.message),this.isDemoMode=!0,this.getBranches(e)}}async switchBranch(e,n){if(this.isDemoMode){const s=this.mockBranches.find(i=>i.id===n);if(!s)throw new Error("Branch not found");return{branch:s,content:"<h1>Switched to "+s.name+"</h1><p>This is the content from the "+s.name+" branch.</p>"}}return(await X.post(`${this.baseUrl}/${n}/switch`,{paperId:e})).data}async deleteBranch(e){if(this.isDemoMode){const n=this.mockBranches.findIndex(r=>r.id===e);n>-1&&this.mockBranches.splice(n,1);return}await X.delete(`${this.baseUrl}/${e}`)}async commitChanges(e,n,r){if(this.isDemoMode){const i={id:`commit-${Date.now()}`,branchId:e,message:n,content:r,authorId:"demo-user",authorName:"Demo User",timestamp:new Date().toISOString(),changes:this.calculateChanges(e,r)};this.mockCommits.push(i);const l=this.mockBranches.find(o=>o.id===e);return l&&(l.lastCommitMessage=n,l.updatedAt=new Date().toISOString()),i}return(await X.post(`${this.baseUrl}/${e}/commit`,{message:n,content:r})).data}async getCommitHistory(e){return this.isDemoMode?this.mockCommits.filter(s=>s.branchId===e).sort((s,i)=>new Date(i.timestamp).getTime()-new Date(s.timestamp).getTime()):(await X.get(`${this.baseUrl}/${e}/commits`)).data}async createMergeRequest(e,n,r,s){if(this.isDemoMode){const l={id:`mr-${Date.now()}`,sourceBranchId:e,targetBranchId:n,paperId:"demo-paper-123",title:r,description:s,status:"open",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),authorId:"demo-user",authorName:"Demo User"};return this.mockMergeRequests.push(l),l}return(await X.post(`${this.baseUrl}/merge-requests`,{sourceBranchId:e,targetBranchId:n,title:r,description:s})).data}async getMergeRequests(e){return this.isDemoMode?this.mockMergeRequests.filter(r=>r.paperId===e):(await X.get(`${this.baseUrl}/merge-requests/paper/${e}`)).data}async mergeBranches(e,n,r="auto"){return this.isDemoMode?{success:!0,mergedContent:"<h1>Merged Content</h1><p>This content was successfully merged from multiple branches.</p>"}:(await X.post(`${this.baseUrl}/merge`,{sourceBranchId:e,targetBranchId:n,strategy:r})).data}async resolveConflict(e,n){return this.isDemoMode?{id:e,section:"Demo Section",sourceContent:"Source content",targetContent:"Target content",resolvedContent:n,status:"resolved",resolutionStrategy:"manual"}:(await X.put(`${this.baseUrl}/conflicts/${e}`,{resolvedContent:n,status:"resolved"})).data}async analyzeConflicts(e,n){return this.isDemoMode?[{id:"conflict-1",section:"Introduction",sourceContent:"This is the source content for the introduction.",targetContent:"This is the target content for the introduction.",status:"unresolved",resolutionStrategy:"manual"}]:(await X.post(`${this.baseUrl}/analyze-conflicts`,{sourceBranchId:e,targetBranchId:n})).data}async autoMergeStrategy(e,n){return this.isDemoMode?e.map(s=>({...s,status:"resolved",resolvedContent:n==="source-wins"?s.sourceContent:s.targetContent})):(await X.post(`${this.baseUrl}/auto-merge`,{conflicts:e,strategy:n})).data}}const is=new cR,uR=({paperId:t,currentBranchId:e,onBranchSwitch:n,onContentUpdate:r,className:s=""})=>{const[i,l]=w.useState([]),[o,c]=w.useState([]),[u,h]=w.useState(!1),[d,f]=w.useState(""),[p,m]=w.useState(null),[x,v]=w.useState(!1),[g,y]=w.useState(new Set);w.useEffect(()=>{b()},[t]),w.useEffect(()=>{e&&k(e)},[e]);const b=async()=>{try{v(!0);const C=await is.getBranches(t);if(l(C),!e&&C.length>0){const _=C.find(M=>M.isMain)||C[0];m(_)}else if(e){const _=C.find(M=>M.id===e);m(_||null)}}catch(C){console.error("Failed to load branches:",C)}finally{v(!1)}},k=async C=>{try{const _=await is.getCommitHistory(C);c(_)}catch(_){console.error("Failed to load commits:",_)}},S=async()=>{if(!(!d.trim()||!p))try{v(!0);const C=await is.createBranch(t,d.trim(),p.id);l(_=>[..._,C]),f(""),h(!1),await j(C.id)}catch(C){console.error("Failed to create branch:",C)}finally{v(!1)}},j=async C=>{try{v(!0);const _=await is.switchBranch(t,C);m(_.branch),n(C),r(_.content),k(C)}catch(_){console.error("Failed to switch branch:",_)}finally{v(!1)}},E=async C=>{if(confirm("Are you sure you want to delete this branch? This action cannot be undone."))try{if(v(!0),await is.deleteBranch(C),l(_=>_.filter(M=>M.id!==C)),(p==null?void 0:p.id)===C){const _=i.find(M=>M.isMain)||i[0];_&&await j(_.id)}}catch(_){console.error("Failed to delete branch:",_)}finally{v(!1)}},A=C=>new Date(C).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),T=C=>C.isMain?"text-blue-600 bg-blue-100":C.status==="merged"?"text-green-600 bg-green-100":C.status==="archived"?"text-gray-600 bg-gray-100":"text-purple-600 bg-purple-100",N=C=>{y(_=>{const M=new Set(_);return M.has(C)?M.delete(C):M.add(C),M})},I=C=>{switch(C){case"insert":return a.jsx(xn,{className:"w-3 h-3 text-green-600"});case"delete":return a.jsx(nr,{className:"w-3 h-3 text-red-600"});case"update":return a.jsx(_u,{className:"w-3 h-3 text-blue-600"});default:return a.jsx(_u,{className:"w-3 h-3 text-gray-600"})}},R=C=>{switch(C){case"insert":return"bg-green-50 border-green-200 text-green-800";case"delete":return"bg-red-50 border-red-200 text-red-800";case"update":return"bg-blue-50 border-blue-200 text-blue-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}};return a.jsxs("div",{className:`bg-white rounded-lg shadow-lg ${s}`,children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[a.jsx(tv,{className:"w-5 h-5 mr-2"}),"Branch Management"]}),a.jsxs("button",{onClick:()=>h(!0),className:"px-3 py-1 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center text-sm",children:[a.jsx(xn,{className:"w-4 h-4 mr-1"}),"New Branch"]})]})}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 p-6",children:[a.jsxs("div",{children:[a.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Branches"}),a.jsx("div",{className:"space-y-2",children:i.map(C=>a.jsxs("div",{className:`p-3 rounded-lg border cursor-pointer transition-colors ${(p==null?void 0:p.id)===C.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>j(C.id),children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center",children:[a.jsx(tv,{className:"w-4 h-4 mr-2 text-gray-500"}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"font-medium text-gray-900",children:C.name}),C.isMain&&a.jsx("span",{className:"px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded",children:"Main"})]}),a.jsxs("p",{className:"text-sm text-gray-600",children:["Last commit: ",C.lastCommitMessage]})]})]}),a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:`px-2 py-1 text-xs rounded ${T(C)}`,children:C.status}),!C.isMain&&a.jsx("button",{onClick:_=>{_.stopPropagation(),E(C.id)},className:"p-1 text-red-600 hover:bg-red-100 rounded",title:"Delete branch",children:a.jsx(nr,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"mt-2 text-xs text-gray-500",children:["Created by ",C.authorName," on ",A(C.createdAt)]})]},C.id))})]}),a.jsxs("div",{children:[a.jsx("h4",{className:"text-md font-medium text-gray-900 mb-3",children:"Commit History"}),a.jsxs("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:[o.map(C=>{var M;const _=g.has(C.id);return a.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[a.jsx("div",{className:"p-3 cursor-pointer hover:bg-gray-50 transition-colors",onClick:()=>N(C.id),children:a.jsxs("div",{className:"flex items-start space-x-3",children:[a.jsx("div",{className:"w-8 h-8 bg-gray-100 rounded-full flex items-center justify-center",children:a.jsx(_u,{className:"w-4 h-4 text-gray-600"})}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx("span",{className:"font-medium text-gray-900",children:C.message}),C.id===((M=o[0])==null?void 0:M.id)&&a.jsx("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-800 rounded",children:"Latest"})]}),a.jsxs("p",{className:"text-sm text-gray-600",children:[C.authorName,"  ",A(C.timestamp)]}),a.jsxs("div",{className:"mt-2 flex items-center space-x-4",children:[a.jsxs("span",{className:"text-xs text-gray-500",children:[C.changes.length," changes"]}),a.jsxs("div",{className:"flex items-center text-xs text-blue-600",children:[_?a.jsx(Qh,{className:"w-4 h-4 mr-1"}):a.jsx(KM,{className:"w-4 h-4 mr-1"}),_?"Hide changes":"Show changes"]})]})]})]})}),_&&a.jsxs("div",{className:"border-t border-gray-200 bg-gray-50 p-4",children:[a.jsx("h5",{className:"text-sm font-medium text-gray-900 mb-3",children:"Changes in this commit:"}),a.jsx("div",{className:"space-y-2",children:C.changes.map((z,q)=>a.jsxs("div",{className:`p-3 rounded border ${R(z.type)}`,children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[I(z.type),a.jsxs("span",{className:"text-sm font-medium capitalize",children:[z.type,"  ",z.section]})]}),z.type==="insert"&&z.newContent&&a.jsxs("div",{className:"text-sm",children:[a.jsxs("div",{className:"text-green-700 font-medium mb-2 flex items-center",children:[a.jsx(xn,{className:"w-3 h-3 mr-1"}),"Added Content:"]}),a.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 rounded px-3 py-2 text-sm",children:a.jsx("div",{className:"text-green-800 leading-relaxed",children:z.newContent})})]}),z.type==="delete"&&z.oldContent&&a.jsxs("div",{className:"text-sm",children:[a.jsxs("div",{className:"text-red-700 font-medium mb-2 flex items-center",children:[a.jsx(nr,{className:"w-3 h-3 mr-1"}),"Removed Content:"]}),a.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 rounded px-3 py-2 text-sm",children:a.jsx("div",{className:"text-red-800 leading-relaxed line-through",children:z.oldContent})})]}),z.type==="update"&&a.jsxs("div",{className:"text-sm space-y-3",children:[z.oldContent&&a.jsxs("div",{children:[a.jsxs("div",{className:"text-red-700 font-medium mb-2 flex items-center",children:[a.jsx(nr,{className:"w-3 h-3 mr-1"}),"Previous Version:"]}),a.jsx("div",{className:"bg-red-50 border-l-4 border-red-400 rounded px-3 py-2",children:a.jsx("div",{className:"text-red-800 leading-relaxed line-through",children:z.oldContent})})]}),z.newContent&&a.jsxs("div",{children:[a.jsxs("div",{className:"text-green-700 font-medium mb-2 flex items-center",children:[a.jsx(xn,{className:"w-3 h-3 mr-1"}),"Updated Version:"]}),a.jsx("div",{className:"bg-green-50 border-l-4 border-green-400 rounded px-3 py-2",children:a.jsx("div",{className:"text-green-800 leading-relaxed font-medium",children:z.newContent})})]})]})]},q))})]})]},C.id)}),o.length===0&&a.jsxs("div",{className:"text-center text-gray-500 py-8",children:[a.jsx(_u,{className:"w-12 h-12 mx-auto mb-2 text-gray-300"}),a.jsx("p",{children:"No commits yet"})]})]})]})]}),u&&a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg p-6 w-96",children:[a.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Create New Branch"}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Branch Name"}),a.jsx("input",{type:"text",value:d,onChange:C=>f(C.target.value),placeholder:"e.g., feature/methodology-section",className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),a.jsxs("div",{className:"mb-4",children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Based on Branch"}),a.jsx("select",{value:(p==null?void 0:p.id)||"",onChange:C=>{const _=i.find(M=>M.id===C.target.value);m(_||null)},className:"w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:i.map(C=>a.jsxs("option",{value:C.id,children:[C.name," ",C.isMain?"(Main)":""]},C.id))})]}),a.jsxs("div",{className:"flex items-center justify-end space-x-3",children:[a.jsx("button",{onClick:()=>h(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200",children:"Cancel"}),a.jsx("button",{onClick:S,disabled:!d.trim()||!p||x,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Creating...":"Create Branch"})]})]})})]})};function sv(t){try{let e=t;return e=e.replace(/\$(?:[^$\\]|\\.)*\$/gs,n=>n.replace(/\s+/g," ")),e=e.replace(/\\\[(?:[^\\]|\\.)*?\\\]/gs,n=>n.replace(/\s+/g," ")),e=e.replace(/\\begin\{(equation\*?|align\*?|gather\*?|multline\*?)\}[\s\S]*?\\end\{\1\}/g,n=>n.replace(/\s+/g," ")),e}catch{return t}}function gi(t){const e=[],n=t.split(/\n/),r=[];let s=null,i=1,l=[0,0,0];const o=()=>{if(s){const h=i+r.length-1;e.push({key:s.key,title:s.title,level:s.level,content:r.join(`
`),lineStart:i,lineEnd:h}),r.length=0}},c=/(\\section|\\subsection|\\subsubsection)\s*\{([^}]*)\}/;let u=1;for(const h of n){const d=h.match(c);if(d){o();const f=d[1]==="\\section"?1:d[1]==="\\subsection"?2:3;l[f-1]+=1;for(let x=f;x<l.length;x++)l[x]=0;const p=l.slice(0,f).join("."),m=(d[2]||"").trim();s={key:`${p}:${m}`,title:m,level:f},i=u+1}else r.push(h);u+=1}if(o(),e.length===0){const h=n.length;e.push({key:"0:Document",title:"Document",level:1,content:t,lineStart:1,lineEnd:h})}return e}function dR(t){const e=[],n=[];for(const r of t){const s={key:r.key,title:r.title,level:r.level,lineStart:r.lineStart||1,lineEnd:r.lineEnd||r.lineStart||1,children:[]};for(;n.length>0&&n[n.length-1].level>=s.level;)n.pop();n.length===0?e.push(s):n[n.length-1].children.push(s),n.push(s)}return e}function uS(t,e){const n=gi(t),r=gi(e),s=new Map(n.map(m=>[m.key,m])),i=new Map(r.map(m=>[m.key,m])),l=[],o=[],c=[],u=[],h=[];for(const[m,x]of i){const v=s.get(m);if(!v)l.push(x);else{const g=sv(v.content).trim(),y=sv(x.content).trim();g===y?u.push(x):c.push({key:m,left:v,right:x})}}for(const[m,x]of s)i.has(m)||o.push(x);const d=n.map(m=>m.key),f=r.map(m=>m.key),p=[];return d.length===f.length&&d.some((m,x)=>m!==f[x])&&d.forEach(m=>{f.indexOf(m)!==d.indexOf(m)&&p.push(m)}),h.push(...c),{added:l,removed:o,modified:c,unchanged:u,reordered:p,conflicts:h}}function hR(t,e,n,r){const s=gi(e),i=gi(n),l=new Map(s.map(d=>[d.key,d])),o=new Map(i.map(d=>[d.key,d])),c=Array.from(new Set([...s.map(d=>d.key),...i.map(d=>d.key)])).sort((d,f)=>{const p=parseFloat(d.split(":")[0]),m=parseFloat(f.split(":")[0]);return p-m}),u=[],h=d=>{const f=d.level===1?"\\section":d.level===2?"\\subsection":"\\subsubsection";u.push(`${f}{${d.title}}`)};for(const d of c){const f=l.get(d),p=o.get(d);if(f&&!p)h(f),u.push(f.content);else if(!f&&p)h(p),u.push(p.content);else if(f&&p){const m=r[d]||"right";h(m==="left"?f:p),m==="both"?(u.push("% >>>>>> SOURCE"),u.push(f.content),u.push("% ======"),u.push(p.content),u.push("% <<<<<< TARGET")):u.push(m==="left"?f.content:p.content)}}return u.join(`

`)}let ig=[],dS=[];(()=>{let t="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(e=>e?parseInt(e,36):1);for(let e=0,n=0;e<t.length;e++)(e%2?dS:ig).push(n=n+t[e])})();function fR(t){if(t<768)return!1;for(let e=0,n=ig.length;;){let r=e+n>>1;if(t<ig[r])n=r;else if(t>=dS[r])e=r+1;else return!0;if(e==n)return!1}}function iv(t){return t>=127462&&t<=127487}const lv=8205;function pR(t,e,n=!0,r=!0){return(n?hS:mR)(t,e,r)}function hS(t,e,n){if(e==t.length)return e;e&&fS(t.charCodeAt(e))&&pS(t.charCodeAt(e-1))&&e--;let r=rp(t,e);for(e+=av(r);e<t.length;){let s=rp(t,e);if(r==lv||s==lv||n&&fR(s))e+=av(s),r=s;else if(iv(s)){let i=0,l=e-2;for(;l>=0&&iv(rp(t,l));)i++,l-=2;if(i%2==0)break;e+=2}else break}return e}function mR(t,e,n){for(;e>0;){let r=hS(t,e-2,n);if(r<e)return r;e--}return 0}function rp(t,e){let n=t.charCodeAt(e);if(!pS(n)||e+1==t.length)return n;let r=t.charCodeAt(e+1);return fS(r)?(n-55296<<10)+(r-56320)+65536:n}function fS(t){return t>=56320&&t<57344}function pS(t){return t>=55296&&t<56320}function av(t){return t<65536?1:2}class Ge{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,n,r){[e,n]=Ua(this,e,n);let s=[];return this.decompose(0,e,s,2),r.length&&r.decompose(0,r.length,s,3),this.decompose(n,this.length,s,1),ls.from(s,this.length-(n-e)+r.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,n=this.length){[e,n]=Ua(this,e,n);let r=[];return this.decompose(e,n,r,0),ls.from(r,n-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let n=this.scanIdentical(e,1),r=this.length-this.scanIdentical(e,-1),s=new Yo(this),i=new Yo(e);for(let l=n,o=n;;){if(s.next(l),i.next(l),l=0,s.lineBreak!=i.lineBreak||s.done!=i.done||s.value!=i.value)return!1;if(o+=s.value.length,s.done||o>=r)return!0}}iter(e=1){return new Yo(this,e)}iterRange(e,n=this.length){return new mS(this,e,n)}iterLines(e,n){let r;if(e==null)r=this.iter();else{n==null&&(n=this.lines+1);let s=this.line(e).from;r=this.iterRange(s,Math.max(s,n==this.lines+1?this.length:n<=1?0:this.line(n-1).to))}return new gS(r)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?Ge.empty:e.length<=32?new _t(e):ls.from(_t.split(e,[]))}}class _t extends Ge{constructor(e,n=gR(e)){super(),this.text=e,this.length=n}get lines(){return this.text.length}get children(){return null}lineInner(e,n,r,s){for(let i=0;;i++){let l=this.text[i],o=s+l.length;if((n?r:o)>=e)return new xR(s,o,r,l);s=o+1,r++}}decompose(e,n,r,s){let i=e<=0&&n>=this.length?this:new _t(ov(this.text,e,n),Math.min(n,this.length)-Math.max(0,e));if(s&1){let l=r.pop(),o=yd(i.text,l.text.slice(),0,i.length);if(o.length<=32)r.push(new _t(o,l.length+i.length));else{let c=o.length>>1;r.push(new _t(o.slice(0,c)),new _t(o.slice(c)))}}else r.push(i)}replace(e,n,r){if(!(r instanceof _t))return super.replace(e,n,r);[e,n]=Ua(this,e,n);let s=yd(this.text,yd(r.text,ov(this.text,0,e)),n),i=this.length+r.length-(n-e);return s.length<=32?new _t(s,i):ls.from(_t.split(s,[]),i)}sliceString(e,n=this.length,r=`
`){[e,n]=Ua(this,e,n);let s="";for(let i=0,l=0;i<=n&&l<this.text.length;l++){let o=this.text[l],c=i+o.length;i>e&&l&&(s+=r),e<c&&n>i&&(s+=o.slice(Math.max(0,e-i),n-i)),i=c+1}return s}flatten(e){for(let n of this.text)e.push(n)}scanIdentical(){return 0}static split(e,n){let r=[],s=-1;for(let i of e)r.push(i),s+=i.length+1,r.length==32&&(n.push(new _t(r,s)),r=[],s=-1);return s>-1&&n.push(new _t(r,s)),n}}class ls extends Ge{constructor(e,n){super(),this.children=e,this.length=n,this.lines=0;for(let r of e)this.lines+=r.lines}lineInner(e,n,r,s){for(let i=0;;i++){let l=this.children[i],o=s+l.length,c=r+l.lines-1;if((n?c:o)>=e)return l.lineInner(e,n,r,s);s=o+1,r=c+1}}decompose(e,n,r,s){for(let i=0,l=0;l<=n&&i<this.children.length;i++){let o=this.children[i],c=l+o.length;if(e<=c&&n>=l){let u=s&((l<=e?1:0)|(c>=n?2:0));l>=e&&c<=n&&!u?r.push(o):o.decompose(e-l,n-l,r,u)}l=c+1}}replace(e,n,r){if([e,n]=Ua(this,e,n),r.lines<this.lines)for(let s=0,i=0;s<this.children.length;s++){let l=this.children[s],o=i+l.length;if(e>=i&&n<=o){let c=l.replace(e-i,n-i,r),u=this.lines-l.lines+c.lines;if(c.lines<u>>4&&c.lines>u>>6){let h=this.children.slice();return h[s]=c,new ls(h,this.length-(n-e)+r.length)}return super.replace(i,o,c)}i=o+1}return super.replace(e,n,r)}sliceString(e,n=this.length,r=`
`){[e,n]=Ua(this,e,n);let s="";for(let i=0,l=0;i<this.children.length&&l<=n;i++){let o=this.children[i],c=l+o.length;l>e&&i&&(s+=r),e<c&&n>l&&(s+=o.sliceString(e-l,n-l,r)),l=c+1}return s}flatten(e){for(let n of this.children)n.flatten(e)}scanIdentical(e,n){if(!(e instanceof ls))return 0;let r=0,[s,i,l,o]=n>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=n,i+=n){if(s==l||i==o)return r;let c=this.children[s],u=e.children[i];if(c!=u)return r+c.scanIdentical(u,n);r+=c.length+1}}static from(e,n=e.reduce((r,s)=>r+s.length+1,-1)){let r=0;for(let p of e)r+=p.lines;if(r<32){let p=[];for(let m of e)m.flatten(p);return new _t(p,n)}let s=Math.max(32,r>>5),i=s<<1,l=s>>1,o=[],c=0,u=-1,h=[];function d(p){let m;if(p.lines>i&&p instanceof ls)for(let x of p.children)d(x);else p.lines>l&&(c>l||!c)?(f(),o.push(p)):p instanceof _t&&c&&(m=h[h.length-1])instanceof _t&&p.lines+m.lines<=32?(c+=p.lines,u+=p.length+1,h[h.length-1]=new _t(m.text.concat(p.text),m.length+1+p.length)):(c+p.lines>s&&f(),c+=p.lines,u+=p.length+1,h.push(p))}function f(){c!=0&&(o.push(h.length==1?h[0]:ls.from(h,u)),u=-1,c=h.length=0)}for(let p of e)d(p);return f(),o.length==1?o[0]:new ls(o,n)}}Ge.empty=new _t([""],0);function gR(t){let e=-1;for(let n of t)e+=n.length+1;return e}function yd(t,e,n=0,r=1e9){for(let s=0,i=0,l=!0;i<t.length&&s<=r;i++){let o=t[i],c=s+o.length;c>=n&&(c>r&&(o=o.slice(0,r-s)),s<n&&(o=o.slice(n-s)),l?(e[e.length-1]+=o,l=!1):e.push(o)),s=c+1}return e}function ov(t,e,n){return yd(t,[""],e,n)}class Yo{constructor(e,n=1){this.dir=n,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[n>0?1:(e instanceof _t?e.text.length:e.children.length)<<1]}nextInner(e,n){for(this.done=this.lineBreak=!1;;){let r=this.nodes.length-1,s=this.nodes[r],i=this.offsets[r],l=i>>1,o=s instanceof _t?s.text.length:s.children.length;if(l==(n>0?o:0)){if(r==0)return this.done=!0,this.value="",this;n>0&&this.offsets[r-1]++,this.nodes.pop(),this.offsets.pop()}else if((i&1)==(n>0?0:1)){if(this.offsets[r]+=n,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(s instanceof _t){let c=s.text[l+(n<0?-1:0)];if(this.offsets[r]+=n,c.length>Math.max(0,e))return this.value=e==0?c:n>0?c.slice(e):c.slice(0,c.length-e),this;e-=c.length}else{let c=s.children[l+(n<0?-1:0)];e>c.length?(e-=c.length,this.offsets[r]+=n):(n<0&&this.offsets[r]--,this.nodes.push(c),this.offsets.push(n>0?1:(c instanceof _t?c.text.length:c.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class mS{constructor(e,n,r){this.value="",this.done=!1,this.cursor=new Yo(e,n>r?-1:1),this.pos=n>r?e.length:0,this.from=Math.min(n,r),this.to=Math.max(n,r)}nextInner(e,n){if(n<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,n<0?this.pos-this.to:this.from-this.pos);let r=n<0?this.pos-this.from:this.to-this.pos;e>r&&(e=r),r-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*n,this.value=s.length<=r?s:n<0?s.slice(s.length-r):s.slice(0,r),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class gS{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:n,lineBreak:r,value:s}=this.inner.next(e);return n&&this.afterBreak?(this.value="",this.afterBreak=!1):n?(this.done=!0,this.value=""):r?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(Ge.prototype[Symbol.iterator]=function(){return this.iter()},Yo.prototype[Symbol.iterator]=mS.prototype[Symbol.iterator]=gS.prototype[Symbol.iterator]=function(){return this});class xR{constructor(e,n,r,s){this.from=e,this.to=n,this.number=r,this.text=s}get length(){return this.to-this.from}}function Ua(t,e,n){return e=Math.max(0,Math.min(t.length,e)),[e,Math.max(e,Math.min(t.length,n))]}function Pn(t,e,n=!0,r=!0){return pR(t,e,n,r)}function yR(t){return t>=56320&&t<57344}function bR(t){return t>=55296&&t<56320}function vR(t,e){let n=t.charCodeAt(e);if(!bR(n)||e+1==t.length)return n;let r=t.charCodeAt(e+1);return yR(r)?(n-55296<<10)+(r-56320)+65536:n}function wR(t){return t<65536?1:2}const lg=/\r\n?|\n/;var er=function(t){return t[t.Simple=0]="Simple",t[t.TrackDel=1]="TrackDel",t[t.TrackBefore=2]="TrackBefore",t[t.TrackAfter=3]="TrackAfter",t}(er||(er={}));class Rs{constructor(e){this.sections=e}get length(){let e=0;for(let n=0;n<this.sections.length;n+=2)e+=this.sections[n];return e}get newLength(){let e=0;for(let n=0;n<this.sections.length;n+=2){let r=this.sections[n+1];e+=r<0?this.sections[n]:r}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let n=0,r=0,s=0;n<this.sections.length;){let i=this.sections[n++],l=this.sections[n++];l<0?(e(r,s,i),s+=i):s+=l,r+=i}}iterChangedRanges(e,n=!1){ag(this,e,n)}get invertedDesc(){let e=[];for(let n=0;n<this.sections.length;){let r=this.sections[n++],s=this.sections[n++];s<0?e.push(r,s):e.push(s,r)}return new Rs(e)}composeDesc(e){return this.empty?e:e.empty?this:xS(this,e)}mapDesc(e,n=!1){return e.empty?this:og(this,e,n)}mapPos(e,n=-1,r=er.Simple){let s=0,i=0;for(let l=0;l<this.sections.length;){let o=this.sections[l++],c=this.sections[l++],u=s+o;if(c<0){if(u>e)return i+(e-s);i+=o}else{if(r!=er.Simple&&u>=e&&(r==er.TrackDel&&s<e&&u>e||r==er.TrackBefore&&s<e||r==er.TrackAfter&&u>e))return null;if(u>e||u==e&&n<0&&!o)return e==s||n<0?i:i+c;i+=c}s=u}if(e>s)throw new RangeError(`Position ${e} is out of range for changeset of length ${s}`);return i}touchesRange(e,n=e){for(let r=0,s=0;r<this.sections.length&&s<=n;){let i=this.sections[r++],l=this.sections[r++],o=s+i;if(l>=0&&s<=n&&o>=e)return s<e&&o>n?"cover":!0;s=o}return!1}toString(){let e="";for(let n=0;n<this.sections.length;){let r=this.sections[n++],s=this.sections[n++];e+=(e?" ":"")+r+(s>=0?":"+s:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(n=>typeof n!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Rs(e)}static create(e){return new Rs(e)}}class Xt extends Rs{constructor(e,n){super(e),this.inserted=n}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return ag(this,(n,r,s,i,l)=>e=e.replace(s,s+(r-n),l),!1),e}mapDesc(e,n=!1){return og(this,e,n,!0)}invert(e){let n=this.sections.slice(),r=[];for(let s=0,i=0;s<n.length;s+=2){let l=n[s],o=n[s+1];if(o>=0){n[s]=o,n[s+1]=l;let c=s>>1;for(;r.length<c;)r.push(Ge.empty);r.push(l?e.slice(i,i+l):Ge.empty)}i+=l}return new Xt(n,r)}compose(e){return this.empty?e:e.empty?this:xS(this,e,!0)}map(e,n=!1){return e.empty?this:og(this,e,n,!0)}iterChanges(e,n=!1){ag(this,e,n)}get desc(){return Rs.create(this.sections)}filter(e){let n=[],r=[],s=[],i=new Pc(this);e:for(let l=0,o=0;;){let c=l==e.length?1e9:e[l++];for(;o<c||o==c&&i.len==0;){if(i.done)break e;let h=Math.min(i.len,c-o);fn(s,h,-1);let d=i.ins==-1?-1:i.off==0?i.ins:0;fn(n,h,d),d>0&&xi(r,n,i.text),i.forward(h),o+=h}let u=e[l++];for(;o<u;){if(i.done)break e;let h=Math.min(i.len,u-o);fn(n,h,-1),fn(s,h,i.ins==-1?-1:i.off==0?i.ins:0),i.forward(h),o+=h}}return{changes:new Xt(n,r),filtered:Rs.create(s)}}toJSON(){let e=[];for(let n=0;n<this.sections.length;n+=2){let r=this.sections[n],s=this.sections[n+1];s<0?e.push(r):s==0?e.push([r]):e.push([r].concat(this.inserted[n>>1].toJSON()))}return e}static of(e,n,r){let s=[],i=[],l=0,o=null;function c(h=!1){if(!h&&!s.length)return;l<n&&fn(s,n-l,-1);let d=new Xt(s,i);o=o?o.compose(d.map(o)):d,s=[],i=[],l=0}function u(h){if(Array.isArray(h))for(let d of h)u(d);else if(h instanceof Xt){if(h.length!=n)throw new RangeError(`Mismatched change set length (got ${h.length}, expected ${n})`);c(),o=o?o.compose(h.map(o)):h}else{let{from:d,to:f=d,insert:p}=h;if(d>f||d<0||f>n)throw new RangeError(`Invalid change range ${d} to ${f} (in doc of length ${n})`);let m=p?typeof p=="string"?Ge.of(p.split(r||lg)):p:Ge.empty,x=m.length;if(d==f&&x==0)return;d<l&&c(),d>l&&fn(s,d-l,-1),fn(s,f-d,x),xi(i,s,m),l=f}}return u(e),c(!o),o}static empty(e){return new Xt(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let n=[],r=[];for(let s=0;s<e.length;s++){let i=e[s];if(typeof i=="number")n.push(i,-1);else{if(!Array.isArray(i)||typeof i[0]!="number"||i.some((l,o)=>o&&typeof l!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(i.length==1)n.push(i[0],0);else{for(;r.length<s;)r.push(Ge.empty);r[s]=Ge.of(i.slice(1)),n.push(i[0],r[s].length)}}}return new Xt(n,r)}static createSet(e,n){return new Xt(e,n)}}function fn(t,e,n,r=!1){if(e==0&&n<=0)return;let s=t.length-2;s>=0&&n<=0&&n==t[s+1]?t[s]+=e:s>=0&&e==0&&t[s]==0?t[s+1]+=n:r?(t[s]+=e,t[s+1]+=n):t.push(e,n)}function xi(t,e,n){if(n.length==0)return;let r=e.length-2>>1;if(r<t.length)t[t.length-1]=t[t.length-1].append(n);else{for(;t.length<r;)t.push(Ge.empty);t.push(n)}}function ag(t,e,n){let r=t.inserted;for(let s=0,i=0,l=0;l<t.sections.length;){let o=t.sections[l++],c=t.sections[l++];if(c<0)s+=o,i+=o;else{let u=s,h=i,d=Ge.empty;for(;u+=o,h+=c,c&&r&&(d=d.append(r[l-2>>1])),!(n||l==t.sections.length||t.sections[l+1]<0);)o=t.sections[l++],c=t.sections[l++];e(s,u,i,h,d),s=u,i=h}}}function og(t,e,n,r=!1){let s=[],i=r?[]:null,l=new Pc(t),o=new Pc(e);for(let c=-1;;){if(l.done&&o.len||o.done&&l.len)throw new Error("Mismatched change set lengths");if(l.ins==-1&&o.ins==-1){let u=Math.min(l.len,o.len);fn(s,u,-1),l.forward(u),o.forward(u)}else if(o.ins>=0&&(l.ins<0||c==l.i||l.off==0&&(o.len<l.len||o.len==l.len&&!n))){let u=o.len;for(fn(s,o.ins,-1);u;){let h=Math.min(l.len,u);l.ins>=0&&c<l.i&&l.len<=h&&(fn(s,0,l.ins),i&&xi(i,s,l.text),c=l.i),l.forward(h),u-=h}o.next()}else if(l.ins>=0){let u=0,h=l.len;for(;h;)if(o.ins==-1){let d=Math.min(h,o.len);u+=d,h-=d,o.forward(d)}else if(o.ins==0&&o.len<h)h-=o.len,o.next();else break;fn(s,u,c<l.i?l.ins:0),i&&c<l.i&&xi(i,s,l.text),c=l.i,l.forward(l.len-h)}else{if(l.done&&o.done)return i?Xt.createSet(s,i):Rs.create(s);throw new Error("Mismatched change set lengths")}}}function xS(t,e,n=!1){let r=[],s=n?[]:null,i=new Pc(t),l=new Pc(e);for(let o=!1;;){if(i.done&&l.done)return s?Xt.createSet(r,s):Rs.create(r);if(i.ins==0)fn(r,i.len,0,o),i.next();else if(l.len==0&&!l.done)fn(r,0,l.ins,o),s&&xi(s,r,l.text),l.next();else{if(i.done||l.done)throw new Error("Mismatched change set lengths");{let c=Math.min(i.len2,l.len),u=r.length;if(i.ins==-1){let h=l.ins==-1?-1:l.off?0:l.ins;fn(r,c,h,o),s&&h&&xi(s,r,l.text)}else l.ins==-1?(fn(r,i.off?0:i.len,c,o),s&&xi(s,r,i.textBit(c))):(fn(r,i.off?0:i.len,l.off?0:l.ins,o),s&&!l.off&&xi(s,r,l.text));o=(i.ins>c||l.ins>=0&&l.len>c)&&(o||r.length>u),i.forward2(c),l.forward(c)}}}}class Pc{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,n=this.i-2>>1;return n>=e.length?Ge.empty:e[n]}textBit(e){let{inserted:n}=this.set,r=this.i-2>>1;return r>=n.length&&!e?Ge.empty:n[r].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class tl{constructor(e,n,r){this.from=e,this.to=n,this.flags=r}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,n=-1){let r,s;return this.empty?r=s=e.mapPos(this.from,n):(r=e.mapPos(this.from,1),s=e.mapPos(this.to,-1)),r==this.from&&s==this.to?this:new tl(r,s,this.flags)}extend(e,n=e){if(e<=this.anchor&&n>=this.anchor)return pe.range(e,n);let r=Math.abs(e-this.anchor)>Math.abs(n-this.anchor)?e:n;return pe.range(this.anchor,r)}eq(e,n=!1){return this.anchor==e.anchor&&this.head==e.head&&(!n||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return pe.range(e.anchor,e.head)}static create(e,n,r){return new tl(e,n,r)}}class pe{constructor(e,n){this.ranges=e,this.mainIndex=n}map(e,n=-1){return e.empty?this:pe.create(this.ranges.map(r=>r.map(e,n)),this.mainIndex)}eq(e,n=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let r=0;r<this.ranges.length;r++)if(!this.ranges[r].eq(e.ranges[r],n))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new pe([this.main],0)}addRange(e,n=!0){return pe.create([e].concat(this.ranges),n?0:this.mainIndex+1)}replaceRange(e,n=this.mainIndex){let r=this.ranges.slice();return r[n]=e,pe.create(r,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new pe(e.ranges.map(n=>tl.fromJSON(n)),e.main)}static single(e,n=e){return new pe([pe.range(e,n)],0)}static create(e,n=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let r=0,s=0;s<e.length;s++){let i=e[s];if(i.empty?i.from<=r:i.from<r)return pe.normalized(e.slice(),n);r=i.to}return new pe(e,n)}static cursor(e,n=0,r,s){return tl.create(e,e,(n==0?0:n<0?8:16)|(r==null?7:Math.min(6,r))|(s??16777215)<<6)}static range(e,n,r,s){let i=(r??16777215)<<6|(s==null?7:Math.min(6,s));return n<e?tl.create(n,e,48|i):tl.create(e,n,(n>e?8:0)|i)}static normalized(e,n=0){let r=e[n];e.sort((s,i)=>s.from-i.from),n=e.indexOf(r);for(let s=1;s<e.length;s++){let i=e[s],l=e[s-1];if(i.empty?i.from<=l.to:i.from<l.to){let o=l.from,c=Math.max(i.to,l.to);s<=n&&n--,e.splice(--s,2,i.anchor>i.head?pe.range(c,o):pe.range(o,c))}}return new pe(e,n)}}function yS(t,e){for(let n of t.ranges)if(n.to>e)throw new RangeError("Selection points outside of document")}let x0=0;class _e{constructor(e,n,r,s,i){this.combine=e,this.compareInput=n,this.compare=r,this.isStatic=s,this.id=x0++,this.default=e([]),this.extensions=typeof i=="function"?i(this):i}get reader(){return this}static define(e={}){return new _e(e.combine||(n=>n),e.compareInput||((n,r)=>n===r),e.compare||(e.combine?(n,r)=>n===r:y0),!!e.static,e.enables)}of(e){return new bd([],this,0,e)}compute(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new bd(e,this,1,n)}computeN(e,n){if(this.isStatic)throw new Error("Can't compute a static facet");return new bd(e,this,2,n)}from(e,n){return n||(n=r=>r),this.compute([e],r=>n(r.field(e)))}}function y0(t,e){return t==e||t.length==e.length&&t.every((n,r)=>n===e[r])}class bd{constructor(e,n,r,s){this.dependencies=e,this.facet=n,this.type=r,this.value=s,this.id=x0++}dynamicSlot(e){var n;let r=this.value,s=this.facet.compareInput,i=this.id,l=e[i]>>1,o=this.type==2,c=!1,u=!1,h=[];for(let d of this.dependencies)d=="doc"?c=!0:d=="selection"?u=!0:((n=e[d.id])!==null&&n!==void 0?n:1)&1||h.push(e[d.id]);return{create(d){return d.values[l]=r(d),1},update(d,f){if(c&&f.docChanged||u&&(f.docChanged||f.selection)||cg(d,h)){let p=r(d);if(o?!cv(p,d.values[l],s):!s(p,d.values[l]))return d.values[l]=p,1}return 0},reconfigure:(d,f)=>{let p,m=f.config.address[i];if(m!=null){let x=dh(f,m);if(this.dependencies.every(v=>v instanceof _e?f.facet(v)===d.facet(v):v instanceof Tl?f.field(v,!1)==d.field(v,!1):!0)||(o?cv(p=r(d),x,s):s(p=r(d),x)))return d.values[l]=x,0}else p=r(d);return d.values[l]=p,1}}}}function cv(t,e,n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!n(t[r],e[r]))return!1;return!0}function cg(t,e){let n=!1;for(let r of e)Zo(t,r)&1&&(n=!0);return n}function kR(t,e,n){let r=n.map(c=>t[c.id]),s=n.map(c=>c.type),i=r.filter(c=>!(c&1)),l=t[e.id]>>1;function o(c){let u=[];for(let h=0;h<r.length;h++){let d=dh(c,r[h]);if(s[h]==2)for(let f of d)u.push(f);else u.push(d)}return e.combine(u)}return{create(c){for(let u of r)Zo(c,u);return c.values[l]=o(c),1},update(c,u){if(!cg(c,i))return 0;let h=o(c);return e.compare(h,c.values[l])?0:(c.values[l]=h,1)},reconfigure(c,u){let h=cg(c,r),d=u.config.facets[e.id],f=u.facet(e);if(d&&!h&&y0(n,d))return c.values[l]=f,0;let p=o(c);return e.compare(p,f)?(c.values[l]=f,0):(c.values[l]=p,1)}}}const Mu=_e.define({static:!0});class Tl{constructor(e,n,r,s,i){this.id=e,this.createF=n,this.updateF=r,this.compareF=s,this.spec=i,this.provides=void 0}static define(e){let n=new Tl(x0++,e.create,e.update,e.compare||((r,s)=>r===s),e);return e.provide&&(n.provides=e.provide(n)),n}create(e){let n=e.facet(Mu).find(r=>r.field==this);return((n==null?void 0:n.create)||this.createF)(e)}slot(e){let n=e[this.id]>>1;return{create:r=>(r.values[n]=this.create(r),1),update:(r,s)=>{let i=r.values[n],l=this.updateF(i,s);return this.compareF(i,l)?0:(r.values[n]=l,1)},reconfigure:(r,s)=>{let i=r.facet(Mu),l=s.facet(Mu),o;return(o=i.find(c=>c.field==this))&&o!=l.find(c=>c.field==this)?(r.values[n]=o.create(r),1):s.config.address[this.id]!=null?(r.values[n]=s.field(this),0):(r.values[n]=this.create(r),1)}}}init(e){return[this,Mu.of({field:this,create:e})]}get extension(){return this}}const Gi={lowest:4,low:3,default:2,high:1,highest:0};function wo(t){return e=>new bS(e,t)}const Xh={highest:wo(Gi.highest),high:wo(Gi.high),default:wo(Gi.default),low:wo(Gi.low),lowest:wo(Gi.lowest)};class bS{constructor(e,n){this.inner=e,this.prec=n}}class Jh{of(e){return new ug(this,e)}reconfigure(e){return Jh.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class ug{constructor(e,n){this.compartment=e,this.inner=n}}class uh{constructor(e,n,r,s,i,l){for(this.base=e,this.compartments=n,this.dynamicSlots=r,this.address=s,this.staticValues=i,this.facets=l,this.statusTemplate=[];this.statusTemplate.length<r.length;)this.statusTemplate.push(0)}staticFacet(e){let n=this.address[e.id];return n==null?e.default:this.staticValues[n>>1]}static resolve(e,n,r){let s=[],i=Object.create(null),l=new Map;for(let f of jR(e,n,l))f instanceof Tl?s.push(f):(i[f.facet.id]||(i[f.facet.id]=[])).push(f);let o=Object.create(null),c=[],u=[];for(let f of s)o[f.id]=u.length<<1,u.push(p=>f.slot(p));let h=r==null?void 0:r.config.facets;for(let f in i){let p=i[f],m=p[0].facet,x=h&&h[f]||[];if(p.every(v=>v.type==0))if(o[m.id]=c.length<<1|1,y0(x,p))c.push(r.facet(m));else{let v=m.combine(p.map(g=>g.value));c.push(r&&m.compare(v,r.facet(m))?r.facet(m):v)}else{for(let v of p)v.type==0?(o[v.id]=c.length<<1|1,c.push(v.value)):(o[v.id]=u.length<<1,u.push(g=>v.dynamicSlot(g)));o[m.id]=u.length<<1,u.push(v=>kR(v,m,p))}}let d=u.map(f=>f(o));return new uh(e,l,d,o,c,i)}}function jR(t,e,n){let r=[[],[],[],[],[]],s=new Map;function i(l,o){let c=s.get(l);if(c!=null){if(c<=o)return;let u=r[c].indexOf(l);u>-1&&r[c].splice(u,1),l instanceof ug&&n.delete(l.compartment)}if(s.set(l,o),Array.isArray(l))for(let u of l)i(u,o);else if(l instanceof ug){if(n.has(l.compartment))throw new RangeError("Duplicate use of compartment in extensions");let u=e.get(l.compartment)||l.inner;n.set(l.compartment,u),i(u,o)}else if(l instanceof bS)i(l.inner,l.prec);else if(l instanceof Tl)r[o].push(l),l.provides&&i(l.provides,o);else if(l instanceof bd)r[o].push(l),l.facet.extensions&&i(l.facet.extensions,Gi.default);else{let u=l.extension;if(!u)throw new Error(`Unrecognized extension value in extension set (${l}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);i(u,o)}}return i(t,Gi.default),r.reduce((l,o)=>l.concat(o))}function Zo(t,e){if(e&1)return 2;let n=e>>1,r=t.status[n];if(r==4)throw new Error("Cyclic dependency between fields and/or facets");if(r&2)return r;t.status[n]=4;let s=t.computeSlot(t,t.config.dynamicSlots[n]);return t.status[n]=2|s}function dh(t,e){return e&1?t.config.staticValues[e>>1]:t.values[e>>1]}const vS=_e.define(),dg=_e.define({combine:t=>t.some(e=>e),static:!0}),wS=_e.define({combine:t=>t.length?t[0]:void 0,static:!0}),kS=_e.define(),jS=_e.define(),SS=_e.define(),NS=_e.define({combine:t=>t.length?t[0]:!1});class ro{constructor(e,n){this.type=e,this.value=n}static define(){return new SR}}class SR{of(e){return new ro(this,e)}}class NR{constructor(e){this.map=e}of(e){return new Ht(this,e)}}class Ht{constructor(e,n){this.type=e,this.value=n}map(e){let n=this.type.map(this.value,e);return n===void 0?void 0:n==this.value?this:new Ht(this.type,n)}is(e){return this.type==e}static define(e={}){return new NR(e.map||(n=>n))}static mapEffects(e,n){if(!e.length)return e;let r=[];for(let s of e){let i=s.map(n);i&&r.push(i)}return r}}Ht.reconfigure=Ht.define();Ht.appendConfig=Ht.define();class yn{constructor(e,n,r,s,i,l){this.startState=e,this.changes=n,this.selection=r,this.effects=s,this.annotations=i,this.scrollIntoView=l,this._doc=null,this._state=null,r&&yS(r,n.newLength),i.some(o=>o.type==yn.time)||(this.annotations=i.concat(yn.time.of(Date.now())))}static create(e,n,r,s,i,l){return new yn(e,n,r,s,i,l)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let n of this.annotations)if(n.type==e)return n.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let n=this.annotation(yn.userEvent);return!!(n&&(n==e||n.length>e.length&&n.slice(0,e.length)==e&&n[e.length]=="."))}}yn.time=ro.define();yn.userEvent=ro.define();yn.addToHistory=ro.define();yn.remote=ro.define();function CR(t,e){let n=[];for(let r=0,s=0;;){let i,l;if(r<t.length&&(s==e.length||e[s]>=t[r]))i=t[r++],l=t[r++];else if(s<e.length)i=e[s++],l=e[s++];else return n;!n.length||n[n.length-1]<i?n.push(i,l):n[n.length-1]<l&&(n[n.length-1]=l)}}function CS(t,e,n){var r;let s,i,l;return n?(s=e.changes,i=Xt.empty(e.changes.length),l=t.changes.compose(e.changes)):(s=e.changes.map(t.changes),i=t.changes.mapDesc(e.changes,!0),l=t.changes.compose(s)),{changes:l,selection:e.selection?e.selection.map(i):(r=t.selection)===null||r===void 0?void 0:r.map(s),effects:Ht.mapEffects(t.effects,s).concat(Ht.mapEffects(e.effects,i)),annotations:t.annotations.length?t.annotations.concat(e.annotations):e.annotations,scrollIntoView:t.scrollIntoView||e.scrollIntoView}}function hg(t,e,n){let r=e.selection,s=ga(e.annotations);return e.userEvent&&(s=s.concat(yn.userEvent.of(e.userEvent))),{changes:e.changes instanceof Xt?e.changes:Xt.of(e.changes||[],n,t.facet(wS)),selection:r&&(r instanceof pe?r:pe.single(r.anchor,r.head)),effects:ga(e.effects),annotations:s,scrollIntoView:!!e.scrollIntoView}}function AS(t,e,n){let r=hg(t,e.length?e[0]:{},t.doc.length);e.length&&e[0].filter===!1&&(n=!1);for(let i=1;i<e.length;i++){e[i].filter===!1&&(n=!1);let l=!!e[i].sequential;r=CS(r,hg(t,e[i],l?r.changes.newLength:t.doc.length),l)}let s=yn.create(t,r.changes,r.selection,r.effects,r.annotations,r.scrollIntoView);return ER(n?AR(s):s)}function AR(t){let e=t.startState,n=!0;for(let s of e.facet(kS)){let i=s(t);if(i===!1){n=!1;break}Array.isArray(i)&&(n=n===!0?i:CR(n,i))}if(n!==!0){let s,i;if(n===!1)i=t.changes.invertedDesc,s=Xt.empty(e.doc.length);else{let l=t.changes.filter(n);s=l.changes,i=l.filtered.mapDesc(l.changes).invertedDesc}t=yn.create(e,s,t.selection&&t.selection.map(i),Ht.mapEffects(t.effects,i),t.annotations,t.scrollIntoView)}let r=e.facet(jS);for(let s=r.length-1;s>=0;s--){let i=r[s](t);i instanceof yn?t=i:Array.isArray(i)&&i.length==1&&i[0]instanceof yn?t=i[0]:t=AS(e,ga(i),!1)}return t}function ER(t){let e=t.startState,n=e.facet(SS),r=t;for(let s=n.length-1;s>=0;s--){let i=n[s](t);i&&Object.keys(i).length&&(r=CS(r,hg(e,i,t.changes.newLength),!0))}return r==t?t:yn.create(e,t.changes,t.selection,r.effects,r.annotations,r.scrollIntoView)}const PR=[];function ga(t){return t==null?PR:Array.isArray(t)?t:[t]}var _s=function(t){return t[t.Word=0]="Word",t[t.Space=1]="Space",t[t.Other=2]="Other",t}(_s||(_s={}));const _R=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let fg;try{fg=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function MR(t){if(fg)return fg.test(t);for(let e=0;e<t.length;e++){let n=t[e];if(/\w/.test(n)||n>""&&(n.toUpperCase()!=n.toLowerCase()||_R.test(n)))return!0}return!1}function TR(t){return e=>{if(!/\S/.test(e))return _s.Space;if(MR(e))return _s.Word;for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>-1)return _s.Word;return _s.Other}}class Ze{constructor(e,n,r,s,i,l){this.config=e,this.doc=n,this.selection=r,this.values=s,this.status=e.statusTemplate.slice(),this.computeSlot=i,l&&(l._state=this);for(let o=0;o<this.config.dynamicSlots.length;o++)Zo(this,o<<1);this.computeSlot=null}field(e,n=!0){let r=this.config.address[e.id];if(r==null){if(n)throw new RangeError("Field is not present in this state");return}return Zo(this,r),dh(this,r)}update(...e){return AS(this,e,!0)}applyTransaction(e){let n=this.config,{base:r,compartments:s}=n;for(let o of e.effects)o.is(Jh.reconfigure)?(n&&(s=new Map,n.compartments.forEach((c,u)=>s.set(u,c)),n=null),s.set(o.value.compartment,o.value.extension)):o.is(Ht.reconfigure)?(n=null,r=o.value):o.is(Ht.appendConfig)&&(n=null,r=ga(r).concat(o.value));let i;n?i=e.startState.values.slice():(n=uh.resolve(r,s,this),i=new Ze(n,this.doc,this.selection,n.dynamicSlots.map(()=>null),(c,u)=>u.reconfigure(c,this),null).values);let l=e.startState.facet(dg)?e.newSelection:e.newSelection.asSingle();new Ze(n,e.newDoc,l,i,(o,c)=>c.update(o,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(n=>({changes:{from:n.from,to:n.to,insert:e},range:pe.cursor(n.from+e.length)}))}changeByRange(e){let n=this.selection,r=e(n.ranges[0]),s=this.changes(r.changes),i=[r.range],l=ga(r.effects);for(let o=1;o<n.ranges.length;o++){let c=e(n.ranges[o]),u=this.changes(c.changes),h=u.map(s);for(let f=0;f<o;f++)i[f]=i[f].map(h);let d=s.mapDesc(u,!0);i.push(c.range.map(d)),s=s.compose(h),l=Ht.mapEffects(l,h).concat(Ht.mapEffects(ga(c.effects),d))}return{changes:s,selection:pe.create(i,n.mainIndex),effects:l}}changes(e=[]){return e instanceof Xt?e:Xt.of(e,this.doc.length,this.facet(Ze.lineSeparator))}toText(e){return Ge.of(e.split(this.facet(Ze.lineSeparator)||lg))}sliceDoc(e=0,n=this.doc.length){return this.doc.sliceString(e,n,this.lineBreak)}facet(e){let n=this.config.address[e.id];return n==null?e.default:(Zo(this,n),dh(this,n))}toJSON(e){let n={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let r in e){let s=e[r];s instanceof Tl&&this.config.address[s.id]!=null&&(n[r]=s.spec.toJSON(this.field(e[r]),this))}return n}static fromJSON(e,n={},r){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(r){for(let i in r)if(Object.prototype.hasOwnProperty.call(e,i)){let l=r[i],o=e[i];s.push(l.init(c=>l.spec.fromJSON(o,c)))}}return Ze.create({doc:e.doc,selection:pe.fromJSON(e.selection),extensions:n.extensions?s.concat([n.extensions]):s})}static create(e={}){let n=uh.resolve(e.extensions||[],new Map),r=e.doc instanceof Ge?e.doc:Ge.of((e.doc||"").split(n.staticFacet(Ze.lineSeparator)||lg)),s=e.selection?e.selection instanceof pe?e.selection:pe.single(e.selection.anchor,e.selection.head):pe.single(0);return yS(s,r.length),n.staticFacet(dg)||(s=s.asSingle()),new Ze(n,r,s,n.dynamicSlots.map(()=>null),(i,l)=>l.create(i),null)}get tabSize(){return this.facet(Ze.tabSize)}get lineBreak(){return this.facet(Ze.lineSeparator)||`
`}get readOnly(){return this.facet(NS)}phrase(e,...n){for(let r of this.facet(Ze.phrases))if(Object.prototype.hasOwnProperty.call(r,e)){e=r[e];break}return n.length&&(e=e.replace(/\$(\$|\d*)/g,(r,s)=>{if(s=="$")return"$";let i=+(s||1);return!i||i>n.length?r:n[i-1]})),e}languageDataAt(e,n,r=-1){let s=[];for(let i of this.facet(vS))for(let l of i(this,n,r))Object.prototype.hasOwnProperty.call(l,e)&&s.push(l[e]);return s}charCategorizer(e){return TR(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:n,from:r,length:s}=this.doc.lineAt(e),i=this.charCategorizer(e),l=e-r,o=e-r;for(;l>0;){let c=Pn(n,l,!1);if(i(n.slice(c,l))!=_s.Word)break;l=c}for(;o<s;){let c=Pn(n,o);if(i(n.slice(o,c))!=_s.Word)break;o=c}return l==o?null:pe.range(l+r,o+r)}}Ze.allowMultipleSelections=dg;Ze.tabSize=_e.define({combine:t=>t.length?t[0]:4});Ze.lineSeparator=wS;Ze.readOnly=NS;Ze.phrases=_e.define({compare(t,e){let n=Object.keys(t),r=Object.keys(e);return n.length==r.length&&n.every(s=>t[s]==e[s])}});Ze.languageData=vS;Ze.changeFilter=kS;Ze.transactionFilter=jS;Ze.transactionExtender=SS;Jh.reconfigure=Ht.define();function ES(t,e,n={}){let r={};for(let s of t)for(let i of Object.keys(s)){let l=s[i],o=r[i];if(o===void 0)r[i]=l;else if(!(o===l||l===void 0))if(Object.hasOwnProperty.call(n,i))r[i]=n[i](o,l);else throw new Error("Config merge conflict for field "+i)}for(let s in e)r[s]===void 0&&(r[s]=e[s]);return r}class Ha{eq(e){return this==e}range(e,n=e){return pg.create(e,n,this)}}Ha.prototype.startSide=Ha.prototype.endSide=0;Ha.prototype.point=!1;Ha.prototype.mapMode=er.TrackDel;let pg=class PS{constructor(e,n,r){this.from=e,this.to=n,this.value=r}static create(e,n,r){return new PS(e,n,r)}};function mg(t,e){return t.from-e.from||t.value.startSide-e.value.startSide}class b0{constructor(e,n,r,s){this.from=e,this.to=n,this.value=r,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(e,n,r,s=0){let i=r?this.to:this.from;for(let l=s,o=i.length;;){if(l==o)return l;let c=l+o>>1,u=i[c]-e||(r?this.value[c].endSide:this.value[c].startSide)-n;if(c==l)return u>=0?l:o;u>=0?o=c:l=c+1}}between(e,n,r,s){for(let i=this.findIndex(n,-1e9,!0),l=this.findIndex(r,1e9,!1,i);i<l;i++)if(s(this.from[i]+e,this.to[i]+e,this.value[i])===!1)return!1}map(e,n){let r=[],s=[],i=[],l=-1,o=-1;for(let c=0;c<this.value.length;c++){let u=this.value[c],h=this.from[c]+e,d=this.to[c]+e,f,p;if(h==d){let m=n.mapPos(h,u.startSide,u.mapMode);if(m==null||(f=p=m,u.startSide!=u.endSide&&(p=n.mapPos(h,u.endSide),p<f)))continue}else if(f=n.mapPos(h,u.startSide),p=n.mapPos(d,u.endSide),f>p||f==p&&u.startSide>0&&u.endSide<=0)continue;(p-f||u.endSide-u.startSide)<0||(l<0&&(l=f),u.point&&(o=Math.max(o,p-f)),r.push(u),s.push(f-l),i.push(p-l))}return{mapped:r.length?new b0(s,i,r,o):null,pos:l}}}class nt{constructor(e,n,r,s){this.chunkPos=e,this.chunk=n,this.nextLayer=r,this.maxPoint=s}static create(e,n,r,s){return new nt(e,n,r,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let n of this.chunk)e+=n.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:n=[],sort:r=!1,filterFrom:s=0,filterTo:i=this.length}=e,l=e.filter;if(n.length==0&&!l)return this;if(r&&(n=n.slice().sort(mg)),this.isEmpty)return n.length?nt.of(n):this;let o=new _S(this,null,-1).goto(0),c=0,u=[],h=new _c;for(;o.value||c<n.length;)if(c<n.length&&(o.from-n[c].from||o.startSide-n[c].value.startSide)>=0){let d=n[c++];h.addInner(d.from,d.to,d.value)||u.push(d)}else o.rangeIndex==1&&o.chunkIndex<this.chunk.length&&(c==n.length||this.chunkEnd(o.chunkIndex)<n[c].from)&&(!l||s>this.chunkEnd(o.chunkIndex)||i<this.chunkPos[o.chunkIndex])&&h.addChunk(this.chunkPos[o.chunkIndex],this.chunk[o.chunkIndex])?o.nextChunk():((!l||s>o.to||i<o.from||l(o.from,o.to,o.value))&&(h.addInner(o.from,o.to,o.value)||u.push(pg.create(o.from,o.to,o.value))),o.next());return h.finishInner(this.nextLayer.isEmpty&&!u.length?nt.empty:this.nextLayer.update({add:u,filter:l,filterFrom:s,filterTo:i}))}map(e){if(e.empty||this.isEmpty)return this;let n=[],r=[],s=-1;for(let l=0;l<this.chunk.length;l++){let o=this.chunkPos[l],c=this.chunk[l],u=e.touchesRange(o,o+c.length);if(u===!1)s=Math.max(s,c.maxPoint),n.push(c),r.push(e.mapPos(o));else if(u===!0){let{mapped:h,pos:d}=c.map(o,e);h&&(s=Math.max(s,h.maxPoint),n.push(h),r.push(d))}}let i=this.nextLayer.map(e);return n.length==0?i:new nt(r,n,i||nt.empty,s)}between(e,n,r){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let i=this.chunkPos[s],l=this.chunk[s];if(n>=i&&e<=i+l.length&&l.between(i,e-i,n-i,r)===!1)return}this.nextLayer.between(e,n,r)}}iter(e=0){return Mc.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,n=0){return Mc.from(e).goto(n)}static compare(e,n,r,s,i=-1){let l=e.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=i),o=n.filter(d=>d.maxPoint>0||!d.isEmpty&&d.maxPoint>=i),c=uv(l,o,r),u=new ko(l,c,i),h=new ko(o,c,i);r.iterGaps((d,f,p)=>dv(u,d,h,f,p,s)),r.empty&&r.length==0&&dv(u,0,h,0,0,s)}static eq(e,n,r=0,s){s==null&&(s=999999999);let i=e.filter(h=>!h.isEmpty&&n.indexOf(h)<0),l=n.filter(h=>!h.isEmpty&&e.indexOf(h)<0);if(i.length!=l.length)return!1;if(!i.length)return!0;let o=uv(i,l),c=new ko(i,o,0).goto(r),u=new ko(l,o,0).goto(r);for(;;){if(c.to!=u.to||!gg(c.active,u.active)||c.point&&(!u.point||!c.point.eq(u.point)))return!1;if(c.to>s)return!0;c.next(),u.next()}}static spans(e,n,r,s,i=-1){let l=new ko(e,null,i).goto(n),o=n,c=l.openStart;for(;;){let u=Math.min(l.to,r);if(l.point){let h=l.activeForPoint(l.to),d=l.pointFrom<n?h.length+1:l.point.startSide<0?h.length:Math.min(h.length,c);s.point(o,u,l.point,h,d,l.pointRank),c=Math.min(l.openEnd(u),h.length)}else u>o&&(s.span(o,u,l.active,c),c=l.openEnd(u));if(l.to>r)return c+(l.point&&l.to>r?1:0);o=l.to,l.next()}}static of(e,n=!1){let r=new _c;for(let s of e instanceof pg?[e]:n?RR(e):e)r.add(s.from,s.to,s.value);return r.finish()}static join(e){if(!e.length)return nt.empty;let n=e[e.length-1];for(let r=e.length-2;r>=0;r--)for(let s=e[r];s!=nt.empty;s=s.nextLayer)n=new nt(s.chunkPos,s.chunk,n,Math.max(s.maxPoint,n.maxPoint));return n}}nt.empty=new nt([],[],null,-1);function RR(t){if(t.length>1)for(let e=t[0],n=1;n<t.length;n++){let r=t[n];if(mg(e,r)>0)return t.slice().sort(mg);e=r}return t}nt.empty.nextLayer=nt.empty;class _c{finishChunk(e){this.chunks.push(new b0(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,n,r){this.addInner(e,n,r)||(this.nextLayer||(this.nextLayer=new _c)).add(e,n,r)}addInner(e,n,r){let s=e-this.lastTo||r.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||r.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(n-this.chunkStart),this.last=r,this.lastFrom=e,this.lastTo=n,this.value.push(r),r.point&&(this.maxPoint=Math.max(this.maxPoint,n-e)),!0)}addChunk(e,n){if((e-this.lastTo||n.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,n.maxPoint),this.chunks.push(n),this.chunkPos.push(e);let r=n.value.length-1;return this.last=n.value[r],this.lastFrom=n.from[r]+e,this.lastTo=n.to[r]+e,!0}finish(){return this.finishInner(nt.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let n=nt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,n}}function uv(t,e,n){let r=new Map;for(let i of t)for(let l=0;l<i.chunk.length;l++)i.chunk[l].maxPoint<=0&&r.set(i.chunk[l],i.chunkPos[l]);let s=new Set;for(let i of e)for(let l=0;l<i.chunk.length;l++){let o=r.get(i.chunk[l]);o!=null&&(n?n.mapPos(o):o)==i.chunkPos[l]&&!(n!=null&&n.touchesRange(o,o+i.chunk[l].length))&&s.add(i.chunk[l])}return s}class _S{constructor(e,n,r,s=0){this.layer=e,this.skip=n,this.minPoint=r,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,n=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,n,!1),this}gotoInner(e,n,r){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,r=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],n,!0);(!r||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(e,n){(this.to-e||this.endSide-n)<0&&this.gotoInner(e,n,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],n=this.layer.chunk[this.chunkIndex],r=e+n.from[this.rangeIndex];if(this.from=r,this.to=e+n.to[this.rangeIndex],this.value=n.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class Mc{constructor(e){this.heap=e}static from(e,n=null,r=-1){let s=[];for(let i=0;i<e.length;i++)for(let l=e[i];!l.isEmpty;l=l.nextLayer)l.maxPoint>=r&&s.push(new _S(l,n,r,i));return s.length==1?s[0]:new Mc(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,n=-1e9){for(let r of this.heap)r.goto(e,n);for(let r=this.heap.length>>1;r>=0;r--)sp(this.heap,r);return this.next(),this}forward(e,n){for(let r of this.heap)r.forward(e,n);for(let r=this.heap.length>>1;r>=0;r--)sp(this.heap,r);(this.to-e||this.value.endSide-n)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),sp(this.heap,0)}}}function sp(t,e){for(let n=t[e];;){let r=(e<<1)+1;if(r>=t.length)break;let s=t[r];if(r+1<t.length&&s.compare(t[r+1])>=0&&(s=t[r+1],r++),n.compare(s)<0)break;t[r]=n,t[e]=s,e=r}}class ko{constructor(e,n,r){this.minPoint=r,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Mc.from(e,n,r)}goto(e,n=-1e9){return this.cursor.goto(e,n),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=n,this.openStart=-1,this.next(),this}forward(e,n){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-n)<0;)this.removeActive(this.minActive);this.cursor.forward(e,n)}removeActive(e){Tu(this.active,e),Tu(this.activeTo,e),Tu(this.activeRank,e),this.minActive=hv(this.active,this.activeTo)}addActive(e){let n=0,{value:r,to:s,rank:i}=this.cursor;for(;n<this.activeRank.length&&(i-this.activeRank[n]||s-this.activeTo[n])>0;)n++;Ru(this.active,n,r),Ru(this.activeTo,n,s),Ru(this.activeRank,n,i),e&&Ru(e,n,this.cursor.from),this.minActive=hv(this.active,this.activeTo)}next(){let e=this.to,n=this.point;this.point=null;let r=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),r&&Tu(r,s)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let i=this.cursor.value;if(!i.point)this.addActive(r),this.cursor.next();else if(n&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=i,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=i.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(r){this.openStart=0;for(let s=r.length-1;s>=0&&r[s]<e;s--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let n=[];for(let r=this.active.length-1;r>=0&&!(this.activeRank[r]<this.pointRank);r--)(this.activeTo[r]>e||this.activeTo[r]==e&&this.active[r].endSide>=this.point.endSide)&&n.push(this.active[r]);return n.reverse()}openEnd(e){let n=0;for(let r=this.activeTo.length-1;r>=0&&this.activeTo[r]>e;r--)n++;return n}}function dv(t,e,n,r,s,i){t.goto(e),n.goto(r);let l=r+s,o=r,c=r-e;for(;;){let u=t.to+c-n.to,h=u||t.endSide-n.endSide,d=h<0?t.to+c:n.to,f=Math.min(d,l);if(t.point||n.point?t.point&&n.point&&(t.point==n.point||t.point.eq(n.point))&&gg(t.activeForPoint(t.to),n.activeForPoint(n.to))||i.comparePoint(o,f,t.point,n.point):f>o&&!gg(t.active,n.active)&&i.compareRange(o,f,t.active,n.active),d>l)break;(u||t.openEnd!=n.openEnd)&&i.boundChange&&i.boundChange(d),o=d,h<=0&&t.next(),h>=0&&n.next()}}function gg(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!=e[n]&&!t[n].eq(e[n]))return!1;return!0}function Tu(t,e){for(let n=e,r=t.length-1;n<r;n++)t[n]=t[n+1];t.pop()}function Ru(t,e,n){for(let r=t.length-1;r>=e;r--)t[r+1]=t[r];t[e]=n}function hv(t,e){let n=-1,r=1e9;for(let s=0;s<e.length;s++)(e[s]-r||t[s].endSide-t[n].endSide)<0&&(n=s,r=e[s]);return n}function Yh(t,e,n=t.length){let r=0;for(let s=0;s<n&&s<t.length;)t.charCodeAt(s)==9?(r+=e-r%e,s++):(r++,s=Pn(t,s));return r}function DR(t,e,n,r){for(let s=0,i=0;;){if(i>=e)return s;if(s==t.length)break;i+=t.charCodeAt(s)==9?n-i%n:1,s=Pn(t,s)}return t.length}const xg="",fv=typeof Symbol>"u"?"__"+xg:Symbol.for(xg),yg=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),pv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Ri{constructor(e,n){this.rules=[];let{finish:r}=n||{};function s(l){return/^@/.test(l)?[l]:l.split(/,\s*/)}function i(l,o,c,u){let h=[],d=/^@(\w+)\b/.exec(l[0]),f=d&&d[1]=="keyframes";if(d&&o==null)return c.push(l[0]+";");for(let p in o){let m=o[p];if(/&/.test(p))i(p.split(/,\s*/).map(x=>l.map(v=>x.replace(/&/,v))).reduce((x,v)=>x.concat(v)),m,c);else if(m&&typeof m=="object"){if(!d)throw new RangeError("The value of a property ("+p+") should be a primitive value.");i(s(p),m,h,f)}else m!=null&&h.push(p.replace(/_.*/,"").replace(/[A-Z]/g,x=>"-"+x.toLowerCase())+": "+m+";")}(h.length||f)&&c.push((r&&!d&&!u?l.map(r):l).join(", ")+" {"+h.join(" ")+"}")}for(let l in e)i(s(l),e[l],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=pv[fv]||1;return pv[fv]=e+1,xg+e.toString(36)}static mount(e,n,r){let s=e[yg],i=r&&r.nonce;s?i&&s.setNonce(i):s=new LR(e,i),s.mount(Array.isArray(n)?n:[n],e)}}let mv=new Map;class LR{constructor(e,n){let r=e.ownerDocument||e,s=r.defaultView;if(!e.head&&e.adoptedStyleSheets&&s.CSSStyleSheet){let i=mv.get(r);if(i)return e[yg]=i;this.sheet=new s.CSSStyleSheet,mv.set(r,this)}else this.styleTag=r.createElement("style"),n&&this.styleTag.setAttribute("nonce",n);this.modules=[],e[yg]=this}mount(e,n){let r=this.sheet,s=0,i=0;for(let l=0;l<e.length;l++){let o=e[l],c=this.modules.indexOf(o);if(c<i&&c>-1&&(this.modules.splice(c,1),i--,c=-1),c==-1){if(this.modules.splice(i++,0,o),r)for(let u=0;u<o.rules.length;u++)r.insertRule(o.rules[u],s++)}else{for(;i<c;)s+=this.modules[i++].rules.length;s+=o.rules.length,i++}}if(r)n.adoptedStyleSheets.indexOf(this.sheet)<0&&(n.adoptedStyleSheets=[this.sheet,...n.adoptedStyleSheets]);else{let l="";for(let c=0;c<this.modules.length;c++)l+=this.modules[c].getRules()+`
`;this.styleTag.textContent=l;let o=n.head||n;this.styleTag.parentNode!=o&&o.insertBefore(this.styleTag,o.firstChild)}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Di={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Tc={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},OR=typeof navigator<"u"&&/Mac/.test(navigator.platform),IR=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var nn=0;nn<10;nn++)Di[48+nn]=Di[96+nn]=String(nn);for(var nn=1;nn<=24;nn++)Di[nn+111]="F"+nn;for(var nn=65;nn<=90;nn++)Di[nn]=String.fromCharCode(nn+32),Tc[nn]=String.fromCharCode(nn);for(var ip in Di)Tc.hasOwnProperty(ip)||(Tc[ip]=Di[ip]);function FR(t){var e=OR&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||IR&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Tc:Di)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}function Rc(t){let e;return t.nodeType==11?e=t.getSelection?t:t.ownerDocument:e=t,e.getSelection()}function bg(t,e){return e?t==e||t.contains(e.nodeType!=1?e.parentNode:e):!1}function vd(t,e){if(!e.anchorNode)return!1;try{return bg(t,e.anchorNode)}catch{return!1}}function Dc(t){return t.nodeType==3?Sl(t,0,t.nodeValue.length).getClientRects():t.nodeType==1?t.getClientRects():[]}function ec(t,e,n,r){return n?gv(t,e,n,r,-1)||gv(t,e,n,r,1):!1}function jl(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e}function hh(t){return t.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(t.nodeName)}function gv(t,e,n,r,s){for(;;){if(t==n&&e==r)return!0;if(e==(s<0?0:fs(t))){if(t.nodeName=="DIV")return!1;let i=t.parentNode;if(!i||i.nodeType!=1)return!1;e=jl(t)+(s<0?0:1),t=i}else if(t.nodeType==1){if(t=t.childNodes[e+(s<0?-1:0)],t.nodeType==1&&t.contentEditable=="false")return!1;e=s<0?fs(t):0}else return!1}}function fs(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Zh(t,e){let n=e?t.left:t.right;return{left:n,right:n,top:t.top,bottom:t.bottom}}function BR(t){let e=t.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.innerWidth,top:0,bottom:t.innerHeight}}function MS(t,e){let n=e.width/t.offsetWidth,r=e.height/t.offsetHeight;return(n>.995&&n<1.005||!isFinite(n)||Math.abs(e.width-t.offsetWidth)<1)&&(n=1),(r>.995&&r<1.005||!isFinite(r)||Math.abs(e.height-t.offsetHeight)<1)&&(r=1),{scaleX:n,scaleY:r}}function zR(t,e,n,r,s,i,l,o){let c=t.ownerDocument,u=c.defaultView||window;for(let h=t,d=!1;h&&!d;)if(h.nodeType==1){let f,p=h==c.body,m=1,x=1;if(p)f=BR(u);else{if(/^(fixed|sticky)$/.test(getComputedStyle(h).position)&&(d=!0),h.scrollHeight<=h.clientHeight&&h.scrollWidth<=h.clientWidth){h=h.assignedSlot||h.parentNode;continue}let y=h.getBoundingClientRect();({scaleX:m,scaleY:x}=MS(h,y)),f={left:y.left,right:y.left+h.clientWidth*m,top:y.top,bottom:y.top+h.clientHeight*x}}let v=0,g=0;if(s=="nearest")e.top<f.top?(g=e.top-(f.top+l),n>0&&e.bottom>f.bottom+g&&(g=e.bottom-f.bottom+l)):e.bottom>f.bottom&&(g=e.bottom-f.bottom+l,n<0&&e.top-g<f.top&&(g=e.top-(f.top+l)));else{let y=e.bottom-e.top,b=f.bottom-f.top;g=(s=="center"&&y<=b?e.top+y/2-b/2:s=="start"||s=="center"&&n<0?e.top-l:e.bottom-b+l)-f.top}if(r=="nearest"?e.left<f.left?(v=e.left-(f.left+i),n>0&&e.right>f.right+v&&(v=e.right-f.right+i)):e.right>f.right&&(v=e.right-f.right+i,n<0&&e.left<f.left+v&&(v=e.left-(f.left+i))):v=(r=="center"?e.left+(e.right-e.left)/2-(f.right-f.left)/2:r=="start"==o?e.left-i:e.right-(f.right-f.left)+i)-f.left,v||g)if(p)u.scrollBy(v,g);else{let y=0,b=0;if(g){let k=h.scrollTop;h.scrollTop+=g/x,b=(h.scrollTop-k)*x}if(v){let k=h.scrollLeft;h.scrollLeft+=v/m,y=(h.scrollLeft-k)*m}e={left:e.left-y,top:e.top-b,right:e.right-y,bottom:e.bottom-b},y&&Math.abs(y-v)<1&&(r="nearest"),b&&Math.abs(b-g)<1&&(s="nearest")}if(p)break;(e.top<f.top||e.bottom>f.bottom||e.left<f.left||e.right>f.right)&&(e={left:Math.max(e.left,f.left),right:Math.min(e.right,f.right),top:Math.max(e.top,f.top),bottom:Math.min(e.bottom,f.bottom)}),h=h.assignedSlot||h.parentNode}else if(h.nodeType==11)h=h.host;else break}function $R(t){let e=t.ownerDocument,n,r;for(let s=t.parentNode;s&&!(s==e.body||n&&r);)if(s.nodeType==1)!r&&s.scrollHeight>s.clientHeight&&(r=s),!n&&s.scrollWidth>s.clientWidth&&(n=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:n,y:r}}class UR{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:n,focusNode:r}=e;this.set(n,Math.min(e.anchorOffset,n?fs(n):0),r,Math.min(e.focusOffset,r?fs(r):0))}set(e,n,r,s){this.anchorNode=e,this.anchorOffset=n,this.focusNode=r,this.focusOffset=s}}let zl=null;function TS(t){if(t.setActive)return t.setActive();if(zl)return t.focus(zl);let e=[];for(let n=t;n&&(e.push(n,n.scrollTop,n.scrollLeft),n!=n.ownerDocument);n=n.parentNode);if(t.focus(zl==null?{get preventScroll(){return zl={preventScroll:!0},!0}}:void 0),!zl){zl=!1;for(let n=0;n<e.length;){let r=e[n++],s=e[n++],i=e[n++];r.scrollTop!=s&&(r.scrollTop=s),r.scrollLeft!=i&&(r.scrollLeft=i)}}}let xv;function Sl(t,e,n=e){let r=xv||(xv=document.createRange());return r.setEnd(t,n),r.setStart(t,e),r}function xa(t,e,n,r){let s={key:e,code:e,keyCode:n,which:n,cancelable:!0};r&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=r);let i=new KeyboardEvent("keydown",s);i.synthetic=!0,t.dispatchEvent(i);let l=new KeyboardEvent("keyup",s);return l.synthetic=!0,t.dispatchEvent(l),i.defaultPrevented||l.defaultPrevented}function HR(t){for(;t;){if(t&&(t.nodeType==9||t.nodeType==11&&t.host))return t;t=t.assignedSlot||t.parentNode}return null}function RS(t){for(;t.attributes.length;)t.removeAttributeNode(t.attributes[0])}function qR(t,e){let n=e.focusNode,r=e.focusOffset;if(!n||e.anchorNode!=n||e.anchorOffset!=r)return!1;for(r=Math.min(r,fs(n));;)if(r){if(n.nodeType!=1)return!1;let s=n.childNodes[r-1];s.contentEditable=="false"?r--:(n=s,r=fs(n))}else{if(n==t)return!0;r=jl(n),n=n.parentNode}}function DS(t){return t.scrollTop>Math.max(1,t.scrollHeight-t.clientHeight-4)}function LS(t,e){for(let n=t,r=e;;){if(n.nodeType==3&&r>0)return{node:n,offset:r};if(n.nodeType==1&&r>0){if(n.contentEditable=="false")return null;n=n.childNodes[r-1],r=fs(n)}else if(n.parentNode&&!hh(n))r=jl(n),n=n.parentNode;else return null}}function OS(t,e){for(let n=t,r=e;;){if(n.nodeType==3&&r<n.nodeValue.length)return{node:n,offset:r};if(n.nodeType==1&&r<n.childNodes.length){if(n.contentEditable=="false")return null;n=n.childNodes[r],r=0}else if(n.parentNode&&!hh(n))r=jl(n)+1,n=n.parentNode;else return null}}class gn{constructor(e,n,r=!0){this.node=e,this.offset=n,this.precise=r}static before(e,n){return new gn(e.parentNode,jl(e),n)}static after(e,n){return new gn(e.parentNode,jl(e)+1,n)}}const v0=[];class ct{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let n=this.posAtStart;for(let r of this.children){if(r==e)return n;n+=r.length+r.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,n){if(this.flags&2){let r=this.dom,s=null,i;for(let l of this.children){if(l.flags&7){if(!l.dom&&(i=s?s.nextSibling:r.firstChild)){let o=ct.get(i);(!o||!o.parent&&o.canReuseDOM(l))&&l.reuseDOM(i)}l.sync(e,n),l.flags&=-8}if(i=s?s.nextSibling:r.firstChild,n&&!n.written&&n.node==r&&i!=l.dom&&(n.written=!0),l.dom.parentNode==r)for(;i&&i!=l.dom;)i=yv(i);else r.insertBefore(l.dom,i);s=l.dom}for(i=s?s.nextSibling:r.firstChild,i&&n&&n.node==r&&(n.written=!0);i;)i=yv(i)}else if(this.flags&1)for(let r of this.children)r.flags&7&&(r.sync(e,n),r.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,n){let r;if(e==this.dom)r=this.dom.childNodes[n];else{let s=fs(e)==0?0:n==0?-1:1;for(;;){let i=e.parentNode;if(i==this.dom)break;s==0&&i.firstChild!=i.lastChild&&(e==i.firstChild?s=-1:s=1),e=i}s<0?r=e:r=e.nextSibling}if(r==this.dom.firstChild)return 0;for(;r&&!ct.get(r);)r=r.nextSibling;if(!r)return this.length;for(let s=0,i=0;;s++){let l=this.children[s];if(l.dom==r)return i;i+=l.length+l.breakAfter}}domBoundsAround(e,n,r=0){let s=-1,i=-1,l=-1,o=-1;for(let c=0,u=r,h=r;c<this.children.length;c++){let d=this.children[c],f=u+d.length;if(u<e&&f>n)return d.domBoundsAround(e,n,u);if(f>=e&&s==-1&&(s=c,i=u),u>n&&d.dom.parentNode==this.dom){l=c,o=h;break}h=f,u=f+d.breakAfter}return{from:i,to:o<0?r+this.length:o,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:l<this.children.length&&l>=0?this.children[l].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let n=this.parent;n;n=n.parent){if(e&&(n.flags|=2),n.flags&1)return;n.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let n=e.parent;if(!n)return e;e=n}}replaceChildren(e,n,r=v0){this.markDirty();for(let s=e;s<n;s++){let i=this.children[s];i.parent==this&&r.indexOf(i)<0&&i.destroy()}r.length<250?this.children.splice(e,n-e,...r):this.children=[].concat(this.children.slice(0,e),r,this.children.slice(n));for(let s=0;s<r.length;s++)r[s].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new IS(this.children,e,this.children.length)}childPos(e,n=1){return this.childCursor().findPos(e,n)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,n,r,s,i,l){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}ct.prototype.breakAfter=0;function yv(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class IS{constructor(e,n,r){this.children=e,this.pos=n,this.i=r,this.off=0}findPos(e,n=1){for(;;){if(e>this.pos||e==this.pos&&(n>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let r=this.children[--this.i];this.pos-=r.length+r.breakAfter}}}function FS(t,e,n,r,s,i,l,o,c){let{children:u}=t,h=u.length?u[e]:null,d=i.length?i[i.length-1]:null,f=d?d.breakAfter:l;if(!(e==r&&h&&!l&&!f&&i.length<2&&h.merge(n,s,i.length?d:null,n==0,o,c))){if(r<u.length){let p=u[r];p&&(s<p.length||p.breakAfter&&(d!=null&&d.breakAfter))?(e==r&&(p=p.split(s),s=0),!f&&d&&p.merge(0,s,d,!0,0,c)?i[i.length-1]=p:((s||p.children.length&&!p.children[0].length)&&p.merge(0,s,null,!1,0,c),i.push(p))):p!=null&&p.breakAfter&&(d?d.breakAfter=1:l=1),r++}for(h&&(h.breakAfter=l,n>0&&(!l&&i.length&&h.merge(n,h.length,i[0],!1,o,0)?h.breakAfter=i.shift().breakAfter:(n<h.length||h.children.length&&h.children[h.children.length-1].length==0)&&h.merge(n,h.length,null,!1,o,0),e++));e<r&&i.length;)if(u[r-1].become(i[i.length-1]))r--,i.pop(),c=i.length?0:o;else if(u[e].become(i[0]))e++,i.shift(),o=i.length?0:c;else break;!i.length&&e&&r<u.length&&!u[e-1].breakAfter&&u[r].merge(0,0,u[e-1],!1,o,c)&&e--,(e<r||i.length)&&t.replaceChildren(e,r,i)}}function BS(t,e,n,r,s,i){let l=t.childCursor(),{i:o,off:c}=l.findPos(n,1),{i:u,off:h}=l.findPos(e,-1),d=e-n;for(let f of r)d+=f.length;t.length+=d,FS(t,u,h,o,c,r,0,s,i)}let Un=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},vg=typeof document<"u"?document:{documentElement:{style:{}}};const wg=/Edge\/(\d+)/.exec(Un.userAgent),zS=/MSIE \d/.test(Un.userAgent),kg=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Un.userAgent),ef=!!(zS||kg||wg),bv=!ef&&/gecko\/(\d+)/i.test(Un.userAgent),lp=!ef&&/Chrome\/(\d+)/.exec(Un.userAgent),VR="webkitFontSmoothing"in vg.documentElement.style,$S=!ef&&/Apple Computer/.test(Un.vendor),vv=$S&&(/Mobile\/\w+/.test(Un.userAgent)||Un.maxTouchPoints>2);var ve={mac:vv||/Mac/.test(Un.platform),windows:/Win/.test(Un.platform),linux:/Linux|X11/.test(Un.platform),ie:ef,ie_version:zS?vg.documentMode||6:kg?+kg[1]:wg?+wg[1]:0,gecko:bv,gecko_version:bv?+(/Firefox\/(\d+)/.exec(Un.userAgent)||[0,0])[1]:0,chrome:!!lp,chrome_version:lp?+lp[1]:0,ios:vv,android:/Android\b/.test(Un.userAgent),safari:$S,webkit_version:VR?+(/\bAppleWebKit\/(\d+)/.exec(Un.userAgent)||[0,0])[1]:0,tabSize:vg.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const WR=256;class Ur extends ct{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,n){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(n&&n.node==this.dom&&(n.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,n,r){return this.flags&8||r&&(!(r instanceof Ur)||this.length-(n-e)+r.length>WR||r.flags&8)?!1:(this.text=this.text.slice(0,e)+(r?r.text:"")+this.text.slice(n),this.markDirty(),!0)}split(e){let n=new Ur(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),n.flags|=this.flags&8,n}localPosFromDOM(e,n){return e==this.dom?n:n?this.text.length:0}domAtPos(e){return new gn(this.dom,e)}domBoundsAround(e,n,r){return{from:r,to:r+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,n){return KR(this.dom,e,n)}}class zs extends ct{constructor(e,n=[],r=0){super(),this.mark=e,this.children=n,this.length=r;for(let s of n)s.setParent(this)}setAttrs(e){if(RS(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let n in this.mark.attrs)e.setAttribute(n,this.mark.attrs[n]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,n){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,n)}merge(e,n,r,s,i,l){return r&&(!(r instanceof zs&&r.mark.eq(this.mark))||e&&i<=0||n<this.length&&l<=0)?!1:(BS(this,e,n,r?r.children.slice():[],i-1,l-1),this.markDirty(),!0)}split(e){let n=[],r=0,s=-1,i=0;for(let o of this.children){let c=r+o.length;c>e&&n.push(r<e?o.split(e-r):o),s<0&&r>=e&&(s=i),r=c,i++}let l=this.length-e;return this.length=e,s>-1&&(this.children.length=s,this.markDirty()),new zs(this.mark,n,l)}domAtPos(e){return US(this,e)}coordsAt(e,n){return qS(this,e,n)}}function KR(t,e,n){let r=t.nodeValue.length;e>r&&(e=r);let s=e,i=e,l=0;e==0&&n<0||e==r&&n>=0?ve.chrome||ve.gecko||(e?(s--,l=1):i<r&&(i++,l=-1)):n<0?s--:i<r&&i++;let o=Sl(t,s,i).getClientRects();if(!o.length)return null;let c=o[(l?l<0:n>=0)?0:o.length-1];return ve.safari&&!l&&c.width==0&&(c=Array.prototype.find.call(o,u=>u.width)||c),l?Zh(c,l<0):c||null}class nl extends ct{static create(e,n,r){return new nl(e,n,r)}constructor(e,n,r){super(),this.widget=e,this.length=n,this.side=r,this.prevWidget=null}split(e){let n=nl.create(this.widget,this.length-e,this.side);return this.length-=e,n}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,n,r,s,i,l){return r&&(!(r instanceof nl)||!this.widget.compare(r.widget)||e>0&&i<=0||n<this.length&&l<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-n),!0)}become(e){return e instanceof nl&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return Ge.empty;let e=this;for(;e.parent;)e=e.parent;let{view:n}=e,r=n&&n.state.doc,s=this.posAtStart;return r?r.slice(s,s+this.length):Ge.empty}domAtPos(e){return(this.length?e==0:this.side>0)?gn.before(this.dom):gn.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,n){let r=this.widget.coordsAt(this.dom,e,n);if(r)return r;let s=this.dom.getClientRects(),i=null;if(!s.length)return null;let l=this.side?this.side<0:e>0;for(let o=l?s.length-1:0;i=s[o],!(e>0?o==0:o==s.length-1||i.top<i.bottom);o+=l?-1:1);return Zh(i,!l)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class qa extends ct{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof qa&&e.side==this.side}split(){return new qa(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?gn.before(this.dom):gn.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return Ge.empty}get isHidden(){return!0}}Ur.prototype.children=nl.prototype.children=qa.prototype.children=v0;function US(t,e){let n=t.dom,{children:r}=t,s=0;for(let i=0;s<r.length;s++){let l=r[s],o=i+l.length;if(!(o==i&&l.getSide()<=0)){if(e>i&&e<o&&l.dom.parentNode==n)return l.domAtPos(e-i);if(e<=i)break;i=o}}for(let i=s;i>0;i--){let l=r[i-1];if(l.dom.parentNode==n)return l.domAtPos(l.length)}for(let i=s;i<r.length;i++){let l=r[i];if(l.dom.parentNode==n)return l.domAtPos(0)}return new gn(n,0)}function HS(t,e,n){let r,{children:s}=t;n>0&&e instanceof zs&&s.length&&(r=s[s.length-1])instanceof zs&&r.mark.eq(e.mark)?HS(r,e.children[0],n-1):(s.push(e),e.setParent(t)),t.length+=e.length}function qS(t,e,n){let r=null,s=-1,i=null,l=-1;function o(u,h){for(let d=0,f=0;d<u.children.length&&f<=h;d++){let p=u.children[d],m=f+p.length;m>=h&&(p.children.length?o(p,h-f):(!i||i.isHidden&&(n>0||GR(i,p)))&&(m>h||f==m&&p.getSide()>0)?(i=p,l=h-f):(f<h||f==m&&p.getSide()<0&&!p.isHidden)&&(r=p,s=h-f)),f=m}}o(t,e);let c=(n<0?r:i)||r||i;return c?c.coordsAt(Math.max(0,c==r?s:l),n):QR(t)}function QR(t){let e=t.dom.lastChild;if(!e)return t.dom.getBoundingClientRect();let n=Dc(e);return n[n.length-1]||null}function GR(t,e){let n=t.coordsAt(0,1),r=e.coordsAt(0,1);return n&&r&&r.top<n.bottom}function jg(t,e){for(let n in t)n=="class"&&e.class?e.class+=" "+t.class:n=="style"&&e.style?e.style+=";"+t.style:e[n]=t[n];return e}const wv=Object.create(null);function fh(t,e,n){if(t==e)return!0;t||(t=wv),e||(e=wv);let r=Object.keys(t),s=Object.keys(e);if(r.length-(n&&r.indexOf(n)>-1?1:0)!=s.length-(n&&s.indexOf(n)>-1?1:0))return!1;for(let i of r)if(i!=n&&(s.indexOf(i)==-1||t[i]!==e[i]))return!1;return!0}function Sg(t,e,n){let r=!1;if(e)for(let s in e)n&&s in n||(r=!0,s=="style"?t.style.cssText="":t.removeAttribute(s));if(n)for(let s in n)e&&e[s]==n[s]||(r=!0,s=="style"?t.style.cssText=n[s]:t.setAttribute(s,n[s]));return r}function XR(t){let e=Object.create(null);for(let n=0;n<t.attributes.length;n++){let r=t.attributes[n];e[r.name]=r.value}return e}class w0{eq(e){return!1}updateDOM(e,n){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,n,r){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var Mn=function(t){return t[t.Text=0]="Text",t[t.WidgetBefore=1]="WidgetBefore",t[t.WidgetAfter=2]="WidgetAfter",t[t.WidgetRange=3]="WidgetRange",t}(Mn||(Mn={}));class Vt extends Ha{constructor(e,n,r,s){super(),this.startSide=e,this.endSide=n,this.widget=r,this.spec=s}get heightRelevant(){return!1}static mark(e){return new nu(e)}static widget(e){let n=Math.max(-1e4,Math.min(1e4,e.side||0)),r=!!e.block;return n+=r&&!e.inlineOrder?n>0?3e8:-4e8:n>0?1e8:-1e8,new Li(e,n,n,r,e.widget||null,!1)}static replace(e){let n=!!e.block,r,s;if(e.isBlockGap)r=-5e8,s=4e8;else{let{start:i,end:l}=VS(e,n);r=(i?n?-3e8:-1:5e8)-1,s=(l?n?2e8:1:-6e8)+1}return new Li(e,r,s,n,e.widget||null,!0)}static line(e){return new ru(e)}static set(e,n=!1){return nt.of(e,n)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}Vt.none=nt.empty;class nu extends Vt{constructor(e){let{start:n,end:r}=VS(e);super(n?-1:5e8,r?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var n,r;return this==e||e instanceof nu&&this.tagName==e.tagName&&(this.class||((n=this.attrs)===null||n===void 0?void 0:n.class))==(e.class||((r=e.attrs)===null||r===void 0?void 0:r.class))&&fh(this.attrs,e.attrs,"class")}range(e,n=e){if(e>=n)throw new RangeError("Mark decorations may not be empty");return super.range(e,n)}}nu.prototype.point=!1;class ru extends Vt{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof ru&&this.spec.class==e.spec.class&&fh(this.spec.attributes,e.spec.attributes)}range(e,n=e){if(n!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,n)}}ru.prototype.mapMode=er.TrackBefore;ru.prototype.point=!0;class Li extends Vt{constructor(e,n,r,s,i,l){super(n,r,i,e),this.block=s,this.isReplace=l,this.mapMode=s?n<=0?er.TrackBefore:er.TrackAfter:er.TrackDel}get type(){return this.startSide!=this.endSide?Mn.WidgetRange:this.startSide<=0?Mn.WidgetBefore:Mn.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Li&&JR(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,n=e){if(this.isReplace&&(e>n||e==n&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&n!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,n)}}Li.prototype.point=!0;function VS(t,e=!1){let{inclusiveStart:n,inclusiveEnd:r}=t;return n==null&&(n=t.inclusive),r==null&&(r=t.inclusive),{start:n??e,end:r??e}}function JR(t,e){return t==e||!!(t&&e&&t.compare(e))}function wd(t,e,n,r=0){let s=n.length-1;s>=0&&n[s]+r>=t?n[s]=Math.max(n[s],e):n.push(t,e)}class Lt extends ct{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,n,r,s,i,l){if(r){if(!(r instanceof Lt))return!1;this.dom||r.transferDOM(this)}return s&&this.setDeco(r?r.attrs:null),BS(this,e,n,r?r.children.slice():[],i,l),!0}split(e){let n=new Lt;if(n.breakAfter=this.breakAfter,this.length==0)return n;let{i:r,off:s}=this.childPos(e);s&&(n.append(this.children[r].split(s),0),this.children[r].merge(s,this.children[r].length,null,!1,0,0),r++);for(let i=r;i<this.children.length;i++)n.append(this.children[i],0);for(;r>0&&this.children[r-1].length==0;)this.children[--r].destroy();return this.children.length=r,this.markDirty(),this.length=e,n}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){fh(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,n){HS(this,e,n)}addLineDeco(e){let n=e.spec.attributes,r=e.spec.class;n&&(this.attrs=jg(n,this.attrs||{})),r&&(this.attrs=jg({class:r},this.attrs||{}))}domAtPos(e){return US(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,n){var r;this.dom?this.flags&4&&(RS(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Sg(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,n);let s=this.dom.lastChild;for(;s&&ct.get(s)instanceof zs;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((r=ct.get(s))===null||r===void 0?void 0:r.isEditable)==!1&&(!ve.ios||!this.children.some(i=>i instanceof Ur))){let i=document.createElement("BR");i.cmIgnore=!0,this.dom.appendChild(i)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,n;for(let r of this.children){if(!(r instanceof Ur)||/[^ -~]/.test(r.text))return null;let s=Dc(r.dom);if(s.length!=1)return null;e+=s[0].width,n=s[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:n}:null}coordsAt(e,n){let r=qS(this,e,n);if(!this.children.length&&r&&this.parent){let{heightOracle:s}=this.parent.view.viewState,i=r.bottom-r.top;if(Math.abs(i-s.lineHeight)<2&&s.textHeight<i){let l=(i-s.textHeight)/2;return{top:r.top+l,bottom:r.bottom-l,left:r.left,right:r.left}}}return r}become(e){return e instanceof Lt&&this.children.length==0&&e.children.length==0&&fh(this.attrs,e.attrs)&&this.breakAfter==e.breakAfter}covers(){return!0}static find(e,n){for(let r=0,s=0;r<e.children.length;r++){let i=e.children[r],l=s+i.length;if(l>=n){if(i instanceof Lt)return i;if(l>n)break}s=l+i.breakAfter}return null}}class Ds extends ct{constructor(e,n,r){super(),this.widget=e,this.length=n,this.deco=r,this.breakAfter=0,this.prevWidget=null}merge(e,n,r,s,i,l){return r&&(!(r instanceof Ds)||!this.widget.compare(r.widget)||e>0&&i<=0||n<this.length&&l<=0)?!1:(this.length=e+(r?r.length:0)+(this.length-n),!0)}domAtPos(e){return e==0?gn.before(this.dom):gn.after(this.dom,e==this.length)}split(e){let n=this.length-e;this.length=e;let r=new Ds(this.widget,n,this.deco);return r.breakAfter=this.breakAfter,r}get children(){return v0}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):Ge.empty}domBoundsAround(){return null}become(e){return e instanceof Ds&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,n){let r=this.widget.coordsAt(this.dom,e,n);return r||(this.widget instanceof Ng?null:Zh(this.dom.getBoundingClientRect(),this.length?e==0:n<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:n,endSide:r}=this.deco;return n==r?!1:e<0?n<0:r>0}}class Ng extends w0{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class tc{constructor(e,n,r,s){this.doc=e,this.pos=n,this.end=r,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=n}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof Ds&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Lt),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Du(new qa(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof Ds)&&this.getLine()}buildText(e,n,r){for(;e>0;){if(this.textOff==this.text.length){let{value:i,lineBreak:l,done:o}=this.cursor.next(this.skip);if(this.skip=0,o)throw new Error("Ran out of text content when drawing inline views");if(l){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=i,this.textOff=0}let s=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(n.slice(n.length-r)),this.getLine().append(Du(new Ur(this.text.slice(this.textOff,this.textOff+s)),n),r),this.atCursorPos=!0,this.textOff+=s,e-=s,r=0}}span(e,n,r,s){this.buildText(n-e,r,s),this.pos=n,this.openStart<0&&(this.openStart=s)}point(e,n,r,s,i,l){if(this.disallowBlockEffectsFor[l]&&r instanceof Li){if(r.block)throw new RangeError("Block decorations may not be specified via plugins");if(n>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let o=n-e;if(r instanceof Li)if(r.block)r.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Ds(r.widget||Va.block,o,r));else{let c=nl.create(r.widget||Va.inline,o,o?0:r.startSide),u=this.atCursorPos&&!c.isEditable&&i<=s.length&&(e<n||r.startSide>0),h=!c.isEditable&&(e<n||i>s.length||r.startSide<=0),d=this.getLine();this.pendingBuffer==2&&!u&&!c.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),u&&(d.append(Du(new qa(1),s),i),i=s.length+Math.max(0,i-s.length)),d.append(Du(c,s),i),this.atCursorPos=h,this.pendingBuffer=h?e<n||i>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(r);o&&(this.textOff+o<=this.text.length?this.textOff+=o:(this.skip+=o-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=n),this.openStart<0&&(this.openStart=i)}static build(e,n,r,s,i){let l=new tc(e,n,r,i);return l.openEnd=nt.spans(s,n,r,l),l.openStart<0&&(l.openStart=l.openEnd),l.finish(l.openEnd),l}}function Du(t,e){for(let n of e)t=new zs(n,[t],t.length);return t}class Va extends w0{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Va.inline=new Va("span");Va.block=new Va("div");var Et=function(t){return t[t.LTR=0]="LTR",t[t.RTL=1]="RTL",t}(Et||(Et={}));const Nl=Et.LTR,k0=Et.RTL;function WS(t){let e=[];for(let n=0;n<t.length;n++)e.push(1<<+t[n]);return e}const YR=WS("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ZR=WS("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Cg=Object.create(null),Gr=[];for(let t of["()","[]","{}"]){let e=t.charCodeAt(0),n=t.charCodeAt(1);Cg[e]=n,Cg[n]=-e}function KS(t){return t<=247?YR[t]:1424<=t&&t<=1524?2:1536<=t&&t<=1785?ZR[t-1536]:1774<=t&&t<=2220?4:8192<=t&&t<=8204?256:64336<=t&&t<=65023?4:1}const eD=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class yi{get dir(){return this.level%2?k0:Nl}constructor(e,n,r){this.from=e,this.to=n,this.level=r}side(e,n){return this.dir==n==e?this.to:this.from}forward(e,n){return e==(this.dir==n)}static find(e,n,r,s){let i=-1;for(let l=0;l<e.length;l++){let o=e[l];if(o.from<=n&&o.to>=n){if(o.level==r)return l;(i<0||(s!=0?s<0?o.from<n:o.to>n:e[i].level>o.level))&&(i=l)}}if(i<0)throw new RangeError("Index out of range");return i}}function QS(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++){let r=t[n],s=e[n];if(r.from!=s.from||r.to!=s.to||r.direction!=s.direction||!QS(r.inner,s.inner))return!1}return!0}const ot=[];function tD(t,e,n,r,s){for(let i=0;i<=r.length;i++){let l=i?r[i-1].to:e,o=i<r.length?r[i].from:n,c=i?256:s;for(let u=l,h=c,d=c;u<o;u++){let f=KS(t.charCodeAt(u));f==512?f=h:f==8&&d==4&&(f=16),ot[u]=f==4?2:f,f&7&&(d=f),h=f}for(let u=l,h=c,d=c;u<o;u++){let f=ot[u];if(f==128)u<o-1&&h==ot[u+1]&&h&24?f=ot[u]=h:ot[u]=256;else if(f==64){let p=u+1;for(;p<o&&ot[p]==64;)p++;let m=u&&h==8||p<n&&ot[p]==8?d==1?1:8:256;for(let x=u;x<p;x++)ot[x]=m;u=p-1}else f==8&&d==1&&(ot[u]=1);h=f,f&7&&(d=f)}}}function nD(t,e,n,r,s){let i=s==1?2:1;for(let l=0,o=0,c=0;l<=r.length;l++){let u=l?r[l-1].to:e,h=l<r.length?r[l].from:n;for(let d=u,f,p,m;d<h;d++)if(p=Cg[f=t.charCodeAt(d)])if(p<0){for(let x=o-3;x>=0;x-=3)if(Gr[x+1]==-p){let v=Gr[x+2],g=v&2?s:v&4?v&1?i:s:0;g&&(ot[d]=ot[Gr[x]]=g),o=x;break}}else{if(Gr.length==189)break;Gr[o++]=d,Gr[o++]=f,Gr[o++]=c}else if((m=ot[d])==2||m==1){let x=m==s;c=x?0:1;for(let v=o-3;v>=0;v-=3){let g=Gr[v+2];if(g&2)break;if(x)Gr[v+2]|=2;else{if(g&4)break;Gr[v+2]|=4}}}}}function rD(t,e,n,r){for(let s=0,i=r;s<=n.length;s++){let l=s?n[s-1].to:t,o=s<n.length?n[s].from:e;for(let c=l;c<o;){let u=ot[c];if(u==256){let h=c+1;for(;;)if(h==o){if(s==n.length)break;h=n[s++].to,o=s<n.length?n[s].from:e}else if(ot[h]==256)h++;else break;let d=i==1,f=(h<e?ot[h]:r)==1,p=d==f?d?1:2:r;for(let m=h,x=s,v=x?n[x-1].to:t;m>c;)m==v&&(m=n[--x].from,v=x?n[x-1].to:t),ot[--m]=p;c=h}else i=u,c++}}}function Ag(t,e,n,r,s,i,l){let o=r%2?2:1;if(r%2==s%2)for(let c=e,u=0;c<n;){let h=!0,d=!1;if(u==i.length||c<i[u].from){let x=ot[c];x!=o&&(h=!1,d=x==16)}let f=!h&&o==1?[]:null,p=h?r:r+1,m=c;e:for(;;)if(u<i.length&&m==i[u].from){if(d)break e;let x=i[u];if(!h)for(let v=x.to,g=u+1;;){if(v==n)break e;if(g<i.length&&i[g].from==v)v=i[g++].to;else{if(ot[v]==o)break e;break}}if(u++,f)f.push(x);else{x.from>c&&l.push(new yi(c,x.from,p));let v=x.direction==Nl!=!(p%2);Eg(t,v?r+1:r,s,x.inner,x.from,x.to,l),c=x.to}m=x.to}else{if(m==n||(h?ot[m]!=o:ot[m]==o))break;m++}f?Ag(t,c,m,r+1,s,f,l):c<m&&l.push(new yi(c,m,p)),c=m}else for(let c=n,u=i.length;c>e;){let h=!0,d=!1;if(!u||c>i[u-1].to){let x=ot[c-1];x!=o&&(h=!1,d=x==16)}let f=!h&&o==1?[]:null,p=h?r:r+1,m=c;e:for(;;)if(u&&m==i[u-1].to){if(d)break e;let x=i[--u];if(!h)for(let v=x.from,g=u;;){if(v==e)break e;if(g&&i[g-1].to==v)v=i[--g].from;else{if(ot[v-1]==o)break e;break}}if(f)f.push(x);else{x.to<c&&l.push(new yi(x.to,c,p));let v=x.direction==Nl!=!(p%2);Eg(t,v?r+1:r,s,x.inner,x.from,x.to,l),c=x.from}m=x.from}else{if(m==e||(h?ot[m-1]!=o:ot[m-1]==o))break;m--}f?Ag(t,m,c,r+1,s,f,l):m<c&&l.push(new yi(m,c,p)),c=m}}function Eg(t,e,n,r,s,i,l){let o=e%2?2:1;tD(t,s,i,r,o),nD(t,s,i,r,o),rD(s,i,r,o),Ag(t,s,i,e,n,r,l)}function sD(t,e,n){if(!t)return[new yi(0,0,e==k0?1:0)];if(e==Nl&&!n.length&&!eD.test(t))return GS(t.length);if(n.length)for(;t.length>ot.length;)ot[ot.length]=256;let r=[],s=e==Nl?0:1;return Eg(t,s,s,n,0,t.length,r),r}function GS(t){return[new yi(0,t,0)]}let XS="";function iD(t,e,n,r,s){var i;let l=r.head-t.from,o=yi.find(e,l,(i=r.bidiLevel)!==null&&i!==void 0?i:-1,r.assoc),c=e[o],u=c.side(s,n);if(l==u){let f=o+=s?1:-1;if(f<0||f>=e.length)return null;c=e[o=f],l=c.side(!s,n),u=c.side(s,n)}let h=Pn(t.text,l,c.forward(s,n));(h<c.from||h>c.to)&&(h=u),XS=t.text.slice(Math.min(l,h),Math.max(l,h));let d=o==(s?e.length-1:0)?null:e[o+(s?1:-1)];return d&&h==u&&d.level+(s?0:1)<c.level?pe.cursor(d.side(!s,n)+t.from,d.forward(s,n)?1:-1,d.level):pe.cursor(h+t.from,c.forward(s,n)?-1:1,c.level)}function lD(t,e,n){for(let r=e;r<n;r++){let s=KS(t.charCodeAt(r));if(s==1)return Nl;if(s==2||s==4)return k0}return Nl}const JS=_e.define(),YS=_e.define(),ZS=_e.define(),eN=_e.define(),Pg=_e.define(),tN=_e.define(),nN=_e.define(),j0=_e.define(),S0=_e.define(),rN=_e.define({combine:t=>t.some(e=>e)}),sN=_e.define({combine:t=>t.some(e=>e)}),iN=_e.define();class ya{constructor(e,n="nearest",r="nearest",s=5,i=5,l=!1){this.range=e,this.y=n,this.x=r,this.yMargin=s,this.xMargin=i,this.isSnapshot=l}map(e){return e.empty?this:new ya(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new ya(pe.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Lu=Ht.define({map:(t,e)=>t.map(e)}),lN=Ht.define();function cs(t,e,n){let r=t.facet(eN);r.length?r[0](e):window.onerror&&window.onerror(String(e),n,void 0,void 0,e)||(n?console.error(n+":",e):console.error(e))}const As=_e.define({combine:t=>t.length?t[0]:!0});let aD=0;const sa=_e.define({combine(t){return t.filter((e,n)=>{for(let r=0;r<n;r++)if(t[r].plugin==e.plugin)return!1;return!0})}});class ps{constructor(e,n,r,s,i){this.id=e,this.create=n,this.domEventHandlers=r,this.domEventObservers=s,this.baseExtensions=i(this),this.extension=this.baseExtensions.concat(sa.of({plugin:this,arg:void 0}))}of(e){return this.baseExtensions.concat(sa.of({plugin:this,arg:e}))}static define(e,n){const{eventHandlers:r,eventObservers:s,provide:i,decorations:l}=n||{};return new ps(aD++,e,r,s,o=>{let c=[];return l&&c.push(Lc.of(u=>{let h=u.plugin(o);return h?l(h):Vt.none})),i&&c.push(i(o)),c})}static fromClass(e,n){return ps.define((r,s)=>new e(r,s),n)}}class ap{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}get plugin(){return this.spec&&this.spec.plugin}update(e){if(this.value){if(this.mustUpdate){let n=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(n)}catch(r){if(cs(n.state,r,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.plugin.create(e,this.spec.arg)}catch(n){cs(e.state,n,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var n;if(!((n=this.value)===null||n===void 0)&&n.destroy)try{this.value.destroy()}catch(r){cs(e.state,r,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const aN=_e.define(),N0=_e.define(),Lc=_e.define(),oN=_e.define(),tf=_e.define(),cN=_e.define();function kv(t,e){let n=t.state.facet(cN);if(!n.length)return n;let r=n.map(i=>i instanceof Function?i(t):i),s=[];return nt.spans(r,e.from,e.to,{point(){},span(i,l,o,c){let u=i-e.from,h=l-e.from,d=s;for(let f=o.length-1;f>=0;f--,c--){let p=o[f].spec.bidiIsolate,m;if(p==null&&(p=lD(e.text,u,h)),c>0&&d.length&&(m=d[d.length-1]).to==u&&m.direction==p)m.to=h,d=m.inner;else{let x={from:u,to:h,direction:p,inner:[]};d.push(x),d=x.inner}}}}),s}const uN=_e.define();function dN(t){let e=0,n=0,r=0,s=0;for(let i of t.state.facet(uN)){let l=i(t);l&&(l.left!=null&&(e=Math.max(e,l.left)),l.right!=null&&(n=Math.max(n,l.right)),l.top!=null&&(r=Math.max(r,l.top)),l.bottom!=null&&(s=Math.max(s,l.bottom)))}return{left:e,right:n,top:r,bottom:s}}const Fo=_e.define();class Sr{constructor(e,n,r,s){this.fromA=e,this.toA=n,this.fromB=r,this.toB=s}join(e){return new Sr(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let n=e.length,r=this;for(;n>0;n--){let s=e[n-1];if(!(s.fromA>r.toA)){if(s.toA<r.fromA)break;r=r.join(s),e.splice(n-1,1)}}return e.splice(n,0,r),e}static extendWithRanges(e,n){if(n.length==0)return e;let r=[];for(let s=0,i=0,l=0,o=0;;s++){let c=s==e.length?null:e[s],u=l-o,h=c?c.fromB:1e9;for(;i<n.length&&n[i]<h;){let d=n[i],f=n[i+1],p=Math.max(o,d),m=Math.min(h,f);if(p<=m&&new Sr(p+u,m+u,p,m).addToSet(r),f>h)break;i+=2}if(!c)return r;new Sr(c.fromA,c.toA,c.fromB,c.toB).addToSet(r),l=c.toA,o=c.toB}}}class ph{constructor(e,n,r){this.view=e,this.state=n,this.transactions=r,this.flags=0,this.startState=e.state,this.changes=Xt.empty(this.startState.doc.length);for(let i of r)this.changes=this.changes.compose(i.changes);let s=[];this.changes.iterChangedRanges((i,l,o,c)=>s.push(new Sr(i,l,o,c))),this.changedRanges=s}static create(e,n,r){return new ph(e,n,r)}get viewportChanged(){return(this.flags&4)>0}get viewportMoved(){return(this.flags&8)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&18)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class jv extends ct{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=Vt.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Lt],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Sr(0,0,0,e.state.doc.length)],0,null)}update(e){var n;let r=e.changedRanges;this.minWidth>0&&r.length&&(r.every(({fromA:u,toA:h})=>h<this.minWidthFrom||u>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(e);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((n=this.domChanged)===null||n===void 0)&&n.newSel?s=this.domChanged.newSel.head:!pD(e.changes,this.hasComposition)&&!e.selectionSet&&(s=e.state.selection.main.head));let i=s>-1?cD(this.view,e.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:u,to:h}=this.hasComposition;r=new Sr(u,h,e.changes.mapPos(u,-1),e.changes.mapPos(h,1)).addToSet(r.slice())}this.hasComposition=i?{from:i.range.fromB,to:i.range.toB}:null,(ve.ie||ve.chrome)&&!i&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let l=this.decorations,o=this.updateDeco(),c=hD(l,o,e.changes);return r=Sr.extendWithRanges(r,c),!(this.flags&7)&&r.length==0?!1:(this.updateInner(r,e.startState.doc.length,i),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,n,r){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,n,r);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let l=ve.chrome||ve.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,l),this.flags&=-8,l&&(l.written||s.selectionRange.focusNode!=l.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(l=>l.flags&=-9);let i=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let l of this.children)l instanceof Ds&&l.widget instanceof Ng&&i.push(l.dom);s.updateGaps(i)}updateChildren(e,n,r){let s=r?r.range.addToSet(e.slice()):e,i=this.childCursor(n);for(let l=s.length-1;;l--){let o=l>=0?s[l]:null;if(!o)break;let{fromA:c,toA:u,fromB:h,toB:d}=o,f,p,m,x;if(r&&r.range.fromB<d&&r.range.toB>h){let k=tc.build(this.view.state.doc,h,r.range.fromB,this.decorations,this.dynamicDecorationMap),S=tc.build(this.view.state.doc,r.range.toB,d,this.decorations,this.dynamicDecorationMap);p=k.breakAtStart,m=k.openStart,x=S.openEnd;let j=this.compositionView(r);S.breakAtStart?j.breakAfter=1:S.content.length&&j.merge(j.length,j.length,S.content[0],!1,S.openStart,0)&&(j.breakAfter=S.content[0].breakAfter,S.content.shift()),k.content.length&&j.merge(0,0,k.content[k.content.length-1],!0,0,k.openEnd)&&k.content.pop(),f=k.content.concat(j).concat(S.content)}else({content:f,breakAtStart:p,openStart:m,openEnd:x}=tc.build(this.view.state.doc,h,d,this.decorations,this.dynamicDecorationMap));let{i:v,off:g}=i.findPos(u,1),{i:y,off:b}=i.findPos(c,-1);FS(this,y,b,v,g,f,p,m,x)}r&&this.fixCompositionDOM(r)}updateEditContextFormatting(e){this.editContextFormatting=this.editContextFormatting.map(e.changes);for(let n of e.transactions)for(let r of n.effects)r.is(lN)&&(this.editContextFormatting=r.value)}compositionView(e){let n=new Ur(e.text.nodeValue);n.flags|=8;for(let{deco:s}of e.marks)n=new zs(s,[n],n.length);let r=new Lt;return r.append(n,0),r}fixCompositionDOM(e){let n=(i,l)=>{l.flags|=8|(l.children.some(c=>c.flags&7)?1:0),this.markedForComposition.add(l);let o=ct.get(i);o&&o!=l&&(o.dom=null),l.setDOM(i)},r=this.childPos(e.range.fromB,1),s=this.children[r.i];n(e.line,s);for(let i=e.marks.length-1;i>=-1;i--)r=s.childPos(r.off,1),s=s.children[r.i],n(i>=0?e.marks[i].node:e.text,s)}updateSelection(e=!1,n=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let r=this.view.root.activeElement,s=r==this.dom,i=!s&&!(this.view.state.facet(As)||this.dom.tabIndex>-1)&&vd(this.dom,this.view.observer.selectionRange)&&!(r&&this.dom.contains(r));if(!(s||n||i))return;let l=this.forceSelection;this.forceSelection=!1;let o=this.view.state.selection.main,c=this.moveToLine(this.domAtPos(o.anchor)),u=o.empty?c:this.moveToLine(this.domAtPos(o.head));if(ve.gecko&&o.empty&&!this.hasComposition&&oD(c)){let d=document.createTextNode("");this.view.observer.ignore(()=>c.node.insertBefore(d,c.node.childNodes[c.offset]||null)),c=u=new gn(d,0),l=!0}let h=this.view.observer.selectionRange;(l||!h.focusNode||(!ec(c.node,c.offset,h.anchorNode,h.anchorOffset)||!ec(u.node,u.offset,h.focusNode,h.focusOffset))&&!this.suppressWidgetCursorChange(h,o))&&(this.view.observer.ignore(()=>{ve.android&&ve.chrome&&this.dom.contains(h.focusNode)&&fD(h.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let d=Rc(this.view.root);if(d)if(o.empty){if(ve.gecko){let f=uD(c.node,c.offset);if(f&&f!=3){let p=(f==1?LS:OS)(c.node,c.offset);p&&(c=new gn(p.node,p.offset))}}d.collapse(c.node,c.offset),o.bidiLevel!=null&&d.caretBidiLevel!==void 0&&(d.caretBidiLevel=o.bidiLevel)}else if(d.extend){d.collapse(c.node,c.offset);try{d.extend(u.node,u.offset)}catch{}}else{let f=document.createRange();o.anchor>o.head&&([c,u]=[u,c]),f.setEnd(u.node,u.offset),f.setStart(c.node,c.offset),d.removeAllRanges(),d.addRange(f)}i&&this.view.root.activeElement==this.dom&&(this.dom.blur(),r&&r.focus())}),this.view.observer.setSelectionRange(c,u)),this.impreciseAnchor=c.precise?null:new gn(h.anchorNode,h.anchorOffset),this.impreciseHead=u.precise?null:new gn(h.focusNode,h.focusOffset)}suppressWidgetCursorChange(e,n){return this.hasComposition&&n.empty&&ec(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==n.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,n=e.state.selection.main,r=Rc(e.root),{anchorNode:s,anchorOffset:i}=e.observer.selectionRange;if(!r||!n.empty||!n.assoc||!r.modify)return;let l=Lt.find(this,n.head);if(!l)return;let o=l.posAtStart;if(n.head==o||n.head==o+l.length)return;let c=this.coordsAt(n.head,-1),u=this.coordsAt(n.head,1);if(!c||!u||c.bottom>u.top)return;let h=this.domAtPos(n.head+n.assoc);r.collapse(h.node,h.offset),r.modify("move",n.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let d=e.observer.selectionRange;e.docView.posFromDOM(d.anchorNode,d.anchorOffset)!=n.from&&r.collapse(s,i)}moveToLine(e){let n=this.dom,r;if(e.node!=n)return e;for(let s=e.offset;!r&&s<n.childNodes.length;s++){let i=ct.get(n.childNodes[s]);i instanceof Lt&&(r=i.domAtPos(0))}for(let s=e.offset-1;!r&&s>=0;s--){let i=ct.get(n.childNodes[s]);i instanceof Lt&&(r=i.domAtPos(i.length))}return r?new gn(r.node,r.offset,!0):e}nearest(e){for(let n=e;n;){let r=ct.get(n);if(r&&r.rootView==this)return r;n=n.parentNode}return null}posFromDOM(e,n){let r=this.nearest(e);if(!r)throw new RangeError("Trying to find position for a DOM position outside of the document");return r.localPosFromDOM(e,n)+r.posAtStart}domAtPos(e){let{i:n,off:r}=this.childCursor().findPos(e,-1);for(;n<this.children.length-1;){let s=this.children[n];if(r<s.length||s instanceof Lt)break;n++,r=0}return this.children[n].domAtPos(r)}coordsAt(e,n){let r=null,s=0;for(let i=this.length,l=this.children.length-1;l>=0;l--){let o=this.children[l],c=i-o.breakAfter,u=c-o.length;if(c<e)break;if(u<=e&&(u<e||o.covers(-1))&&(c>e||o.covers(1))&&(!r||o instanceof Lt&&!(r instanceof Lt&&n>=0)))r=o,s=u;else if(r&&u==e&&c==e&&o instanceof Ds&&Math.abs(n)<2){if(o.deco.startSide<0)break;l&&(r=null)}i=u}return r?r.coordsAt(e-s,n):null}coordsForChar(e){let{i:n,off:r}=this.childPos(e,1),s=this.children[n];if(!(s instanceof Lt))return null;for(;s.children.length;){let{i:o,off:c}=s.childPos(r,1);for(;;o++){if(o==s.children.length)return null;if((s=s.children[o]).length)break}r=c}if(!(s instanceof Ur))return null;let i=Pn(s.text,r);if(i==r)return null;let l=Sl(s.dom,r,i).getClientRects();for(let o=0;o<l.length;o++){let c=l[o];if(o==l.length-1||c.top<c.bottom&&c.left<c.right)return c}return null}measureVisibleLineHeights(e){let n=[],{from:r,to:s}=e,i=this.view.contentDOM.clientWidth,l=i>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,o=-1,c=this.view.textDirection==Et.LTR;for(let u=0,h=0;h<this.children.length;h++){let d=this.children[h],f=u+d.length;if(f>s)break;if(u>=r){let p=d.dom.getBoundingClientRect();if(n.push(p.height),l){let m=d.dom.lastChild,x=m?Dc(m):[];if(x.length){let v=x[x.length-1],g=c?v.right-p.left:p.right-v.left;g>o&&(o=g,this.minWidth=i,this.minWidthFrom=u,this.minWidthTo=f)}}}u=f+d.breakAfter}return n}textDirectionAt(e){let{i:n}=this.childPos(e,1);return getComputedStyle(this.children[n].dom).direction=="rtl"?Et.RTL:Et.LTR}measureTextSize(){for(let i of this.children)if(i instanceof Lt){let l=i.measureTextSize();if(l)return l}let e=document.createElement("div"),n,r,s;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let i=Dc(e.firstChild)[0];n=e.getBoundingClientRect().height,r=i?i.width/27:7,s=i?i.height:n,e.remove()}),{lineHeight:n,charWidth:r,textHeight:s}}childCursor(e=this.length){let n=this.children.length;return n&&(e-=this.children[--n].length),new IS(this.children,e,n)}computeBlockGapDeco(){let e=[],n=this.view.viewState;for(let r=0,s=0;;s++){let i=s==n.viewports.length?null:n.viewports[s],l=i?i.from-1:this.length;if(l>r){let o=(n.lineBlockAt(l).bottom-n.lineBlockAt(r).top)/this.view.scaleY;e.push(Vt.replace({widget:new Ng(o),block:!0,inclusive:!0,isBlockGap:!0}).range(r,l))}if(!i)break;r=i.to+1}return Vt.set(e)}updateDeco(){let e=1,n=this.view.state.facet(Lc).map(i=>(this.dynamicDecorationMap[e++]=typeof i=="function")?i(this.view):i),r=!1,s=this.view.state.facet(oN).map((i,l)=>{let o=typeof i=="function";return o&&(r=!0),o?i(this.view):i});for(s.length&&(this.dynamicDecorationMap[e++]=r,n.push(nt.join(s))),this.decorations=[this.editContextFormatting,...n,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];e<this.decorations.length;)this.dynamicDecorationMap[e++]=!1;return this.decorations}scrollIntoView(e){if(e.isSnapshot){let u=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=u.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}for(let u of this.view.state.facet(iN))try{if(u(this.view,e.range,e))return!0}catch(h){cs(this.view.state,h,"scroll handler")}let{range:n}=e,r=this.coordsAt(n.head,n.empty?n.assoc:n.head>n.anchor?-1:1),s;if(!r)return;!n.empty&&(s=this.coordsAt(n.anchor,n.anchor>n.head?-1:1))&&(r={left:Math.min(r.left,s.left),top:Math.min(r.top,s.top),right:Math.max(r.right,s.right),bottom:Math.max(r.bottom,s.bottom)});let i=dN(this.view),l={left:r.left-i.left,top:r.top-i.top,right:r.right+i.right,bottom:r.bottom+i.bottom},{offsetWidth:o,offsetHeight:c}=this.view.scrollDOM;zR(this.view.scrollDOM,l,n.head<n.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,o),-o),Math.max(Math.min(e.yMargin,c),-c),this.view.textDirection==Et.LTR)}}function oD(t){return t.node.nodeType==1&&t.node.firstChild&&(t.offset==0||t.node.childNodes[t.offset-1].contentEditable=="false")&&(t.offset==t.node.childNodes.length||t.node.childNodes[t.offset].contentEditable=="false")}function hN(t,e){let n=t.observer.selectionRange;if(!n.focusNode)return null;let r=LS(n.focusNode,n.focusOffset),s=OS(n.focusNode,n.focusOffset),i=r||s;if(s&&r&&s.node!=r.node){let o=ct.get(s.node);if(!o||o instanceof Ur&&o.text!=s.node.nodeValue)i=s;else if(t.docView.lastCompositionAfterCursor){let c=ct.get(r.node);!c||c instanceof Ur&&c.text!=r.node.nodeValue||(i=s)}}if(t.docView.lastCompositionAfterCursor=i!=r,!i)return null;let l=e-i.offset;return{from:l,to:l+i.node.nodeValue.length,node:i.node}}function cD(t,e,n){let r=hN(t,n);if(!r)return null;let{node:s,from:i,to:l}=r,o=s.nodeValue;if(/[\n\r]/.test(o)||t.state.doc.sliceString(r.from,r.to)!=o)return null;let c=e.invertedDesc,u=new Sr(c.mapPos(i),c.mapPos(l),i,l),h=[];for(let d=s.parentNode;;d=d.parentNode){let f=ct.get(d);if(f instanceof zs)h.push({node:d,deco:f.mark});else{if(f instanceof Lt||d.nodeName=="DIV"&&d.parentNode==t.contentDOM)return{range:u,text:s,marks:h,line:d};if(d!=t.contentDOM)h.push({node:d,deco:new nu({inclusive:!0,attributes:XR(d),tagName:d.tagName.toLowerCase()})});else return null}}}function uD(t,e){return t.nodeType!=1?0:(e&&t.childNodes[e-1].contentEditable=="false"?1:0)|(e<t.childNodes.length&&t.childNodes[e].contentEditable=="false"?2:0)}let dD=class{constructor(){this.changes=[]}compareRange(e,n){wd(e,n,this.changes)}comparePoint(e,n){wd(e,n,this.changes)}boundChange(e){wd(e,e,this.changes)}};function hD(t,e,n){let r=new dD;return nt.compare(t,e,n,r),r.changes}function fD(t,e){for(let n=t;n&&n!=e;n=n.assignedSlot||n.parentNode)if(n.nodeType==1&&n.contentEditable=="false")return!0;return!1}function pD(t,e){let n=!1;return e&&t.iterChangedRanges((r,s)=>{r<e.to&&s>e.from&&(n=!0)}),n}function mD(t,e,n=1){let r=t.charCategorizer(e),s=t.doc.lineAt(e),i=e-s.from;if(s.length==0)return pe.cursor(e);i==0?n=1:i==s.length&&(n=-1);let l=i,o=i;n<0?l=Pn(s.text,i,!1):o=Pn(s.text,i);let c=r(s.text.slice(l,o));for(;l>0;){let u=Pn(s.text,l,!1);if(r(s.text.slice(u,l))!=c)break;l=u}for(;o<s.length;){let u=Pn(s.text,o);if(r(s.text.slice(o,u))!=c)break;o=u}return pe.range(l+s.from,o+s.from)}function gD(t,e){return e.left>t?e.left-t:Math.max(0,t-e.right)}function xD(t,e){return e.top>t?e.top-t:Math.max(0,t-e.bottom)}function op(t,e){return t.top<e.bottom-1&&t.bottom>e.top+1}function Sv(t,e){return e<t.top?{top:e,left:t.left,right:t.right,bottom:t.bottom}:t}function Nv(t,e){return e>t.bottom?{top:t.top,left:t.left,right:t.right,bottom:e}:t}function _g(t,e,n){let r,s,i,l,o=!1,c,u,h,d;for(let m=t.firstChild;m;m=m.nextSibling){let x=Dc(m);for(let v=0;v<x.length;v++){let g=x[v];s&&op(s,g)&&(g=Sv(Nv(g,s.bottom),s.top));let y=gD(e,g),b=xD(n,g);if(y==0&&b==0)return m.nodeType==3?Cv(m,e,n):_g(m,e,n);(!r||l>b||l==b&&i>y)&&(r=m,s=g,i=y,l=b,o=y?e<g.left?v>0:v<x.length-1:!0),y==0?n>g.bottom&&(!h||h.bottom<g.bottom)?(c=m,h=g):n<g.top&&(!d||d.top>g.top)&&(u=m,d=g):h&&op(h,g)?h=Nv(h,g.bottom):d&&op(d,g)&&(d=Sv(d,g.top))}}if(h&&h.bottom>=n?(r=c,s=h):d&&d.top<=n&&(r=u,s=d),!r)return{node:t,offset:0};let f=Math.max(s.left,Math.min(s.right,e));if(r.nodeType==3)return Cv(r,f,n);if(o&&r.contentEditable!="false")return _g(r,f,n);let p=Array.prototype.indexOf.call(t.childNodes,r)+(e>=(s.left+s.right)/2?1:0);return{node:t,offset:p}}function Cv(t,e,n){let r=t.nodeValue.length,s=-1,i=1e9,l=0;for(let o=0;o<r;o++){let c=Sl(t,o,o+1).getClientRects();for(let u=0;u<c.length;u++){let h=c[u];if(h.top==h.bottom)continue;l||(l=e-h.left);let d=(h.top>n?h.top-n:n-h.bottom)-1;if(h.left-1<=e&&h.right+1>=e&&d<i){let f=e>=(h.left+h.right)/2,p=f;if((ve.chrome||ve.gecko)&&Sl(t,o).getBoundingClientRect().left==h.right&&(p=!f),d<=0)return{node:t,offset:o+(p?1:0)};s=o+(p?1:0),i=d}}}return{node:t,offset:s>-1?s:l>0?t.nodeValue.length:0}}function fN(t,e,n,r=-1){var s,i;let l=t.contentDOM.getBoundingClientRect(),o=l.top+t.viewState.paddingTop,c,{docHeight:u}=t.viewState,{x:h,y:d}=e,f=d-o;if(f<0)return 0;if(f>u)return t.state.doc.length;for(let k=t.viewState.heightOracle.textHeight/2,S=!1;c=t.elementAtHeight(f),c.type!=Mn.Text;)for(;f=r>0?c.bottom+k:c.top-k,!(f>=0&&f<=u);){if(S)return n?null:0;S=!0,r=-r}d=o+f;let p=c.from;if(p<t.viewport.from)return t.viewport.from==0?0:n?null:Av(t,l,c,h,d);if(p>t.viewport.to)return t.viewport.to==t.state.doc.length?t.state.doc.length:n?null:Av(t,l,c,h,d);let m=t.dom.ownerDocument,x=t.root.elementFromPoint?t.root:m,v=x.elementFromPoint(h,d);v&&!t.contentDOM.contains(v)&&(v=null),v||(h=Math.max(l.left+1,Math.min(l.right-1,h)),v=x.elementFromPoint(h,d),v&&!t.contentDOM.contains(v)&&(v=null));let g,y=-1;if(v&&((s=t.docView.nearest(v))===null||s===void 0?void 0:s.isEditable)!=!1){if(m.caretPositionFromPoint){let k=m.caretPositionFromPoint(h,d);k&&({offsetNode:g,offset:y}=k)}else if(m.caretRangeFromPoint){let k=m.caretRangeFromPoint(h,d);k&&({startContainer:g,startOffset:y}=k,(!t.contentDOM.contains(g)||ve.safari&&yD(g,y,h)||ve.chrome&&bD(g,y,h))&&(g=void 0))}g&&(y=Math.min(fs(g),y))}if(!g||!t.docView.dom.contains(g)){let k=Lt.find(t.docView,p);if(!k)return f>c.top+c.height/2?c.to:c.from;({node:g,offset:y}=_g(k.dom,h,d))}let b=t.docView.nearest(g);if(!b)return null;if(b.isWidget&&((i=b.dom)===null||i===void 0?void 0:i.nodeType)==1){let k=b.dom.getBoundingClientRect();return e.y<k.top||e.y<=k.bottom&&e.x<=(k.left+k.right)/2?b.posAtStart:b.posAtEnd}else return b.localPosFromDOM(g,y)+b.posAtStart}function Av(t,e,n,r,s){let i=Math.round((r-e.left)*t.defaultCharacterWidth);if(t.lineWrapping&&n.height>t.defaultLineHeight*1.5){let o=t.viewState.heightOracle.textHeight,c=Math.floor((s-n.top-(t.defaultLineHeight-o)*.5)/o);i+=c*t.viewState.heightOracle.lineLength}let l=t.state.sliceDoc(n.from,n.to);return n.from+DR(l,i,t.state.tabSize)}function yD(t,e,n){let r,s=t;if(t.nodeType!=3||e!=(r=t.nodeValue.length))return!1;for(;;){let i=s.nextSibling;if(i){if(i.nodeName=="BR")break;return!1}else{let l=s.parentNode;if(!l||l.nodeName=="DIV")break;s=l}}return Sl(t,r-1,r).getBoundingClientRect().right>n}function bD(t,e,n){if(e!=0)return!1;for(let s=t;;){let i=s.parentNode;if(!i||i.nodeType!=1||i.firstChild!=s)return!1;if(i.classList.contains("cm-line"))break;s=i}let r=t.nodeType==1?t.getBoundingClientRect():Sl(t,0,Math.max(t.nodeValue.length,1)).getBoundingClientRect();return n-r.left>5}function Mg(t,e,n){let r=t.lineBlockAt(e);if(Array.isArray(r.type)){let s;for(let i of r.type){if(i.from>e)break;if(!(i.to<e)){if(i.from<e&&i.to>e)return i;(!s||i.type==Mn.Text&&(s.type!=i.type||(n<0?i.from<e:i.to>e)))&&(s=i)}}return s||r}return r}function vD(t,e,n,r){let s=Mg(t,e.head,e.assoc||-1),i=!r||s.type!=Mn.Text||!(t.lineWrapping||s.widgetLineBreaks)?null:t.coordsAtPos(e.assoc<0&&e.head>s.from?e.head-1:e.head);if(i){let l=t.dom.getBoundingClientRect(),o=t.textDirectionAt(s.from),c=t.posAtCoords({x:n==(o==Et.LTR)?l.right-1:l.left+1,y:(i.top+i.bottom)/2});if(c!=null)return pe.cursor(c,n?-1:1)}return pe.cursor(n?s.to:s.from,n?-1:1)}function Ev(t,e,n,r){let s=t.state.doc.lineAt(e.head),i=t.bidiSpans(s),l=t.textDirectionAt(s.from);for(let o=e,c=null;;){let u=iD(s,i,l,o,n),h=XS;if(!u){if(s.number==(n?t.state.doc.lines:1))return o;h=`
`,s=t.state.doc.line(s.number+(n?1:-1)),i=t.bidiSpans(s),u=t.visualLineSide(s,!n)}if(c){if(!c(h))return o}else{if(!r)return u;c=r(h)}o=u}}function wD(t,e,n){let r=t.state.charCategorizer(e),s=r(n);return i=>{let l=r(i);return s==_s.Space&&(s=l),s==l}}function kD(t,e,n,r){let s=e.head,i=n?1:-1;if(s==(n?t.state.doc.length:0))return pe.cursor(s,e.assoc);let l=e.goalColumn,o,c=t.contentDOM.getBoundingClientRect(),u=t.coordsAtPos(s,e.assoc||-1),h=t.documentTop;if(u)l==null&&(l=u.left-c.left),o=i<0?u.top:u.bottom;else{let p=t.viewState.lineBlockAt(s);l==null&&(l=Math.min(c.right-c.left,t.defaultCharacterWidth*(s-p.from))),o=(i<0?p.top:p.bottom)+h}let d=c.left+l,f=r??t.viewState.heightOracle.textHeight>>1;for(let p=0;;p+=10){let m=o+(f+p)*i,x=fN(t,{x:d,y:m},!1,i);if(m<c.top||m>c.bottom||(i<0?x<s:x>s)){let v=t.docView.coordsForChar(x),g=!v||m<v.top?-1:1;return pe.cursor(x,g,void 0,l)}}}function kd(t,e,n){for(;;){let r=0;for(let s of t)s.between(e-1,e+1,(i,l,o)=>{if(e>i&&e<l){let c=r||n||(e-i<l-e?-1:1);e=c<0?i:l,r=c}});if(!r)return e}}function pN(t,e){let n=null;for(let r=0;r<e.ranges.length;r++){let s=e.ranges[r],i=null;if(s.empty){let l=kd(t,s.from,0);l!=s.from&&(i=pe.cursor(l,-1))}else{let l=kd(t,s.from,-1),o=kd(t,s.to,1);(l!=s.from||o!=s.to)&&(i=pe.range(s.from==s.anchor?l:o,s.from==s.head?l:o))}i&&(n||(n=e.ranges.slice()),n[r]=i)}return n?pe.create(n,e.mainIndex):e}function cp(t,e,n){let r=kd(t.state.facet(tf).map(s=>s(t)),n.from,e.head>n.from?-1:1);return r==n.from?n:pe.cursor(r,r<n.from?1:-1)}const Bo="";class jD{constructor(e,n){this.points=e,this.text="",this.lineSeparator=n.facet(Ze.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Bo}readRange(e,n){if(!e)return this;let r=e.parentNode;for(let s=e;;){this.findPointBefore(r,s);let i=this.text.length;this.readNode(s);let l=s.nextSibling;if(l==n)break;let o=ct.get(s),c=ct.get(l);(o&&c?o.breakAfter:(o?o.breakAfter:hh(s))||hh(l)&&(s.nodeName!="BR"||s.cmIgnore)&&this.text.length>i)&&this.lineBreak(),s=l}return this.findPointBefore(r,n),this}readTextNode(e){let n=e.nodeValue;for(let r of this.points)r.node==e&&(r.pos=this.text.length+Math.min(r.offset,n.length));for(let r=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let i=-1,l=1,o;if(this.lineSeparator?(i=n.indexOf(this.lineSeparator,r),l=this.lineSeparator.length):(o=s.exec(n))&&(i=o.index,l=o[0].length),this.append(n.slice(r,i<0?n.length:i)),i<0)break;if(this.lineBreak(),l>1)for(let c of this.points)c.node==e&&c.pos>this.text.length&&(c.pos-=l-1);r=i+l}}readNode(e){if(e.cmIgnore)return;let n=ct.get(e),r=n&&n.overrideDOMText;if(r!=null){this.findPointInside(e,r.length);for(let s=r.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,n){for(let r of this.points)r.node==e&&e.childNodes[r.offset]==n&&(r.pos=this.text.length)}findPointInside(e,n){for(let r of this.points)(e.nodeType==3?r.node==e:e.contains(r.node))&&(r.pos=this.text.length+(SD(e,r.node,r.offset)?n:0))}}function SD(t,e,n){for(;;){if(!e||n<fs(e))return!1;if(e==t)return!0;n=jl(e)+1,e=e.parentNode}}class Pv{constructor(e,n){this.node=e,this.offset=n,this.pos=-1}}class ND{constructor(e,n,r,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=n>-1;let{impreciseHead:i,impreciseAnchor:l}=e.docView;if(e.state.readOnly&&n>-1)this.newSel=null;else if(n>-1&&(this.bounds=e.docView.domBoundsAround(n,r,0))){let o=i||l?[]:ED(e),c=new jD(o,e.state);c.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=c.text,this.newSel=PD(o,this.bounds.from)}else{let o=e.observer.selectionRange,c=i&&i.node==o.focusNode&&i.offset==o.focusOffset||!bg(e.contentDOM,o.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(o.focusNode,o.focusOffset),u=l&&l.node==o.anchorNode&&l.offset==o.anchorOffset||!bg(e.contentDOM,o.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(o.anchorNode,o.anchorOffset),h=e.viewport;if((ve.ios||ve.chrome)&&e.state.selection.main.empty&&c!=u&&(h.from>0||h.to<e.state.doc.length)){let d=Math.min(c,u),f=Math.max(c,u),p=h.from-d,m=h.to-f;(p==0||p==1||d==0)&&(m==0||m==-1||f==e.state.doc.length)&&(c=0,u=e.state.doc.length)}this.newSel=pe.single(u,c)}}}function mN(t,e){let n,{newSel:r}=e,s=t.state.selection.main,i=t.inputState.lastKeyTime>Date.now()-100?t.inputState.lastKeyCode:-1;if(e.bounds){let{from:l,to:o}=e.bounds,c=s.from,u=null;(i===8||ve.android&&e.text.length<o-l)&&(c=s.to,u="end");let h=AD(t.state.doc.sliceString(l,o,Bo),e.text,c-l,u);h&&(ve.chrome&&i==13&&h.toB==h.from+2&&e.text.slice(h.from,h.toB)==Bo+Bo&&h.toB--,n={from:l+h.from,to:l+h.toA,insert:Ge.of(e.text.slice(h.from,h.toB).split(Bo))})}else r&&(!t.hasFocus&&t.state.facet(As)||r.main.eq(s))&&(r=null);if(!n&&!r)return!1;if(!n&&e.typeOver&&!s.empty&&r&&r.main.empty?n={from:s.from,to:s.to,insert:t.state.doc.slice(s.from,s.to)}:(ve.mac||ve.android)&&n&&n.from==n.to&&n.from==s.head-1&&/^\. ?$/.test(n.insert.toString())&&t.contentDOM.getAttribute("autocorrect")=="off"?(r&&n.insert.length==2&&(r=pe.single(r.main.anchor-1,r.main.head-1)),n={from:n.from,to:n.to,insert:Ge.of([n.insert.toString().replace("."," ")])}):n&&n.from>=s.from&&n.to<=s.to&&(n.from!=s.from||n.to!=s.to)&&s.to-s.from-(n.to-n.from)<=4?n={from:s.from,to:s.to,insert:t.state.doc.slice(s.from,n.from).append(n.insert).append(t.state.doc.slice(n.to,s.to))}:ve.chrome&&n&&n.from==n.to&&n.from==s.head&&n.insert.toString()==`
 `&&t.lineWrapping&&(r&&(r=pe.single(r.main.anchor-1,r.main.head-1)),n={from:s.from,to:s.to,insert:Ge.of([" "])}),n)return C0(t,n,r,i);if(r&&!r.main.eq(s)){let l=!1,o="select";return t.inputState.lastSelectionTime>Date.now()-50&&(t.inputState.lastSelectionOrigin=="select"&&(l=!0),o=t.inputState.lastSelectionOrigin,o=="select.pointer"&&(r=pN(t.state.facet(tf).map(c=>c(t)),r))),t.dispatch({selection:r,scrollIntoView:l,userEvent:o}),!0}else return!1}function C0(t,e,n,r=-1){if(ve.ios&&t.inputState.flushIOSKey(e))return!0;let s=t.state.selection.main;if(ve.android&&(e.to==s.to&&(e.from==s.from||e.from==s.from-1&&t.state.sliceDoc(e.from,s.from)==" ")&&e.insert.length==1&&e.insert.lines==2&&xa(t.contentDOM,"Enter",13)||(e.from==s.from-1&&e.to==s.to&&e.insert.length==0||r==8&&e.insert.length<e.to-e.from&&e.to>s.head)&&xa(t.contentDOM,"Backspace",8)||e.from==s.from&&e.to==s.to+1&&e.insert.length==0&&xa(t.contentDOM,"Delete",46)))return!0;let i=e.insert.toString();t.inputState.composing>=0&&t.inputState.composing++;let l,o=()=>l||(l=CD(t,e,n));return t.state.facet(tN).some(c=>c(t,e.from,e.to,i,o))||t.dispatch(o()),!0}function CD(t,e,n){let r,s=t.state,i=s.selection.main;if(e.from>=i.from&&e.to<=i.to&&e.to-e.from>=(i.to-i.from)/3&&(!n||n.main.empty&&n.main.from==e.from+e.insert.length)&&t.inputState.composing<0){let o=i.from<e.from?s.sliceDoc(i.from,e.from):"",c=i.to>e.to?s.sliceDoc(e.to,i.to):"";r=s.replaceSelection(t.state.toText(o+e.insert.sliceString(0,void 0,t.state.lineBreak)+c))}else{let o=s.changes(e),c=n&&n.main.to<=o.newLength?n.main:void 0;if(s.selection.ranges.length>1&&t.inputState.composing>=0&&e.to<=i.to&&e.to>=i.to-10){let u=t.state.sliceDoc(e.from,e.to),h,d=n&&hN(t,n.main.head);if(d){let m=e.insert.length-(e.to-e.from);h={from:d.from,to:d.to-m}}else h=t.state.doc.lineAt(i.head);let f=i.to-e.to,p=i.to-i.from;r=s.changeByRange(m=>{if(m.from==i.from&&m.to==i.to)return{changes:o,range:c||m.map(o)};let x=m.to-f,v=x-u.length;if(m.to-m.from!=p||t.state.sliceDoc(v,x)!=u||m.to>=h.from&&m.from<=h.to)return{range:m};let g=s.changes({from:v,to:x,insert:e.insert}),y=m.to-i.to;return{changes:g,range:c?pe.range(Math.max(0,c.anchor+y),Math.max(0,c.head+y)):m.map(g)}})}else r={changes:o,selection:c&&s.selection.replaceRange(c)}}let l="input.type";return(t.composing||t.inputState.compositionPendingChange&&t.inputState.compositionEndedAt>Date.now()-50)&&(t.inputState.compositionPendingChange=!1,l+=".compose",t.inputState.compositionFirstChange&&(l+=".start",t.inputState.compositionFirstChange=!1)),s.update(r,{userEvent:l,scrollIntoView:!0})}function AD(t,e,n,r){let s=Math.min(t.length,e.length),i=0;for(;i<s&&t.charCodeAt(i)==e.charCodeAt(i);)i++;if(i==s&&t.length==e.length)return null;let l=t.length,o=e.length;for(;l>0&&o>0&&t.charCodeAt(l-1)==e.charCodeAt(o-1);)l--,o--;if(r=="end"){let c=Math.max(0,i-Math.min(l,o));n-=l+c-i}if(l<i&&t.length<e.length){let c=n<=i&&n>=l?i-n:0;i-=c,o=i+(o-l),l=i}else if(o<i){let c=n<=i&&n>=o?i-n:0;i-=c,l=i+(l-o),o=i}return{from:i,toA:l,toB:o}}function ED(t){let e=[];if(t.root.activeElement!=t.contentDOM)return e;let{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}=t.observer.selectionRange;return n&&(e.push(new Pv(n,r)),(s!=n||i!=r)&&e.push(new Pv(s,i))),e}function PD(t,e){if(t.length==0)return null;let n=t[0].pos,r=t.length==2?t[1].pos:n;return n>-1&&r>-1?pe.single(n+e,r+e):null}class _D{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,ve.safari&&e.contentDOM.addEventListener("input",()=>null),ve.gecko&&WD(e.contentDOM.ownerDocument)}handleEvent(e){!FD(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||(this.view.updateState!=0?Promise.resolve().then(()=>this.runHandlers(e.type,e)):this.runHandlers(e.type,e))}runHandlers(e,n){let r=this.handlers[e];if(r){for(let s of r.observers)s(this.view,n);for(let s of r.handlers){if(n.defaultPrevented)break;if(s(this.view,n)){n.preventDefault();break}}}}ensureHandlers(e){let n=MD(e),r=this.handlers,s=this.view.contentDOM;for(let i in n)if(i!="scroll"){let l=!n[i].handlers.length,o=r[i];o&&l!=!o.handlers.length&&(s.removeEventListener(i,this.handleEvent),o=null),o||s.addEventListener(i,this.handleEvent,{passive:l})}for(let i in r)i!="scroll"&&!n[i]&&s.removeEventListener(i,this.handleEvent);this.handlers=n}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&e.keyCode!=27&&xN.indexOf(e.keyCode)<0&&(this.tabFocusMode=-1),ve.android&&ve.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let n;return ve.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((n=gN.find(r=>r.keyCode==e.keyCode))&&!e.ctrlKey||TD.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=n||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(e){let n=this.pendingIOSKey;return!n||n.key=="Enter"&&e&&e.from<e.to&&/^\S+$/.test(e.insert.toString())?!1:(this.pendingIOSKey=void 0,xa(this.view.contentDOM,n.key,n.keyCode,n instanceof KeyboardEvent?n:void 0))}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:ve.safari&&!ve.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.view.observer.update(e),this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function _v(t,e){return(n,r)=>{try{return e.call(t,r,n)}catch(s){cs(n.state,s)}}}function MD(t){let e=Object.create(null);function n(r){return e[r]||(e[r]={observers:[],handlers:[]})}for(let r of t){let s=r.spec,i=s&&s.plugin.domEventHandlers,l=s&&s.plugin.domEventObservers;if(i)for(let o in i){let c=i[o];c&&n(o).handlers.push(_v(r.value,c))}if(l)for(let o in l){let c=l[o];c&&n(o).observers.push(_v(r.value,c))}}for(let r in Hr)n(r).handlers.push(Hr[r]);for(let r in Er)n(r).observers.push(Er[r]);return e}const gN=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],TD="dthko",xN=[16,17,18,20,91,92,224,225],Ou=6;function Iu(t){return Math.max(0,t)*.7+8}function RD(t,e){return Math.max(Math.abs(t.clientX-e.clientX),Math.abs(t.clientY-e.clientY))}class DD{constructor(e,n,r,s){this.view=e,this.startEvent=n,this.style=r,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=n,this.scrollParents=$R(e.contentDOM),this.atoms=e.state.facet(tf).map(l=>l(e));let i=e.contentDOM.ownerDocument;i.addEventListener("mousemove",this.move=this.move.bind(this)),i.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=n.shiftKey,this.multiple=e.state.facet(Ze.allowMultipleSelections)&&LD(e,n),this.dragging=ID(e,n)&&vN(n)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&RD(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let n=0,r=0,s=0,i=0,l=this.view.win.innerWidth,o=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:l}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:i,bottom:o}=this.scrollParents.y.getBoundingClientRect());let c=dN(this.view);e.clientX-c.left<=s+Ou?n=-Iu(s-e.clientX):e.clientX+c.right>=l-Ou&&(n=Iu(e.clientX-l)),e.clientY-c.top<=i+Ou?r=-Iu(i-e.clientY):e.clientY+c.bottom>=o-Ou&&(r=Iu(e.clientY-o)),this.setScrollSpeed(n,r)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,n){this.scrollSpeed={x:e,y:n},e||n?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:e,y:n}=this.scrollSpeed;e&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=e,e=0),n&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=n,n=0),(e||n)&&this.view.win.scrollBy(e,n),this.dragging===!1&&this.select(this.lastEvent)}select(e){let{view:n}=this,r=pN(this.atoms,this.style.get(e,this.extend,this.multiple));(this.mustSelect||!r.eq(n.state.selection,this.dragging===!1))&&this.view.dispatch({selection:r,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){e.transactions.some(n=>n.isUserEvent("input.type"))?this.destroy():this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function LD(t,e){let n=t.state.facet(JS);return n.length?n[0](e):ve.mac?e.metaKey:e.ctrlKey}function OD(t,e){let n=t.state.facet(YS);return n.length?n[0](e):ve.mac?!e.altKey:!e.ctrlKey}function ID(t,e){let{main:n}=t.state.selection;if(n.empty)return!1;let r=Rc(t.root);if(!r||r.rangeCount==0)return!0;let s=r.getRangeAt(0).getClientRects();for(let i=0;i<s.length;i++){let l=s[i];if(l.left<=e.clientX&&l.right>=e.clientX&&l.top<=e.clientY&&l.bottom>=e.clientY)return!0}return!1}function FD(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target,r;n!=t.contentDOM;n=n.parentNode)if(!n||n.nodeType==11||(r=ct.get(n))&&r.ignoreEvent(e))return!1;return!0}const Hr=Object.create(null),Er=Object.create(null),yN=ve.ie&&ve.ie_version<15||ve.ios&&ve.webkit_version<604;function BD(t){let e=t.dom.parentNode;if(!e)return;let n=e.appendChild(document.createElement("textarea"));n.style.cssText="position: fixed; left: -10000px; top: 10px",n.focus(),setTimeout(()=>{t.focus(),n.remove(),bN(t,n.value)},50)}function nf(t,e,n){for(let r of t.facet(e))n=r(n,t);return n}function bN(t,e){e=nf(t.state,j0,e);let{state:n}=t,r,s=1,i=n.toText(e),l=i.lines==n.selection.ranges.length;if(Tg!=null&&n.selection.ranges.every(c=>c.empty)&&Tg==i.toString()){let c=-1;r=n.changeByRange(u=>{let h=n.doc.lineAt(u.from);if(h.from==c)return{range:u};c=h.from;let d=n.toText((l?i.line(s++).text:e)+n.lineBreak);return{changes:{from:h.from,insert:d},range:pe.cursor(u.from+d.length)}})}else l?r=n.changeByRange(c=>{let u=i.line(s++);return{changes:{from:c.from,to:c.to,insert:u.text},range:pe.cursor(c.from+u.length)}}):r=n.replaceSelection(i);t.dispatch(r,{userEvent:"input.paste",scrollIntoView:!0})}Er.scroll=t=>{t.inputState.lastScrollTop=t.scrollDOM.scrollTop,t.inputState.lastScrollLeft=t.scrollDOM.scrollLeft};Hr.keydown=(t,e)=>(t.inputState.setSelectionOrigin("select"),e.keyCode==27&&t.inputState.tabFocusMode!=0&&(t.inputState.tabFocusMode=Date.now()+2e3),!1);Er.touchstart=(t,e)=>{t.inputState.lastTouchTime=Date.now(),t.inputState.setSelectionOrigin("select.pointer")};Er.touchmove=t=>{t.inputState.setSelectionOrigin("select.pointer")};Hr.mousedown=(t,e)=>{if(t.observer.flush(),t.inputState.lastTouchTime>Date.now()-2e3)return!1;let n=null;for(let r of t.state.facet(ZS))if(n=r(t,e),n)break;if(!n&&e.button==0&&(n=UD(t,e)),n){let r=!t.hasFocus;t.inputState.startMouseSelection(new DD(t,e,n,r)),r&&t.observer.ignore(()=>{TS(t.contentDOM);let i=t.root.activeElement;i&&!i.contains(t.contentDOM)&&i.blur()});let s=t.inputState.mouseSelection;if(s)return s.start(e),s.dragging===!1}else t.inputState.setSelectionOrigin("select.pointer");return!1};function Mv(t,e,n,r){if(r==1)return pe.cursor(e,n);if(r==2)return mD(t.state,e,n);{let s=Lt.find(t.docView,e),i=t.state.doc.lineAt(s?s.posAtEnd:e),l=s?s.posAtStart:i.from,o=s?s.posAtEnd:i.to;return o<t.state.doc.length&&o==i.to&&o++,pe.range(l,o)}}let Tv=(t,e,n)=>e>=n.top&&e<=n.bottom&&t>=n.left&&t<=n.right;function zD(t,e,n,r){let s=Lt.find(t.docView,e);if(!s)return 1;let i=e-s.posAtStart;if(i==0)return 1;if(i==s.length)return-1;let l=s.coordsAt(i,-1);if(l&&Tv(n,r,l))return-1;let o=s.coordsAt(i,1);return o&&Tv(n,r,o)?1:l&&l.bottom>=r?-1:1}function Rv(t,e){let n=t.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:n,bias:zD(t,n,e.clientX,e.clientY)}}const $D=ve.ie&&ve.ie_version<=11;let Dv=null,Lv=0,Ov=0;function vN(t){if(!$D)return t.detail;let e=Dv,n=Ov;return Dv=t,Ov=Date.now(),Lv=!e||n>Date.now()-400&&Math.abs(e.clientX-t.clientX)<2&&Math.abs(e.clientY-t.clientY)<2?(Lv+1)%3:1}function UD(t,e){let n=Rv(t,e),r=vN(e),s=t.state.selection;return{update(i){i.docChanged&&(n.pos=i.changes.mapPos(n.pos),s=s.map(i.changes))},get(i,l,o){let c=Rv(t,i),u,h=Mv(t,c.pos,c.bias,r);if(n.pos!=c.pos&&!l){let d=Mv(t,n.pos,n.bias,r),f=Math.min(d.from,h.from),p=Math.max(d.to,h.to);h=f<h.from?pe.range(f,p):pe.range(p,f)}return l?s.replaceRange(s.main.extend(h.from,h.to)):o&&r==1&&s.ranges.length>1&&(u=HD(s,c.pos))?u:o?s.addRange(h):pe.create([h])}}}function HD(t,e){for(let n=0;n<t.ranges.length;n++){let{from:r,to:s}=t.ranges[n];if(r<=e&&s>=e)return pe.create(t.ranges.slice(0,n).concat(t.ranges.slice(n+1)),t.mainIndex==n?0:t.mainIndex-(t.mainIndex>n?1:0))}return null}Hr.dragstart=(t,e)=>{let{selection:{main:n}}=t.state;if(e.target.draggable){let s=t.docView.nearest(e.target);if(s&&s.isWidget){let i=s.posAtStart,l=i+s.length;(i>=n.to||l<=n.from)&&(n=pe.range(i,l))}}let{inputState:r}=t;return r.mouseSelection&&(r.mouseSelection.dragging=!0),r.draggedContent=n,e.dataTransfer&&(e.dataTransfer.setData("Text",nf(t.state,S0,t.state.sliceDoc(n.from,n.to))),e.dataTransfer.effectAllowed="copyMove"),!1};Hr.dragend=t=>(t.inputState.draggedContent=null,!1);function Iv(t,e,n,r){if(n=nf(t.state,j0,n),!n)return;let s=t.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:i}=t.inputState,l=r&&i&&OD(t,e)?{from:i.from,to:i.to}:null,o={from:s,insert:n},c=t.state.changes(l?[l,o]:o);t.focus(),t.dispatch({changes:c,selection:{anchor:c.mapPos(s,-1),head:c.mapPos(s,1)},userEvent:l?"move.drop":"input.drop"}),t.inputState.draggedContent=null}Hr.drop=(t,e)=>{if(!e.dataTransfer)return!1;if(t.state.readOnly)return!0;let n=e.dataTransfer.files;if(n&&n.length){let r=Array(n.length),s=0,i=()=>{++s==n.length&&Iv(t,e,r.filter(l=>l!=null).join(t.state.lineBreak),!1)};for(let l=0;l<n.length;l++){let o=new FileReader;o.onerror=i,o.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(o.result)||(r[l]=o.result),i()},o.readAsText(n[l])}return!0}else{let r=e.dataTransfer.getData("Text");if(r)return Iv(t,e,r,!0),!0}return!1};Hr.paste=(t,e)=>{if(t.state.readOnly)return!0;t.observer.flush();let n=yN?null:e.clipboardData;return n?(bN(t,n.getData("text/plain")||n.getData("text/uri-list")),!0):(BD(t),!1)};function qD(t,e){let n=t.dom.parentNode;if(!n)return;let r=n.appendChild(document.createElement("textarea"));r.style.cssText="position: fixed; left: -10000px; top: 10px",r.value=e,r.focus(),r.selectionEnd=e.length,r.selectionStart=0,setTimeout(()=>{r.remove(),t.focus()},50)}function VD(t){let e=[],n=[],r=!1;for(let s of t.selection.ranges)s.empty||(e.push(t.sliceDoc(s.from,s.to)),n.push(s));if(!e.length){let s=-1;for(let{from:i}of t.selection.ranges){let l=t.doc.lineAt(i);l.number>s&&(e.push(l.text),n.push({from:l.from,to:Math.min(t.doc.length,l.to+1)})),s=l.number}r=!0}return{text:nf(t,S0,e.join(t.lineBreak)),ranges:n,linewise:r}}let Tg=null;Hr.copy=Hr.cut=(t,e)=>{let{text:n,ranges:r,linewise:s}=VD(t.state);if(!n&&!s)return!1;Tg=s?n:null,e.type=="cut"&&!t.state.readOnly&&t.dispatch({changes:r,scrollIntoView:!0,userEvent:"delete.cut"});let i=yN?null:e.clipboardData;return i?(i.clearData(),i.setData("text/plain",n),!0):(qD(t,n),!1)};const wN=ro.define();function kN(t,e){let n=[];for(let r of t.facet(nN)){let s=r(t,e);s&&n.push(s)}return n.length?t.update({effects:n,annotations:wN.of(!0)}):null}function jN(t){setTimeout(()=>{let e=t.hasFocus;if(e!=t.inputState.notifiedFocused){let n=kN(t.state,e);n?t.dispatch(n):t.update([])}},10)}Er.focus=t=>{t.inputState.lastFocusTime=Date.now(),!t.scrollDOM.scrollTop&&(t.inputState.lastScrollTop||t.inputState.lastScrollLeft)&&(t.scrollDOM.scrollTop=t.inputState.lastScrollTop,t.scrollDOM.scrollLeft=t.inputState.lastScrollLeft),jN(t)};Er.blur=t=>{t.observer.clearSelectionRange(),jN(t)};Er.compositionstart=Er.compositionupdate=t=>{t.observer.editContext||(t.inputState.compositionFirstChange==null&&(t.inputState.compositionFirstChange=!0),t.inputState.composing<0&&(t.inputState.composing=0))};Er.compositionend=t=>{t.observer.editContext||(t.inputState.composing=-1,t.inputState.compositionEndedAt=Date.now(),t.inputState.compositionPendingKey=!0,t.inputState.compositionPendingChange=t.observer.pendingRecords().length>0,t.inputState.compositionFirstChange=null,ve.chrome&&ve.android?t.observer.flushSoon():t.inputState.compositionPendingChange?Promise.resolve().then(()=>t.observer.flush()):setTimeout(()=>{t.inputState.composing<0&&t.docView.hasComposition&&t.update([])},50))};Er.contextmenu=t=>{t.inputState.lastContextMenu=Date.now()};Hr.beforeinput=(t,e)=>{var n,r;if(e.inputType=="insertReplacementText"&&t.observer.editContext){let i=(n=e.dataTransfer)===null||n===void 0?void 0:n.getData("text/plain"),l=e.getTargetRanges();if(i&&l.length){let o=l[0],c=t.posAtDOM(o.startContainer,o.startOffset),u=t.posAtDOM(o.endContainer,o.endOffset);return C0(t,{from:c,to:u,insert:t.state.toText(i)},null),!0}}let s;if(ve.chrome&&ve.android&&(s=gN.find(i=>i.inputType==e.inputType))&&(t.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let i=((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0;setTimeout(()=>{var l;(((l=window.visualViewport)===null||l===void 0?void 0:l.height)||0)>i+10&&t.hasFocus&&(t.contentDOM.blur(),t.focus())},100)}return ve.ios&&e.inputType=="deleteContentForward"&&t.observer.flushSoon(),ve.safari&&e.inputType=="insertText"&&t.inputState.composing>=0&&setTimeout(()=>Er.compositionend(t,e),20),!1};const Fv=new Set;function WD(t){Fv.has(t)||(Fv.add(t),t.addEventListener("copy",()=>{}),t.addEventListener("cut",()=>{}))}const Bv=["pre-wrap","normal","pre-line","break-spaces"];let Wa=!1;function zv(){Wa=!1}class KD{constructor(e){this.lineWrapping=e,this.doc=Ge.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(e,n){let r=this.doc.lineAt(n).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(r+=Math.max(0,Math.ceil((n-e-r*this.lineLength*.5)/this.lineLength))),this.lineHeight*r}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/Math.max(1,this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return Bv.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let n=!1;for(let r=0;r<e.length;r++){let s=e[r];s<0?r++:this.heightSamples[Math.floor(s*10)]||(n=!0,this.heightSamples[Math.floor(s*10)]=!0)}return n}refresh(e,n,r,s,i,l){let o=Bv.indexOf(e)>-1,c=Math.round(n)!=Math.round(this.lineHeight)||this.lineWrapping!=o;if(this.lineWrapping=o,this.lineHeight=n,this.charWidth=r,this.textHeight=s,this.lineLength=i,c){this.heightSamples={};for(let u=0;u<l.length;u++){let h=l[u];h<0?u++:this.heightSamples[Math.floor(h*10)]=!0}}return c}}class QD{constructor(e,n){this.from=e,this.heights=n,this.index=0}get more(){return this.index<this.heights.length}}class as{constructor(e,n,r,s,i){this.from=e,this.length=n,this.top=r,this.height=s,this._content=i}get type(){return typeof this._content=="number"?Mn.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Li?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let n=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new as(this.from,this.length+e.length,this.top,this.height+e.height,n)}}var mt=function(t){return t[t.ByPos=0]="ByPos",t[t.ByHeight=1]="ByHeight",t[t.ByPosNoHeight=2]="ByPosNoHeight",t}(mt||(mt={}));const jd=.001;class Tn{constructor(e,n,r=2){this.length=e,this.height=n,this.flags=r}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e){this.height!=e&&(Math.abs(this.height-e)>jd&&(Wa=!0),this.height=e)}replace(e,n,r){return Tn.of(r)}decomposeLeft(e,n){n.push(this)}decomposeRight(e,n){n.push(this)}applyChanges(e,n,r,s){let i=this,l=r.doc;for(let o=s.length-1;o>=0;o--){let{fromA:c,toA:u,fromB:h,toB:d}=s[o],f=i.lineAt(c,mt.ByPosNoHeight,r.setDoc(n),0,0),p=f.to>=u?f:i.lineAt(u,mt.ByPosNoHeight,r,0,0);for(d+=p.to-u,u=p.to;o>0&&f.from<=s[o-1].toA;)c=s[o-1].fromA,h=s[o-1].fromB,o--,c<f.from&&(f=i.lineAt(c,mt.ByPosNoHeight,r,0,0));h+=f.from-c,c=f.from;let m=A0.build(r.setDoc(l),e,h,d);i=mh(i,i.replace(c,u,m))}return i.updateHeight(r,0)}static empty(){return new Zn(0,0)}static of(e){if(e.length==1)return e[0];let n=0,r=e.length,s=0,i=0;for(;;)if(n==r)if(s>i*2){let o=e[n-1];o.break?e.splice(--n,1,o.left,null,o.right):e.splice(--n,1,o.left,o.right),r+=1+o.break,s-=o.size}else if(i>s*2){let o=e[r];o.break?e.splice(r,1,o.left,null,o.right):e.splice(r,1,o.left,o.right),r+=2+o.break,i-=o.size}else break;else if(s<i){let o=e[n++];o&&(s+=o.size)}else{let o=e[--r];o&&(i+=o.size)}let l=0;return e[n-1]==null?(l=1,n--):e[n]==null&&(l=1,r++),new GD(Tn.of(e.slice(0,n)),l,Tn.of(e.slice(r)))}}function mh(t,e){return t==e?t:(t.constructor!=e.constructor&&(Wa=!0),e)}Tn.prototype.size=1;class SN extends Tn{constructor(e,n,r){super(e,n),this.deco=r}blockAt(e,n,r,s){return new as(s,this.length,r,this.height,this.deco||0)}lineAt(e,n,r,s,i){return this.blockAt(0,r,s,i)}forEachLine(e,n,r,s,i,l){e<=i+this.length&&n>=i&&l(this.blockAt(0,r,s,i))}updateHeight(e,n=0,r=!1,s){return s&&s.from<=n&&s.more&&this.setHeight(s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Zn extends SN{constructor(e,n){super(e,n,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,n,r,s){return new as(s,this.length,r,this.height,this.breaks)}replace(e,n,r){let s=r[0];return r.length==1&&(s instanceof Zn||s instanceof tn&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof tn?s=new Zn(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):Tn.of(r)}updateHeight(e,n=0,r=!1,s){return s&&s.from<=n&&s.more?this.setHeight(s.heights[s.index++]):(r||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class tn extends Tn{constructor(e){super(e,0)}heightMetrics(e,n){let r=e.doc.lineAt(n).number,s=e.doc.lineAt(n+this.length).number,i=s-r+1,l,o=0;if(e.lineWrapping){let c=Math.min(this.height,e.lineHeight*i);l=c/i,this.length>i+1&&(o=(this.height-c)/(this.length-i-1))}else l=this.height/i;return{firstLine:r,lastLine:s,perLine:l,perChar:o}}blockAt(e,n,r,s){let{firstLine:i,lastLine:l,perLine:o,perChar:c}=this.heightMetrics(n,s);if(n.lineWrapping){let u=s+(e<n.lineHeight?0:Math.round(Math.max(0,Math.min(1,(e-r)/this.height))*this.length)),h=n.doc.lineAt(u),d=o+h.length*c,f=Math.max(r,e-d/2);return new as(h.from,h.length,f,d,0)}else{let u=Math.max(0,Math.min(l-i,Math.floor((e-r)/o))),{from:h,length:d}=n.doc.line(i+u);return new as(h,d,r+o*u,o,0)}}lineAt(e,n,r,s,i){if(n==mt.ByHeight)return this.blockAt(e,r,s,i);if(n==mt.ByPosNoHeight){let{from:p,to:m}=r.doc.lineAt(e);return new as(p,m-p,0,0,0)}let{firstLine:l,perLine:o,perChar:c}=this.heightMetrics(r,i),u=r.doc.lineAt(e),h=o+u.length*c,d=u.number-l,f=s+o*d+c*(u.from-i-d);return new as(u.from,u.length,Math.max(s,Math.min(f,s+this.height-h)),h,0)}forEachLine(e,n,r,s,i,l){e=Math.max(e,i),n=Math.min(n,i+this.length);let{firstLine:o,perLine:c,perChar:u}=this.heightMetrics(r,i);for(let h=e,d=s;h<=n;){let f=r.doc.lineAt(h);if(h==e){let m=f.number-o;d+=c*m+u*(e-i-m)}let p=c+u*f.length;l(new as(f.from,f.length,d,p,0)),d+=p,h=f.to+1}}replace(e,n,r){let s=this.length-n;if(s>0){let i=r[r.length-1];i instanceof tn?r[r.length-1]=new tn(i.length+s):r.push(null,new tn(s-1))}if(e>0){let i=r[0];i instanceof tn?r[0]=new tn(e+i.length):r.unshift(new tn(e-1),null)}return Tn.of(r)}decomposeLeft(e,n){n.push(new tn(e-1),null)}decomposeRight(e,n){n.push(null,new tn(this.length-e-1))}updateHeight(e,n=0,r=!1,s){let i=n+this.length;if(s&&s.from<=n+this.length&&s.more){let l=[],o=Math.max(n,s.from),c=-1;for(s.from>n&&l.push(new tn(s.from-n-1).updateHeight(e,n));o<=i&&s.more;){let h=e.doc.lineAt(o).length;l.length&&l.push(null);let d=s.heights[s.index++];c==-1?c=d:Math.abs(d-c)>=jd&&(c=-2);let f=new Zn(h,d);f.outdated=!1,l.push(f),o+=h+1}o<=i&&l.push(null,new tn(i-o).updateHeight(e,o));let u=Tn.of(l);return(c<0||Math.abs(u.height-this.height)>=jd||Math.abs(c-this.heightMetrics(e,n).perLine)>=jd)&&(Wa=!0),mh(this,u)}else(r||this.outdated)&&(this.setHeight(e.heightForGap(n,n+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class GD extends Tn{constructor(e,n,r){super(e.length+n+r.length,e.height+r.height,n|(e.outdated||r.outdated?2:0)),this.left=e,this.right=r,this.size=e.size+r.size}get break(){return this.flags&1}blockAt(e,n,r,s){let i=r+this.left.height;return e<i?this.left.blockAt(e,n,r,s):this.right.blockAt(e,n,i,s+this.left.length+this.break)}lineAt(e,n,r,s,i){let l=s+this.left.height,o=i+this.left.length+this.break,c=n==mt.ByHeight?e<l:e<o,u=c?this.left.lineAt(e,n,r,s,i):this.right.lineAt(e,n,r,l,o);if(this.break||(c?u.to<o:u.from>o))return u;let h=n==mt.ByPosNoHeight?mt.ByPosNoHeight:mt.ByPos;return c?u.join(this.right.lineAt(o,h,r,l,o)):this.left.lineAt(o,h,r,s,i).join(u)}forEachLine(e,n,r,s,i,l){let o=s+this.left.height,c=i+this.left.length+this.break;if(this.break)e<c&&this.left.forEachLine(e,n,r,s,i,l),n>=c&&this.right.forEachLine(e,n,r,o,c,l);else{let u=this.lineAt(c,mt.ByPos,r,s,i);e<u.from&&this.left.forEachLine(e,u.from-1,r,s,i,l),u.to>=e&&u.from<=n&&l(u),n>u.to&&this.right.forEachLine(u.to+1,n,r,o,c,l)}}replace(e,n,r){let s=this.left.length+this.break;if(n<s)return this.balanced(this.left.replace(e,n,r),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-s,n-s,r));let i=[];e>0&&this.decomposeLeft(e,i);let l=i.length;for(let o of r)i.push(o);if(e>0&&$v(i,l-1),n<this.length){let o=i.length;this.decomposeRight(n,i),$v(i,o)}return Tn.of(i)}decomposeLeft(e,n){let r=this.left.length;if(e<=r)return this.left.decomposeLeft(e,n);n.push(this.left),this.break&&(r++,e>=r&&n.push(null)),e>r&&this.right.decomposeLeft(e-r,n)}decomposeRight(e,n){let r=this.left.length,s=r+this.break;if(e>=s)return this.right.decomposeRight(e-s,n);e<r&&this.left.decomposeRight(e,n),this.break&&e<s&&n.push(null),n.push(this.right)}balanced(e,n){return e.size>2*n.size||n.size>2*e.size?Tn.of(this.break?[e,null,n]:[e,n]):(this.left=mh(this.left,e),this.right=mh(this.right,n),this.setHeight(e.height+n.height),this.outdated=e.outdated||n.outdated,this.size=e.size+n.size,this.length=e.length+this.break+n.length,this)}updateHeight(e,n=0,r=!1,s){let{left:i,right:l}=this,o=n+i.length+this.break,c=null;return s&&s.from<=n+i.length&&s.more?c=i=i.updateHeight(e,n,r,s):i.updateHeight(e,n,r),s&&s.from<=o+l.length&&s.more?c=l=l.updateHeight(e,o,r,s):l.updateHeight(e,o,r),c?this.balanced(i,l):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function $v(t,e){let n,r;t[e]==null&&(n=t[e-1])instanceof tn&&(r=t[e+1])instanceof tn&&t.splice(e-1,3,new tn(n.length+1+r.length))}const XD=5;class A0{constructor(e,n){this.pos=e,this.oracle=n,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,n){if(this.lineStart>-1){let r=Math.min(n,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof Zn?s.length+=r-this.pos:(r>this.pos||!this.isCovered)&&this.nodes.push(new Zn(r-this.pos,-1)),this.writtenTo=r,n>r&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=n}point(e,n,r){if(e<n||r.heightRelevant){let s=r.widget?r.widget.estimatedHeight:0,i=r.widget?r.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let l=n-e;r.block?this.addBlock(new SN(l,s,r)):(l||i||s>=XD)&&this.addLineDeco(s,i,l)}else n>e&&this.span(e,n);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:n}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=n,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new Zn(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,n){let r=new tn(n-e);return this.oracle.doc.lineAt(e).to==n&&(r.flags|=4),r}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof Zn)return e;let n=new Zn(0,-1);return this.nodes.push(n),n}addBlock(e){this.enterLine();let n=e.deco;n&&n.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,n&&n.endSide>0&&(this.covering=e)}addLineDeco(e,n,r){let s=this.ensureLine();s.length+=r,s.collapsed+=r,s.widgetHeight=Math.max(s.widgetHeight,e),s.breaks+=n,this.writtenTo=this.pos=this.pos+r}finish(e){let n=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(n instanceof Zn)&&!this.isCovered?this.nodes.push(new Zn(0,-1)):(this.writtenTo<this.pos||n==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let r=e;for(let s of this.nodes)s instanceof Zn&&s.updateHeight(this.oracle,r),r+=s?s.length:1;return this.nodes}static build(e,n,r,s){let i=new A0(r,e);return nt.spans(n,r,s,i,0),i.finish(r)}}function JD(t,e,n){let r=new YD;return nt.compare(t,e,n,r,0),r.changes}class YD{constructor(){this.changes=[]}compareRange(){}comparePoint(e,n,r,s){(e<n||r&&r.heightRelevant||s&&s.heightRelevant)&&wd(e,n,this.changes,5)}}function ZD(t,e){let n=t.getBoundingClientRect(),r=t.ownerDocument,s=r.defaultView||window,i=Math.max(0,n.left),l=Math.min(s.innerWidth,n.right),o=Math.max(0,n.top),c=Math.min(s.innerHeight,n.bottom);for(let u=t.parentNode;u&&u!=r.body;)if(u.nodeType==1){let h=u,d=window.getComputedStyle(h);if((h.scrollHeight>h.clientHeight||h.scrollWidth>h.clientWidth)&&d.overflow!="visible"){let f=h.getBoundingClientRect();i=Math.max(i,f.left),l=Math.min(l,f.right),o=Math.max(o,f.top),c=Math.min(u==t.parentNode?s.innerHeight:c,f.bottom)}u=d.position=="absolute"||d.position=="fixed"?h.offsetParent:h.parentNode}else if(u.nodeType==11)u=u.host;else break;return{left:i-n.left,right:Math.max(i,l)-n.left,top:o-(n.top+e),bottom:Math.max(o,c)-(n.top+e)}}function e6(t){let e=t.getBoundingClientRect(),n=t.ownerDocument.defaultView||window;return e.left<n.innerWidth&&e.right>0&&e.top<n.innerHeight&&e.bottom>0}function t6(t,e){let n=t.getBoundingClientRect();return{left:0,right:n.right-n.left,top:e,bottom:n.bottom-(n.top+e)}}class up{constructor(e,n,r,s){this.from=e,this.to=n,this.size=r,this.displaySize=s}static same(e,n){if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++){let s=e[r],i=n[r];if(s.from!=i.from||s.to!=i.to||s.size!=i.size)return!1}return!0}draw(e,n){return Vt.replace({widget:new n6(this.displaySize*(n?e.scaleY:e.scaleX),n)}).range(this.from,this.to)}}class n6 extends w0{constructor(e,n){super(),this.size=e,this.vertical=n}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class Uv{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Hv,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=Et.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let n=e.facet(N0).some(r=>typeof r!="function"&&r.class=="cm-lineWrapping");this.heightOracle=new KD(n),this.stateDeco=e.facet(Lc).filter(r=>typeof r!="function"),this.heightMap=Tn.empty().applyChanges(this.stateDeco,Ge.empty,this.heightOracle.setDoc(e.doc),[new Sr(0,0,0,e.doc.length)]);for(let r=0;r<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());r++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=Vt.set(this.lineGaps.map(r=>r.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:n}=this.state.selection;for(let r=0;r<=1;r++){let s=r?n.head:n.anchor;if(!e.some(({from:i,to:l})=>s>=i&&s<=l)){let{from:i,to:l}=this.lineBlockAt(s);e.push(new Fu(i,l))}}return this.viewports=e.sort((r,s)=>r.from-s.from),this.updateScaler()}updateScaler(){let e=this.scaler;return this.scaler=this.heightMap.height<=7e6?Hv:new E0(this.heightOracle,this.heightMap,this.viewports),e.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(zo(e,this.scaler))})}update(e,n=null){this.state=e.state;let r=this.stateDeco;this.stateDeco=this.state.facet(Lc).filter(h=>typeof h!="function");let s=e.changedRanges,i=Sr.extendWithRanges(s,JD(r,this.stateDeco,e?e.changes:Xt.empty(this.state.doc.length))),l=this.heightMap.height,o=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);zv(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),i),(this.heightMap.height!=l||Wa)&&(e.flags|=2),o?(this.scrollAnchorPos=e.changes.mapPos(o.from,-1),this.scrollAnchorHeight=o.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=l);let c=i.length?this.mapViewport(this.viewport,e.changes):this.viewport;(n&&(n.range.head<c.from||n.range.head>c.to)||!this.viewportIsAppropriate(c))&&(c=this.getViewport(0,n));let u=c.from!=this.viewport.from||c.to!=this.viewport.to;this.viewport=c,e.flags|=this.updateForViewport(),(u||!e.changes.empty||e.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(e.changes),n&&(this.scrollTarget=n),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(sN)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let n=e.contentDOM,r=window.getComputedStyle(n),s=this.heightOracle,i=r.whiteSpace;this.defaultTextDirection=r.direction=="rtl"?Et.RTL:Et.LTR;let l=this.heightOracle.mustRefreshForWrapping(i),o=n.getBoundingClientRect(),c=l||this.mustMeasureContent||this.contentDOMHeight!=o.height;this.contentDOMHeight=o.height,this.mustMeasureContent=!1;let u=0,h=0;if(o.width&&o.height){let{scaleX:k,scaleY:S}=MS(n,o);(k>.005&&Math.abs(this.scaleX-k)>.005||S>.005&&Math.abs(this.scaleY-S)>.005)&&(this.scaleX=k,this.scaleY=S,u|=16,l=c=!0)}let d=(parseInt(r.paddingTop)||0)*this.scaleY,f=(parseInt(r.paddingBottom)||0)*this.scaleY;(this.paddingTop!=d||this.paddingBottom!=f)&&(this.paddingTop=d,this.paddingBottom=f,u|=18),this.editorWidth!=e.scrollDOM.clientWidth&&(s.lineWrapping&&(c=!0),this.editorWidth=e.scrollDOM.clientWidth,u|=16);let p=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=p&&(this.scrollAnchorHeight=-1,this.scrollTop=p),this.scrolledToBottom=DS(e.scrollDOM);let m=(this.printing?t6:ZD)(n,this.paddingTop),x=m.top-this.pixelViewport.top,v=m.bottom-this.pixelViewport.bottom;this.pixelViewport=m;let g=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(g!=this.inView&&(this.inView=g,g&&(c=!0)),!this.inView&&!this.scrollTarget&&!e6(e.dom))return 0;let y=o.width;if((this.contentDOMWidth!=y||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=o.width,this.editorHeight=e.scrollDOM.clientHeight,u|=16),c){let k=e.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(k)&&(l=!0),l||s.lineWrapping&&Math.abs(y-this.contentDOMWidth)>s.charWidth){let{lineHeight:S,charWidth:j,textHeight:E}=e.docView.measureTextSize();l=S>0&&s.refresh(i,S,j,E,Math.max(5,y/j),k),l&&(e.docView.minWidth=0,u|=16)}x>0&&v>0?h=Math.max(x,v):x<0&&v<0&&(h=Math.min(x,v)),zv();for(let S of this.viewports){let j=S.from==this.viewport.from?k:e.docView.measureVisibleLineHeights(S);this.heightMap=(l?Tn.empty().applyChanges(this.stateDeco,Ge.empty,this.heightOracle,[new Sr(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(s,0,l,new QD(S.from,j))}Wa&&(u|=2)}let b=!this.viewportIsAppropriate(this.viewport,h)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return b&&(u&2&&(u|=this.updateScaler()),this.viewport=this.getViewport(h,this.scrollTarget),u|=this.updateForViewport()),(u&2||b)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(l?[]:this.lineGaps,e)),u|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),u}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,n){let r=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),s=this.heightMap,i=this.heightOracle,{visibleTop:l,visibleBottom:o}=this,c=new Fu(s.lineAt(l-r*1e3,mt.ByHeight,i,0,0).from,s.lineAt(o+(1-r)*1e3,mt.ByHeight,i,0,0).to);if(n){let{head:u}=n.range;if(u<c.from||u>c.to){let h=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),d=s.lineAt(u,mt.ByPos,i,0,0),f;n.y=="center"?f=(d.top+d.bottom)/2-h/2:n.y=="start"||n.y=="nearest"&&u<c.from?f=d.top:f=d.bottom-h,c=new Fu(s.lineAt(f-1e3/2,mt.ByHeight,i,0,0).from,s.lineAt(f+h+1e3/2,mt.ByHeight,i,0,0).to)}}return c}mapViewport(e,n){let r=n.mapPos(e.from,-1),s=n.mapPos(e.to,1);return new Fu(this.heightMap.lineAt(r,mt.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,mt.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:n},r=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(e,mt.ByPos,this.heightOracle,0,0),{bottom:i}=this.heightMap.lineAt(n,mt.ByPos,this.heightOracle,0,0),{visibleTop:l,visibleBottom:o}=this;return(e==0||s<=l-Math.max(10,Math.min(-r,250)))&&(n==this.state.doc.length||i>=o+Math.max(10,Math.min(r,250)))&&s>l-2*1e3&&i<o+2*1e3}mapLineGaps(e,n){if(!e.length||n.empty)return e;let r=[];for(let s of e)n.touchesRange(s.from,s.to)||r.push(new up(n.mapPos(s.from),n.mapPos(s.to),s.size,s.displaySize));return r}ensureLineGaps(e,n){let r=this.heightOracle.lineWrapping,s=r?1e4:2e3,i=s>>1,l=s<<1;if(this.defaultTextDirection!=Et.LTR&&!r)return[];let o=[],c=(h,d,f,p)=>{if(d-h<i)return;let m=this.state.selection.main,x=[m.from];m.empty||x.push(m.to);for(let g of x)if(g>h&&g<d){c(h,g-10,f,p),c(g+10,d,f,p);return}let v=s6(e,g=>g.from>=f.from&&g.to<=f.to&&Math.abs(g.from-h)<i&&Math.abs(g.to-d)<i&&!x.some(y=>g.from<y&&g.to>y));if(!v){if(d<f.to&&n&&r&&n.visibleRanges.some(b=>b.from<=d&&b.to>=d)){let b=n.moveToLineBoundary(pe.cursor(d),!1,!0).head;b>h&&(d=b)}let g=this.gapSize(f,h,d,p),y=r||g<2e6?g:2e6;v=new up(h,d,g,y)}o.push(v)},u=h=>{if(h.length<l||h.type!=Mn.Text)return;let d=r6(h.from,h.to,this.stateDeco);if(d.total<l)return;let f=this.scrollTarget?this.scrollTarget.range.head:null,p,m;if(r){let x=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,v,g;if(f!=null){let y=zu(d,f),b=((this.visibleBottom-this.visibleTop)/2+x)/h.height;v=y-b,g=y+b}else v=(this.visibleTop-h.top-x)/h.height,g=(this.visibleBottom-h.top+x)/h.height;p=Bu(d,v),m=Bu(d,g)}else{let x=d.total*this.heightOracle.charWidth,v=s*this.heightOracle.charWidth,g=0;if(x>2e6)for(let j of e)j.from>=h.from&&j.from<h.to&&j.size!=j.displaySize&&j.from*this.heightOracle.charWidth+g<this.pixelViewport.left&&(g=j.size-j.displaySize);let y=this.pixelViewport.left+g,b=this.pixelViewport.right+g,k,S;if(f!=null){let j=zu(d,f),E=((b-y)/2+v)/x;k=j-E,S=j+E}else k=(y-v)/x,S=(b+v)/x;p=Bu(d,k),m=Bu(d,S)}p>h.from&&c(h.from,p,h,d),m<h.to&&c(m,h.to,h,d)};for(let h of this.viewportLines)Array.isArray(h.type)?h.type.forEach(u):u(h);return o}gapSize(e,n,r,s){let i=zu(s,r)-zu(s,n);return this.heightOracle.lineWrapping?e.height*i:s.total*this.heightOracle.charWidth*i}updateLineGaps(e){up.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=Vt.set(e.map(n=>n.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(e){let n=this.stateDeco;this.lineGaps.length&&(n=n.concat(this.lineGapDeco));let r=[];nt.spans(n,this.viewport.from,this.viewport.to,{span(i,l){r.push({from:i,to:l})},point(){}},20);let s=0;if(r.length!=this.visibleRanges.length)s=12;else for(let i=0;i<r.length&&!(s&8);i++){let l=this.visibleRanges[i],o=r[i];(l.from!=o.from||l.to!=o.to)&&(s|=4,e&&e.mapPos(l.from,-1)==o.from&&e.mapPos(l.to,1)==o.to||(s|=8))}return this.visibleRanges=r,s}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(n=>n.from<=e&&n.to>=e)||zo(this.heightMap.lineAt(e,mt.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return e>=this.viewportLines[0].top&&e<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(n=>n.top<=e&&n.bottom>=e)||zo(this.heightMap.lineAt(this.scaler.fromDOM(e),mt.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let n=this.lineBlockAtHeight(e+8);return n.from>=this.viewport.from||this.viewportLines[0].top-e>200?n:this.viewportLines[0]}elementAtHeight(e){return zo(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Fu{constructor(e,n){this.from=e,this.to=n}}function r6(t,e,n){let r=[],s=t,i=0;return nt.spans(n,t,e,{span(){},point(l,o){l>s&&(r.push({from:s,to:l}),i+=l-s),s=o}},20),s<e&&(r.push({from:s,to:e}),i+=e-s),{total:i,ranges:r}}function Bu({total:t,ranges:e},n){if(n<=0)return e[0].from;if(n>=1)return e[e.length-1].to;let r=Math.floor(t*n);for(let s=0;;s++){let{from:i,to:l}=e[s],o=l-i;if(r<=o)return i+r;r-=o}}function zu(t,e){let n=0;for(let{from:r,to:s}of t.ranges){if(e<=s){n+=e-r;break}n+=s-r}return n/t.total}function s6(t,e){for(let n of t)if(e(n))return n}const Hv={toDOM(t){return t},fromDOM(t){return t},scale:1,eq(t){return t==this}};class E0{constructor(e,n,r){let s=0,i=0,l=0;this.viewports=r.map(({from:o,to:c})=>{let u=n.lineAt(o,mt.ByPos,e,0,0).top,h=n.lineAt(c,mt.ByPos,e,0,0).bottom;return s+=h-u,{from:o,to:c,top:u,bottom:h,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(n.height-s);for(let o of this.viewports)o.domTop=l+(o.top-i)*this.scale,l=o.domBottom=o.domTop+(o.bottom-o.top),i=o.bottom}toDOM(e){for(let n=0,r=0,s=0;;n++){let i=n<this.viewports.length?this.viewports[n]:null;if(!i||e<i.top)return s+(e-r)*this.scale;if(e<=i.bottom)return i.domTop+(e-i.top);r=i.bottom,s=i.domBottom}}fromDOM(e){for(let n=0,r=0,s=0;;n++){let i=n<this.viewports.length?this.viewports[n]:null;if(!i||e<i.domTop)return r+(e-s)/this.scale;if(e<=i.domBottom)return i.top+(e-i.domTop);r=i.bottom,s=i.domBottom}}eq(e){return e instanceof E0?this.scale==e.scale&&this.viewports.length==e.viewports.length&&this.viewports.every((n,r)=>n.from==e.viewports[r].from&&n.to==e.viewports[r].to):!1}}function zo(t,e){if(e.scale==1)return t;let n=e.toDOM(t.top),r=e.toDOM(t.bottom);return new as(t.from,t.length,n,r-n,Array.isArray(t._content)?t._content.map(s=>zo(s,e)):t._content)}const $u=_e.define({combine:t=>t.join(" ")}),Rg=_e.define({combine:t=>t.indexOf(!0)>-1}),Dg=Ri.newName(),NN=Ri.newName(),CN=Ri.newName(),AN={"&light":"."+NN,"&dark":"."+CN};function Lg(t,e,n){return new Ri(e,{finish(r){return/&/.test(r)?r.replace(/&\w*/,s=>{if(s=="&")return t;if(!n||!n[s])throw new RangeError(`Unsupported selector: ${s}`);return n[s]}):t+" "+r}})}const i6=Lg("."+Dg,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#ddd"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",zIndex:200},".cm-gutters-before":{insetInlineStart:0},".cm-gutters-after":{insetInlineEnd:0},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",border:"0px solid #ddd","&.cm-gutters-before":{borderRightWidth:"1px"},"&.cm-gutters-after":{borderLeftWidth:"1px"}},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-dialog":{padding:"2px 19px 4px 6px",position:"relative","& label":{fontSize:"80%"}},".cm-dialog-close":{position:"absolute",top:"3px",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",fontSize:"14px",padding:"0"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top",userSelect:"none"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},AN),l6={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},dp=ve.ie&&ve.ie_version<=11;class a6{constructor(e){this.view=e,this.active=!1,this.editContext=null,this.selectionRange=new UR,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(n=>{for(let r of n)this.queue.push(r);(ve.ie&&ve.ie_version<=11||ve.ios&&e.composing)&&n.some(r=>r.type=="childList"&&r.removedNodes.length||r.type=="characterData"&&r.oldValue.length>r.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&ve.android&&e.constructor.EDIT_CONTEXT!==!1&&!(ve.chrome&&ve.chrome_version<126)&&(this.editContext=new c6(e),e.state.facet(As)&&(e.contentDOM.editContext=this.editContext.editContext)),dp&&(this.onCharData=n=>{this.queue.push({target:n.target,type:"characterData",oldValue:n.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var n;((n=this.view.docView)===null||n===void 0?void 0:n.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(n=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),n.length>0&&n[n.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(n=>{n.length>0&&n[n.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(e){(e.type=="change"||!e.type)&&!e.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((n,r)=>n!=e[r]))){this.gapIntersection.disconnect();for(let n of e)this.gapIntersection.observe(n);this.gaps=e}}onSelectionChange(e){let n=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:r}=this,s=this.selectionRange;if(r.state.facet(As)?r.root.activeElement!=this.dom:!vd(this.dom,s))return;let i=s.anchorNode&&r.docView.nearest(s.anchorNode);if(i&&i.ignoreEvent(e)){n||(this.selectionChanged=!1);return}(ve.ie&&ve.ie_version<=11||ve.android&&ve.chrome)&&!r.state.selection.main.empty&&s.focusNode&&ec(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,n=Rc(e.root);if(!n)return!1;let r=ve.safari&&e.root.nodeType==11&&e.root.activeElement==this.dom&&o6(this.view,n)||n;if(!r||this.selectionRange.eq(r))return!1;let s=vd(this.dom,r);return s&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&qR(this.dom,r)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(r),s&&(this.selectionChanged=!0),!0)}setSelectionRange(e,n){this.selectionRange.set(e.node,e.offset,n.node,n.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,n=null;for(let r=this.dom;r;)if(r.nodeType==1)!n&&e<this.scrollTargets.length&&this.scrollTargets[e]==r?e++:n||(n=this.scrollTargets.slice(0,e)),n&&n.push(r),r=r.assignedSlot||r.parentNode;else if(r.nodeType==11)r=r.host;else break;if(e<this.scrollTargets.length&&!n&&(n=this.scrollTargets.slice(0,e)),n){for(let r of this.scrollTargets)r.removeEventListener("scroll",this.onScroll);for(let r of this.scrollTargets=n)r.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,l6),dp&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),dp&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,n){var r;if(!this.delayedAndroidKey){let s=()=>{let i=this.delayedAndroidKey;i&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=i.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&i.force&&xa(this.dom,i.key,i.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:n,force:this.lastChange<Date.now()-50||!!(!((r=this.delayedAndroidKey)===null||r===void 0)&&r.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let n=-1,r=-1,s=!1;for(let i of e){let l=this.readMutation(i);l&&(l.typeOver&&(s=!0),n==-1?{from:n,to:r}=l:(n=Math.min(l.from,n),r=Math.max(l.to,r)))}return{from:n,to:r,typeOver:s}}readChange(){let{from:e,to:n,typeOver:r}=this.processRecords(),s=this.selectionChanged&&vd(this.dom,this.selectionRange);if(e<0&&!s)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let i=new ND(this.view,e,n,r);return this.view.docView.domChanged={newSel:i.newSel?i.newSel.main:null},i}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let n=this.readChange();if(!n)return this.view.requestMeasure(),!1;let r=this.view.state,s=mN(this.view,n);return this.view.state==r&&(n.domChanged||n.newSel&&!n.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(e){let n=this.view.docView.nearest(e.target);if(!n||n.ignoreMutation(e))return null;if(n.markDirty(e.type=="attributes"),e.type=="attributes"&&(n.flags|=4),e.type=="childList"){let r=qv(n,e.previousSibling||e.target.previousSibling,-1),s=qv(n,e.nextSibling||e.target.nextSibling,1);return{from:r?n.posAfter(r):n.posAtStart,to:s?n.posBefore(s):n.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}update(e){this.editContext&&(this.editContext.update(e),e.startState.facet(As)!=e.state.facet(As)&&(e.view.contentDOM.editContext=e.state.facet(As)?this.editContext.editContext:null))}destroy(){var e,n,r;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(n=this.gapIntersection)===null||n===void 0||n.disconnect(),(r=this.resizeScroll)===null||r===void 0||r.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function qv(t,e,n){for(;e;){let r=ct.get(e);if(r&&r.parent==t)return r;let s=e.parentNode;e=s!=t.dom?s:n>0?e.nextSibling:e.previousSibling}return null}function Vv(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,l=t.docView.domAtPos(t.state.selection.main.anchor);return ec(l.node,l.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function o6(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return Vv(t,s)}let n=null;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.contentDOM.addEventListener("beforeinput",r,!0),t.dom.ownerDocument.execCommand("indent"),t.contentDOM.removeEventListener("beforeinput",r,!0),n?Vv(t,n):null}class c6{constructor(e){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.composing=null,this.resetRange(e.state);let n=this.editContext=new window.EditContext({text:e.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,e.state.selection.main.anchor))),selectionEnd:this.toContextPos(e.state.selection.main.head)});this.handlers.textupdate=r=>{let s=e.state.selection.main,{anchor:i,head:l}=s,o=this.toEditorPos(r.updateRangeStart),c=this.toEditorPos(r.updateRangeEnd);e.inputState.composing>=0&&!this.composing&&(this.composing={contextBase:r.updateRangeStart,editorBase:o,drifted:!1});let u={from:o,to:c,insert:Ge.of(r.text.split(`
`))};if(u.from==this.from&&i<this.from?u.from=i:u.to==this.to&&i>this.to&&(u.to=i),u.from==u.to&&!u.insert.length){let h=pe.single(this.toEditorPos(r.selectionStart),this.toEditorPos(r.selectionEnd));h.main.eq(s)||e.dispatch({selection:h,userEvent:"select"});return}if((ve.mac||ve.android)&&u.from==l-1&&/^\. ?$/.test(r.text)&&e.contentDOM.getAttribute("autocorrect")=="off"&&(u={from:o,to:c,insert:Ge.of([r.text.replace("."," ")])}),this.pendingContextChange=u,!e.state.readOnly){let h=this.to-this.from+(u.to-u.from+u.insert.length);C0(e,u,pe.single(this.toEditorPos(r.selectionStart,h),this.toEditorPos(r.selectionEnd,h)))}this.pendingContextChange&&(this.revertPending(e.state),this.setSelection(e.state))},this.handlers.characterboundsupdate=r=>{let s=[],i=null;for(let l=this.toEditorPos(r.rangeStart),o=this.toEditorPos(r.rangeEnd);l<o;l++){let c=e.coordsForChar(l);i=c&&new DOMRect(c.left,c.top,c.right-c.left,c.bottom-c.top)||i||new DOMRect,s.push(i)}n.updateCharacterBounds(r.rangeStart,s)},this.handlers.textformatupdate=r=>{let s=[];for(let i of r.getTextFormats()){let l=i.underlineStyle,o=i.underlineThickness;if(l!="None"&&o!="None"){let c=this.toEditorPos(i.rangeStart),u=this.toEditorPos(i.rangeEnd);if(c<u){let h=`text-decoration: underline ${l=="Dashed"?"dashed ":l=="Squiggle"?"wavy ":""}${o=="Thin"?1:2}px`;s.push(Vt.mark({attributes:{style:h}}).range(c,u))}}}e.dispatch({effects:lN.of(Vt.set(s))})},this.handlers.compositionstart=()=>{e.inputState.composing<0&&(e.inputState.composing=0,e.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{if(e.inputState.composing=-1,e.inputState.compositionFirstChange=null,this.composing){let{drifted:r}=this.composing;this.composing=null,r&&this.reset(e.state)}};for(let r in this.handlers)n.addEventListener(r,this.handlers[r]);this.measureReq={read:r=>{this.editContext.updateControlBounds(r.contentDOM.getBoundingClientRect());let s=Rc(r.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(e){let n=0,r=!1,s=this.pendingContextChange;return e.changes.iterChanges((i,l,o,c,u)=>{if(r)return;let h=u.length-(l-i);if(s&&l>=s.to)if(s.from==i&&s.to==l&&s.insert.eq(u)){s=this.pendingContextChange=null,n+=h,this.to+=h;return}else s=null,this.revertPending(e.state);if(i+=n,l+=n,l<=this.from)this.from+=h,this.to+=h;else if(i<this.to){if(i<this.from||l>this.to||this.to-this.from+u.length>3e4){r=!0;return}this.editContext.updateText(this.toContextPos(i),this.toContextPos(l),u.toString()),this.to+=h}n+=h}),s&&!r&&this.revertPending(e.state),!r}update(e){let n=this.pendingContextChange,r=e.startState.selection.main;this.composing&&(this.composing.drifted||!e.changes.touchesRange(r.from,r.to)&&e.transactions.some(s=>!s.isUserEvent("input.type")&&s.changes.touchesRange(this.from,this.to)))?(this.composing.drifted=!0,this.composing.editorBase=e.changes.mapPos(this.composing.editorBase)):!this.applyEdits(e)||!this.rangeIsValid(e.state)?(this.pendingContextChange=null,this.reset(e.state)):(e.docChanged||e.selectionSet||n)&&this.setSelection(e.state),(e.geometryChanged||e.docChanged||e.selectionSet)&&e.view.requestMeasure(this.measureReq)}resetRange(e){let{head:n}=e.selection.main;this.from=Math.max(0,n-1e4),this.to=Math.min(e.doc.length,n+1e4)}reset(e){this.resetRange(e),this.editContext.updateText(0,this.editContext.text.length,e.doc.sliceString(this.from,this.to)),this.setSelection(e)}revertPending(e){let n=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(n.from),this.toContextPos(n.from+n.insert.length),e.doc.sliceString(n.from,n.to))}setSelection(e){let{main:n}=e.selection,r=this.toContextPos(Math.max(this.from,Math.min(this.to,n.anchor))),s=this.toContextPos(n.head);(this.editContext.selectionStart!=r||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(r,s)}rangeIsValid(e){let{head:n}=e.selection.main;return!(this.from>0&&n-this.from<500||this.to<e.doc.length&&this.to-n<500||this.to-this.from>1e4*3)}toEditorPos(e,n=this.to-this.from){e=Math.min(e,n);let r=this.composing;return r&&r.drifted?r.editorBase+(e-r.contextBase):e+this.from}toContextPos(e){let n=this.composing;return n&&n.drifted?n.contextBase+(e-n.editorBase):e-this.from}destroy(){for(let e in this.handlers)this.editContext.removeEventListener(e,this.handlers[e])}}class Oe{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return!!this.inputState&&this.inputState.composing>0}get compositionStarted(){return!!this.inputState&&this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){var n;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:r}=e;this.dispatchTransactions=e.dispatchTransactions||r&&(s=>s.forEach(i=>r(i,this)))||(s=>this.update(s)),this.dispatch=this.dispatch.bind(this),this._root=e.root||HR(e.parent)||document,this.viewState=new Uv(e.state||Ze.create(e)),e.scrollTo&&e.scrollTo.is(Lu)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(sa).map(s=>new ap(s));for(let s of this.plugins)s.update(this);this.observer=new a6(this),this.inputState=new _D(this),this.inputState.ensureHandlers(this.plugins),this.docView=new jv(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((n=document.fonts)===null||n===void 0)&&n.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...e){let n=e.length==1&&e[0]instanceof yn?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(n,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let n=!1,r=!1,s,i=this.state;for(let f of e){if(f.startState!=i)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");i=f.state}if(this.destroyed){this.viewState.state=i;return}let l=this.hasFocus,o=0,c=null;e.some(f=>f.annotation(wN))?(this.inputState.notifiedFocused=l,o=1):l!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=l,c=kN(i,l),c||(o=1));let u=this.observer.delayedAndroidKey,h=null;if(u?(this.observer.clearDelayedAndroidKey(),h=this.observer.readChange(),(h&&!this.state.doc.eq(i.doc)||!this.state.selection.eq(i.selection))&&(h=null)):this.observer.clear(),i.facet(Ze.phrases)!=this.state.facet(Ze.phrases))return this.setState(i);s=ph.create(this,i,e),s.flags|=o;let d=this.viewState.scrollTarget;try{this.updateState=2;for(let f of e){if(d&&(d=d.map(f.changes)),f.scrollIntoView){let{main:p}=f.state.selection;d=new ya(p.empty?p:pe.cursor(p.head,p.head>p.anchor?-1:1))}for(let p of f.effects)p.is(Lu)&&(d=p.value.clip(this.state))}this.viewState.update(s,d),this.bidiCache=gh.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),n=this.docView.update(s),this.state.facet(Fo)!=this.styleModules&&this.mountStyles(),r=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(n,e.some(f=>f.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet($u)!=s.state.facet($u)&&(this.viewState.mustMeasureContent=!0),(n||r||d||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),n&&this.docViewUpdate(),!s.empty)for(let f of this.state.facet(Pg))try{f(s)}catch(p){cs(this.state,p,"update listener")}(c||h)&&Promise.resolve().then(()=>{c&&this.state==c.startState&&this.dispatch(c),h&&!mN(this,h)&&u.force&&xa(this.contentDOM,u.key,u.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let n=this.hasFocus;try{for(let r of this.plugins)r.destroy(this);this.viewState=new Uv(e),this.plugins=e.facet(sa).map(r=>new ap(r)),this.pluginMap.clear();for(let r of this.plugins)r.update(this);this.docView.destroy(),this.docView=new jv(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}n&&this.focus(),this.requestMeasure()}updatePlugins(e){let n=e.startState.facet(sa),r=e.state.facet(sa);if(n!=r){let s=[];for(let i of r){let l=n.indexOf(i);if(l<0)s.push(new ap(i));else{let o=this.plugins[l];o.mustUpdate=e,s.push(o)}}for(let i of this.plugins)i.mustUpdate!=e&&i.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=e;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);n!=r&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let e of this.plugins){let n=e.value;if(n&&n.docViewUpdate)try{n.docViewUpdate(this)}catch(r){cs(this.state,r,"doc view update listener")}}}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let n=null,r=this.scrollDOM,s=r.scrollTop*this.scaleY,{scrollAnchorPos:i,scrollAnchorHeight:l}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(l=-1),this.viewState.scrollAnchorHeight=-1;try{for(let o=0;;o++){if(l<0)if(DS(r))i=-1,l=this.viewState.heightMap.height;else{let p=this.viewState.scrollAnchorAt(s);i=p.from,l=p.top}this.updateState=1;let c=this.viewState.measure(this);if(!c&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(o>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let u=[];c&4||([this.measureRequests,u]=[u,this.measureRequests]);let h=u.map(p=>{try{return p.read(this)}catch(m){return cs(this.state,m),Wv}}),d=ph.create(this,this.state,[]),f=!1;d.flags|=c,n?n.flags|=c:n=d,this.updateState=2,d.empty||(this.updatePlugins(d),this.inputState.update(d),this.updateAttrs(),f=this.docView.update(d),f&&this.docViewUpdate());for(let p=0;p<u.length;p++)if(h[p]!=Wv)try{let m=u[p];m.write&&m.write(h[p],this)}catch(m){cs(this.state,m)}if(f&&this.docView.updateSelection(!0),!d.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,l=-1;continue}else{let m=(i<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(i).top)-l;if(m>1||m<-1){s=s+m,r.scrollTop=s/this.scaleY,l=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(n&&!n.empty)for(let o of this.state.facet(Pg))o(n)}get themeClasses(){return Dg+" "+(this.state.facet(Rg)?CN:NN)+" "+this.state.facet($u)}updateAttrs(){let e=Kv(this,aN,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),n={spellcheck:"false",autocorrect:"off",autocapitalize:"off",writingsuggestions:"false",translate:"no",contenteditable:this.state.facet(As)?"true":"false",class:"cm-content",style:`${ve.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(n["aria-readonly"]="true"),Kv(this,N0,n);let r=this.observer.ignore(()=>{let s=Sg(this.contentDOM,this.contentAttrs,n),i=Sg(this.dom,this.editorAttrs,e);return s||i});return this.editorAttrs=e,this.contentAttrs=n,r}showAnnouncements(e){let n=!0;for(let r of e)for(let s of r.effects)if(s.is(Oe.announce)){n&&(this.announceDOM.textContent=""),n=!1;let i=this.announceDOM.appendChild(document.createElement("div"));i.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(Fo);let e=this.state.facet(Oe.cspNonce);Ri.mount(this.root,this.styleModules.concat(i6).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let n=0;n<this.measureRequests.length;n++)if(this.measureRequests[n].key===e.key){this.measureRequests[n]=e;return}}this.measureRequests.push(e)}}plugin(e){let n=this.pluginMap.get(e);return(n===void 0||n&&n.plugin!=e)&&this.pluginMap.set(e,n=this.plugins.find(r=>r.plugin==e)||null),n&&n.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,n,r){return cp(this,e,Ev(this,e,n,r))}moveByGroup(e,n){return cp(this,e,Ev(this,e,n,r=>wD(this,e.head,r)))}visualLineSide(e,n){let r=this.bidiSpans(e),s=this.textDirectionAt(e.from),i=r[n?r.length-1:0];return pe.cursor(i.side(n,s)+e.from,i.forward(!n,s)?1:-1)}moveToLineBoundary(e,n,r=!0){return vD(this,e,n,r)}moveVertically(e,n,r){return cp(this,e,kD(this,e,n,r))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,n=0){return this.docView.posFromDOM(e,n)}posAtCoords(e,n=!0){return this.readMeasured(),fN(this,e,n)}coordsAtPos(e,n=1){this.readMeasured();let r=this.docView.coordsAt(e,n);if(!r||r.left==r.right)return r;let s=this.state.doc.lineAt(e),i=this.bidiSpans(s),l=i[yi.find(i,e-s.from,-1,n)];return Zh(r,l.dir==Et.LTR==n>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(rN)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>u6)return GS(e.length);let n=this.textDirectionAt(e.from),r;for(let i of this.bidiCache)if(i.from==e.from&&i.dir==n&&(i.fresh||QS(i.isolates,r=kv(this,e))))return i.order;r||(r=kv(this,e));let s=sD(e.text,n,r);return this.bidiCache.push(new gh(e.from,e.to,n,r,!0,s)),s}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||ve.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{TS(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,n={}){return Lu.of(new ya(typeof e=="number"?pe.cursor(e):e,n.y,n.x,n.yMargin,n.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:n}=this.scrollDOM,r=this.viewState.scrollAnchorAt(e);return Lu.of(new ya(pe.cursor(r.from),"start","start",r.top-e,n,!0))}setTabFocusMode(e){e==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof e=="boolean"?this.inputState.tabFocusMode=e?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+e)}static domEventHandlers(e){return ps.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return ps.define(()=>({}),{eventObservers:e})}static theme(e,n){let r=Ri.newName(),s=[$u.of(r),Fo.of(Lg(`.${r}`,e))];return n&&n.dark&&s.push(Rg.of(!0)),s}static baseTheme(e){return Xh.lowest(Fo.of(Lg("."+Dg,e,AN)))}static findFromDOM(e){var n;let r=e.querySelector(".cm-content"),s=r&&ct.get(r)||ct.get(e);return((n=s==null?void 0:s.rootView)===null||n===void 0?void 0:n.view)||null}}Oe.styleModule=Fo;Oe.inputHandler=tN;Oe.clipboardInputFilter=j0;Oe.clipboardOutputFilter=S0;Oe.scrollHandler=iN;Oe.focusChangeEffect=nN;Oe.perLineTextDirection=rN;Oe.exceptionSink=eN;Oe.updateListener=Pg;Oe.editable=As;Oe.mouseSelectionStyle=ZS;Oe.dragMovesSelection=YS;Oe.clickAddsSelectionRange=JS;Oe.decorations=Lc;Oe.outerDecorations=oN;Oe.atomicRanges=tf;Oe.bidiIsolatedRanges=cN;Oe.scrollMargins=uN;Oe.darkTheme=Rg;Oe.cspNonce=_e.define({combine:t=>t.length?t[0]:""});Oe.contentAttributes=N0;Oe.editorAttributes=aN;Oe.lineWrapping=Oe.contentAttributes.of({class:"cm-lineWrapping"});Oe.announce=Ht.define();const u6=4096,Wv={};class gh{constructor(e,n,r,s,i,l){this.from=e,this.to=n,this.dir=r,this.isolates=s,this.fresh=i,this.order=l}static update(e,n){if(n.empty&&!e.some(i=>i.fresh))return e;let r=[],s=e.length?e[e.length-1].dir:Et.LTR;for(let i=Math.max(0,e.length-10);i<e.length;i++){let l=e[i];l.dir==s&&!n.touchesRange(l.from,l.to)&&r.push(new gh(n.mapPos(l.from,1),n.mapPos(l.to,-1),l.dir,l.isolates,!1,l.order))}return r}}function Kv(t,e,n){for(let r=t.state.facet(e),s=r.length-1;s>=0;s--){let i=r[s],l=typeof i=="function"?i(t):i;l&&jg(l,n)}return n}const d6=ve.mac?"mac":ve.windows?"win":ve.linux?"linux":"key";function h6(t,e){const n=t.split(/-(?!$)/);let r=n[n.length-1];r=="Space"&&(r=" ");let s,i,l,o;for(let c=0;c<n.length-1;++c){const u=n[c];if(/^(cmd|meta|m)$/i.test(u))o=!0;else if(/^a(lt)?$/i.test(u))s=!0;else if(/^(c|ctrl|control)$/i.test(u))i=!0;else if(/^s(hift)?$/i.test(u))l=!0;else if(/^mod$/i.test(u))e=="mac"?o=!0:i=!0;else throw new Error("Unrecognized modifier name: "+u)}return s&&(r="Alt-"+r),i&&(r="Ctrl-"+r),o&&(r="Meta-"+r),l&&(r="Shift-"+r),r}function Uu(t,e,n){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n!==!1&&e.shiftKey&&(t="Shift-"+t),t}const f6=Xh.default(Oe.domEventHandlers({keydown(t,e){return x6(p6(e.state),t,e,"editor")}})),EN=_e.define({enables:f6}),Qv=new WeakMap;function p6(t){let e=t.facet(EN),n=Qv.get(e);return n||Qv.set(e,n=g6(e.reduce((r,s)=>r.concat(s),[]))),n}let si=null;const m6=4e3;function g6(t,e=d6){let n=Object.create(null),r=Object.create(null),s=(l,o)=>{let c=r[l];if(c==null)r[l]=o;else if(c!=o)throw new Error("Key binding "+l+" is used both as a regular binding and as a multi-stroke prefix")},i=(l,o,c,u,h)=>{var d,f;let p=n[l]||(n[l]=Object.create(null)),m=o.split(/ (?!$)/).map(g=>h6(g,e));for(let g=1;g<m.length;g++){let y=m.slice(0,g).join(" ");s(y,!0),p[y]||(p[y]={preventDefault:!0,stopPropagation:!1,run:[b=>{let k=si={view:b,prefix:y,scope:l};return setTimeout(()=>{si==k&&(si=null)},m6),!0}]})}let x=m.join(" ");s(x,!1);let v=p[x]||(p[x]={preventDefault:!1,stopPropagation:!1,run:((f=(d=p._any)===null||d===void 0?void 0:d.run)===null||f===void 0?void 0:f.slice())||[]});c&&v.run.push(c),u&&(v.preventDefault=!0),h&&(v.stopPropagation=!0)};for(let l of t){let o=l.scope?l.scope.split(" "):["editor"];if(l.any)for(let u of o){let h=n[u]||(n[u]=Object.create(null));h._any||(h._any={preventDefault:!1,stopPropagation:!1,run:[]});let{any:d}=l;for(let f in h)h[f].run.push(p=>d(p,Og))}let c=l[e]||l.key;if(c)for(let u of o)i(u,c,l.run,l.preventDefault,l.stopPropagation),l.shift&&i(u,"Shift-"+c,l.shift,l.preventDefault,l.stopPropagation)}return n}let Og=null;function x6(t,e,n,r){Og=e;let s=FR(e),i=vR(s,0),l=wR(i)==s.length&&s!=" ",o="",c=!1,u=!1,h=!1;si&&si.view==n&&si.scope==r&&(o=si.prefix+" ",xN.indexOf(e.keyCode)<0&&(u=!0,si=null));let d=new Set,f=v=>{if(v){for(let g of v.run)if(!d.has(g)&&(d.add(g),g(n)))return v.stopPropagation&&(h=!0),!0;v.preventDefault&&(v.stopPropagation&&(h=!0),u=!0)}return!1},p=t[r],m,x;return p&&(f(p[o+Uu(s,e,!l)])?c=!0:l&&(e.altKey||e.metaKey||e.ctrlKey)&&!(ve.windows&&e.ctrlKey&&e.altKey)&&!(ve.mac&&e.altKey&&!(e.ctrlKey||e.metaKey))&&(m=Di[e.keyCode])&&m!=s?(f(p[o+Uu(m,e,!0)])||e.shiftKey&&(x=Tc[e.keyCode])!=s&&x!=m&&f(p[o+Uu(x,e,!1)]))&&(c=!0):l&&e.shiftKey&&f(p[o+Uu(s,e,!0)])&&(c=!0),!c&&f(p._any)&&(c=!0)),u&&(c=!0),c&&h&&e.stopPropagation(),Og=null,c}class su{constructor(e,n,r,s,i){this.className=e,this.left=n,this.top=r,this.width=s,this.height=i}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,n){return n.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,n,r){if(r.empty){let s=e.coordsAtPos(r.head,r.assoc||1);if(!s)return[];let i=PN(e);return[new su(n,s.left-i.left,s.top-i.top,null,s.bottom-s.top)]}else return y6(e,n,r)}}function PN(t){let e=t.scrollDOM.getBoundingClientRect();return{left:(t.textDirection==Et.LTR?e.left:e.right-t.scrollDOM.clientWidth*t.scaleX)-t.scrollDOM.scrollLeft*t.scaleX,top:e.top-t.scrollDOM.scrollTop*t.scaleY}}function Gv(t,e,n,r){let s=t.coordsAtPos(e,n*2);if(!s)return r;let i=t.dom.getBoundingClientRect(),l=(s.top+s.bottom)/2,o=t.posAtCoords({x:i.left+1,y:l}),c=t.posAtCoords({x:i.right-1,y:l});return o==null||c==null?r:{from:Math.max(r.from,Math.min(o,c)),to:Math.min(r.to,Math.max(o,c))}}function y6(t,e,n){if(n.to<=t.viewport.from||n.from>=t.viewport.to)return[];let r=Math.max(n.from,t.viewport.from),s=Math.min(n.to,t.viewport.to),i=t.textDirection==Et.LTR,l=t.contentDOM,o=l.getBoundingClientRect(),c=PN(t),u=l.querySelector(".cm-line"),h=u&&window.getComputedStyle(u),d=o.left+(h?parseInt(h.paddingLeft)+Math.min(0,parseInt(h.textIndent)):0),f=o.right-(h?parseInt(h.paddingRight):0),p=Mg(t,r,1),m=Mg(t,s,-1),x=p.type==Mn.Text?p:null,v=m.type==Mn.Text?m:null;if(x&&(t.lineWrapping||p.widgetLineBreaks)&&(x=Gv(t,r,1,x)),v&&(t.lineWrapping||m.widgetLineBreaks)&&(v=Gv(t,s,-1,v)),x&&v&&x.from==v.from&&x.to==v.to)return y(b(n.from,n.to,x));{let S=x?b(n.from,null,x):k(p,!1),j=v?b(null,n.to,v):k(m,!0),E=[];return(x||p).to<(v||m).from-(x&&v?1:0)||p.widgetLineBreaks>1&&S.bottom+t.defaultLineHeight/2<j.top?E.push(g(d,S.bottom,f,j.top)):S.bottom<j.top&&t.elementAtHeight((S.bottom+j.top)/2).type==Mn.Text&&(S.bottom=j.top=(S.bottom+j.top)/2),y(S).concat(E).concat(y(j))}function g(S,j,E,A){return new su(e,S-c.left,j-c.top,E-S,A-j)}function y({top:S,bottom:j,horizontal:E}){let A=[];for(let T=0;T<E.length;T+=2)A.push(g(E[T],S,E[T+1],j));return A}function b(S,j,E){let A=1e9,T=-1e9,N=[];function I(_,M,z,q,F){let V=t.coordsAtPos(_,_==E.to?-2:2),P=t.coordsAtPos(z,z==E.from?2:-2);!V||!P||(A=Math.min(V.top,P.top,A),T=Math.max(V.bottom,P.bottom,T),F==Et.LTR?N.push(i&&M?d:V.left,i&&q?f:P.right):N.push(!i&&q?d:P.left,!i&&M?f:V.right))}let R=S??E.from,C=j??E.to;for(let _ of t.visibleRanges)if(_.to>R&&_.from<C)for(let M=Math.max(_.from,R),z=Math.min(_.to,C);;){let q=t.state.doc.lineAt(M);for(let F of t.bidiSpans(q)){let V=F.from+q.from,P=F.to+q.from;if(V>=z)break;P>M&&I(Math.max(V,M),S==null&&V<=R,Math.min(P,z),j==null&&P>=C,F.dir)}if(M=q.to+1,M>=z)break}return N.length==0&&I(R,S==null,C,j==null,t.textDirection),{top:A,bottom:T,horizontal:N}}function k(S,j){let E=o.top+(j?S.top:S.bottom);return{top:E,bottom:E,horizontal:[]}}}function b6(t,e){return t.constructor==e.constructor&&t.eq(e)}class v6{constructor(e,n){this.view=e,this.layer=n,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),n.above&&this.dom.classList.add("cm-layer-above"),n.class&&this.dom.classList.add(n.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),n.mount&&n.mount(this.dom,e)}update(e){e.startState.facet(Sd)!=e.state.facet(Sd)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}docViewUpdate(e){this.layer.updateOnDocViewUpdate!==!1&&e.requestMeasure(this.measureReq)}setOrder(e){let n=0,r=e.facet(Sd);for(;n<r.length&&r[n]!=this.layer;)n++;this.dom.style.zIndex=String((this.layer.above?150:-1)-n)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:n}=this.view;(e!=this.scaleX||n!=this.scaleY)&&(this.scaleX=e,this.scaleY=n,this.dom.style.transform=`scale(${1/e}, ${1/n})`)}draw(e){if(e.length!=this.drawn.length||e.some((n,r)=>!b6(n,this.drawn[r]))){let n=this.dom.firstChild,r=0;for(let s of e)s.update&&n&&s.constructor&&this.drawn[r].constructor&&s.update(n,this.drawn[r])?(n=n.nextSibling,r++):this.dom.insertBefore(s.draw(),n);for(;n;){let s=n.nextSibling;n.remove(),n=s}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const Sd=_e.define();function _N(t){return[ps.define(e=>new v6(e,t)),Sd.of(t)]}const Oc=_e.define({combine(t){return ES(t,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,n)=>Math.min(e,n),drawRangeCursor:(e,n)=>e||n})}});function w6(t={}){return[Oc.of(t),k6,j6,S6,sN.of(!0)]}function MN(t){return t.startState.facet(Oc)!=t.state.facet(Oc)}const k6=_N({above:!0,markers(t){let{state:e}=t,n=e.facet(Oc),r=[];for(let s of e.selection.ranges){let i=s==e.selection.main;if(s.empty||n.drawRangeCursor){let l=i?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",o=s.empty?s:pe.cursor(s.head,s.head>s.anchor?-1:1);for(let c of su.forRange(t,l,o))r.push(c)}}return r},update(t,e){t.transactions.some(r=>r.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let n=MN(t);return n&&Xv(t.state,e),t.docChanged||t.selectionSet||n},mount(t,e){Xv(e.state,t)},class:"cm-cursorLayer"});function Xv(t,e){e.style.animationDuration=t.facet(Oc).cursorBlinkRate+"ms"}const j6=_N({above:!1,markers(t){return t.state.selection.ranges.map(e=>e.empty?[]:su.forRange(t,"cm-selectionBackground",e)).reduce((e,n)=>e.concat(n))},update(t,e){return t.docChanged||t.selectionSet||t.viewportChanged||MN(t)},class:"cm-selectionLayer"}),S6=Xh.highest(Oe.theme({".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"},caretColor:"transparent !important"},".cm-content":{caretColor:"transparent !important","& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}}));function N6(){return A6}const C6=Vt.line({class:"cm-activeLine"}),A6=ps.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.docChanged||t.selectionSet)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=-1,n=[];for(let r of t.state.selection.ranges){let s=t.lineBlockAt(r.head);s.from>e&&(n.push(C6.range(s.from)),e=s.from)}return Vt.set(n)}},{decorations:t=>t.decorations});class Cl extends Ha{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Cl.prototype.elementClass="";Cl.prototype.toDOM=void 0;Cl.prototype.mapMode=er.TrackBefore;Cl.prototype.startSide=Cl.prototype.endSide=-1;Cl.prototype.point=!0;const hp=_e.define(),E6=_e.define(),Nd=_e.define(),Jv=_e.define({combine:t=>t.some(e=>e)});function P6(t){return[_6]}const _6=ps.fromClass(class{constructor(t){this.view=t,this.domAfter=null,this.prevViewport=t.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters cm-gutters-before",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=t.state.facet(Nd).map(e=>new Zv(t,e)),this.fixed=!t.state.facet(Jv);for(let e of this.gutters)e.config.side=="after"?this.getDOMAfter().appendChild(e.dom):this.dom.appendChild(e.dom);this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),t.scrollDOM.insertBefore(this.dom,t.contentDOM)}getDOMAfter(){return this.domAfter||(this.domAfter=document.createElement("div"),this.domAfter.className="cm-gutters cm-gutters-after",this.domAfter.setAttribute("aria-hidden","true"),this.domAfter.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.domAfter.style.position=this.fixed?"sticky":"",this.view.scrollDOM.appendChild(this.domAfter)),this.domAfter}update(t){if(this.updateGutters(t)){let e=this.prevViewport,n=t.view.viewport,r=Math.min(e.to,n.to)-Math.max(e.from,n.from);this.syncGutters(r<(n.to-n.from)*.8)}if(t.geometryChanged){let e=this.view.contentHeight/this.view.scaleY+"px";this.dom.style.minHeight=e,this.domAfter&&(this.domAfter.style.minHeight=e)}this.view.state.facet(Jv)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":"",this.domAfter&&(this.domAfter.style.position=this.fixed?"sticky":"")),this.prevViewport=t.view.viewport}syncGutters(t){let e=this.dom.nextSibling;t&&(this.dom.remove(),this.domAfter&&this.domAfter.remove());let n=nt.iter(this.view.state.facet(hp),this.view.viewport.from),r=[],s=this.gutters.map(i=>new M6(i,this.view.viewport,-this.view.documentPadding.top));for(let i of this.view.viewportLineBlocks)if(r.length&&(r=[]),Array.isArray(i.type)){let l=!0;for(let o of i.type)if(o.type==Mn.Text&&l){Ig(n,r,o.from);for(let c of s)c.line(this.view,o,r);l=!1}else if(o.widget)for(let c of s)c.widget(this.view,o)}else if(i.type==Mn.Text){Ig(n,r,i.from);for(let l of s)l.line(this.view,i,r)}else if(i.widget)for(let l of s)l.widget(this.view,i);for(let i of s)i.finish();t&&(this.view.scrollDOM.insertBefore(this.dom,e),this.domAfter&&this.view.scrollDOM.appendChild(this.domAfter))}updateGutters(t){let e=t.startState.facet(Nd),n=t.state.facet(Nd),r=t.docChanged||t.heightChanged||t.viewportChanged||!nt.eq(t.startState.facet(hp),t.state.facet(hp),t.view.viewport.from,t.view.viewport.to);if(e==n)for(let s of this.gutters)s.update(t)&&(r=!0);else{r=!0;let s=[];for(let i of n){let l=e.indexOf(i);l<0?s.push(new Zv(this.view,i)):(this.gutters[l].update(t),s.push(this.gutters[l]))}for(let i of this.gutters)i.dom.remove(),s.indexOf(i)<0&&i.destroy();for(let i of s)i.config.side=="after"?this.getDOMAfter().appendChild(i.dom):this.dom.appendChild(i.dom);this.gutters=s}return r}destroy(){for(let t of this.gutters)t.destroy();this.dom.remove(),this.domAfter&&this.domAfter.remove()}},{provide:t=>Oe.scrollMargins.of(e=>{let n=e.plugin(t);if(!n||n.gutters.length==0||!n.fixed)return null;let r=n.dom.offsetWidth*e.scaleX,s=n.domAfter?n.domAfter.offsetWidth*e.scaleX:0;return e.textDirection==Et.LTR?{left:r,right:s}:{right:r,left:s}})});function Yv(t){return Array.isArray(t)?t:[t]}function Ig(t,e,n){for(;t.value&&t.from<=n;)t.from==n&&e.push(t.value),t.next()}class M6{constructor(e,n,r){this.gutter=e,this.height=r,this.i=0,this.cursor=nt.iter(e.markers,n.from)}addElement(e,n,r){let{gutter:s}=this,i=(n.top-this.height)/e.scaleY,l=n.height/e.scaleY;if(this.i==s.elements.length){let o=new TN(e,l,i,r);s.elements.push(o),s.dom.appendChild(o.dom)}else s.elements[this.i].update(e,l,i,r);this.height=n.bottom,this.i++}line(e,n,r){let s=[];Ig(this.cursor,s,n.from),r.length&&(s=s.concat(r));let i=this.gutter.config.lineMarker(e,n,s);i&&s.unshift(i);let l=this.gutter;s.length==0&&!l.config.renderEmptyElements||this.addElement(e,n,s)}widget(e,n){let r=this.gutter.config.widgetMarker(e,n.widget,n),s=r?[r]:null;for(let i of e.state.facet(E6)){let l=i(e,n.widget,n);l&&(s||(s=[])).push(l)}s&&this.addElement(e,n,s)}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let n=e.elements.pop();e.dom.removeChild(n.dom),n.destroy()}}}class Zv{constructor(e,n){this.view=e,this.config=n,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let r in n.domEventHandlers)this.dom.addEventListener(r,s=>{let i=s.target,l;if(i!=this.dom&&this.dom.contains(i)){for(;i.parentNode!=this.dom;)i=i.parentNode;let c=i.getBoundingClientRect();l=(c.top+c.bottom)/2}else l=s.clientY;let o=e.lineBlockAtHeight(l-e.documentTop);n.domEventHandlers[r](e,o,s)&&s.preventDefault()});this.markers=Yv(n.markers(e)),n.initialSpacer&&(this.spacer=new TN(e,0,0,[n.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let n=this.markers;if(this.markers=Yv(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let s=this.config.updateSpacer(this.spacer.markers[0],e);s!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[s])}let r=e.view.viewport;return!nt.eq(this.markers,n,r.from,r.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class TN{constructor(e,n,r,s){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,n,r,s)}update(e,n,r,s){this.height!=n&&(this.height=n,this.dom.style.height=n+"px"),this.above!=r&&(this.dom.style.marginTop=(this.above=r)?r+"px":""),T6(this.markers,s)||this.setMarkers(e,s)}setMarkers(e,n){let r="cm-gutterElement",s=this.dom.firstChild;for(let i=0,l=0;;){let o=l,c=i<n.length?n[i++]:null,u=!1;if(c){let h=c.elementClass;h&&(r+=" "+h);for(let d=l;d<this.markers.length;d++)if(this.markers[d].compare(c)){o=d,u=!0;break}}else o=this.markers.length;for(;l<o;){let h=this.markers[l++];if(h.toDOM){h.destroy(s);let d=s.nextSibling;s.remove(),s=d}}if(!c)break;c.toDOM&&(u?s=s.nextSibling:this.dom.insertBefore(c.toDOM(e),s)),u&&l++}this.dom.className=r,this.markers=n}destroy(){this.setMarkers(null,[])}}function T6(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].compare(e[n]))return!1;return!0}const R6=_e.define(),D6=_e.define(),ia=_e.define({combine(t){return ES(t,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,n){let r=Object.assign({},e);for(let s in n){let i=r[s],l=n[s];r[s]=i?(o,c,u)=>i(o,c,u)||l(o,c,u):l}return r}})}});class fp extends Cl{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function pp(t,e){return t.state.facet(ia).formatNumber(e,t.state)}const L6=Nd.compute([ia],t=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(R6)},lineMarker(e,n,r){return r.some(s=>s.toDOM)?null:new fp(pp(e,e.state.doc.lineAt(n.from).number))},widgetMarker:(e,n,r)=>{for(let s of e.state.facet(D6)){let i=s(e,n,r);if(i)return i}return null},lineMarkerChange:e=>e.startState.facet(ia)!=e.state.facet(ia),initialSpacer(e){return new fp(pp(e,ew(e.state.doc.lines)))},updateSpacer(e,n){let r=pp(n.view,ew(n.view.state.doc.lines));return r==e.number?e:new fp(r)},domEventHandlers:t.facet(ia).domEventHandlers,side:"before"}));function O6(t={}){return[ia.of(t),P6(),L6]}function ew(t){let e=9;for(;e<t;)e=e*10+9;return e}const I6=1024;let F6=0;class mp{constructor(e,n){this.from=e,this.to=n}}class We{constructor(e={}){this.id=F6++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Kn.match(e)),n=>{let r=e(n);return r===void 0?null:[this,r]}}}We.closedBy=new We({deserialize:t=>t.split(" ")});We.openedBy=new We({deserialize:t=>t.split(" ")});We.group=new We({deserialize:t=>t.split(" ")});We.isolate=new We({deserialize:t=>{if(t&&t!="rtl"&&t!="ltr"&&t!="auto")throw new RangeError("Invalid value for isolate: "+t);return t||"auto"}});We.contextHash=new We({perNode:!0});We.lookAhead=new We({perNode:!0});We.mounted=new We({perNode:!0});class xh{constructor(e,n,r){this.tree=e,this.overlay=n,this.parser=r}static get(e){return e&&e.props&&e.props[We.mounted.id]}}const B6=Object.create(null);class Kn{constructor(e,n,r,s=0){this.name=e,this.props=n,this.id=r,this.flags=s}static define(e){let n=e.props&&e.props.length?Object.create(null):B6,r=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),s=new Kn(e.name||"",n,e.id,r);if(e.props){for(let i of e.props)if(Array.isArray(i)||(i=i(s)),i){if(i[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");n[i[0].id]=i[1]}}return s}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let n=this.prop(We.group);return n?n.indexOf(e)>-1:!1}return this.id==e}static match(e){let n=Object.create(null);for(let r in e)for(let s of r.split(" "))n[s]=e[r];return r=>{for(let s=r.prop(We.group),i=-1;i<(s?s.length:0);i++){let l=n[i<0?r.name:s[i]];if(l)return l}}}}Kn.none=new Kn("",Object.create(null),0,8);class P0{constructor(e){this.types=e;for(let n=0;n<e.length;n++)if(e[n].id!=n)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let n=[];for(let r of this.types){let s=null;for(let i of e){let l=i(r);l&&(s||(s=Object.assign({},r.props)),s[l[0].id]=l[1])}n.push(s?new Kn(r.name,s,r.id,r.flags):r)}return new P0(n)}}const Hu=new WeakMap,tw=new WeakMap;var rn;(function(t){t[t.ExcludeBuffers=1]="ExcludeBuffers",t[t.IncludeAnonymous=2]="IncludeAnonymous",t[t.IgnoreMounts=4]="IgnoreMounts",t[t.IgnoreOverlays=8]="IgnoreOverlays"})(rn||(rn={}));class kt{constructor(e,n,r,s,i){if(this.type=e,this.children=n,this.positions=r,this.length=s,this.props=null,i&&i.length){this.props=Object.create(null);for(let[l,o]of i)this.props[typeof l=="number"?l:l.id]=o}}toString(){let e=xh.get(this);if(e&&!e.overlay)return e.tree.toString();let n="";for(let r of this.children){let s=r.toString();s&&(n&&(n+=","),n+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(n.length?"("+n+")":""):n}cursor(e=0){return new Bg(this.topNode,e)}cursorAt(e,n=0,r=0){let s=Hu.get(this)||this.topNode,i=new Bg(s);return i.moveTo(e,n),Hu.set(this,i._tree),i}get topNode(){return new Nr(this,0,0,null)}resolve(e,n=0){let r=Ic(Hu.get(this)||this.topNode,e,n,!1);return Hu.set(this,r),r}resolveInner(e,n=0){let r=Ic(tw.get(this)||this.topNode,e,n,!0);return tw.set(this,r),r}resolveStack(e,n=0){return U6(this,e,n)}iterate(e){let{enter:n,leave:r,from:s=0,to:i=this.length}=e,l=e.mode||0,o=(l&rn.IncludeAnonymous)>0;for(let c=this.cursor(l|rn.IncludeAnonymous);;){let u=!1;if(c.from<=i&&c.to>=s&&(!o&&c.type.isAnonymous||n(c)!==!1)){if(c.firstChild())continue;u=!0}for(;u&&r&&(o||!c.type.isAnonymous)&&r(c),!c.nextSibling();){if(!c.parent())return;u=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let n in this.props)e.push([+n,this.props[n]]);return e}balance(e={}){return this.children.length<=8?this:T0(Kn.none,this.children,this.positions,0,this.children.length,0,this.length,(n,r,s)=>new kt(this.type,n,r,s,this.propValues),e.makeTree||((n,r,s)=>new kt(Kn.none,n,r,s)))}static build(e){return H6(e)}}kt.empty=new kt(Kn.none,[],[],0);class _0{constructor(e,n){this.buffer=e,this.index=n}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new _0(this.buffer,this.index)}}class Oi{constructor(e,n,r){this.buffer=e,this.length=n,this.set=r}get type(){return Kn.none}toString(){let e=[];for(let n=0;n<this.buffer.length;)e.push(this.childString(n)),n=this.buffer[n+3];return e.join(",")}childString(e){let n=this.buffer[e],r=this.buffer[e+3],s=this.set.types[n],i=s.name;if(/\W/.test(i)&&!s.isError&&(i=JSON.stringify(i)),e+=4,r==e)return i;let l=[];for(;e<r;)l.push(this.childString(e)),e=this.buffer[e+3];return i+"("+l.join(",")+")"}findChild(e,n,r,s,i){let{buffer:l}=this,o=-1;for(let c=e;c!=n&&!(RN(i,s,l[c+1],l[c+2])&&(o=c,r>0));c=l[c+3]);return o}slice(e,n,r){let s=this.buffer,i=new Uint16Array(n-e),l=0;for(let o=e,c=0;o<n;){i[c++]=s[o++],i[c++]=s[o++]-r;let u=i[c++]=s[o++]-r;i[c++]=s[o++]-e,l=Math.max(l,u)}return new Oi(i,l,this.set)}}function RN(t,e,n,r){switch(t){case-2:return n<e;case-1:return r>=e&&n<e;case 0:return n<e&&r>e;case 1:return n<=e&&r>e;case 2:return r>e;case 4:return!0}}function Ic(t,e,n,r){for(var s;t.from==t.to||(n<1?t.from>=e:t.from>e)||(n>-1?t.to<=e:t.to<e);){let l=!r&&t instanceof Nr&&t.index<0?null:t.parent;if(!l)return t;t=l}let i=r?0:rn.IgnoreOverlays;if(r)for(let l=t,o=l.parent;o;l=o,o=l.parent)l instanceof Nr&&l.index<0&&((s=o.enter(e,n,i))===null||s===void 0?void 0:s.from)!=l.from&&(t=o);for(;;){let l=t.enter(e,n,i);if(!l)return t;t=l}}class DN{cursor(e=0){return new Bg(this,e)}getChild(e,n=null,r=null){let s=nw(this,e,n,r);return s.length?s[0]:null}getChildren(e,n=null,r=null){return nw(this,e,n,r)}resolve(e,n=0){return Ic(this,e,n,!1)}resolveInner(e,n=0){return Ic(this,e,n,!0)}matchContext(e){return Fg(this.parent,e)}enterUnfinishedNodesBefore(e){let n=this.childBefore(e),r=this;for(;n;){let s=n.lastChild;if(!s||s.to!=n.to)break;s.type.isError&&s.from==s.to?(r=n,n=s.prevSibling):n=s}return r}get node(){return this}get next(){return this.parent}}class Nr extends DN{constructor(e,n,r,s){super(),this._tree=e,this.from=n,this.index=r,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,n,r,s,i=0){for(let l=this;;){for(let{children:o,positions:c}=l._tree,u=n>0?o.length:-1;e!=u;e+=n){let h=o[e],d=c[e]+l.from;if(RN(s,r,d,d+h.length)){if(h instanceof Oi){if(i&rn.ExcludeBuffers)continue;let f=h.findChild(0,h.buffer.length,n,r-d,s);if(f>-1)return new bi(new z6(l,h,e,d),null,f)}else if(i&rn.IncludeAnonymous||!h.type.isAnonymous||M0(h)){let f;if(!(i&rn.IgnoreMounts)&&(f=xh.get(h))&&!f.overlay)return new Nr(f.tree,d,e,l);let p=new Nr(h,d,e,l);return i&rn.IncludeAnonymous||!p.type.isAnonymous?p:p.nextChild(n<0?h.children.length-1:0,n,r,s)}}}if(i&rn.IncludeAnonymous||!l.type.isAnonymous||(l.index>=0?e=l.index+n:e=n<0?-1:l._parent._tree.children.length,l=l._parent,!l))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,n,r=0){let s;if(!(r&rn.IgnoreOverlays)&&(s=xh.get(this._tree))&&s.overlay){let i=e-this.from;for(let{from:l,to:o}of s.overlay)if((n>0?l<=i:l<i)&&(n<0?o>=i:o>i))return new Nr(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,n,r)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function nw(t,e,n,r){let s=t.cursor(),i=[];if(!s.firstChild())return i;if(n!=null){for(let l=!1;!l;)if(l=s.type.is(n),!s.nextSibling())return i}for(;;){if(r!=null&&s.type.is(r))return i;if(s.type.is(e)&&i.push(s.node),!s.nextSibling())return r==null?i:[]}}function Fg(t,e,n=e.length-1){for(let r=t;n>=0;r=r.parent){if(!r)return!1;if(!r.type.isAnonymous){if(e[n]&&e[n]!=r.name)return!1;n--}}return!0}class z6{constructor(e,n,r,s){this.parent=e,this.buffer=n,this.index=r,this.start=s}}class bi extends DN{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,n,r){super(),this.context=e,this._parent=n,this.index=r,this.type=e.buffer.set.types[e.buffer.buffer[r]]}child(e,n,r){let{buffer:s}=this.context,i=s.findChild(this.index+4,s.buffer[this.index+3],e,n-this.context.start,r);return i<0?null:new bi(this.context,this,i)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,n,r=0){if(r&rn.ExcludeBuffers)return null;let{buffer:s}=this.context,i=s.findChild(this.index+4,s.buffer[this.index+3],n>0?1:-1,e-this.context.start,n);return i<0?null:new bi(this.context,this,i)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,n=e.buffer[this.index+3];return n<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new bi(this.context,this._parent,n):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,n=this._parent?this._parent.index+4:0;return this.index==n?this.externalSibling(-1):new bi(this.context,this._parent,e.findChild(n,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],n=[],{buffer:r}=this.context,s=this.index+4,i=r.buffer[this.index+3];if(i>s){let l=r.buffer[this.index+1];e.push(r.slice(s,i,l)),n.push(0)}return new kt(this.type,e,n,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function LN(t){if(!t.length)return null;let e=0,n=t[0];for(let i=1;i<t.length;i++){let l=t[i];(l.from>n.from||l.to<n.to)&&(n=l,e=i)}let r=n instanceof Nr&&n.index<0?null:n.parent,s=t.slice();return r?s[e]=r:s.splice(e,1),new $6(s,n)}class $6{constructor(e,n){this.heads=e,this.node=n}get next(){return LN(this.heads)}}function U6(t,e,n){let r=t.resolveInner(e,n),s=null;for(let i=r instanceof Nr?r:r.context.parent;i;i=i.parent)if(i.index<0){let l=i.parent;(s||(s=[r])).push(l.resolve(e,n)),i=l}else{let l=xh.get(i.tree);if(l&&l.overlay&&l.overlay[0].from<=e&&l.overlay[l.overlay.length-1].to>=e){let o=new Nr(l.tree,l.overlay[0].from+i.from,-1,i);(s||(s=[r])).push(Ic(o,e,n,!1))}}return s?LN(s):r}class Bg{get name(){return this.type.name}constructor(e,n=0){if(this.mode=n,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Nr)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let r=e._parent;r;r=r._parent)this.stack.unshift(r.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,n){this.index=e;let{start:r,buffer:s}=this.buffer;return this.type=n||s.set.types[s.buffer[e]],this.from=r+s.buffer[e+1],this.to=r+s.buffer[e+2],!0}yield(e){return e?e instanceof Nr?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,n,r){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,n,r,this.mode));let{buffer:s}=this.buffer,i=s.findChild(this.index+4,s.buffer[this.index+3],e,n-this.buffer.start,r);return i<0?!1:(this.stack.push(this.index),this.yieldBuf(i))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,n,r=this.mode){return this.buffer?r&rn.ExcludeBuffers?!1:this.enterChild(1,e,n):this.yield(this._tree.enter(e,n,r))}parent(){if(!this.buffer)return this.yieldNode(this.mode&rn.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&rn.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:n}=this.buffer,r=this.stack.length-1;if(e<0){let s=r<0?0:this.stack[r]+4;if(this.index!=s)return this.yieldBuf(n.findChild(s,this.index,-1,0,4))}else{let s=n.buffer[this.index+3];if(s<(r<0?n.buffer.length:n.buffer[this.stack[r]+3]))return this.yieldBuf(s)}return r<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let n,r,{buffer:s}=this;if(s){if(e>0){if(this.index<s.buffer.buffer.length)return!1}else for(let i=0;i<this.index;i++)if(s.buffer.buffer[i+3]<this.index)return!1;({index:n,parent:r}=s)}else({index:n,_parent:r}=this._tree);for(;r;{index:n,_parent:r}=r)if(n>-1)for(let i=n+e,l=e<0?-1:r._tree.children.length;i!=l;i+=e){let o=r._tree.children[i];if(this.mode&rn.IncludeAnonymous||o instanceof Oi||!o.type.isAnonymous||M0(o))return!1}return!0}move(e,n){if(n&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,n=0){for(;(this.from==this.to||(n<1?this.from>=e:this.from>e)||(n>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,n););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,n=null,r=0;if(e&&e.context==this.buffer)e:for(let s=this.index,i=this.stack.length;i>=0;){for(let l=e;l;l=l._parent)if(l.index==s){if(s==this.index)return l;n=l,r=i+1;break e}s=this.stack[--i]}for(let s=r;s<this.stack.length;s++)n=new bi(this.buffer,n,this.stack[s]);return this.bufferNode=new bi(this.buffer,n,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,n){for(let r=0;;){let s=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){r++;continue}this.type.isAnonymous||(s=!0)}for(;;){if(s&&n&&n(this),s=this.type.isAnonymous,!r)return;if(this.nextSibling())break;this.parent(),r--,s=!0}}}matchContext(e){if(!this.buffer)return Fg(this.node.parent,e);let{buffer:n}=this.buffer,{types:r}=n.set;for(let s=e.length-1,i=this.stack.length-1;s>=0;i--){if(i<0)return Fg(this._tree,e,s);let l=r[n.buffer[this.stack[i]]];if(!l.isAnonymous){if(e[s]&&e[s]!=l.name)return!1;s--}}return!0}}function M0(t){return t.children.some(e=>e instanceof Oi||!e.type.isAnonymous||M0(e))}function H6(t){var e;let{buffer:n,nodeSet:r,maxBufferLength:s=I6,reused:i=[],minRepeatType:l=r.types.length}=t,o=Array.isArray(n)?new _0(n,n.length):n,c=r.types,u=0,h=0;function d(S,j,E,A,T,N){let{id:I,start:R,end:C,size:_}=o,M=h,z=u;for(;_<0;)if(o.next(),_==-1){let H=i[I];E.push(H),A.push(R-S);return}else if(_==-3){u=I;return}else if(_==-4){h=I;return}else throw new RangeError(`Unrecognized record size: ${_}`);let q=c[I],F,V,P=R-S;if(C-R<=s&&(V=v(o.pos-j,T))){let H=new Uint16Array(V.size-V.skip),Y=o.pos-V.size,L=H.length;for(;o.pos>Y;)L=g(V.start,H,L);F=new Oi(H,C-V.start,r),P=V.start-S}else{let H=o.pos-_;o.next();let Y=[],L=[],Se=I>=l?I:-1,we=0,ge=C;for(;o.pos>H;)Se>=0&&o.id==Se&&o.size>=0?(o.end<=ge-s&&(m(Y,L,R,we,o.end,ge,Se,M,z),we=Y.length,ge=o.end),o.next()):N>2500?f(R,H,Y,L):d(R,H,Y,L,Se,N+1);if(Se>=0&&we>0&&we<Y.length&&m(Y,L,R,we,R,ge,Se,M,z),Y.reverse(),L.reverse(),Se>-1&&we>0){let Ce=p(q,z);F=T0(q,Y,L,0,Y.length,0,C-R,Ce,Ce)}else F=x(q,Y,L,C-R,M-C,z)}E.push(F),A.push(P)}function f(S,j,E,A){let T=[],N=0,I=-1;for(;o.pos>j;){let{id:R,start:C,end:_,size:M}=o;if(M>4)o.next();else{if(I>-1&&C<I)break;I<0&&(I=_-s),T.push(R,C,_),N++,o.next()}}if(N){let R=new Uint16Array(N*4),C=T[T.length-2];for(let _=T.length-3,M=0;_>=0;_-=3)R[M++]=T[_],R[M++]=T[_+1]-C,R[M++]=T[_+2]-C,R[M++]=M;E.push(new Oi(R,T[2]-C,r)),A.push(C-S)}}function p(S,j){return(E,A,T)=>{let N=0,I=E.length-1,R,C;if(I>=0&&(R=E[I])instanceof kt){if(!I&&R.type==S&&R.length==T)return R;(C=R.prop(We.lookAhead))&&(N=A[I]+R.length+C)}return x(S,E,A,T,N,j)}}function m(S,j,E,A,T,N,I,R,C){let _=[],M=[];for(;S.length>A;)_.push(S.pop()),M.push(j.pop()+E-T);S.push(x(r.types[I],_,M,N-T,R-N,C)),j.push(T-E)}function x(S,j,E,A,T,N,I){if(N){let R=[We.contextHash,N];I=I?[R].concat(I):[R]}if(T>25){let R=[We.lookAhead,T];I=I?[R].concat(I):[R]}return new kt(S,j,E,A,I)}function v(S,j){let E=o.fork(),A=0,T=0,N=0,I=E.end-s,R={size:0,start:0,skip:0};e:for(let C=E.pos-S;E.pos>C;){let _=E.size;if(E.id==j&&_>=0){R.size=A,R.start=T,R.skip=N,N+=4,A+=4,E.next();continue}let M=E.pos-_;if(_<0||M<C||E.start<I)break;let z=E.id>=l?4:0,q=E.start;for(E.next();E.pos>M;){if(E.size<0)if(E.size==-3)z+=4;else break e;else E.id>=l&&(z+=4);E.next()}T=q,A+=_,N+=z}return(j<0||A==S)&&(R.size=A,R.start=T,R.skip=N),R.size>4?R:void 0}function g(S,j,E){let{id:A,start:T,end:N,size:I}=o;if(o.next(),I>=0&&A<l){let R=E;if(I>4){let C=o.pos-(I-4);for(;o.pos>C;)E=g(S,j,E)}j[--E]=R,j[--E]=N-S,j[--E]=T-S,j[--E]=A}else I==-3?u=A:I==-4&&(h=A);return E}let y=[],b=[];for(;o.pos>0;)d(t.start||0,t.bufferStart||0,y,b,-1,0);let k=(e=t.length)!==null&&e!==void 0?e:y.length?b[0]+y[0].length:0;return new kt(c[t.topID],y.reverse(),b.reverse(),k)}const rw=new WeakMap;function Cd(t,e){if(!t.isAnonymous||e instanceof Oi||e.type!=t)return 1;let n=rw.get(e);if(n==null){n=1;for(let r of e.children){if(r.type!=t||!(r instanceof kt)){n=1;break}n+=Cd(t,r)}rw.set(e,n)}return n}function T0(t,e,n,r,s,i,l,o,c){let u=0;for(let m=r;m<s;m++)u+=Cd(t,e[m]);let h=Math.ceil(u*1.5/8),d=[],f=[];function p(m,x,v,g,y){for(let b=v;b<g;){let k=b,S=x[b],j=Cd(t,m[b]);for(b++;b<g;b++){let E=Cd(t,m[b]);if(j+E>=h)break;j+=E}if(b==k+1){if(j>h){let E=m[k];p(E.children,E.positions,0,E.children.length,x[k]+y);continue}d.push(m[k])}else{let E=x[b-1]+m[b-1].length-S;d.push(T0(t,m,x,k,b,S,E,null,c))}f.push(S+y-i)}}return p(e,n,r,s,0),(o||c)(d,f,l)}class pl{constructor(e,n,r,s,i=!1,l=!1){this.from=e,this.to=n,this.tree=r,this.offset=s,this.open=(i?1:0)|(l?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,n=[],r=!1){let s=[new pl(0,e.length,e,0,!1,r)];for(let i of n)i.to>e.length&&s.push(i);return s}static applyChanges(e,n,r=128){if(!n.length)return e;let s=[],i=1,l=e.length?e[0]:null;for(let o=0,c=0,u=0;;o++){let h=o<n.length?n[o]:null,d=h?h.fromA:1e9;if(d-c>=r)for(;l&&l.from<d;){let f=l;if(c>=f.from||d<=f.to||u){let p=Math.max(f.from,c)-u,m=Math.min(f.to,d)-u;f=p>=m?null:new pl(p,m,f.tree,f.offset+u,o>0,!!h)}if(f&&s.push(f),l.to>d)break;l=i<e.length?e[i++]:null}if(!h)break;c=h.toA,u=h.toA-h.toB}return s}}class ON{startParse(e,n,r){return typeof e=="string"&&(e=new q6(e)),r=r?r.length?r.map(s=>new mp(s.from,s.to)):[new mp(0,0)]:[new mp(0,e.length)],this.createParse(e,n||[],r)}parse(e,n,r){let s=this.startParse(e,n,r);for(;;){let i=s.advance();if(i)return i}}}class q6{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,n){return this.string.slice(e,n)}}new We({perNode:!0});let V6=0;class xr{constructor(e,n,r,s){this.name=e,this.set=n,this.base=r,this.modified=s,this.id=V6++}toString(){let{name:e}=this;for(let n of this.modified)n.name&&(e=`${n.name}(${e})`);return e}static define(e,n){let r=typeof e=="string"?e:"?";if(e instanceof xr&&(n=e),n!=null&&n.base)throw new Error("Can not derive from a modified tag");let s=new xr(r,[],null,[]);if(s.set.push(s),n)for(let i of n.set)s.set.push(i);return s}static defineModifier(e){let n=new yh(e);return r=>r.modified.indexOf(n)>-1?r:yh.get(r.base||r,r.modified.concat(n).sort((s,i)=>s.id-i.id))}}let W6=0;class yh{constructor(e){this.name=e,this.instances=[],this.id=W6++}static get(e,n){if(!n.length)return e;let r=n[0].instances.find(o=>o.base==e&&K6(n,o.modified));if(r)return r;let s=[],i=new xr(e.name,s,e,n);for(let o of n)o.instances.push(i);let l=Q6(n);for(let o of e.set)if(!o.modified.length)for(let c of l)s.push(yh.get(o,c));return i}}function K6(t,e){return t.length==e.length&&t.every((n,r)=>n==e[r])}function Q6(t){let e=[[]];for(let n=0;n<t.length;n++)for(let r=0,s=e.length;r<s;r++)e.push(e[r].concat(t[n]));return e.sort((n,r)=>r.length-n.length)}function G6(t){let e=Object.create(null);for(let n in t){let r=t[n];Array.isArray(r)||(r=[r]);for(let s of n.split(" "))if(s){let i=[],l=2,o=s;for(let d=0;;){if(o=="..."&&d>0&&d+3==s.length){l=1;break}let f=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(o);if(!f)throw new RangeError("Invalid path: "+s);if(i.push(f[0]=="*"?"":f[0][0]=='"'?JSON.parse(f[0]):f[0]),d+=f[0].length,d==s.length)break;let p=s[d++];if(d==s.length&&p=="!"){l=0;break}if(p!="/")throw new RangeError("Invalid path: "+s);o=s.slice(d)}let c=i.length-1,u=i[c];if(!u)throw new RangeError("Invalid path: "+s);let h=new bh(r,l,c>0?i.slice(0,c):null);e[u]=h.sort(e[u])}}return IN.add(e)}const IN=new We;class bh{constructor(e,n,r,s){this.tags=e,this.mode=n,this.context=r,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}bh.empty=new bh([],2,null);function FN(t,e){let n=Object.create(null);for(let i of t)if(!Array.isArray(i.tag))n[i.tag.id]=i.class;else for(let l of i.tag)n[l.id]=i.class;let{scope:r,all:s=null}=e||{};return{style:i=>{let l=s;for(let o of i)for(let c of o.set){let u=n[c.id];if(u){l=l?l+" "+u:u;break}}return l},scope:r}}function X6(t,e){let n=null;for(let r of t){let s=r.style(e);s&&(n=n?n+" "+s:s)}return n}function J6(t,e,n,r=0,s=t.length){let i=new Y6(r,Array.isArray(e)?e:[e],n);i.highlightRange(t.cursor(),r,s,"",i.highlighters),i.flush(s)}class Y6{constructor(e,n,r){this.at=e,this.highlighters=n,this.span=r,this.class=""}startSpan(e,n){n!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=n)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,n,r,s,i){let{type:l,from:o,to:c}=e;if(o>=r||c<=n)return;l.isTop&&(i=this.highlighters.filter(p=>!p.scope||p.scope(l)));let u=s,h=Z6(e)||bh.empty,d=X6(i,h.tags);if(d&&(u&&(u+=" "),u+=d,h.mode==1&&(s+=(s?" ":"")+d)),this.startSpan(Math.max(n,o),u),h.opaque)return;let f=e.tree&&e.tree.prop(We.mounted);if(f&&f.overlay){let p=e.node.enter(f.overlay[0].from+o,1),m=this.highlighters.filter(v=>!v.scope||v.scope(f.tree.type)),x=e.firstChild();for(let v=0,g=o;;v++){let y=v<f.overlay.length?f.overlay[v]:null,b=y?y.from+o:c,k=Math.max(n,g),S=Math.min(r,b);if(k<S&&x)for(;e.from<S&&(this.highlightRange(e,k,S,s,i),this.startSpan(Math.min(S,e.to),u),!(e.to>=b||!e.nextSibling())););if(!y||b>r)break;g=y.to+o,g>n&&(this.highlightRange(p.cursor(),Math.max(n,y.from+o),Math.min(r,g),"",m),this.startSpan(Math.min(r,g),u))}x&&e.parent()}else if(e.firstChild()){f&&(s="");do if(!(e.to<=n)){if(e.from>=r)break;this.highlightRange(e,n,r,s,i),this.startSpan(Math.min(r,e.to),u)}while(e.nextSibling());e.parent()}}}function Z6(t){let e=t.type.prop(IN);for(;e&&e.context&&!t.matchContext(e.context);)e=e.next;return e||null}const xe=xr.define,qu=xe(),ei=xe(),sw=xe(ei),iw=xe(ei),ti=xe(),Vu=xe(ti),gp=xe(ti),Yr=xe(),qi=xe(Yr),Xr=xe(),Jr=xe(),zg=xe(),jo=xe(zg),Wu=xe(),Ne={comment:qu,lineComment:xe(qu),blockComment:xe(qu),docComment:xe(qu),name:ei,variableName:xe(ei),typeName:sw,tagName:xe(sw),propertyName:iw,attributeName:xe(iw),className:xe(ei),labelName:xe(ei),namespace:xe(ei),macroName:xe(ei),literal:ti,string:Vu,docString:xe(Vu),character:xe(Vu),attributeValue:xe(Vu),number:gp,integer:xe(gp),float:xe(gp),bool:xe(ti),regexp:xe(ti),escape:xe(ti),color:xe(ti),url:xe(ti),keyword:Xr,self:xe(Xr),null:xe(Xr),atom:xe(Xr),unit:xe(Xr),modifier:xe(Xr),operatorKeyword:xe(Xr),controlKeyword:xe(Xr),definitionKeyword:xe(Xr),moduleKeyword:xe(Xr),operator:Jr,derefOperator:xe(Jr),arithmeticOperator:xe(Jr),logicOperator:xe(Jr),bitwiseOperator:xe(Jr),compareOperator:xe(Jr),updateOperator:xe(Jr),definitionOperator:xe(Jr),typeOperator:xe(Jr),controlOperator:xe(Jr),punctuation:zg,separator:xe(zg),bracket:jo,angleBracket:xe(jo),squareBracket:xe(jo),paren:xe(jo),brace:xe(jo),content:Yr,heading:qi,heading1:xe(qi),heading2:xe(qi),heading3:xe(qi),heading4:xe(qi),heading5:xe(qi),heading6:xe(qi),contentSeparator:xe(Yr),list:xe(Yr),quote:xe(Yr),emphasis:xe(Yr),strong:xe(Yr),link:xe(Yr),monospace:xe(Yr),strikethrough:xe(Yr),inserted:xe(),deleted:xe(),changed:xe(),invalid:xe(),meta:Wu,documentMeta:xe(Wu),annotation:xe(Wu),processingInstruction:xe(Wu),definition:xr.defineModifier("definition"),constant:xr.defineModifier("constant"),function:xr.defineModifier("function"),standard:xr.defineModifier("standard"),local:xr.defineModifier("local"),special:xr.defineModifier("special")};for(let t in Ne){let e=Ne[t];e instanceof xr&&(e.name=t)}FN([{tag:Ne.link,class:"tok-link"},{tag:Ne.heading,class:"tok-heading"},{tag:Ne.emphasis,class:"tok-emphasis"},{tag:Ne.strong,class:"tok-strong"},{tag:Ne.keyword,class:"tok-keyword"},{tag:Ne.atom,class:"tok-atom"},{tag:Ne.bool,class:"tok-bool"},{tag:Ne.url,class:"tok-url"},{tag:Ne.labelName,class:"tok-labelName"},{tag:Ne.inserted,class:"tok-inserted"},{tag:Ne.deleted,class:"tok-deleted"},{tag:Ne.literal,class:"tok-literal"},{tag:Ne.string,class:"tok-string"},{tag:Ne.number,class:"tok-number"},{tag:[Ne.regexp,Ne.escape,Ne.special(Ne.string)],class:"tok-string2"},{tag:Ne.variableName,class:"tok-variableName"},{tag:Ne.local(Ne.variableName),class:"tok-variableName tok-local"},{tag:Ne.definition(Ne.variableName),class:"tok-variableName tok-definition"},{tag:Ne.special(Ne.variableName),class:"tok-variableName2"},{tag:Ne.definition(Ne.propertyName),class:"tok-propertyName tok-definition"},{tag:Ne.typeName,class:"tok-typeName"},{tag:Ne.namespace,class:"tok-namespace"},{tag:Ne.className,class:"tok-className"},{tag:Ne.macroName,class:"tok-macroName"},{tag:Ne.propertyName,class:"tok-propertyName"},{tag:Ne.operator,class:"tok-operator"},{tag:Ne.comment,class:"tok-comment"},{tag:Ne.meta,class:"tok-meta"},{tag:Ne.invalid,class:"tok-invalid"},{tag:Ne.punctuation,class:"tok-punctuation"}]);var xp;const la=new We;function eL(t){return _e.define({combine:t?e=>e.concat(t):void 0})}const tL=new We;class Ir{constructor(e,n,r=[],s=""){this.data=e,this.name=s,Ze.prototype.hasOwnProperty("tree")||Object.defineProperty(Ze.prototype,"tree",{get(){return ms(this)}}),this.parser=n,this.extension=[Ga.of(this),Ze.languageData.of((i,l,o)=>{let c=lw(i,l,o),u=c.type.prop(la);if(!u)return[];let h=i.facet(u),d=c.type.prop(tL);if(d){let f=c.resolve(l-c.from,o);for(let p of d)if(p.test(f,i)){let m=i.facet(p.facet);return p.type=="replace"?m:m.concat(h)}}return h})].concat(r)}isActiveAt(e,n,r=-1){return lw(e,n,r).type.prop(la)==this.data}findRegions(e){let n=e.facet(Ga);if((n==null?void 0:n.data)==this.data)return[{from:0,to:e.doc.length}];if(!n||!n.allowsNesting)return[];let r=[],s=(i,l)=>{if(i.prop(la)==this.data){r.push({from:l,to:l+i.length});return}let o=i.prop(We.mounted);if(o){if(o.tree.prop(la)==this.data){if(o.overlay)for(let c of o.overlay)r.push({from:c.from+l,to:c.to+l});else r.push({from:l,to:l+i.length});return}else if(o.overlay){let c=r.length;if(s(o.tree,o.overlay[0].from+l),r.length>c)return}}for(let c=0;c<i.children.length;c++){let u=i.children[c];u instanceof kt&&s(u,i.positions[c]+l)}};return s(ms(e),0),r}get allowsNesting(){return!0}}Ir.setState=Ht.define();function lw(t,e,n){let r=t.facet(Ga),s=ms(t).topNode;if(!r||r.allowsNesting)for(let i=s;i;i=i.enter(e,n,rn.ExcludeBuffers))i.type.isTop&&(s=i);return s}function ms(t){let e=t.field(Ir.state,!1);return e?e.tree:kt.empty}class nL{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,n){let r=this.cursorPos-this.string.length;return e<r||n>=this.cursorPos?this.doc.sliceString(e,n):this.string.slice(e-r,n-r)}}let So=null;class Ka{constructor(e,n,r=[],s,i,l,o,c){this.parser=e,this.state=n,this.fragments=r,this.tree=s,this.treeLen=i,this.viewport=l,this.skipped=o,this.scheduleOn=c,this.parse=null,this.tempSkipped=[]}static create(e,n,r){return new Ka(e,n,[],kt.empty,0,r,[],null)}startParse(){return this.parser.startParse(new nL(this.state.doc),this.fragments)}work(e,n){return n!=null&&n>=this.state.doc.length&&(n=void 0),this.tree!=kt.empty&&this.isDone(n??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var r;if(typeof e=="number"){let s=Date.now()+e;e=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),n!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>n)&&n<this.state.doc.length&&this.parse.stopAt(n);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(pl.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(r=this.parse.stoppedAt)!==null&&r!==void 0?r:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(n??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,n;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(n=this.parse.advance()););}),this.treeLen=e,this.tree=n,this.fragments=this.withoutTempSkipped(pl.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let n=So;So=this;try{return e()}finally{So=n}}withoutTempSkipped(e){for(let n;n=this.tempSkipped.pop();)e=aw(e,n.from,n.to);return e}changes(e,n){let{fragments:r,tree:s,treeLen:i,viewport:l,skipped:o}=this;if(this.takeTree(),!e.empty){let c=[];if(e.iterChangedRanges((u,h,d,f)=>c.push({fromA:u,toA:h,fromB:d,toB:f})),r=pl.applyChanges(r,c),s=kt.empty,i=0,l={from:e.mapPos(l.from,-1),to:e.mapPos(l.to,1)},this.skipped.length){o=[];for(let u of this.skipped){let h=e.mapPos(u.from,1),d=e.mapPos(u.to,-1);h<d&&o.push({from:h,to:d})}}}return new Ka(this.parser,n,r,s,i,l,o,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let n=this.skipped.length;for(let r=0;r<this.skipped.length;r++){let{from:s,to:i}=this.skipped[r];s<e.to&&i>e.from&&(this.fragments=aw(this.fragments,s,i),this.skipped.splice(r--,1))}return this.skipped.length>=n?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,n){this.skipped.push({from:e,to:n})}static getSkippingParser(e){return new class extends ON{createParse(n,r,s){let i=s[0].from,l=s[s.length-1].to;return{parsedPos:i,advance(){let c=So;if(c){for(let u of s)c.tempSkipped.push(u);e&&(c.scheduleOn=c.scheduleOn?Promise.all([c.scheduleOn,e]):e)}return this.parsedPos=l,new kt(Kn.none,[],[],l-i)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let n=this.fragments;return this.treeLen>=e&&n.length&&n[0].from==0&&n[0].to>=e}static get(){return So}}function aw(t,e,n){return pl.applyChanges(t,[{fromA:e,toA:n,fromB:e,toB:n}])}class Qa{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let n=this.context.changes(e.changes,e.state),r=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),n.viewport.to);return n.work(20,r)||n.takeTree(),new Qa(n)}static init(e){let n=Math.min(3e3,e.doc.length),r=Ka.create(e.facet(Ga).parser,e,{from:0,to:n});return r.work(20,n)||r.takeTree(),new Qa(r)}}Ir.state=Tl.define({create:Qa.init,update(t,e){for(let n of e.effects)if(n.is(Ir.setState))return n.value;return e.startState.facet(Ga)!=e.state.facet(Ga)?Qa.init(e.state):t.apply(e)}});let BN=t=>{let e=setTimeout(()=>t(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(BN=t=>{let e=-1,n=setTimeout(()=>{e=requestIdleCallback(t,{timeout:400})},100);return()=>e<0?clearTimeout(n):cancelIdleCallback(e)});const yp=typeof navigator<"u"&&(!((xp=navigator.scheduling)===null||xp===void 0)&&xp.isInputPending)?()=>navigator.scheduling.isInputPending():null,rL=ps.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let n=this.view.state.field(Ir.state).context;(n.updateViewport(e.view.viewport)||this.view.viewport.to>n.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(n)}scheduleWork(){if(this.working)return;let{state:e}=this.view,n=e.field(Ir.state);(n.tree!=n.context.tree||!n.context.isDone(e.doc.length))&&(this.working=BN(this.work))}work(e){this.working=null;let n=Date.now();if(this.chunkEnd<n&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=n+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:r,viewport:{to:s}}=this.view,i=r.field(Ir.state);if(i.tree==i.context.tree&&i.context.isDone(s+1e5))return;let l=Date.now()+Math.min(this.chunkBudget,100,e&&!yp?Math.max(25,e.timeRemaining()-5):1e9),o=i.context.treeLen<s&&r.doc.length>s+1e3,c=i.context.work(()=>yp&&yp()||Date.now()>l,s+(o?0:1e5));this.chunkBudget-=Date.now()-n,(c||this.chunkBudget<=0)&&(i.context.takeTree(),this.view.dispatch({effects:Ir.setState.of(new Qa(i.context))})),this.chunkBudget>0&&!(c&&!o)&&this.scheduleWork(),this.checkAsyncSchedule(i.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(n=>cs(this.view.state,n)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Ga=_e.define({combine(t){return t.length?t[0]:null},enables:t=>[Ir.state,rL,Oe.contentAttributes.compute([t],e=>{let n=e.facet(t);return n&&n.name?{"data-language":n.name}:{}})]}),sL=_e.define(),R0=_e.define({combine:t=>{if(!t.length)return"  ";let e=t[0];if(!e||/\S/.test(e)||Array.from(e).some(n=>n!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(t[0]));return e}});function Al(t){let e=t.facet(R0);return e.charCodeAt(0)==9?t.tabSize*e.length:e.length}function vh(t,e){let n="",r=t.tabSize,s=t.facet(R0)[0];if(s=="	"){for(;e>=r;)n+="	",e-=r;s=" "}for(let i=0;i<e;i++)n+=s;return n}function zN(t,e){t instanceof Ze&&(t=new rf(t));for(let r of t.state.facet(sL)){let s=r(t,e);if(s!==void 0)return s}let n=ms(t.state);return n.length>=e?iL(t,n,e):null}class rf{constructor(e,n={}){this.state=e,this.options=n,this.unit=Al(e)}lineAt(e,n=1){let r=this.state.doc.lineAt(e),{simulateBreak:s,simulateDoubleBreak:i}=this.options;return s!=null&&s>=r.from&&s<=r.to?i&&s==e?{text:"",from:e}:(n<0?s<e:s<=e)?{text:r.text.slice(s-r.from),from:s}:{text:r.text.slice(0,s-r.from),from:r.from}:r}textAfterPos(e,n=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:r,from:s}=this.lineAt(e,n);return r.slice(e-s,Math.min(r.length,e+100-s))}column(e,n=1){let{text:r,from:s}=this.lineAt(e,n),i=this.countColumn(r,e-s),l=this.options.overrideIndentation?this.options.overrideIndentation(s):-1;return l>-1&&(i+=l-this.countColumn(r,r.search(/\S|$/))),i}countColumn(e,n=e.length){return Yh(e,this.state.tabSize,n)}lineIndent(e,n=1){let{text:r,from:s}=this.lineAt(e,n),i=this.options.overrideIndentation;if(i){let l=i(s);if(l>-1)return l}return this.countColumn(r,r.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const $N=new We;function iL(t,e,n){let r=e.resolveStack(n),s=e.resolveInner(n,-1).resolve(n,0).enterUnfinishedNodesBefore(n);if(s!=r.node){let i=[];for(let l=s;l&&!(l.from<r.node.from||l.to>r.node.to||l.from==r.node.from&&l.type==r.node.type);l=l.parent)i.push(l);for(let l=i.length-1;l>=0;l--)r={node:i[l],next:r}}return UN(r,t,n)}function UN(t,e,n){for(let r=t;r;r=r.next){let s=aL(r.node);if(s)return s(D0.create(e,n,r))}return 0}function lL(t){return t.pos==t.options.simulateBreak&&t.options.simulateDoubleBreak}function aL(t){let e=t.type.prop($N);if(e)return e;let n=t.firstChild,r;if(n&&(r=n.type.prop(We.closedBy))){let s=t.lastChild,i=s&&r.indexOf(s.name)>-1;return l=>dL(l,!0,1,void 0,i&&!lL(l)?s.from:void 0)}return t.parent==null?oL:null}function oL(){return 0}class D0 extends rf{constructor(e,n,r){super(e.state,e.options),this.base=e,this.pos=n,this.context=r}get node(){return this.context.node}static create(e,n,r){return new D0(e,n,r)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let n=this.state.doc.lineAt(e.from);for(;;){let r=e.resolve(n.from);for(;r.parent&&r.parent.from==r.from;)r=r.parent;if(cL(r,e))break;n=this.state.doc.lineAt(r.from)}return this.lineIndent(n.from)}continue(){return UN(this.context.next,this.base,this.pos)}}function cL(t,e){for(let n=e;n;n=n.parent)if(t==n)return!0;return!1}function uL(t){let e=t.node,n=e.childAfter(e.from),r=e.lastChild;if(!n)return null;let s=t.options.simulateBreak,i=t.state.doc.lineAt(n.from),l=s==null||s<=i.from?i.to:Math.min(i.to,s);for(let o=n.to;;){let c=e.childAfter(o);if(!c||c==r)return null;if(!c.type.isSkipped){if(c.from>=l)return null;let u=/^ */.exec(i.text.slice(n.to-i.from))[0].length;return{from:n.from,to:n.to+u}}o=c.to}}function dL(t,e,n,r,s){let i=t.textAfter,l=i.match(/^\s*/)[0].length,o=r&&i.slice(l,l+r.length)==r||s==t.pos+l,c=uL(t);return c?o?t.column(c.from):t.column(c.to):t.baseIndent+(o?0:t.unit*n)}class sf{constructor(e,n){this.specs=e;let r;function s(o){let c=Ri.newName();return(r||(r=Object.create(null)))["."+c]=o,c}const i=typeof n.all=="string"?n.all:n.all?s(n.all):void 0,l=n.scope;this.scope=l instanceof Ir?o=>o.prop(la)==l.data:l?o=>o==l:void 0,this.style=FN(e.map(o=>({tag:o.tag,class:o.class||s(Object.assign({},o,{tag:null}))})),{all:i}).style,this.module=r?new Ri(r):null,this.themeType=n.themeType}static define(e,n){return new sf(e,n||{})}}const $g=_e.define(),HN=_e.define({combine(t){return t.length?[t[0]]:null}});function bp(t){let e=t.facet($g);return e.length?e:t.facet(HN)}function hL(t,e){let n=[pL],r;return t instanceof sf&&(t.module&&n.push(Oe.styleModule.of(t.module)),r=t.themeType),e!=null&&e.fallback?n.push(HN.of(t)):r?n.push($g.computeN([Oe.darkTheme],s=>s.facet(Oe.darkTheme)==(r=="dark")?[t]:[])):n.push($g.of(t)),n}class fL{constructor(e){this.markCache=Object.create(null),this.tree=ms(e.state),this.decorations=this.buildDeco(e,bp(e.state)),this.decoratedTo=e.viewport.to}update(e){let n=ms(e.state),r=bp(e.state),s=r!=bp(e.startState),{viewport:i}=e.view,l=e.changes.mapPos(this.decoratedTo,1);n.length<i.to&&!s&&n.type==this.tree.type&&l>=i.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=l):(n!=this.tree||e.viewportChanged||s)&&(this.tree=n,this.decorations=this.buildDeco(e.view,r),this.decoratedTo=i.to)}buildDeco(e,n){if(!n||!this.tree.length)return Vt.none;let r=new _c;for(let{from:s,to:i}of e.visibleRanges)J6(this.tree,n,(l,o,c)=>{r.add(l,o,this.markCache[c]||(this.markCache[c]=Vt.mark({class:c})))},s,i);return r.finish()}}const pL=Xh.high(ps.fromClass(fL,{decorations:t=>t.decorations})),mL=1e4,gL="()[]{}",xL=new We;function Ug(t,e,n){let r=t.prop(e<0?We.openedBy:We.closedBy);if(r)return r;if(t.name.length==1){let s=n.indexOf(t.name);if(s>-1&&s%2==(e<0?1:0))return[n[s+e]]}return null}function Hg(t){let e=t.type.prop(xL);return e?e(t.node):t}function aa(t,e,n,r={}){let s=r.maxScanDistance||mL,i=r.brackets||gL,l=ms(t),o=l.resolveInner(e,n);for(let c=o;c;c=c.parent){let u=Ug(c.type,n,i);if(u&&c.from<c.to){let h=Hg(c);if(h&&(n>0?e>=h.from&&e<h.to:e>h.from&&e<=h.to))return yL(t,e,n,c,h,u,i)}}return bL(t,e,n,l,o.type,s,i)}function yL(t,e,n,r,s,i,l){let o=r.parent,c={from:s.from,to:s.to},u=0,h=o==null?void 0:o.cursor();if(h&&(n<0?h.childBefore(r.from):h.childAfter(r.to)))do if(n<0?h.to<=r.from:h.from>=r.to){if(u==0&&i.indexOf(h.type.name)>-1&&h.from<h.to){let d=Hg(h);return{start:c,end:d?{from:d.from,to:d.to}:void 0,matched:!0}}else if(Ug(h.type,n,l))u++;else if(Ug(h.type,-n,l)){if(u==0){let d=Hg(h);return{start:c,end:d&&d.from<d.to?{from:d.from,to:d.to}:void 0,matched:!1}}u--}}while(n<0?h.prevSibling():h.nextSibling());return{start:c,matched:!1}}function bL(t,e,n,r,s,i,l){let o=n<0?t.sliceDoc(e-1,e):t.sliceDoc(e,e+1),c=l.indexOf(o);if(c<0||c%2==0!=n>0)return null;let u={from:n<0?e-1:e,to:n>0?e+1:e},h=t.doc.iterRange(e,n>0?t.doc.length:0),d=0;for(let f=0;!h.next().done&&f<=i;){let p=h.value;n<0&&(f+=p.length);let m=e+f*n;for(let x=n>0?0:p.length-1,v=n>0?p.length:-1;x!=v;x+=n){let g=l.indexOf(p[x]);if(!(g<0||r.resolveInner(m+x,1).type!=s))if(g%2==0==n>0)d++;else{if(d==1)return{start:u,end:{from:m+x,to:m+x+1},matched:g>>1==c>>1};d--}}n>0&&(f+=p.length)}return h.done?{start:u,matched:!1}:null}function ow(t,e,n,r=0,s=0){e==null&&(e=t.search(/[^\s\u00a0]/),e==-1&&(e=t.length));let i=s;for(let l=r;l<e;l++)t.charCodeAt(l)==9?i+=n-i%n:i++;return i}class qN{constructor(e,n,r,s){this.string=e,this.tabSize=n,this.indentUnit=r,this.overrideIndent=s,this.pos=0,this.start=0,this.lastColumnPos=0,this.lastColumnValue=0}eol(){return this.pos>=this.string.length}sol(){return this.pos==0}peek(){return this.string.charAt(this.pos)||void 0}next(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)}eat(e){let n=this.string.charAt(this.pos),r;if(typeof e=="string"?r=n==e:r=n&&(e instanceof RegExp?e.test(n):e(n)),r)return++this.pos,n}eatWhile(e){let n=this.pos;for(;this.eat(e););return this.pos>n}eatSpace(){let e=this.pos;for(;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e}skipToEnd(){this.pos=this.string.length}skipTo(e){let n=this.string.indexOf(e,this.pos);if(n>-1)return this.pos=n,!0}backUp(e){this.pos-=e}column(){return this.lastColumnPos<this.start&&(this.lastColumnValue=ow(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue}indentation(){var e;return(e=this.overrideIndent)!==null&&e!==void 0?e:ow(this.string,null,this.tabSize)}match(e,n,r){if(typeof e=="string"){let s=l=>r?l.toLowerCase():l,i=this.string.substr(this.pos,e.length);return s(i)==s(e)?(n!==!1&&(this.pos+=e.length),!0):null}else{let s=this.string.slice(this.pos).match(e);return s&&s.index>0?null:(s&&n!==!1&&(this.pos+=s[0].length),s)}}current(){return this.string.slice(this.start,this.pos)}}function vL(t){return{name:t.name||"",token:t.token,blankLine:t.blankLine||(()=>{}),startState:t.startState||(()=>!0),copyState:t.copyState||wL,indent:t.indent||(()=>null),languageData:t.languageData||{},tokenTable:t.tokenTable||O0,mergeTokens:t.mergeTokens!==!1}}function wL(t){if(typeof t!="object")return t;let e={};for(let n in t){let r=t[n];e[n]=r instanceof Array?r.slice():r}return e}const cw=new WeakMap;class lf extends Ir{constructor(e){let n=eL(e.languageData),r=vL(e),s,i=new class extends ON{createParse(l,o,c){return new jL(s,l,o,c)}};super(n,i,[],e.name),this.topNode=CL(n,this),s=this,this.streamParser=r,this.stateAfter=new We({perNode:!0}),this.tokenTable=e.tokenTable?new QN(r.tokenTable):NL}static define(e){return new lf(e)}getIndent(e){let n,{overrideIndentation:r}=e.options;r&&(n=cw.get(e.state),n!=null&&n<e.pos-1e4&&(n=void 0));let s=L0(this,e.node.tree,e.node.from,e.node.from,n??e.pos),i,l;if(s?(l=s.state,i=s.pos+1):(l=this.streamParser.startState(e.unit),i=e.node.from),e.pos-i>1e4)return null;for(;i<e.pos;){let c=e.state.doc.lineAt(i),u=Math.min(e.pos,c.to);if(c.length){let h=r?r(c.from):-1,d=new qN(c.text,e.state.tabSize,e.unit,h<0?void 0:h);for(;d.pos<u-c.from;)WN(this.streamParser.token,d,l)}else this.streamParser.blankLine(l,e.unit);if(u==e.pos)break;i=c.to+1}let o=e.lineAt(e.pos);return r&&n==null&&cw.set(e.state,o.from),this.streamParser.indent(l,/^\s*(.*)/.exec(o.text)[1],e)}get allowsNesting(){return!1}}function L0(t,e,n,r,s){let i=n>=r&&n+e.length<=s&&e.prop(t.stateAfter);if(i)return{state:t.streamParser.copyState(i),pos:n+e.length};for(let l=e.children.length-1;l>=0;l--){let o=e.children[l],c=n+e.positions[l],u=o instanceof kt&&c<s&&L0(t,o,c,r,s);if(u)return u}return null}function VN(t,e,n,r,s){if(s&&n<=0&&r>=e.length)return e;!s&&n==0&&e.type==t.topNode&&(s=!0);for(let i=e.children.length-1;i>=0;i--){let l=e.positions[i],o=e.children[i],c;if(l<r&&o instanceof kt){if(!(c=VN(t,o,n-l,r-l,s)))break;return s?new kt(e.type,e.children.slice(0,i).concat(c),e.positions.slice(0,i+1),l+c.length):c}}return null}function kL(t,e,n,r,s){for(let i of e){let l=i.from+(i.openStart?25:0),o=i.to-(i.openEnd?25:0),c=l<=n&&o>n&&L0(t,i.tree,0-i.offset,n,o),u;if(c&&c.pos<=r&&(u=VN(t,i.tree,n+i.offset,c.pos+i.offset,!1)))return{state:c.state,tree:u}}return{state:t.streamParser.startState(s?Al(s):4),tree:kt.empty}}class jL{constructor(e,n,r,s){this.lang=e,this.input=n,this.fragments=r,this.ranges=s,this.stoppedAt=null,this.chunks=[],this.chunkPos=[],this.chunk=[],this.chunkReused=void 0,this.rangeIndex=0,this.to=s[s.length-1].to;let i=Ka.get(),l=s[0].from,{state:o,tree:c}=kL(e,r,l,this.to,i==null?void 0:i.state);this.state=o,this.parsedPos=this.chunkStart=l+c.length;for(let u=0;u<c.children.length;u++)this.chunks.push(c.children[u]),this.chunkPos.push(c.positions[u]);i&&this.parsedPos<i.viewport.from-1e5&&s.some(u=>u.from<=i.viewport.from&&u.to>=i.viewport.from)&&(this.state=this.lang.streamParser.startState(Al(i.state)),i.skipUntilInView(this.parsedPos,i.viewport.from),this.parsedPos=i.viewport.from),this.moveRangeIndex()}advance(){let e=Ka.get(),n=this.stoppedAt==null?this.to:Math.min(this.to,this.stoppedAt),r=Math.min(n,this.chunkStart+512);for(e&&(r=Math.min(r,e.viewport.to));this.parsedPos<r;)this.parseLine(e);return this.chunkStart<this.parsedPos&&this.finishChunk(),this.parsedPos>=n?this.finish():e&&this.parsedPos>=e.viewport.to?(e.skipUntilInView(this.parsedPos,n),this.finish()):null}stopAt(e){this.stoppedAt=e}lineAfter(e){let n=this.input.chunk(e);if(this.input.lineChunks)n==`
`&&(n="");else{let r=n.indexOf(`
`);r>-1&&(n=n.slice(0,r))}return e+n.length<=this.to?n:n.slice(0,this.to-e)}nextLine(){let e=this.parsedPos,n=this.lineAfter(e),r=e+n.length;for(let s=this.rangeIndex;;){let i=this.ranges[s].to;if(i>=r||(n=n.slice(0,i-(r-n.length)),s++,s==this.ranges.length))break;let l=this.ranges[s].from,o=this.lineAfter(l);n+=o,r=l+o.length}return{line:n,end:r}}skipGapsTo(e,n,r){for(;;){let s=this.ranges[this.rangeIndex].to,i=e+n;if(r>0?s>i:s>=i)break;let l=this.ranges[++this.rangeIndex].from;n+=l-s}return n}moveRangeIndex(){for(;this.ranges[this.rangeIndex].to<this.parsedPos;)this.rangeIndex++}emitToken(e,n,r,s){let i=4;if(this.ranges.length>1){s=this.skipGapsTo(n,s,1),n+=s;let o=this.chunk.length;s=this.skipGapsTo(r,s,-1),r+=s,i+=this.chunk.length-o}let l=this.chunk.length-4;return this.lang.streamParser.mergeTokens&&i==4&&l>=0&&this.chunk[l]==e&&this.chunk[l+2]==n?this.chunk[l+2]=r:this.chunk.push(e,n,r,i),s}parseLine(e){let{line:n,end:r}=this.nextLine(),s=0,{streamParser:i}=this.lang,l=new qN(n,e?e.state.tabSize:4,e?Al(e.state):2);if(l.eol())i.blankLine(this.state,l.indentUnit);else for(;!l.eol();){let o=WN(i.token,l,this.state);if(o&&(s=this.emitToken(this.lang.tokenTable.resolve(o),this.parsedPos+l.start,this.parsedPos+l.pos,s)),l.start>1e4)break}this.parsedPos=r,this.moveRangeIndex(),this.parsedPos<this.to&&this.parsedPos++}finishChunk(){let e=kt.build({buffer:this.chunk,start:this.chunkStart,length:this.parsedPos-this.chunkStart,nodeSet:SL,topID:0,maxBufferLength:512,reused:this.chunkReused});e=new kt(e.type,e.children,e.positions,e.length,[[this.lang.stateAfter,this.lang.streamParser.copyState(this.state)]]),this.chunks.push(e),this.chunkPos.push(this.chunkStart-this.ranges[0].from),this.chunk=[],this.chunkReused=void 0,this.chunkStart=this.parsedPos}finish(){return new kt(this.lang.topNode,this.chunks,this.chunkPos,this.parsedPos-this.ranges[0].from).balance()}}function WN(t,e,n){e.start=e.pos;for(let r=0;r<10;r++){let s=t(e,n);if(e.pos>e.start)return s}throw new Error("Stream parser failed to advance stream.")}const O0=Object.create(null),Fc=[Kn.none],SL=new P0(Fc),uw=[],dw=Object.create(null),KN=Object.create(null);for(let[t,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])KN[t]=GN(O0,e);class QN{constructor(e){this.extra=e,this.table=Object.assign(Object.create(null),KN)}resolve(e){return e?this.table[e]||(this.table[e]=GN(this.extra,e)):0}}const NL=new QN(O0);function vp(t,e){uw.indexOf(t)>-1||(uw.push(t),console.warn(e))}function GN(t,e){let n=[];for(let o of e.split(" ")){let c=[];for(let u of o.split(".")){let h=t[u]||Ne[u];h?typeof h=="function"?c.length?c=c.map(h):vp(u,`Modifier ${u} used at start of tag`):c.length?vp(u,`Tag ${u} used as modifier`):c=Array.isArray(h)?h:[h]:vp(u,`Unknown highlighting tag ${u}`)}for(let u of c)n.push(u)}if(!n.length)return 0;let r=e.replace(/ /g,"_"),s=r+" "+n.map(o=>o.id),i=dw[s];if(i)return i.id;let l=dw[s]=Kn.define({id:Fc.length,name:r,props:[G6({[r]:n})]});return Fc.push(l),l.id}function CL(t,e){let n=Kn.define({id:Fc.length,name:"Document",props:[la.add(()=>t),$N.add(()=>r=>e.getIndent(r))],top:!0});return Fc.push(n),n}Et.RTL,Et.LTR;function XN(t){function e(d,f){d.cmdState.push(f)}function n(d){return d.cmdState.length>0?d.cmdState[d.cmdState.length-1]:null}function r(d){var f=d.cmdState.pop();f&&f.closeBracket()}function s(d){for(var f=d.cmdState,p=f.length-1;p>=0;p--){var m=f[p];if(m.name!="DEFAULT")return m}return{styleIdentifier:function(){return null}}}function i(d,f,p){return function(){this.name=d,this.bracketNo=0,this.style=f,this.styles=p,this.argument=null,this.styleIdentifier=function(){return this.styles[this.bracketNo-1]||null},this.openBracket=function(){return this.bracketNo++,"bracket"},this.closeBracket=function(){}}}var l={};l.importmodule=i("importmodule","tag",["string","builtin"]),l.documentclass=i("documentclass","tag",["","atom"]),l.usepackage=i("usepackage","tag",["atom"]),l.begin=i("begin","tag",["atom"]),l.end=i("end","tag",["atom"]),l.label=i("label","tag",["atom"]),l.ref=i("ref","tag",["atom"]),l.eqref=i("eqref","tag",["atom"]),l.cite=i("cite","tag",["atom"]),l.bibitem=i("bibitem","tag",["atom"]),l.Bibitem=i("Bibitem","tag",["atom"]),l.RBibitem=i("RBibitem","tag",["atom"]),l.DEFAULT=function(){this.name="DEFAULT",this.style="tag",this.styleIdentifier=this.openBracket=this.closeBracket=function(){}};function o(d,f){d.f=f}function c(d,f){var p;if(d.match(/^\\[a-zA-Z@\xc0-\u1fff\u2060-\uffff]+/)){var m=d.current().slice(1);return p=l.hasOwnProperty(m)?l[m]:l.DEFAULT,p=new p,e(f,p),o(f,h),p.style}if(d.match(/^\\[$&%#{}_]/)||d.match(/^\\[,;!\/\\]/))return"tag";if(d.match("\\["))return o(f,function(v,g){return u(v,g,"\\]")}),"keyword";if(d.match("\\("))return o(f,function(v,g){return u(v,g,"\\)")}),"keyword";if(d.match("$$"))return o(f,function(v,g){return u(v,g,"$$")}),"keyword";if(d.match("$"))return o(f,function(v,g){return u(v,g,"$")}),"keyword";var x=d.next();if(x=="%")return d.skipToEnd(),"comment";if(x=="}"||x=="]"){if(p=n(f),p)p.closeBracket(x),o(f,h);else return"error";return"bracket"}else return x=="{"||x=="["?(p=l.DEFAULT,p=new p,e(f,p),"bracket"):/\d/.test(x)?(d.eatWhile(/[\w.%]/),"atom"):(d.eatWhile(/[\w\-_]/),p=s(f),p.name=="begin"&&(p.argument=d.current()),p.styleIdentifier())}function u(d,f,p){if(d.eatSpace())return null;if(p&&d.match(p))return o(f,c),"keyword";if(d.match(/^\\[a-zA-Z@]+/))return"tag";if(d.match(/^[a-zA-Z]+/))return"variableName.special";if(d.match(/^\\[$&%#{}_]/)||d.match(/^\\[,;!\/]/)||d.match(/^[\^_&]/))return"tag";if(d.match(/^[+\-<>|=,\/@!*:;'"`~#?]/))return null;if(d.match(/^(\d+\.\d*|\d*\.\d+|\d+)/))return"number";var m=d.next();return m=="{"||m=="}"||m=="["||m=="]"||m=="("||m==")"?"bracket":m=="%"?(d.skipToEnd(),"comment"):"error"}function h(d,f){var p=d.peek(),m;return p=="{"||p=="["?(m=n(f),m.openBracket(p),d.eat(p),o(f,c),"bracket"):/[ \t\r]/.test(p)?(d.eat(p),null):(o(f,c),r(f),c(d,f))}return{name:"stex",startState:function(){var d=t?function(f,p){return u(f,p)}:c;return{cmdState:[],f:d}},copyState:function(d){return{cmdState:d.cmdState.slice(),f:d.f}},token:function(d,f){return f.f(d,f)},blankLine:function(d){d.f=c,d.cmdState.length=0},languageData:{commentTokens:{line:"%"}}}}const JN=XN(!1);XN(!0);const AL=[lf.define(JN),Oe.lineWrapping,Oe.theme({"&":{fontSize:"13px",backgroundColor:"#fff"},".cm-content":{padding:"12px"},".cm-scroller":{overflow:"auto"}})];function hw(t,e){const n=Ze.create({doc:e||"",extensions:[...AL,Oe.editable.of(!1)]});return new Oe({state:n,parent:t})}const EL=({paperId:t,onMerged:e})=>{const[n,r]=w.useState([]),[s,i]=w.useState(""),[l,o]=w.useState(""),[c,u]=w.useState(""),[h,d]=w.useState(""),[f,p]=w.useState(""),[m,x]=w.useState(null),[v,g]=w.useState([]),[y,b]=w.useState([]),[k,S]=w.useState({}),j=w.useRef(null),E=w.useRef(null),A=w.useRef(null),T=w.useRef(null);w.useEffect(()=>{(async()=>{const _=await is.getBranches(t);r(_);const M=_.find(z=>z.isMain)||_[0];M&&o(M.id)})()},[t]),w.useEffect(()=>{(async()=>{var H,Y;if(!s||!l)return;const[M,z]=await Promise.all([is.getCommitHistory(s),is.getCommitHistory(l)]);g(M),b(z);const q=M[0],F=z[0],V=((H=q==null?void 0:q.content_json)==null?void 0:H.latex_source)||(q==null?void 0:q.content)||"",P=((Y=F==null?void 0:F.content_json)==null?void 0:Y.latex_source)||(F==null?void 0:F.content)||"";u(V),d(P),p(P),x(uS(V,P))})()},[s,l]),w.useEffect(()=>{var _,M;if(j.current){try{(_=A.current)==null||_.destroy()}catch{}A.current=hw(j.current,c)}if(E.current){try{(M=T.current)==null||M.destroy()}catch{}T.current=hw(E.current,h)}return()=>{var z,q;try{(z=A.current)==null||z.destroy()}catch{}try{(q=T.current)==null||q.destroy()}catch{}}},[c,h]);const N=!!m,I=(m==null?void 0:m.conflicts)||[],R=()=>{if(!m)return;const _={};m.added.forEach(M=>{_[M.key]="right"}),m.removed.forEach(M=>{_[M.key]="left"}),m.modified.forEach(M=>{_[M.key]||(_[M.key]="right")}),S(_)},C=()=>{const _=hR(f,c,h,k);e==null||e(_)};return a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[a.jsx(D5,{className:"w-4 h-4"}),a.jsx("div",{className:"font-medium",children:"Merge Changes"})]}),a.jsxs("div",{className:"flex gap-3 items-end",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"text-xs text-gray-600",children:"Source Branch"}),a.jsxs("select",{className:"w-full border rounded p-2",value:s,onChange:_=>i(_.target.value),children:[a.jsx("option",{value:"",children:"Select"}),n.map(_=>a.jsx("option",{value:_.id,children:_.name},_.id))]})]}),a.jsxs("div",{className:"flex-1",children:[a.jsx("label",{className:"text-xs text-gray-600",children:"Target Branch"}),a.jsxs("select",{className:"w-full border rounded p-2",value:l,onChange:_=>o(_.target.value),children:[a.jsx("option",{value:"",children:"Select"}),n.map(_=>a.jsx("option",{value:_.id,children:_.name},_.id))]})]}),a.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded disabled:opacity-50",disabled:!s||!l,onClick:R,children:"Auto-merge non-overlapping"}),a.jsx("button",{className:"px-3 py-2 bg-green-600 text-white rounded disabled:opacity-50",disabled:!N,onClick:C,children:"Apply Merge"}),a.jsxs("button",{className:"px-3 py-2 bg-gray-700 text-white rounded disabled:opacity-50 flex items-center gap-1",disabled:!s||!l,onClick:async()=>{try{const _=n.find(z=>z.id===s),M=n.find(z=>z.id===l);await is.createMergeRequest(s,l,`Merge ${_==null?void 0:_.name} into ${M==null?void 0:M.name}`,"Proposed merge of changes"),alert("Merge Request created")}catch(_){console.error(_)}},children:[a.jsx(O5,{className:"w-4 h-4"})," Create MR"]})]}),m&&a.jsxs("div",{className:"text-xs text-gray-700",children:[a.jsxs("div",{className:"flex gap-4 mb-1",children:[a.jsxs("div",{children:["Added: ",a.jsx("span",{className:"font-semibold text-green-700",children:m.added.length})]}),a.jsxs("div",{children:["Removed: ",a.jsx("span",{className:"font-semibold text-red-700",children:m.removed.length})]}),a.jsxs("div",{children:["Modified: ",a.jsx("span",{className:"font-semibold text-yellow-700",children:m.modified.length})]}),a.jsxs("div",{children:["Reordered: ",a.jsx("span",{className:"font-semibold text-blue-700",children:m.reordered.length})]}),I.length>0&&a.jsxs("div",{className:"flex items-center gap-1 text-red-700",children:[a.jsx(LT,{className:"w-4 h-4"})," Conflicts: ",I.length]})]}),a.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[a.jsxs("div",{className:"border rounded p-2",children:[a.jsx("div",{className:"font-medium text-green-700 mb-1",children:"New sections"}),a.jsxs("ul",{className:"space-y-0.5 max-h-24 overflow-auto",children:[m.added.map(_=>a.jsx("li",{children:_.key},_.key)),m.added.length===0&&a.jsx("li",{className:"text-gray-500",children:"None"})]})]}),a.jsxs("div",{className:"border rounded p-2",children:[a.jsx("div",{className:"font-medium text-red-700 mb-1",children:"Removed sections"}),a.jsxs("ul",{className:"space-y-0.5 max-h-24 overflow-auto",children:[m.removed.map(_=>a.jsx("li",{children:_.key},_.key)),m.removed.length===0&&a.jsx("li",{className:"text-gray-500",children:"None"})]})]}),a.jsxs("div",{className:"border rounded p-2",children:[a.jsx("div",{className:"font-medium text-blue-700 mb-1",children:"Reordered"}),a.jsxs("ul",{className:"space-y-0.5 max-h-24 overflow-auto",children:[m.reordered.map(_=>a.jsx("li",{children:_},_)),m.reordered.length===0&&a.jsx("li",{className:"text-gray-500",children:"None"})]})]})]})]}),(v.length>0||y.length>0)&&a.jsxs("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[a.jsxs("div",{className:"border rounded",children:[a.jsx("div",{className:"px-2 py-1 bg-gray-50 border-b",children:"Source commits"}),a.jsxs("ul",{className:"max-h-28 overflow-auto divide-y",children:[v.slice(0,5).map(_=>a.jsxs("li",{className:"px-2 py-1",children:[a.jsx("div",{className:"font-medium",children:_.message}),a.jsx("div",{className:"text-gray-500",children:new Date(_.timestamp).toLocaleString()})]},_.id)),v.length===0&&a.jsx("li",{className:"px-2 py-2 text-gray-500",children:"No commits"})]})]}),a.jsxs("div",{className:"border rounded",children:[a.jsx("div",{className:"px-2 py-1 bg-gray-50 border-b",children:"Target commits"}),a.jsxs("ul",{className:"max-h-28 overflow-auto divide-y",children:[y.slice(0,5).map(_=>a.jsxs("li",{className:"px-2 py-1",children:[a.jsx("div",{className:"font-medium",children:_.message}),a.jsx("div",{className:"text-gray-500",children:new Date(_.timestamp).toLocaleString()})]},_.id)),y.length===0&&a.jsx("li",{className:"px-2 py-2 text-gray-500",children:"No commits"})]})]})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[a.jsxs("div",{className:"border rounded overflow-hidden",children:[a.jsx("div",{className:"px-2 py-1 text-xs bg-gray-50 border-b",children:"Source preview"}),a.jsx("div",{ref:j,className:"h-[300px]"})]}),a.jsxs("div",{className:"border rounded overflow-hidden",children:[a.jsx("div",{className:"px-2 py-1 text-xs bg-gray-50 border-b",children:"Target preview"}),a.jsx("div",{ref:E,className:"h-[300px]"})]})]}),I.length>0&&a.jsxs("div",{className:"mt-3",children:[a.jsx("div",{className:"text-sm font-medium mb-2",children:"Resolve Conflicts"}),a.jsx("div",{className:"space-y-2",children:I.map(_=>a.jsxs("div",{className:"border rounded p-2",children:[a.jsx("div",{className:"text-xs text-gray-600 mb-1",children:_.key}),a.jsxs("div",{className:"flex gap-2 text-xs",children:[a.jsxs("label",{className:"inline-flex items-center gap-1",children:[a.jsx("input",{type:"radio",name:`pick-${_.key}`,checked:(k[_.key]||"right")==="left",onChange:()=>S(M=>({...M,[_.key]:"left"}))})," Source"]}),a.jsxs("label",{className:"inline-flex items-center gap-1",children:[a.jsx("input",{type:"radio",name:`pick-${_.key}`,checked:(k[_.key]||"right")==="right",onChange:()=>S(M=>({...M,[_.key]:"right"}))})," Target"]}),a.jsxs("label",{className:"inline-flex items-center gap-1",children:[a.jsx("input",{type:"radio",name:`pick-${_.key}`,checked:(k[_.key]||"right")==="both",onChange:()=>S(M=>({...M,[_.key]:"both"}))})," Both"]})]})]},_.key))})]})]})},PL=({paperId:t,open:e,onClose:n,onLoadVersion:r,currentVersion:s,pendingVersion:i,onPromote:l})=>{const[o,c]=w.useState(!1),[u,h]=w.useState(null),[d,f]=w.useState([]),[p,m]=w.useState(s||null);return w.useEffect(()=>{if(!e)return;let x=!1;return(async()=>{try{c(!0),h(null);const g=await rt.getPaperVersions(t);if(x)return;const y=g==null?void 0:g.data;f((y==null?void 0:y.versions)||[]),m((y==null?void 0:y.current_version)||s||null)}catch(g){x||h((g==null?void 0:g.message)||"Failed to load versions")}finally{x||c(!1)}})(),()=>{x=!0}},[e,t,s]),w.useEffect(()=>{e&&m(s||null)},[s,e]),e?a.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-30 flex items-center justify-center",onClick:n,children:a.jsxs("div",{className:"bg-white w-[720px] max-h-[80vh] rounded-lg shadow-xl overflow-hidden",onClick:x=>x.stopPropagation(),children:[a.jsxs("div",{className:"px-4 py-3 border-b flex items-center justify-between",children:[a.jsx("div",{className:"text-base font-semibold",children:"Versions"}),a.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:n,children:"Close"})]}),o&&a.jsx("div",{className:"p-4 text-sm text-gray-600",children:"Loading"}),u&&a.jsx("div",{className:"p-4 text-sm text-red-700",children:u}),!o&&!u&&a.jsxs("div",{className:"p-2 overflow-auto",style:{maxHeight:"calc(80vh - 56px)"},children:[i&&a.jsxs("div",{className:"px-3 py-2 mb-2 text-xs rounded-md border border-amber-300 bg-amber-50 text-amber-700",children:["Version ",i," is awaiting approval. Promote it to make it the default."]}),d.length===0?a.jsx("div",{className:"p-4 text-sm text-gray-500",children:"No versions yet."}):a.jsx("div",{className:"divide-y",children:d.map((x,v)=>{const g=x.created_at?new Date(x.created_at).toLocaleString():"",y=x.version_number||"Version",b=x.change_summary||"",k=x.created_by||"",S=x.content_json&&typeof x.content_json.latex_source=="string"?x.content_json.latex_source.length:(x.content||"").length,j=p?x.version_number===p:!1,E=!j&&i?x.version_number===i:!j&&v===0;return a.jsxs("div",{className:"px-3 py-2 flex items-start gap-3",children:[a.jsxs("div",{className:"flex-1 min-w-0",children:[a.jsx("div",{className:"text-sm font-medium text-gray-900 truncate",children:y}),a.jsxs("div",{className:"text-[11px] text-gray-600",children:[g,k?`  by ${k}`:"",S?`  ${S} chars`:""]}),a.jsxs("div",{className:"flex items-center gap-2 mt-1 flex-wrap",children:[b&&a.jsx("span",{className:"text-xs text-gray-700",children:b}),j&&a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-700 border border-emerald-200",children:"Default"}),E&&a.jsx("span",{className:"text-[11px] px-2 py-0.5 rounded-full bg-amber-100 text-amber-700 border border-amber-200",children:"Awaiting approval"})]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{className:"px-2 py-1 text-xs border rounded",onClick:()=>{const A=x.content_json&&x.content_json.latex_source?x.content_json.latex_source:x.content||"";r(A||""),n()},children:"Load"}),!j&&a.jsx("button",{className:"px-2 py-1 text-xs border rounded bg-purple-600 text-white hover:bg-purple-700",onClick:async()=>{try{await rt.restorePaperVersion(t,x.version_number);const A=await rt.getPaperVersions(t);h(null);const T=A==null?void 0:A.data;f((T==null?void 0:T.versions)||[]),m((T==null?void 0:T.current_version)||x.version_number),l&&await l(x.version_number)}catch(A){h((A==null?void 0:A.message)||"Failed to promote version")}},children:E?"Make Default":"Set Default"})]})]},x.id)})})]})]})}):null},_L=({paperId:t,content:e,onClose:n,onJumpToLine:r,onReplaceLines:s,lockedKeys:i,onLockToggle:l,baseline:o,onRevertAll:c})=>{const u=w.useMemo(()=>gi(e),[e]),h=w.useMemo(()=>dR(u),[u]),[d,f]=w.useState(""),[p,m]=w.useState(!1);w.useEffect(()=>{(async()=>{try{if(m(!0),typeof o=="string")f(o);else{const g=await rt.getPaperVersions(t),y=g==null?void 0:g.data,k=((y==null?void 0:y.versions)||[])[0],S=k!=null&&k.content_json&&k.content_json.latex_source?k.content_json.latex_source:(k==null?void 0:k.content)||"";f(S||"")}}catch{f("")}finally{m(!1)}})()},[t,o]);const x=w.useMemo(()=>{if(!d)return new Set;const g=uS(d,e);return new Set([...g.added.map(b=>b.key),...g.removed.map(b=>b.key),...g.modified.map(b=>b.key)])},[d,e]),v=g=>{const y=i&&i[g.key],b=x.has(g.key);return a.jsxs("div",{className:"pl-2 border-l",children:[a.jsxs("div",{className:"flex items-center justify-between py-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{className:"text-left text-sm hover:underline",onClick:()=>r(g.lineStart),children:g.title}),b&&a.jsx("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-yellow-100 text-yellow-800",children:"changed"}),y&&a.jsxs("span",{className:"text-[10px] px-1.5 py-0.5 rounded bg-red-100 text-red-700 flex items-center gap-1",children:[a.jsx(nv,{className:"w-3 h-3"})," ",y.userName]})]}),a.jsxs("div",{className:"flex items-center gap-1",children:[a.jsxs("button",{title:"Compare with HEAD",className:"px-1.5 py-0.5 text-xs border rounded flex items-center gap-1",onClick:async()=>{var k,S;try{const j=((k=gi(d).find(T=>T.key===g.key))==null?void 0:k.content)||"",E=((S=gi(e).find(T=>T.key===g.key))==null?void 0:S.content)||"",A=window.open("","_blank","width=700,height=500");A&&A.document.write(`<pre style="white-space:pre-wrap;padding:8px;">--- HEAD
${j}

--- Current
${E}</pre>`)}catch{}},children:[a.jsx(T5,{className:"w-3 h-3"})," Compare"]}),a.jsx("button",{title:"Revert to HEAD",className:"px-1.5 py-0.5 text-xs border rounded",onClick:async()=>{try{const k=gi(d).find(S=>S.key===g.key);if(!k)return;s(k.lineStart||1,k.lineEnd||k.lineStart||1,k.content||"")}catch{}},children:"Revert"}),l&&a.jsx("button",{title:y?"Unlock":"Lock",className:"px-1.5 py-0.5 text-xs border rounded",onClick:()=>l(g.key,!y),children:y?a.jsx(W5,{className:"w-3 h-3"}):a.jsx(nv,{className:"w-3 h-3"})})]})]}),g.children.length>0&&a.jsx("div",{className:"pl-3",children:g.children.map(v)})]},g.key)};return a.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-30 flex items-center justify-end",onClick:n,children:a.jsxs("div",{className:"bg-white w-[420px] h-full p-3 overflow-auto",onClick:g=>g.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between mb-2",children:[a.jsx("div",{className:"font-semibold",children:"Changes vs Published"}),a.jsxs("div",{className:"flex items-center gap-2",children:[c&&a.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:c,children:"Revert All"}),a.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:n,children:"Close"})]})]}),p&&a.jsx("div",{className:"text-xs text-gray-500 mb-2",children:"Loading published"}),a.jsx("div",{className:"space-y-1",children:h.map(v)})]})})},ML=({selectedText:t,onReplaceText:e,onInsertText:n,paperIds:r=[],currentPaperContent:s="",onCitationInsert:i,open:l,onOpenChange:o,showLauncher:c=!0})=>{const u=typeof l=="boolean",[h,d]=w.useState(!1),f=u?!!l:h,p=M=>{u||d(M),o==null||o(M)},[m,x]=w.useState(null),[v,g]=w.useState(null),[y,b]=w.useState(null),[k,S]=w.useState(""),[j,E]=w.useState(!1),A=t.trim().length>0,T=[{id:"expand",name:"Expand Text",description:"Expand and elaborate on selected text",icon:a.jsx(x5,{size:16}),action:()=>N("expand"),requiresSelection:!0,category:"writing",shortcut:"Ctrl+Shift+E"},{id:"rephrase",name:"Rephrase",description:"Rewrite text in different words",icon:a.jsx(Jo,{size:16}),action:()=>N("rephrase"),requiresSelection:!0,category:"writing",shortcut:"Ctrl+Shift+R"},{id:"complete",name:"Complete Sentence",description:"Continue writing from where you left off",icon:a.jsx(MM,{size:16}),action:()=>N("complete"),requiresSelection:!0,category:"writing",shortcut:"Ctrl+Shift+C"},{id:"summarize",name:"Summarize",description:"Create a concise summary",icon:a.jsx(ln,{size:16}),action:()=>N("summarize"),requiresSelection:!0,category:"writing",shortcut:"Ctrl+Shift+S"},{id:"grammar",name:"Grammar Check",description:"Check grammar, spelling, and style",icon:a.jsx(rv,{size:16}),action:()=>N("grammar"),requiresSelection:!0,category:"style",shortcut:"Ctrl+Shift+G"},{id:"academic",name:"Academic Style",description:"Convert to formal academic writing",icon:a.jsx(rg,{size:16}),action:()=>N("academic"),requiresSelection:!0,category:"style",shortcut:"Ctrl+Shift+A"},{id:"enhance",name:"Research Enhancement",description:"Enhance with research context",icon:a.jsx(hs,{size:16}),action:()=>N("enhance"),requiresSelection:!0,category:"research",shortcut:"Ctrl+Shift+H"},{id:"analyze",name:"Analyze Text",description:"Get insights and analysis",icon:a.jsx(ep,{size:16}),action:()=>N("analyze"),requiresSelection:!0,category:"analysis",shortcut:"Ctrl+Shift+L"},{id:"smart_suggest",name:"Smart Suggestions",description:"Get AI-powered writing suggestions",icon:a.jsx(Ec,{size:16}),action:()=>N("smart_suggest"),requiresSelection:!1,category:"writing",shortcut:"Ctrl+Shift+I"},{id:"citation_help",name:"Citation Help",description:"Get help with citations and references",icon:a.jsx(Y5,{size:16}),action:()=>N("citation_help"),requiresSelection:!1,category:"research",shortcut:"Ctrl+Shift+Q"}],N=async M=>{var z,q;if(!(M==="smart_suggest"||M==="citation_help")){if(!A){b("Please select some text first");return}}x(M),b(null),g(null),E(!0);try{let F;const V=`${k}

Current paper content: ${s.substring(0,1e3)}...`;switch(M){case"expand":F=await ur.generateText(t,"expand",V,300);break;case"rephrase":F=await ur.generateText(t,"rephrase",V,200);break;case"complete":F=await ur.generateText(t,"complete",V,200);break;case"summarize":F=await ur.generateText(t,"summarize",V,100);break;case"grammar":F=await ur.checkGrammarAndStyle(t,!0,!0,!0);break;case"academic":F=await ur.generateText(t,"academic_style",V,200);break;case"enhance":if(r.length===0){b("No research papers available for context enhancement");return}F=await ur.enhanceWithResearchContext(t,r,"enhance");break;case"analyze":F=await ur.generateText(t,"analyze",V,150);break;case"smart_suggest":F=await ur.generateText("","suggestions",V,100);break;case"citation_help":F=await ur.generateText("","citation_help",V,150);break;default:throw new Error("Unknown action")}console.log("AI Response:",F.data);const P={text:F.data.generated_text||F.data.corrected_text||F.data.enhanced_text||F.data.text||"",confidence:F.data.confidence||.8,suggestions:F.data.suggestions||[],citations:F.data.citations||[],reasoning:F.data.reasoning||""};if(console.log("Processed Result:",P),!P.text||P.text.trim()==="")throw new Error("AI response did not contain valid text content");g(P)}catch(F){b(((q=(z=F.response)==null?void 0:z.data)==null?void 0:q.detail)||F.message||"An error occurred")}finally{x(null),E(!1)}},I=()=>{v&&(console.log("Applying AI result:",v.text),console.log("Text length:",v.text.length),console.log("Text preview:",v.text.substring(0,200)),m==="grammar"||["enhance","academic","rephrase"].includes(m||"")?e(v.text):n(v.text),g(null))},R=()=>{v!=null&&v.text&&(navigator.clipboard.writeText(v.text),setTimeout(()=>g(null),2e3))},C=()=>{m&&N(m)},_=M=>{switch(M){case"writing":return a.jsx(rv,{size:14});case"style":return a.jsx(rg,{size:14});case"research":return a.jsx(hs,{size:14});case"analysis":return a.jsx(ep,{size:14});default:return a.jsx(vr,{size:14})}};return w.useEffect(()=>{const M=z=>{if(z.ctrlKey&&z.shiftKey){if(z.key.toLowerCase()==="k"){z.preventDefault(),p(!f);return}const q=T.find(F=>F.shortcut===`Ctrl+Shift+${z.key.toUpperCase()}`);q&&(z.preventDefault(),q.action())}};return document.addEventListener("keydown",M),()=>document.removeEventListener("keydown",M)},[T,f]),f?a.jsxs("div",{className:"fixed bottom-6 right-6 z-50 w-96 max-h-[80vh] bg-white rounded-lg shadow-2xl border border-gray-200 overflow-hidden",children:[a.jsx("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4",children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ep,{size:20}),a.jsx("h3",{className:"font-semibold",children:"AI Writing Assistant"})]}),a.jsx("button",{onClick:()=>p(!1),className:"text-white/80 hover:text-white transition-colors",children:a.jsx(Jt,{size:20})})]})}),a.jsxs("div",{className:"p-4 max-h-[calc(80vh-80px)] overflow-y-auto",children:[v?a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h4",{className:"font-medium text-gray-900",children:"AI Result"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{onClick:C,disabled:j,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Regenerate",children:a.jsx(dT,{size:16,className:j?"animate-spin":""})}),a.jsx("button",{onClick:R,className:"p-2 text-gray-600 hover:text-gray-800 transition-colors",title:"Copy to clipboard",children:a.jsx(Xs,{size:16})})]})]}),a.jsx("div",{className:"bg-gray-50 rounded-lg p-3",children:a.jsx("p",{className:"text-gray-800 whitespace-pre-wrap",children:v.text})}),v.suggestions&&v.suggestions.length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Suggestions:"}),a.jsx("ul",{className:"space-y-1",children:v.suggestions.map((M,z)=>a.jsxs("li",{className:"text-sm text-gray-600 flex items-center gap-2",children:[a.jsx("div",{className:"w-1.5 h-1.5 bg-blue-400 rounded-full"}),M]},z))})]}),v.citations&&v.citations.length>0&&a.jsxs("div",{children:[a.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Citations:"}),a.jsx("div",{className:"space-y-2",children:v.citations.map((M,z)=>a.jsx("button",{onClick:()=>i==null?void 0:i(M),className:"w-full text-left p-2 bg-blue-50 border border-blue-200 rounded text-sm text-blue-800 hover:bg-blue-100 transition-colors",children:M},z))})]}),a.jsxs("div",{className:"flex gap-2",children:[a.jsxs("button",{onClick:I,className:"flex-1 bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors flex items-center justify-center gap-2",children:[a.jsx(ql,{size:16}),"Apply Result"]}),a.jsx("button",{onClick:()=>g(null),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:"Cancel"})]})]}):a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Additional Context (Optional)"}),a.jsx("textarea",{value:k,onChange:M=>S(M.target.value),placeholder:"Add any specific instructions or context for the AI...",className:"w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-blue-500",rows:2})]}),["writing","style","research","analysis"].map(M=>a.jsxs("div",{children:[a.jsxs("h4",{className:"text-sm font-medium text-gray-700 mb-2 capitalize flex items-center gap-2",children:[_(M),M," Tools"]}),a.jsx("div",{className:"grid grid-cols-2 gap-2",children:T.filter(z=>z.category===M).map(z=>a.jsxs("button",{onClick:z.action,disabled:z.requiresSelection&&!A,className:`p-3 text-left rounded-lg border transition-all duration-200 hover:shadow-md ${z.requiresSelection&&!A?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white hover:bg-gray-50 border-gray-200"}`,title:`${z.description} ${z.shortcut?`(${z.shortcut})`:""}`,children:[a.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[z.icon,a.jsx("span",{className:"text-sm font-medium",children:z.name})]}),a.jsx("p",{className:"text-xs text-gray-600",children:z.description}),z.shortcut&&a.jsx("div",{className:"text-xs text-gray-400 mt-1 font-mono",children:z.shortcut})]},z.id))})]},M)),!A&&a.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:a.jsxs("div",{className:"flex items-center gap-2 text-yellow-800",children:[a.jsx(Ec,{size:16}),a.jsx("span",{className:"text-sm",children:"Select text to use most AI tools, or use Smart Suggestions for general help"})]})})]}),y&&a.jsxs("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:[a.jsxs("div",{className:"flex items-center gap-2 text-red-800",children:[a.jsx(Cc,{size:16}),a.jsx("span",{className:"text-sm",children:y})]}),a.jsx("button",{onClick:()=>b(null),className:"mt-2 text-sm text-red-600 hover:text-red-800",children:"Dismiss"})]})]})]}):c?a.jsx("button",{onClick:()=>p(!0),className:"fixed bottom-6 right-6 z-50 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-4 rounded-full shadow-lg hover:shadow-xl transition-all duration-200 hover:scale-105",title:"AI Writing Tools",children:a.jsx(vr,{size:24})}):null},I0=({paperId:t,projectId:e,paperTitle:n,initialContent:r="",initialContentJson:s,Adapter:i,fullBleed:l=!1,onHostContentChange:o,initialPaperRole:c,forceReadOnly:u=!1})=>{const h=Qn(),{user:d}=Ln(),f=w.useRef(null),[p,m]=w.useState(""),[x,v]=w.useState(!1),[g,y]=w.useState(!1),[b,k]=w.useState(!1),[S,j]=w.useState(void 0),[E,A]=w.useState(""),[T,N]=w.useState(!1),[I,R]=w.useState(""),[C,_]=w.useState(!1),[M,z]=w.useState({}),[q,F]=w.useState(""),[V,P]=w.useState({visible:!1,text:""}),[H,Y]=w.useState(!1),[L,Se]=w.useState(null),[we,ge]=w.useState(null),Ce=u?"viewer":c??"viewer",[Ie,re]=w.useState(Ce),[J,Q]=w.useState(!1),he=u||Ie==="viewer",Re=!he,De=$=>{P({visible:!0,text:$}),setTimeout(()=>P({visible:!1,text:""}),3e3)},D=w.useRef(null),[G,ae]=w.useState(600),je=!!(s&&typeof s=="object"&&s.authoring_mode==="latex");w.useEffect(()=>{const $=()=>{var W;try{const te=((W=D.current)==null?void 0:W.getBoundingClientRect().top)||0,fe=window.innerHeight||800,O=Math.max(360,fe-te-12);ae(O)}catch{}};return $(),window.addEventListener("resize",$),()=>window.removeEventListener("resize",$)},[]),w.useEffect(()=>{j(void 0)},[t]),w.useEffect(()=>{let $=!1;return(async()=>{if(u){re("viewer");return}if(!t){re(Ce);return}try{const te=await xM.getTeamMembers(t),O=(Array.isArray(te.data)?te.data:[]).find(ye=>ye.user_id===(d==null?void 0:d.id));if(!O){$||re(Ce);return}const Z=((O==null?void 0:O.role)||"viewer").toLowerCase();$||re((Z==="reviewer"?"viewer":Z==="owner"?"admin":Z)||Ce)}catch{$||re(fe=>fe||Ce)}})(),()=>{$=!0}},[t,d==null?void 0:d.id,Ce,u]),w.useEffect(()=>{re(u?"viewer":Ce)},[Ce,u,t]),w.useEffect(()=>{Re||v(!1)},[Re]);const de={isConnected:!1,isConnecting:!1,users:[],sessionId:null,lastSync:0,error:null};w.useEffect(()=>{const $=W=>{try{const te=JSON.parse(W.data);(te==null?void 0:te.type)==="section_locked"&&te.section_key&&te.user?z(fe=>({...fe,[te.section_key]:{userName:te.user.name||te.user.email||"User",expiresAt:te.expires_at||""}})):(te==null?void 0:te.type)==="section_unlocked"&&te.section_key&&z(fe=>{const O={...fe};return delete O[te.section_key],O})}catch{}};try{const W=hn;if(W&&W.ws&&W.ws.addEventListener)return W.ws.addEventListener("message",$),()=>{try{W.ws.removeEventListener("message",$)}catch{}}}catch{}},[]);const Ae=($,W)=>{var te;console.log("[DocumentShell]  handleContentChange called:",{htmlLength:($==null?void 0:$.length)||0,hasJson:!!W,isLatex:je,latexSourceLength:((te=W==null?void 0:W.latex_source)==null?void 0:te.length)||0,paperId:t,timestamp:new Date().toISOString()}),window.__SH_LAST_HTML=$,window.__SH_LAST_JSON=W;try{F($||"")}catch{}try{o==null||o($,W)}catch{}},Je=($,W)=>{var Z,ne;const te=(W||"References").trim(),fe=document.createElement("div");fe.innerHTML=$||"";const O=Array.from(fe.querySelectorAll("li")).map(ye=>(ye.textContent||"").trim()).filter(Boolean);if((Z=f.current)!=null&&Z.insertBibliography){f.current.insertBibliography(te,O);return}if((ne=f.current)!=null&&ne.insertHTML){const ye=O.map(se=>`<li style="font-size:11px;">${se}</li>`).join(""),B=`<p style="font-size:12px; font-weight:700;">${te}</p><ul>${ye}</ul>`;f.current.insertHTML(B);return}(async()=>{var ye,B,se,ee;try{if(await((ye=f.current)==null?void 0:ye.insertText(`${te}`)),await((B=f.current)==null?void 0:B.insertText(`

`)),O.length)for(const le of O)await((se=f.current)==null?void 0:se.insertText(` ${le}
`));else{const le=(fe.textContent||"").trim();le&&await((ee=f.current)==null?void 0:ee.insertText(le))}}catch{}})()},Ye=w.useCallback(async()=>{var $;try{const W=await rt.getPaperVersions(t),te=W==null?void 0:W.data,fe=(te==null?void 0:te.versions)||[],O=(te==null?void 0:te.current_version)||((($=fe[0])==null?void 0:$.version_number)??null);ge(O||null);const Z=O?fe.find(B=>B.version_number===O):null,ne=Z?Z.content_json&&Z.content_json.latex_source?Z.content_json.latex_source:Z.content||"":"";A(ne||"");const ye=fe[0];ye&&ye.version_number&&ye.version_number!==O?Se(ye.version_number):Se(null)}catch(W){console.warn("Failed to refresh versions",W)}},[t]);w.useEffect(()=>{let $=!0;return(async()=>{var W,te,fe;try{const Z=(await rt.getPaper(t)).data||{},ne=!!(Z!=null&&Z.content_json&&typeof Z.content_json=="object"&&Z.content_json.authoring_mode==="latex"),ye=ne&&((W=Z.content_json)==null?void 0:W.latex_source)||"",B=ne?"":Z.content||"";if(!$)return;const se=ne?ye||"":B||"";F(se),(fe=(te=f.current)==null?void 0:te.setContent)==null||fe.call(te,se),await Ye()}catch(O){console.warn("Failed to load paper content for shell",O)}})(),()=>{$=!1}},[t,Ye]);const dt=Array.isArray(de==null?void 0:de.users)?de.users:[],It=w.useCallback(()=>{h(e?`/projects/${e}/papers/${t}`:"/projects")},[h,e,t]),Ft=l?"fixed inset-0 flex flex-col bg-gray-50 overflow-auto":"min-h-screen flex flex-col overflow-auto";return a.jsxs("div",{className:Ft,children:[a.jsxs("div",{className:"pointer-events-none absolute top-20 right-4 z-30 flex flex-col items-end gap-2",children:[(V==null?void 0:V.visible)&&a.jsx("div",{className:"pointer-events-auto rounded-md border border-green-300 bg-green-100 px-3 py-1 text-[11px] font-medium text-green-800 shadow",children:V.text}),(L||dt.length>0)&&a.jsxs("div",{className:"pointer-events-auto flex items-center gap-3 rounded-md bg-white/80 px-2.5 py-1.5 shadow backdrop-blur",children:[L&&a.jsxs("button",{className:"rounded-md border border-amber-300 bg-amber-50 px-2 py-1 text-[11px] font-medium text-amber-700 hover:bg-amber-100",onClick:()=>Y(!0),children:["Version ",L," ready  review versions"]}),dt.length>0&&a.jsxs("div",{className:"flex -space-x-2 items-center",children:[dt.slice(0,5).map(($,W)=>{const te=($.name||$.email||"?").split(" ").map(O=>O[0]).join("").slice(0,2).toUpperCase(),fe=$.color||"#3B82F6";return a.jsx("div",{title:`${$.name||$.email} is viewing`,className:"flex h-6 w-6 items-center justify-center rounded-full border border-white text-[10px] font-semibold text-white",style:{backgroundColor:fe},children:te},$.user_id||W)}),dt.length>5&&a.jsxs("div",{className:"flex h-6 w-6 items-center justify-center rounded-full border border-white bg-slate-200 text-[10px] font-semibold text-slate-700",children:["+",dt.length-5]})]})]})]}),a.jsx("div",{ref:D,className:"flex-1 min-h-0 flex flex-col p-0",style:l?{}:{height:G},children:a.jsx(i,{ref:f,content:r||"",contentJson:s,paperId:t,paperTitle:n,onContentChange:Ae,onSelectionChange:m,className:"h-full",lockedSectionKeys:Object.keys(M),readOnly:he,onNavigateBack:It})}),Re&&a.jsx(oR,{paperId:t,projectId:e,paperTitle:n||"",isOpen:x,onClose:()=>v(!1),onToggle:()=>v($=>!$),onInsertContent:$=>{var W;return(W=f.current)==null?void 0:W.insertText($||"")},onInsertBibliography:($,W)=>Je($,W),collaboration:de,latexMode:!!(s&&typeof s=="object"&&s.authoring_mode==="latex"),paperRole:Ie}),g&&a.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-30 flex items-center justify-center",onClick:()=>y(!1),children:a.jsx("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-[800px] p-4",onClick:$=>$.stopPropagation(),children:a.jsx(uR,{paperId:t,currentBranchId:S,onBranchSwitch:async $=>{},onContentUpdate:async $=>{var W,te;await((te=(W=f.current)==null?void 0:W.setContent)==null?void 0:te.call(W,$)),F($||"")}})})}),C&&a.jsx(_L,{paperId:t,content:q,baseline:E,onRevertAll:async()=>{var $,W;try{await((W=($=f.current)==null?void 0:$.setContent)==null?void 0:W.call($,E||"")),F(E||"")}catch{}},lockedKeys:M,onClose:()=>_(!1),onJumpToLine:$=>{var W,te;return(te=(W=f.current)==null?void 0:W.scrollToLine)==null?void 0:te.call(W,$)},onReplaceLines:($,W,te)=>{var fe,O;return(O=(fe=f.current)==null?void 0:fe.replaceLines)==null?void 0:O.call(fe,$,W,te)},onLockToggle:($,W)=>{try{W?hn.sendMessage({type:"section_lock",section_key:$,duration_sec:300}):hn.sendMessage({type:"section_unlock",section_key:$})}catch{}}}),b&&a.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-30 flex items-center justify-center",onClick:()=>k(!1),children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-4xl w-[900px] p-4",onClick:$=>$.stopPropagation(),children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("div",{className:"text-base font-semibold",children:"Merge"}),a.jsx("button",{className:"text-sm px-2 py-1 border rounded",onClick:()=>k(!1),children:"Close"})]}),a.jsx(EL,{paperId:t,onMerged:async $=>{var W,te;await((te=(W=f.current)==null?void 0:W.setContent)==null?void 0:te.call(W,$)),k(!1)}})]})}),T&&a.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-30 flex items-center justify-center",onClick:()=>N(!1),children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-[560px] p-5",onClick:$=>$.stopPropagation(),children:[a.jsx("div",{className:"text-lg font-semibold mb-2",children:"Commit Changes"}),a.jsxs("div",{className:"text-sm text-gray-600 mb-3",children:["Current branch: ",a.jsx("span",{className:"font-mono",children:S||"unknown"})]}),a.jsx("textarea",{className:"w-full border border-gray-300 rounded-md p-2 text-sm mb-3",rows:3,placeholder:"Commit message",value:I,onChange:$=>R($.target.value)}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{className:"px-3 py-1.5 border rounded-md",onClick:()=>N(!1),children:"Cancel"}),a.jsx("button",{className:"px-3 py-1.5 rounded-md bg-blue-600 text-white",onClick:async()=>{try{if(!S)throw new Error("No branch selected");await is.commitChanges(S,I||"Update via OnlyOffice",q||""),N(!1),R("")}catch($){console.error("Commit failed",$)}},children:"Commit"})]})]})}),a.jsx(PL,{paperId:t,open:H,currentVersion:we||void 0,pendingVersion:L||void 0,onClose:()=>Y(!1),onLoadVersion:async $=>{var W,te;try{await((te=(W=f.current)==null?void 0:W.setContent)==null?void 0:te.call(W,$))}catch{}},onPromote:async()=>{await Ye(),De("Default version updated")}}),a.jsx(ML,{selectedText:p||"",onReplaceText:$=>{var W,te;return(te=(W=f.current)==null?void 0:W.replaceSelection)==null?void 0:te.call(W,$||"")},onInsertText:$=>{var W;return(W=f.current)==null?void 0:W.insertText($||"")},paperIds:[t],currentPaperContent:q,onCitationInsert:$=>{var W;return(W=f.current)==null?void 0:W.insertText($||"")},open:!he&&J,onOpenChange:$=>Q(he?!1:$),showLauncher:!1})]})},af=w.forwardRef(function({paperId:e,paperTitle:n,className:r,onDirtyChange:s,readOnly:i=!1},l){const o=w.useRef(null),c=w.useRef("oo-editor-"+Math.random().toString(36).slice(2)),u=w.useRef(null),[h,d]=w.useState(!0),[f,p]=w.useState(null),m=w.useRef(null),x=w.useRef("*"),v=w.useRef(new Map);w.useEffect(()=>{let b=!1;const k=()=>new Promise((j,E)=>{if(window.DocsAPI)return j();const A="http://localhost:8080",T=document.createElement("script");T.src=`${A}/web-apps/apps/api/documents/api.js?ts=${Date.now()}`,T.async=!0,T.onload=()=>j(),T.onerror=()=>E(new Error("Failed to load OnlyOffice API")),document.head.appendChild(T)});return(async()=>{try{if(d(!0),p(null),await k(),b)return;const j="http://host.docker.internal:8000",E=e?`${j}/onlyoffice/document?paperId=${encodeURIComponent(e)}`:`${j}/onlyoffice/sample-document`,N={documentType:"word",document:{fileType:"docx",key:e?`paper-${e}`:"demo",title:n||"ScholarHub Document",url:E,permissions:i?{edit:!1,print:!0,download:!0,comment:!1,review:!1,fillForms:!1}:void 0},editorConfig:{mode:i?"view":"edit",lang:"en",user:{id:"1",name:"ScholarHub User"},customization:{chat:!0,comments:!1,feedback:!1,plugins:!0,hideRightMenu:!1,leftMenu:!0,rightMenu:!0,compactToolbar:!1,toolbarNoTabs:!1,autosave:!i,autosaveDelay:600,forcesave:!i},callbackUrl:`${j}/onlyoffice/callback`},width:"100%",height:"100%",events:{}};if(N.events.onDocumentStateChange=C=>{const _=typeof C=="boolean"?C:!!(C&&C.data);try{s&&s(_)}catch{}try{console.debug("[OOAdapter] onDocumentStateChange:",{isModified:_,raw:C})}catch{}},N.events.onRequestSaveAs=()=>(console.debug("[OOAdapter] onRequestSaveAs"),!0),N.events.onRequestSave=()=>{if(!i)try{console.debug("[OOAdapter] onRequestSave -> forceSave"),u.current&&typeof u.current.forceSave=="function"&&u.current.forceSave()}catch(C){console.warn("[OOAdapter] onRequestSave forceSave failed",C)}return!0},N.events.onError=C=>{try{console.error("[OOAdapter] onError:",C)}catch{}},N.events.onRequestClose=()=>{if(!i)try{u.current&&typeof u.current.forceSave=="function"&&u.current.forceSave()}catch{}return!0},u.current){try{u.current.destroyEditor()}catch{}u.current=null}const I=c.current,R=document.getElementById(I);R&&(R.innerHTML=""),u.current=new window.DocsAPI.DocEditor(I,N),d(!1)}catch(j){p((j==null?void 0:j.message)||"OnlyOffice failed to initialize"),d(!1)}})(),()=>{if(b=!0,u.current){if(!i)try{typeof u.current.forceSave=="function"&&u.current.forceSave()}catch{}try{u.current.destroyEditor()}catch{}u.current=null}}},[e,n,i]),w.useEffect(()=>{const b=(()=>{try{return new URL("http://localhost:8080").origin}catch{return"http://localhost:8080"}})();async function k(){try{const j=m.current;if(!j)return;j.postMessage({__shbridge:!0,type:"SH_BRIDGE_INIT",allowedOrigin:window.location.origin},b),setTimeout(async()=>{try{await g("ping")}catch(E){console.warn("Bridge ping failed",E)}},100)}catch{}}function S(j){const E=j.data||{};if(!(!E||!E.__shbridge)&&j.origin===b){if(E.type==="SH_BRIDGE_READY"){m.current=j.source,x.current=j.origin||b,k();return}if(E.type==="SH_BRIDGE_RESP"||E.type==="SH_BRIDGE_INIT_ACK"){const A=E.requestId;if(A&&v.current.has(A)){const T=v.current.get(A);v.current.delete(A),E.ok?T.resolve(E.result):T.reject(new Error(E.error||"Bridge error"))}}}}return window.addEventListener("message",S),()=>{window.removeEventListener("message",S)}},[]);function g(b,k){return new Promise((S,j)=>{const E=m.current;if(!E)return j(new Error("Bridge not ready"));const A=Math.random().toString(36).slice(2);v.current.set(A,{resolve:S,reject:j});try{E.postMessage({__shbridge:!0,type:"SH_BRIDGE_CMD",cmd:b,requestId:A,...k||{}},x.current||"*")}catch(T){v.current.delete(A),j(T)}setTimeout(()=>{v.current.has(A)&&(v.current.delete(A),j(new Error("Bridge timeout")))},8e3)})}w.useImperativeHandle(l,()=>({async getSelection(){try{return await g("getSelection")}catch{return""}},async insertText(b){if(!i)try{await g("insertText",{text:b})}catch(k){alert("Insert failed (bridge): "+(k==null?void 0:k.message))}},async replaceSelection(b){if(!i)try{await g("replaceSelection",{text:b})}catch(k){alert("Replace selection failed (bridge): "+(k==null?void 0:k.message))}},async setContent(b){},async save(){if(i)return Promise.resolve();try{u.current&&typeof u.current.forceSave=="function"?(console.log("OOAdapter.save: invoking forceSave"),u.current.forceSave()):console.log("OOAdapter.save: no forceSave available; relying on autosave")}catch(b){console.warn("OOAdapter.save: forceSave failed",b)}return Promise.resolve()},async insertHTML(b){var j;if(i)return;const k=document.createElement("div");k.innerHTML=b||"";const S=(k.textContent||"").trim();S&&await((j=this.insertText)==null?void 0:j.call(this,S))},async insertBibliography(b,k){if(!i)try{await g("insertBibliography",{heading:b,items:k})}catch(S){alert("Insert bibliography failed (bridge): "+(S==null?void 0:S.message))}},focus(){var b,k;try{(k=(b=o.current)==null?void 0:b.querySelector("iframe"))==null||k.focus()}catch{}}}),[i]);const y=["relative",r].filter(Boolean).join(" ");return a.jsxs("div",{ref:o,className:y,style:{height:"100%",minHeight:"600px"},children:[a.jsx("div",{id:c.current,style:{width:"100%",height:"100%"}}),h&&a.jsx("div",{className:"pointer-events-none absolute inset-0 z-10 flex items-center justify-center bg-white/60 text-sm text-gray-600",children:"Loading OnlyOffice"}),f&&a.jsx("div",{className:"absolute inset-0 z-20 flex items-center justify-center",children:a.jsx("div",{className:"rounded-md border border-red-200 bg-white px-3 py-2 text-sm text-red-600",children:f})})]})}),fw=()=>{const{paperId:t}=$i(),e=t||"demo-paper",n=`OnlyOffice  ${e}`;return a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx(I0,{paperId:e,paperTitle:n,initialContent:"",Adapter:af,fullBleed:!0,initialPaperRole:"admin"})})},pw=()=>{const{paperId:t}=$i(),e=t||"demo-paper",n=`OO  ${e}`;return a.jsx("div",{className:"min-h-screen bg-gray-50",children:a.jsx(I0,{paperId:e,paperTitle:n,initialContent:"",Adapter:af,initialPaperRole:"admin"})})},TL=[{path:"prototypes/onlyoffice/:paperId",element:a.jsx(fw,{})},{path:"prototypes/onlyoffice",element:a.jsx(fw,{})},{path:"prototypes/docshell-oo/:paperId",element:a.jsx(pw,{})},{path:"prototypes/docshell-oo",element:a.jsx(pw,{})}],RL=()=>{const{user:t,updateUser:e}=Ln(),[n,r]=w.useState({first_name:"",last_name:""}),[s,i]=w.useState({current_password:"",new_password:"",confirm_password:""}),[l,o]=w.useState(!1),[c,u]=w.useState(!1),[h,d]=w.useState(""),[f,p]=w.useState("");w.useEffect(()=>{t&&r({first_name:t.first_name||"",last_name:t.last_name||""})},[t]);const m=async v=>{var g,y;v.preventDefault(),o(!0),p(""),d("");try{await oh.updateUser(t.id,n),e({...t,...n}),d("Profile updated successfully!")}catch(b){p(((y=(g=b.response)==null?void 0:g.data)==null?void 0:y.detail)||"Failed to update profile")}finally{o(!1)}},x=async v=>{var g,y;if(v.preventDefault(),s.new_password!==s.confirm_password){p("New passwords do not match");return}if(s.new_password.length<8){p("New password must be at least 8 characters long");return}u(!0),p(""),d("");try{await oh.changePassword({current_password:s.current_password,new_password:s.new_password}),d("Password changed successfully!"),i({current_password:"",new_password:"",confirm_password:""})}catch(b){p(((y=(g=b.response)==null?void 0:g.data)==null?void 0:y.detail)||"Failed to change password")}finally{u(!1)}};return t?a.jsx("div",{className:"max-w-2xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"space-y-8",children:[a.jsxs("div",{children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Profile"}),a.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Update your personal information and manage your account settings."})]}),h&&a.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md",children:h}),f&&a.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md",children:f}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"Profile Information"}),a.jsxs("form",{onSubmit:m,className:"space-y-4",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"first_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),a.jsx("input",{id:"first_name",type:"text",value:n.first_name,onChange:v=>r(g=>({...g,first_name:v.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:"Enter your first name"})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"last_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),a.jsx("input",{id:"last_name",type:"text",value:n.last_name,onChange:v=>r(g=>({...g,last_name:v.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:"Enter your last name"})]})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsx("input",{id:"email",type:"email",value:t.email,disabled:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-500 cursor-not-allowed"}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Email address cannot be changed. Contact support if needed."})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",disabled:l,className:"bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:l?"Updating...":"Update Profile"})})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"Change Password"}),a.jsxs("form",{onSubmit:x,className:"space-y-4",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"current_password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Current Password"}),a.jsx("input",{id:"current_password",type:"password",value:s.current_password,onChange:v=>i(g=>({...g,current_password:v.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:"Enter your current password",required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"new_password",className:"block text-sm font-medium text-gray-700 mb-2",children:"New Password"}),a.jsx("input",{id:"new_password",type:"password",value:s.new_password,onChange:v=>i(g=>({...g,new_password:v.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:"Enter your new password",required:!0}),a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Password must be at least 8 characters long."})]}),a.jsxs("div",{children:[a.jsx("label",{htmlFor:"confirm_password",className:"block text-sm font-medium text-gray-700 mb-2",children:"Confirm New Password"}),a.jsx("input",{id:"confirm_password",type:"password",value:s.confirm_password,onChange:v=>i(g=>({...g,confirm_password:v.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-colors",placeholder:"Confirm your new password",required:!0})]}),a.jsx("div",{className:"flex justify-end",children:a.jsx("button",{type:"submit",disabled:c,className:"bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Changing...":"Change Password"})})]})]}),a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsx("h2",{className:"text-lg font-medium text-gray-900 mb-6",children:"Account Information"}),a.jsxs("div",{className:"space-y-4",children:[a.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Account Created"}),a.jsx("span",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()})]}),a.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Last Updated"}),a.jsx("span",{className:"text-sm text-gray-500",children:new Date(t.updated_at).toLocaleDateString()})]}),a.jsxs("div",{className:"flex justify-between items-center py-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Account Status"}),a.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.is_active?"Active":"Inactive"})]})]})]})]})}):a.jsx("div",{children:"Loading..."})},DL=[{path:"profile",element:a.jsx(RL,{})}],LL=t=>t?Array.isArray(t)?t.filter(Boolean):t?[t]:[]:[],qg=({isOpen:t,mode:e,isSubmitting:n,error:r,initialProject:s,onClose:i,onSubmit:l})=>{const[o,c]=w.useState(""),[u,h]=w.useState(""),[d,f]=w.useState(""),[p,m]=w.useState("");if(w.useEffect(()=>{if(!t){c(""),h(""),f(""),m("");return}e==="edit"&&s?(c(s.title??""),h(s.idea??""),m(s.scope??""),f(LL(s.keywords).join(", "))):(c(""),h(""),m(""),f(""))},[t,s,e]),!t)return null;const x=b=>{if(b.preventDefault(),!o.trim())return;const k=d.split(",").map(j=>j.trim()).filter(Boolean),S={title:o.trim(),idea:u.trim()||void 0,scope:p.trim()||void 0,keywords:k.length?k:void 0};l(S)},v=e==="create"?"Create a new project":"Edit project details",g=e==="create"?"Set the stage for your next research initiative.":"Update the title, scope, and keywords for this project.",y=e==="create"?"Create project":"Save changes";return a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[a.jsx("div",{className:"absolute inset-0 bg-gray-900/40","aria-hidden":"true",onClick:i}),a.jsxs("form",{onSubmit:x,className:"relative w-full max-w-lg rounded-2xl bg-white shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 px-6 py-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:v}),a.jsx("p",{className:"text-sm text-gray-500",children:g})]}),a.jsx("button",{type:"button",onClick:i,className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100","aria-label":e==="create"?"Close create project modal":"Close edit project modal",children:a.jsx(Jt,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"space-y-5 px-6 py-5",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Project title"}),a.jsx("input",{type:"text",value:o,onChange:b=>c(b.target.value),className:"mt-2 w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"e.g. Neural Interface Study",autoFocus:!0,required:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Idea / problem statement"}),a.jsx("textarea",{value:u,onChange:b=>h(b.target.value),rows:3,className:"mt-2 w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Capture the vision for this project"})]}),a.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Keywords"}),a.jsx("input",{type:"text",value:d,onChange:b=>f(b.target.value),className:"mt-2 w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"biology, robotics, ..."}),a.jsx("p",{className:"mt-1 text-xs text-gray-400",children:"Separate keywords with commas."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Scope"}),a.jsx("input",{type:"text",value:p,onChange:b=>m(b.target.value),className:"mt-2 w-full rounded-md border border-gray-300 px-3 py-2 text-sm shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Exploratory phase"})]})]}),r&&a.jsx("p",{className:"text-sm text-red-600",children:r})]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-100 px-6 py-4",children:[a.jsx("button",{type:"button",onClick:i,className:"rounded-md px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100",children:"Cancel"}),a.jsx("button",{type:"submit",className:"inline-flex items-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-60",disabled:n||!o.trim(),children:n?e==="create"?"Creating":"Saving":y})]})]})]})},mw=t=>{try{return new Date(t).toLocaleDateString(void 0,{month:"short",day:"numeric",year:"numeric"})}catch{return t}},gw=()=>{const[t,e]=w.useState(""),[n,r]=w.useState("grid"),[s,i]=w.useState(!1),[l,o]=w.useState(null),[c,u]=w.useState(null),[h,d]=w.useState(null),f=qs(),{user:p}=Ln(),{data:m,isLoading:x,isFetching:v,isError:g,refetch:y}=Tt({queryKey:["projects"],queryFn:async()=>(await mr.list()).data}),b=at({mutationFn:async C=>(o(null),(await mr.create(C)).data),onSuccess:()=>{f.invalidateQueries({queryKey:["projects"]}),i(!1)},onError:C=>{var M,z;const _=(z=(M=C==null?void 0:C.response)==null?void 0:M.data)==null?void 0:z.detail;o(_??"Unable to create project. Please try again.")}}),k=at({mutationFn:async({projectId:C,payload:_})=>(await mr.update(C,_)).data,onSuccess:(C,_)=>{f.invalidateQueries({queryKey:["projects"]}),f.invalidateQueries({queryKey:["project",_.projectId]}),u(null),d(null)},onError:C=>{var M,z;const _=(z=(M=C==null?void 0:C.response)==null?void 0:M.data)==null?void 0:z.detail;d(_??"Unable to update project. Please try again.")}}),S=(m==null?void 0:m.projects)??[],j=p==null?void 0:p.id,E=Tt({queryKey:["project-invitations"],queryFn:async()=>{var _;return((_=(await mr.listPendingInvitations()).data)==null?void 0:_.invitations)??[]}}),A=at({mutationFn:async({projectId:C,memberId:_})=>{await mr.acceptInvitation(C,_)},onSuccess:()=>{f.invalidateQueries({queryKey:["project-invitations"]}),f.invalidateQueries({queryKey:["projects"]})},onError:()=>{alert("Failed to accept invitation. Please try again.")}}),T=at({mutationFn:async({projectId:C,memberId:_})=>{await mr.declineInvitation(C,_)},onSuccess:()=>{f.invalidateQueries({queryKey:["project-invitations"]})},onError:()=>{alert("Failed to decline invitation. Please try again.")}}),N=E.data??[],I=w.useMemo(()=>{const C=t.trim().toLowerCase();return C?S.filter(_=>{var z;const M=Array.isArray(_.keywords)?_.keywords:[];return _.title.toLowerCase().includes(C)||(((z=_.idea)==null?void 0:z.toLowerCase().includes(C))??!1)||M.some(q=>q.toLowerCase().includes(C))}):S},[S,t]),R=(m==null?void 0:m.total)??0;return a.jsxs("div",{className:"space-y-8",children:[a.jsxs("header",{className:"flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Projects"}),a.jsxs("span",{className:"rounded-full bg-indigo-50 px-3 py-1 text-xs font-medium text-indigo-700",children:[R," total"]})]}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Spin up new initiatives or jump back into active collaborations."})]}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsxs("div",{className:"relative hidden sm:flex",children:[a.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-3 flex items-center",children:a.jsx(Ts,{className:"h-4 w-4 text-gray-400"})}),a.jsx("input",{type:"search",value:t,onChange:C=>e(C.target.value),className:"h-10 w-full rounded-full border border-gray-200 bg-white pl-9 pr-4 text-sm text-gray-700 shadow-sm placeholder:text-gray-400 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Search projects"})]}),a.jsxs("div",{className:"flex rounded-full border border-gray-200 bg-white p-1 shadow-sm",children:[a.jsx("button",{type:"button",onClick:()=>r("grid"),className:`inline-flex h-9 w-9 items-center justify-center rounded-full ${n==="grid"?"bg-indigo-600 text-white":"text-gray-500 hover:bg-gray-100"}`,"aria-label":"Grid view",children:a.jsx(F5,{className:"h-4 w-4"})}),a.jsx("button",{type:"button",onClick:()=>r("table"),className:`inline-flex h-9 w-9 items-center justify-center rounded-full ${n==="table"?"bg-indigo-600 text-white":"text-gray-500 hover:bg-gray-100"}`,"aria-label":"Table view",children:a.jsx(H5,{className:"h-4 w-4"})})]}),a.jsx("button",{type:"button",onClick:()=>i(!0),className:"inline-flex items-center rounded-full bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"New Project"})]})]}),a.jsx("div",{className:"sm:hidden",children:a.jsxs("div",{className:"relative",children:[a.jsx("div",{className:"pointer-events-none absolute inset-y-0 left-3 flex items-center",children:a.jsx(Ts,{className:"h-4 w-4 text-gray-400"})}),a.jsx("input",{type:"search",value:t,onChange:C=>e(C.target.value),className:"h-11 w-full rounded-full border border-gray-200 bg-white pl-9 pr-4 text-sm text-gray-700 shadow-sm placeholder:text-gray-400 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Search projects"})]})}),E.isLoading?a.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-6",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Pending invitations"}),a.jsx("div",{className:"text-sm text-gray-600",children:"Loading"})]}):E.isError?a.jsxs("div",{className:"rounded-2xl border border-red-200 bg-red-50 p-6 text-sm text-red-700",children:[a.jsx("h3",{className:"text-base font-semibold",children:"Pending invitations"}),a.jsx("p",{className:"mt-1",children:"We couldn't load project invitations right now."})]}):N.length>0?a.jsxs("section",{className:"space-y-4",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Pending invitations"}),a.jsxs("span",{className:"text-xs font-medium text-gray-500",children:[N.length," pending"]})]}),a.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:N.map(C=>a.jsxs("div",{className:"flex h-full flex-col justify-between rounded-xl border border-dashed border-amber-300 bg-amber-50 p-5 shadow-sm",children:[a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex items-center gap-2 text-xs font-semibold uppercase tracking-wide text-amber-700",children:[a.jsx(mn,{className:"h-4 w-4"})," Pending invitation"]}),a.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",title:C.project_title,children:C.project_title}),a.jsxs("p",{className:"text-sm text-gray-600 capitalize",children:["Role: ",C.role.toLowerCase()]}),C.invited_at&&a.jsxs("p",{className:"text-xs text-gray-500",children:["Invited ",new Date(C.invited_at).toLocaleString()]}),C.invited_by&&a.jsxs("p",{className:"text-xs text-gray-500",children:["Invited by ",C.invited_by]})]}),a.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:()=>A.mutate({projectId:C.project_id,memberId:C.member_id}),disabled:A.isPending||T.isPending,className:"inline-flex flex-1 items-center justify-center rounded-full bg-green-600 px-3 py-2 text-xs font-medium text-white shadow-sm hover:bg-green-700 disabled:cursor-not-allowed disabled:opacity-60",children:"Accept"}),a.jsx("button",{type:"button",onClick:()=>T.mutate({projectId:C.project_id,memberId:C.member_id}),disabled:A.isPending||T.isPending,className:"inline-flex flex-1 items-center justify-center rounded-full border border-red-200 bg-red-50 px-3 py-2 text-xs font-medium text-red-600 hover:bg-red-100 disabled:cursor-not-allowed disabled:opacity-60",children:"Decline"})]})]},C.member_id))})]}):null,g?a.jsxs("div",{className:"rounded-xl border border-red-200 bg-red-50 p-6 text-sm text-red-700",children:[a.jsx("p",{className:"font-medium",children:"We couldn't load your projects."}),a.jsx("p",{className:"mt-1",children:"Try refreshing or check back in a moment."}),a.jsxs("button",{type:"button",onClick:()=>y(),className:"mt-4 inline-flex items-center gap-2 rounded-md border border-transparent bg-red-600 px-3 py-2 text-xs font-medium text-white hover:bg-red-700",children:[a.jsx(cT,{className:"h-4 w-4"})," Retry"]})]}):x?a.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:Array.from({length:6}).map((C,_)=>a.jsx("div",{className:"h-40 animate-pulse rounded-xl border border-gray-200 bg-white"},_))}):I.length===0?a.jsxs("div",{className:"rounded-2xl border border-dashed border-gray-300 bg-white p-12 text-center",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"No projects yet"}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:t?"Try a different search term or clear the filter to see all projects.":"Create your first project to begin tracking research ideas, references, and papers."}),a.jsx("button",{type:"button",onClick:()=>i(!0),className:"mt-6 inline-flex items-center rounded-full bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:"Create a project"})]}):n==="grid"?a.jsx("div",{className:"grid gap-4 sm:grid-cols-2 xl:grid-cols-3",children:I.map(C=>{var F,V;const _=Array.isArray(C.keywords)?C.keywords:[],M=(F=C.current_user_status)==null?void 0:F.toLowerCase(),z=(V=C.current_user_role)==null?void 0:V.toLowerCase(),q=C.created_by===j||M==="accepted"&&z==="admin";return a.jsxs("article",{className:"flex h-full flex-col justify-between rounded-xl border border-gray-200 bg-white p-5 shadow-sm transition hover:border-indigo-200 hover:shadow-md",children:[a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-start justify-between gap-3",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:C.title}),C.idea&&a.jsx("p",{className:"mt-2 line-clamp-2 text-sm text-gray-500",children:C.idea})]}),a.jsx("span",{className:"rounded-full bg-gray-100 px-2.5 py-1 text-xs font-medium text-gray-600",children:C.status||"Active"})]}),_.length>0&&a.jsxs("div",{className:"mt-4 flex flex-wrap gap-2",children:[_.slice(0,4).map(P=>a.jsx("span",{className:"inline-flex rounded-full bg-indigo-50 px-2.5 py-1 text-xs font-medium text-indigo-700",children:P},P)),_.length>4&&a.jsxs("span",{className:"inline-flex rounded-full bg-indigo-50 px-2.5 py-1 text-xs font-medium text-indigo-700",children:["+",_.length-4]})]})]}),a.jsxs("div",{className:"mt-6 flex items-center justify-between text-xs text-gray-500",children:[a.jsxs("span",{children:["Updated ",mw(C.updated_at)]}),a.jsxs("div",{className:"flex items-center gap-3",children:[q&&a.jsx("button",{type:"button",onClick:()=>{d(null),u(C)},className:"text-sm font-medium text-gray-500 hover:text-indigo-600",children:"Edit"}),a.jsx(sr,{to:`/projects/${C.id}`,className:"text-sm font-medium text-indigo-600 hover:text-indigo-700",children:"Open project "})]})]})]},C.id)})}):a.jsx("div",{className:"overflow-hidden rounded-xl border border-gray-200 bg-white shadow-sm",children:a.jsxs("table",{className:"min-w-full divide-y divide-gray-100",children:[a.jsx("thead",{className:"bg-gray-50 text-left text-xs font-semibold uppercase tracking-wide text-gray-500",children:a.jsxs("tr",{children:[a.jsx("th",{className:"px-6 py-3",children:"Project"}),a.jsx("th",{className:"px-6 py-3",children:"Scope"}),a.jsx("th",{className:"px-6 py-3",children:"Keywords"}),a.jsx("th",{className:"px-6 py-3",children:"Updated"}),a.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),a.jsx("tbody",{className:"divide-y divide-gray-100 text-sm text-gray-700",children:I.map(C=>{const _=Array.isArray(C.keywords)?C.keywords:[];return a.jsxs("tr",{className:"hover:bg-gray-50",children:[a.jsxs("td",{className:"px-6 py-4",children:[a.jsx("div",{className:"font-medium text-gray-900",children:C.title}),C.idea&&a.jsx("div",{className:"mt-1 text-xs text-gray-500 line-clamp-1",children:C.idea})]}),a.jsx("td",{className:"px-6 py-4 text-gray-500",children:C.scope||""}),a.jsxs("td",{className:"px-6 py-4 text-gray-500",children:[_.length?_.slice(0,3).join(", "):"",_.length>3&&`, +${_.length-3}`]}),a.jsx("td",{className:"px-6 py-4 text-gray-500",children:mw(C.updated_at)}),a.jsx("td",{className:"px-6 py-4 text-right",children:a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{type:"button",onClick:()=>{d(null),u(C)},className:"text-sm font-medium text-gray-500 hover:text-indigo-600",children:"Edit"}),a.jsx(sr,{to:`/projects/${C.id}`,className:"text-sm font-medium text-indigo-600 hover:text-indigo-700",children:"Open"})]})})]},C.id)})})]})}),a.jsx(qg,{isOpen:s,mode:"create",isSubmitting:b.isPending,error:l,onClose:()=>{o(null),i(!1)},onSubmit:C=>b.mutate(C)}),a.jsx(qg,{isOpen:!!c,mode:"edit",isSubmitting:k.isPending,error:h,initialProject:c?{...c,keywords:Array.isArray(c.keywords)?c.keywords:c.keywords?[c.keywords]:[]}:void 0,onClose:()=>{d(null),u(null)},onSubmit:C=>{c&&k.mutate({projectId:c.id,payload:C})}}),v&&!x&&a.jsx("p",{className:"text-xs text-gray-400",children:"Refreshing projects"})]})},F0=({isOpen:t,onClose:e,onConfirm:n,title:r,message:s,description:i,confirmText:l,confirmLabel:o,cancelText:c,cancelLabel:u,confirmButtonColor:h="red",confirmTone:d,icon:f="warning",isSubmitting:p=!1})=>{if(!t)return null;const m=i??s??"Are you sure?",x=o??l??"Confirm",v=u??c??"Cancel",g=()=>{switch(f){case"warning":return a.jsx("svg",{className:"w-6 h-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})});case"error":return a.jsx("svg",{className:"w-6 h-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"info":return a.jsx("svg",{className:"w-6 h-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})});case"success":return a.jsx("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});default:return null}},y=()=>{switch(d?{danger:"red",primary:"blue",success:"green",warning:"yellow",default:"blue"}[d]??h:h){case"red":return"bg-red-600 hover:bg-red-700 focus:ring-red-500";case"blue":return"bg-blue-600 hover:bg-blue-700 focus:ring-blue-500";case"green":return"bg-green-600 hover:bg-green-700 focus:ring-green-500";case"yellow":return"bg-yellow-600 hover:bg-yellow-700 focus:ring-yellow-500";default:return"bg-red-600 hover:bg-red-700 focus:ring-red-500"}};return a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-4",children:[a.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:a.jsxs("div",{className:"flex items-center space-x-3",children:[g(),a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:r})]})}),a.jsxs("div",{className:"px-6 py-4",children:[a.jsx("p",{className:"text-gray-600 mb-6",children:m}),a.jsxs("div",{className:"flex justify-end space-x-3",children:[a.jsx("button",{onClick:e,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500",children:v}),a.jsx("button",{onClick:n,disabled:p,className:`px-4 py-2 text-white rounded-md transition-colors focus:outline-none focus:ring-2 ${y()} ${p?"opacity-70 cursor-not-allowed":""}`,children:x})]})]})]})})},qr=()=>BP(),xw=[{label:"Overview",path:"",exact:!0},{label:"Discussion",path:"discussion"},{label:"Papers",path:"papers"},{label:"Discovery",path:"discovery",badge:"discovery"},{label:"Sync Space",path:"sync-space"},{label:"Related Papers",path:"related-papers"},{label:"Updates",path:"updates"}],OL=()=>{var R,C;const{projectId:t,paperId:e}=$i(),n=Qn(),r=qs(),[s,i]=w.useState(!1),[l,o]=w.useState(null),[c,u]=w.useState(!1),h=at({mutationFn:async _=>{await mr.delete(_)},onSuccess:()=>{u(!1),r.invalidateQueries({queryKey:["projects"]}),n("/projects")},onError:()=>{alert("Failed to delete project. Please try again.")}}),{user:d}=Ln(),{data:f,isLoading:p,isError:m,refetch:x}=Tt({queryKey:["project",t],queryFn:async()=>{if(!t)throw new Error("Missing project id");return(await mr.get(t)).data},enabled:!!t}),v=f,g=w.useMemo(()=>{var _;return((_=v==null?void 0:v.members)==null?void 0:_.length)??0},[v]),y=d==null?void 0:d.id,b=(R=v==null?void 0:v.members)==null?void 0:R.find(_=>_.user_id===y),k=(C=b==null?void 0:b.status)==null?void 0:C.toLowerCase(),S=w.useMemo(()=>{if(!v||!y)return"viewer";if(v.created_by===y)return"admin";if(!b||k!=="accepted")return"viewer";const _=(b.role||"").toLowerCase();return _==="owner"?"admin":_==="reviewer"?"viewer":_==="admin"||_==="editor"?_:"viewer"},[v,y,b,k]),j=w.useMemo(()=>S==="viewer"?xw.filter(_=>_.path!=="discovery"):xw,[S]),A=Tt({queryKey:["project",t,"discoveryPendingCount"],queryFn:async()=>t?(await ws.getPendingCount(t)).data.pending:0,enabled:!!t&&S!=="viewer",refetchInterval:6e4}).data??0,T=!!e,N=S==="admin";w.useEffect(()=>{T&&s&&(o(null),i(!1))},[T,s]);const I=at({mutationFn:async({projectId:_,payload:M})=>(await mr.update(_,M)).data,onSuccess:(_,M)=>{r.invalidateQueries({queryKey:["projects"]}),r.invalidateQueries({queryKey:["project",M.projectId]}),i(!1),o(null)},onError:_=>{var z,q;const M=_;o(((q=(z=M==null?void 0:M.response)==null?void 0:z.data)==null?void 0:q.detail)??"Unable to update project right now.")}});return p?a.jsxs("div",{className:"space-y-6",children:[a.jsx("div",{className:"h-28 w-full animate-pulse rounded-2xl bg-white shadow-sm"}),a.jsx("div",{className:"h-64 w-full animate-pulse rounded-2xl bg-white shadow-sm"})]}):m||!v?a.jsxs("div",{className:"max-w-xl rounded-2xl border border-red-200 bg-red-50 p-8 text-sm text-red-700",children:[a.jsx("h2",{className:"text-base font-semibold",children:"Project unavailable"}),a.jsx("p",{className:"mt-2",children:"We couldn't load that project. It may have been removed or you may no longer have access."}),a.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[a.jsx("button",{type:"button",onClick:()=>n("/projects"),className:"inline-flex items-center rounded-full bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700",children:"Back to projects"}),a.jsx("button",{type:"button",onClick:()=>x(),className:"inline-flex items-center rounded-full border border-red-200 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-100",children:"Try again"})]})]}):a.jsxs("div",{className:"space-y-8",children:[!T&&a.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"mb-4 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("button",{type:"button",onClick:()=>n("/projects"),className:"inline-flex items-center gap-2 text-sm font-medium text-gray-500 hover:text-gray-700",children:[a.jsx(p0,{className:"h-4 w-4"}),"All projects"]}),a.jsxs("div",{className:"flex items-center gap-2",children:[N&&a.jsx("button",{type:"button",onClick:()=>{o(null),i(!0)},className:"inline-flex items-center rounded-full border border-indigo-200 px-4 py-2 text-sm font-medium text-indigo-600 hover:bg-indigo-50",children:"Edit project"}),N&&a.jsxs("button",{type:"button",onClick:()=>u(!0),className:"inline-flex items-center gap-2 rounded-full border border-red-200 px-4 py-2 text-sm font-medium text-red-600 hover:bg-red-50",children:[a.jsx(nr,{className:"h-4 w-4"}),"Delete"]})]})]}),a.jsxs("div",{className:"flex flex-col gap-6 lg:flex-row lg:items-start lg:justify-between",children:[a.jsxs("div",{className:"max-w-2xl",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:v.title}),v.idea&&a.jsx("p",{className:"mt-2 text-sm text-gray-600",children:v.idea}),v.keywords&&v.keywords.length>0&&a.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:v.keywords.map(_=>a.jsx("span",{className:"inline-flex rounded-full bg-indigo-50 px-2.5 py-1 text-xs font-medium text-indigo-700",children:_},_))})]}),a.jsxs("div",{className:"flex flex-col items-start gap-3 text-sm text-gray-500 lg:items-end",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(Kh,{className:"h-4 w-4"}),a.jsxs("span",{children:["Updated ",new Date(v.updated_at).toLocaleString()]})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(tu,{className:"h-4 w-4"}),a.jsxs("span",{children:[g," member",g===1?"":"s"]})]}),v.scope&&a.jsx("span",{className:"rounded-full bg-gray-100 px-3 py-1 text-xs font-medium text-gray-600",children:v.scope})]})]}),a.jsx("nav",{className:"mt-8 flex flex-wrap gap-2 text-sm font-medium",children:j.map(({label:_,path:M,exact:z,badge:q})=>{const F=q==="discovery"?A:0;return a.jsx(f4,{to:M?`/projects/${v.id}/${M}`:`/projects/${v.id}`,end:!!z,className:({isActive:V})=>`inline-flex items-center rounded-full px-3 py-1.5 transition-colors ${V?"bg-indigo-600 text-white":"text-gray-500 hover:bg-gray-100"}`,children:a.jsxs("span",{className:"flex items-center gap-1",children:[_,F>0&&a.jsx("span",{className:"inline-flex h-5 min-w-[1.25rem] items-center justify-center rounded-full bg-white/90 px-1 text-xs font-semibold text-indigo-600",children:F>99?"99+":F})]})},_)})})]}),a.jsx(g2,{context:{project:v,currentRole:S}}),!T&&a.jsx(qg,{isOpen:s,mode:"edit",isSubmitting:I.isPending,error:l,initialProject:{title:v.title,idea:v.idea??void 0,scope:v.scope??void 0,keywords:Array.isArray(v.keywords)?v.keywords:v.keywords?[v.keywords]:[]},onClose:()=>{o(null),i(!1)},onSubmit:_=>{t&&I.mutate({projectId:t,payload:_})}}),a.jsx(F0,{isOpen:c,title:"Delete project",description:"This will permanently remove the project and its membership. This action cannot be undone.",confirmLabel:h.isPending?"Deleting":"Delete project",confirmTone:"danger",isSubmitting:h.isPending,onClose:()=>u(!1),onConfirm:()=>{t&&h.mutate(t)}})]})},IL=({isOpen:t,onClose:e,onInvite:n,paperTitle:r})=>{const[s,i]=w.useState(""),[l,o]=w.useState("viewer"),[c,u]=w.useState(!1),[h,d]=w.useState(null),[f,p]=w.useState("idle"),m=[{value:"admin",label:"Admin",description:"Full control: manage team, edit papers, approve references",icon:a.jsx(g0,{className:"w-4 h-4"})},{value:"editor",label:"Editor",description:"Edit papers, approve/reject references, add manual citations",icon:a.jsx(Gh,{className:"w-4 h-4"})},{value:"viewer",label:"Viewer",description:"Read-only access to papers and discussions",icon:a.jsx(Ac,{className:"w-4 h-4"})}],x=async v=>{var g,y;if(v.preventDefault(),!s.trim()){d("Please enter an email address");return}u(!0),d(null);try{await n(s.trim(),l),i(""),o("viewer"),e()}catch(b){const k=(y=(g=b==null?void 0:b.response)==null?void 0:g.data)==null?void 0:y.detail;d(k==="User not found"?"No account found for this email. Ask the user to register, then try again.":k==="Not authorized to invite team members"?"You do not have permission to invite members for this paper.":k==="User is already a team member"?"This user is already a member of the paper.":k==="Invalid role for invitation"?"Select a valid role: Admin, Editor, or Viewer.":b.message||"Failed to send invitation")}finally{u(!1)}};return w.useEffect(()=>{let v;const g=async()=>{var k,S;const y=s.trim(),b=/[^@\s]+@[^@\s]+\.[^@\s]+/.test(y);if(!y||!b){p("idle");return}try{p("checking"),await oh.lookupByEmail(y),p("found")}catch(j){((k=j==null?void 0:j.response)==null?void 0:k.status)===404?p("not_found"):(((S=j==null?void 0:j.response)==null?void 0:S.status)>=500,p("idle"))}};return v=window.setTimeout(g,400),()=>{v&&window.clearTimeout(v)}},[s]),t?a.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-md w-full mx-auto max-h-[90vh] overflow-y-auto",children:[a.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[a.jsxs("div",{className:"flex items-center space-x-3 min-w-0",children:[a.jsx(BT,{className:"w-6 h-6 text-blue-600 flex-shrink-0"}),a.jsx("h2",{className:"text-xl font-semibold text-gray-900 truncate",children:"Invite Team Member"})]}),a.jsx("button",{onClick:e,className:"text-gray-400 hover:text-gray-600 transition-colors flex-shrink-0 ml-3",children:a.jsx(Jt,{className:"w-6 h-6"})})]}),a.jsxs("div",{className:"p-6",children:[a.jsxs("p",{className:"text-gray-600 mb-6 break-words",children:["Invite someone to collaborate on ",a.jsxs("span",{className:"font-medium",children:['"',r,'"']})]}),a.jsxs("form",{onSubmit:x,className:"space-y-6",children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-2",children:"Email Address"}),a.jsxs("div",{className:"relative",children:[a.jsx(G5,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),a.jsx("input",{type:"email",id:"email",value:s,onChange:v=>i(v.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"colleague@example.com",disabled:c}),f!=="idle"&&a.jsxs("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-xs",children:[f==="checking"&&a.jsx("span",{className:"text-gray-400",children:"Checking..."}),f==="found"&&a.jsx("span",{className:"text-green-600",children:"User found"}),f==="not_found"&&a.jsx("span",{className:"text-yellow-600",children:"No account"})]})]}),f==="not_found"&&a.jsx("p",{className:"mt-1 text-xs text-yellow-700",children:"This email is not registered. Ask them to sign up, then try again."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Role"}),a.jsx("div",{className:"space-y-3",children:m.map(v=>a.jsxs("label",{className:`flex items-start space-x-3 p-3 border rounded-lg cursor-pointer transition-colors ${l===v.value?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:[a.jsx("input",{type:"radio",name:"role",value:v.value,checked:l===v.value,onChange:g=>o(g.target.value),className:"mt-1 text-blue-600 focus:ring-blue-500",disabled:c}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[a.jsx("span",{className:"text-blue-600 flex-shrink-0",children:v.icon}),a.jsx("span",{className:"font-medium text-gray-900 truncate",children:v.label})]}),a.jsx("p",{className:"text-sm text-gray-600 break-words",children:v.description})]})]},v.value))})]}),h&&a.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-md",children:a.jsx("p",{className:"text-sm text-red-700",children:h})}),a.jsxs("div",{className:"flex space-x-3 pt-4",children:[a.jsx("button",{type:"button",onClick:e,className:"flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition-colors",disabled:c,children:"Cancel"}),a.jsx("button",{type:"submit",disabled:c||!s.trim()||f==="not_found",className:"flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"Sending...":"Send Invitation"})]})]})]})]})}):null},$l=t=>{const e=(t||"").toLowerCase();return e==="admin"||e==="editor"||e==="viewer"?e:"viewer"},FL={admin:"bg-purple-100 text-purple-800",editor:"bg-green-100 text-green-800",viewer:"bg-gray-100 text-gray-800"},yw=t=>{switch(t){case"admin":return a.jsx(g0,{className:"h-4 w-4 text-purple-600"});case"editor":return a.jsx(Gh,{className:"h-4 w-4 text-green-600"});default:return a.jsx(Ac,{className:"h-4 w-4 text-gray-500"})}},BL=()=>{var N;const{project:t}=qr(),{user:e}=Ln(),n=qs(),[r,s]=w.useState(!1),[i,l]=w.useState(null),[o,c]=w.useState(null),[u,h]=w.useState(!1),d=I=>{if(!I)return"Unknown error";if(typeof I=="string")return I;if(Array.isArray(I))return I.map(R=>R&&typeof R=="object"&&"msg"in R?String(R.msg):JSON.stringify(R)).join(`
`);if(typeof I=="object"&&"msg"in I)return String(I.msg);try{return JSON.stringify(I)}catch{return String(I)}},f=t.members??[],p=e==null?void 0:e.id,m=t.created_by===p,x=f.find(I=>I.user_id===p),g=((N=x==null?void 0:x.status)==null?void 0:N.toLowerCase())==="accepted",y=m?"admin":$l(x==null?void 0:x.role),b=g&&y==="admin",k=m,S=w.useMemo(()=>{const I={admin:0,editor:1,viewer:2};return[...f].sort((R,C)=>{var z,q;const _=R.user_id===t.created_by?"admin":$l(R.role),M=C.user_id===t.created_by?"admin":$l(C.role);return I[_]===I[M]?(((z=R.user)==null?void 0:z.email)||"").localeCompare(((q=C.user)==null?void 0:q.email)||""):I[_]-I[M]})},[f,t.created_by]),j=async()=>{await n.invalidateQueries({queryKey:["project",t.id]})},E=async(I,R)=>{var _,M;if(!b){const z=new Error("Not authorized to invite members for this project.");throw c(z.message),z}const C=$l(R);if(C==="admin"&&!k){const z=new Error("Only the creator can assign the admin role.");throw c(z.message),z}try{c(null);const q=(await oh.lookupByEmail(I)).data,F=(q==null?void 0:q.id)||(q==null?void 0:q.user_id)||(q==null?void 0:q.userId)||"";if(!F)throw new Error("Lookup response missing user id");if(!/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(F))throw new Error("Invitee must have a registered account before joining this project.");console.debug("Inviting project member",{projectId:t.id,userId:F,role:C}),await mr.addMember(t.id,{user_id:F,role:C}),await j()}catch(z){const q=(M=(_=z==null?void 0:z.response)==null?void 0:_.data)==null?void 0:M.detail;throw q?console.error("Project invite failed",q):console.error("Project invite failed",z),q?c(d(q)):z instanceof Error&&c(z.message),z}},A=async(I,R)=>{var _,M;if(!b)return;const C=f.find(z=>z.id===I);if(C&&C.user_id!==t.created_by&&$l(C.role)!==R){if(R==="admin"&&!k){alert("Only the owner can assign the admin role.");return}l(I);try{await mr.updateMember(t.id,I,{role:R}),await j()}catch(z){const q=(M=(_=z==null?void 0:z.response)==null?void 0:_.data)==null?void 0:M.detail;alert(q||"Unable to update member role right now.")}finally{l(null)}}},T=async(I,R)=>{var _,M;if(!(!b||!window.confirm(`Remove ${R||"this member"} from the project?`))){l(I);try{await mr.removeMember(t.id,I),await j()}catch(z){const q=(M=(_=z==null?void 0:z.response)==null?void 0:_.data)==null?void 0:M.detail;alert(q||"Unable to remove this member right now.")}finally{l(null)}}};return a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(tu,{className:"h-4 w-4 text-indigo-600"}),a.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Team"})]}),b&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",onClick:()=>s(!0),className:"inline-flex items-center rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 hover:bg-indigo-50",children:"Invite member"}),a.jsxs("button",{type:"button",onClick:()=>h(I=>!I),className:"inline-flex items-center gap-1 rounded-full border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-gray-100",children:[!u&&a.jsx(m0,{className:"h-3.5 w-3.5"}),u?"Done":"Manage"]})]})]}),o&&a.jsx("div",{className:"mt-3 rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-700",children:o}),a.jsx("ul",{className:"mt-4 space-y-3",children:S.length===0?a.jsx("li",{className:"rounded-lg border border-dashed border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-500",children:"No collaborators yet."}):S.map(I=>{var H,Y,L,Se,we;const R=I.user_id===t.created_by,C=$l(I.role),_=(I.status||"accepted").toLowerCase(),M=_==="invited",z=_==="declined",q=I.user_id===p,F=!b||R||M||!k&&C==="admin",V=!b||R||q,P=((H=I.user)==null?void 0:H.display_name)||[(Y=I.user)==null?void 0:Y.first_name,(L=I.user)==null?void 0:L.last_name].filter(Boolean).join(" ").trim()||((Se=I.user)==null?void 0:Se.email)||I.user_id;return a.jsxs("li",{className:"flex flex-col gap-3 rounded-lg border border-gray-200 bg-white px-4 py-3 shadow-sm sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"mt-1 flex h-8 w-8 items-center justify-center rounded-full bg-gray-100",children:yw(C)}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("p",{className:"truncate text-sm font-semibold text-gray-900 flex items-center gap-2",children:[a.jsx("span",{className:"truncate",children:P}),q&&a.jsx("span",{className:"text-[10px] uppercase tracking-wide text-indigo-500",children:"You"})]}),((we=I.user)==null?void 0:we.email)&&a.jsx("p",{className:"truncate text-xs text-gray-500",children:I.user.email}),_!=="accepted"&&a.jsxs("p",{className:`mt-1 text-xs ${M?"text-amber-600":z?"text-red-600":"text-gray-500"}`,children:["Status: ",_]})]})]}),a.jsxs("div",{className:"flex flex-col items-start gap-2 sm:flex-row sm:items-center sm:gap-3",children:[a.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-medium ${FL[C]}`,children:[yw(C),a.jsx("span",{className:"capitalize",children:C}),R&&a.jsx(lS,{className:"h-3 w-3 text-yellow-500","aria-label":"Project creator"}),M&&a.jsx(mn,{className:"h-3 w-3 text-amber-500","aria-label":"Invitation pending"})]}),b&&u&&a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsxs("select",{className:"rounded-md border border-gray-200 px-2 py-1 text-xs text-gray-700",value:C,disabled:F||!!i,onChange:ge=>A(I.id,ge.target.value),children:[a.jsx("option",{value:"admin",disabled:!k,children:"Admin"}),a.jsx("option",{value:"editor",children:"Editor"}),a.jsx("option",{value:"viewer",children:"Viewer"})]}),a.jsx("button",{type:"button",onClick:()=>{var ge;return T(I.id,(ge=I.user)==null?void 0:ge.email)},disabled:V||!!i,className:"inline-flex items-center rounded-md p-1 text-gray-400 hover:text-red-600 disabled:cursor-not-allowed disabled:opacity-50",title:V?"You cannot remove this member":"Remove member",children:a.jsx(nr,{className:"h-4 w-4"})})]})]})]},I.id)})}),b&&a.jsx(IL,{isOpen:r,onClose:()=>s(!1),onInvite:E,paperTitle:t.title})]})},zL=()=>{const{project:t}=qr();return a.jsx("div",{className:"space-y-6",children:a.jsxs("div",{className:"grid gap-6 lg:grid-cols-[2fr,1fr]",children:[a.jsxs("section",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[a.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Project context"}),a.jsxs("dl",{className:"mt-4 space-y-4 text-sm text-gray-600",children:[a.jsxs("div",{children:[a.jsx("dt",{className:"font-medium text-gray-700",children:"Idea"}),a.jsx("dd",{className:"mt-1 whitespace-pre-line",children:t.idea?t.idea:a.jsx("span",{className:"text-gray-400",children:"No idea captured yet."})})]}),a.jsxs("div",{children:[a.jsx("dt",{className:"font-medium text-gray-700",children:"Scope"}),a.jsx("dd",{className:"mt-1",children:t.scope?t.scope:a.jsx("span",{className:"text-gray-400",children:"Not defined"})})]}),a.jsxs("div",{children:[a.jsx("dt",{className:"font-medium text-gray-700",children:"Keywords"}),a.jsx("dd",{className:"mt-2 flex flex-wrap gap-2",children:t.keywords&&t.keywords.length>0?t.keywords.map(e=>a.jsx("span",{className:"inline-flex rounded-full bg-indigo-50 px-2.5 py-1 text-xs font-medium text-indigo-700",children:e},e)):a.jsx("span",{className:"text-gray-400",children:"No keywords recorded yet."})})]})]})]}),a.jsx("section",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:a.jsx(BL,{})})]})})};function $L(t,e){const n={};return(t[t.length-1]===""?[...t,""]:t).join((n.padRight?" ":"")+","+(n.padLeft===!1?"":" ")).trim()}const UL=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,HL=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,qL={};function bw(t,e){return(qL.jsx?HL:UL).test(t)}const VL=/[ \t\n\f\r]/g;function WL(t){return typeof t=="object"?t.type==="text"?vw(t.value):!1:vw(t)}function vw(t){return t.replace(VL,"")===""}class iu{constructor(e,n,r){this.normal=n,this.property=e,r&&(this.space=r)}}iu.prototype.normal={};iu.prototype.property={};iu.prototype.space=void 0;function YN(t,e){const n={},r={};for(const s of t)Object.assign(n,s.property),Object.assign(r,s.normal);return new iu(n,r,e)}function Vg(t){return t.toLowerCase()}class Gn{constructor(e,n){this.attribute=n,this.property=e}}Gn.prototype.attribute="";Gn.prototype.booleanish=!1;Gn.prototype.boolean=!1;Gn.prototype.commaOrSpaceSeparated=!1;Gn.prototype.commaSeparated=!1;Gn.prototype.defined=!1;Gn.prototype.mustUseProperty=!1;Gn.prototype.number=!1;Gn.prototype.overloadedBoolean=!1;Gn.prototype.property="";Gn.prototype.spaceSeparated=!1;Gn.prototype.space=void 0;let KL=0;const ze=Rl(),Dt=Rl(),Wg=Rl(),ue=Rl(),ht=Rl(),ba=Rl(),Jn=Rl();function Rl(){return 2**++KL}const Kg=Object.freeze(Object.defineProperty({__proto__:null,boolean:ze,booleanish:Dt,commaOrSpaceSeparated:Jn,commaSeparated:ba,number:ue,overloadedBoolean:Wg,spaceSeparated:ht},Symbol.toStringTag,{value:"Module"})),wp=Object.keys(Kg);class B0 extends Gn{constructor(e,n,r,s){let i=-1;if(super(e,n),ww(this,"space",s),typeof r=="number")for(;++i<wp.length;){const l=wp[i];ww(this,wp[i],(r&Kg[l])===Kg[l])}}}B0.prototype.defined=!0;function ww(t,e,n){n&&(t[e]=n)}function so(t){const e={},n={};for(const[r,s]of Object.entries(t.properties)){const i=new B0(r,t.transform(t.attributes||{},r),s,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(i.mustUseProperty=!0),e[r]=i,n[Vg(r)]=r,n[Vg(i.attribute)]=r}return new iu(e,n,t.space)}const ZN=so({properties:{ariaActiveDescendant:null,ariaAtomic:Dt,ariaAutoComplete:null,ariaBusy:Dt,ariaChecked:Dt,ariaColCount:ue,ariaColIndex:ue,ariaColSpan:ue,ariaControls:ht,ariaCurrent:null,ariaDescribedBy:ht,ariaDetails:null,ariaDisabled:Dt,ariaDropEffect:ht,ariaErrorMessage:null,ariaExpanded:Dt,ariaFlowTo:ht,ariaGrabbed:Dt,ariaHasPopup:null,ariaHidden:Dt,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:ht,ariaLevel:ue,ariaLive:null,ariaModal:Dt,ariaMultiLine:Dt,ariaMultiSelectable:Dt,ariaOrientation:null,ariaOwns:ht,ariaPlaceholder:null,ariaPosInSet:ue,ariaPressed:Dt,ariaReadOnly:Dt,ariaRelevant:null,ariaRequired:Dt,ariaRoleDescription:ht,ariaRowCount:ue,ariaRowIndex:ue,ariaRowSpan:ue,ariaSelected:Dt,ariaSetSize:ue,ariaSort:null,ariaValueMax:ue,ariaValueMin:ue,ariaValueNow:ue,ariaValueText:null,role:null},transform(t,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function eC(t,e){return e in t?t[e]:e}function tC(t,e){return eC(t,e.toLowerCase())}const QL=so({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:ba,acceptCharset:ht,accessKey:ht,action:null,allow:null,allowFullScreen:ze,allowPaymentRequest:ze,allowUserMedia:ze,alt:null,as:null,async:ze,autoCapitalize:null,autoComplete:ht,autoFocus:ze,autoPlay:ze,blocking:ht,capture:null,charSet:null,checked:ze,cite:null,className:ht,cols:ue,colSpan:null,content:null,contentEditable:Dt,controls:ze,controlsList:ht,coords:ue|ba,crossOrigin:null,data:null,dateTime:null,decoding:null,default:ze,defer:ze,dir:null,dirName:null,disabled:ze,download:Wg,draggable:Dt,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:ze,formTarget:null,headers:ht,height:ue,hidden:Wg,high:ue,href:null,hrefLang:null,htmlFor:ht,httpEquiv:ht,id:null,imageSizes:null,imageSrcSet:null,inert:ze,inputMode:null,integrity:null,is:null,isMap:ze,itemId:null,itemProp:ht,itemRef:ht,itemScope:ze,itemType:ht,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:ze,low:ue,manifest:null,max:null,maxLength:ue,media:null,method:null,min:null,minLength:ue,multiple:ze,muted:ze,name:null,nonce:null,noModule:ze,noValidate:ze,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:ze,optimum:ue,pattern:null,ping:ht,placeholder:null,playsInline:ze,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:ze,referrerPolicy:null,rel:ht,required:ze,reversed:ze,rows:ue,rowSpan:ue,sandbox:ht,scope:null,scoped:ze,seamless:ze,selected:ze,shadowRootClonable:ze,shadowRootDelegatesFocus:ze,shadowRootMode:null,shape:null,size:ue,sizes:null,slot:null,span:ue,spellCheck:Dt,src:null,srcDoc:null,srcLang:null,srcSet:null,start:ue,step:null,style:null,tabIndex:ue,target:null,title:null,translate:null,type:null,typeMustMatch:ze,useMap:null,value:Dt,width:ue,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:ht,axis:null,background:null,bgColor:null,border:ue,borderColor:null,bottomMargin:ue,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:ze,declare:ze,event:null,face:null,frame:null,frameBorder:null,hSpace:ue,leftMargin:ue,link:null,longDesc:null,lowSrc:null,marginHeight:ue,marginWidth:ue,noResize:ze,noHref:ze,noShade:ze,noWrap:ze,object:null,profile:null,prompt:null,rev:null,rightMargin:ue,rules:null,scheme:null,scrolling:Dt,standby:null,summary:null,text:null,topMargin:ue,valueType:null,version:null,vAlign:null,vLink:null,vSpace:ue,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:ze,disableRemotePlayback:ze,prefix:null,property:null,results:ue,security:null,unselectable:null},space:"html",transform:tC}),GL=so({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:Jn,accentHeight:ue,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:ue,amplitude:ue,arabicForm:null,ascent:ue,attributeName:null,attributeType:null,azimuth:ue,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:ue,by:null,calcMode:null,capHeight:ue,className:ht,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:ue,diffuseConstant:ue,direction:null,display:null,dur:null,divisor:ue,dominantBaseline:null,download:ze,dx:null,dy:null,edgeMode:null,editable:null,elevation:ue,enableBackground:null,end:null,event:null,exponent:ue,externalResourcesRequired:null,fill:null,fillOpacity:ue,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:ba,g2:ba,glyphName:ba,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:ue,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:ue,horizOriginX:ue,horizOriginY:ue,id:null,ideographic:ue,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:ue,k:ue,k1:ue,k2:ue,k3:ue,k4:ue,kernelMatrix:Jn,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:ue,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:ue,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:ue,overlineThickness:ue,paintOrder:null,panose1:null,path:null,pathLength:ue,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:ht,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:ue,pointsAtY:ue,pointsAtZ:ue,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:Jn,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:Jn,rev:Jn,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:Jn,requiredFeatures:Jn,requiredFonts:Jn,requiredFormats:Jn,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:ue,specularExponent:ue,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:ue,strikethroughThickness:ue,string:null,stroke:null,strokeDashArray:Jn,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:ue,strokeOpacity:ue,strokeWidth:null,style:null,surfaceScale:ue,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:Jn,tabIndex:ue,tableValues:null,target:null,targetX:ue,targetY:ue,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:Jn,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:ue,underlineThickness:ue,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:ue,values:null,vAlphabetic:ue,vMathematical:ue,vectorEffect:null,vHanging:ue,vIdeographic:ue,version:null,vertAdvY:ue,vertOriginX:ue,vertOriginY:ue,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:ue,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:eC}),nC=so({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(t,e){return"xlink:"+e.slice(5).toLowerCase()}}),rC=so({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:tC}),sC=so({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(t,e){return"xml:"+e.slice(3).toLowerCase()}}),XL={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},JL=/[A-Z]/g,kw=/-[a-z]/g,YL=/^data[-\w.:]+$/i;function ZL(t,e){const n=Vg(e);let r=e,s=Gn;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&n.slice(0,4)==="data"&&YL.test(e)){if(e.charAt(4)==="-"){const i=e.slice(5).replace(kw,tO);r="data"+i.charAt(0).toUpperCase()+i.slice(1)}else{const i=e.slice(4);if(!kw.test(i)){let l=i.replace(JL,eO);l.charAt(0)!=="-"&&(l="-"+l),e="data"+l}}s=B0}return new s(r,e)}function eO(t){return"-"+t.toLowerCase()}function tO(t){return t.charAt(1).toUpperCase()}const nO=YN([ZN,QL,nC,rC,sC],"html"),z0=YN([ZN,GL,nC,rC,sC],"svg");function rO(t){return t.join(" ").trim()}var $0={},jw=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,sO=/\n/g,iO=/^\s*/,lO=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,aO=/^:\s*/,oO=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,cO=/^[;\s]*/,uO=/^\s+|\s+$/g,dO=`
`,Sw="/",Nw="*",Xi="",hO="comment",fO="declaration",pO=function(t,e){if(typeof t!="string")throw new TypeError("First argument must be a string");if(!t)return[];e=e||{};var n=1,r=1;function s(m){var x=m.match(sO);x&&(n+=x.length);var v=m.lastIndexOf(dO);r=~v?m.length-v:r+m.length}function i(){var m={line:n,column:r};return function(x){return x.position=new l(m),u(),x}}function l(m){this.start=m,this.end={line:n,column:r},this.source=e.source}l.prototype.content=t;function o(m){var x=new Error(e.source+":"+n+":"+r+": "+m);if(x.reason=m,x.filename=e.source,x.line=n,x.column=r,x.source=t,!e.silent)throw x}function c(m){var x=m.exec(t);if(x){var v=x[0];return s(v),t=t.slice(v.length),x}}function u(){c(iO)}function h(m){var x;for(m=m||[];x=d();)x!==!1&&m.push(x);return m}function d(){var m=i();if(!(Sw!=t.charAt(0)||Nw!=t.charAt(1))){for(var x=2;Xi!=t.charAt(x)&&(Nw!=t.charAt(x)||Sw!=t.charAt(x+1));)++x;if(x+=2,Xi===t.charAt(x-1))return o("End of comment missing");var v=t.slice(2,x-2);return r+=2,s(v),t=t.slice(x),r+=2,m({type:hO,comment:v})}}function f(){var m=i(),x=c(lO);if(x){if(d(),!c(aO))return o("property missing ':'");var v=c(oO),g=m({type:fO,property:Cw(x[0].replace(jw,Xi)),value:v?Cw(v[0].replace(jw,Xi)):Xi});return c(cO),g}}function p(){var m=[];h(m);for(var x;x=f();)x!==!1&&(m.push(x),h(m));return m}return u(),p()};function Cw(t){return t?t.replace(uO,Xi):Xi}var mO=_d&&_d.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty($0,"__esModule",{value:!0});$0.default=xO;var gO=mO(pO);function xO(t,e){var n=null;if(!t||typeof t!="string")return n;var r=(0,gO.default)(t),s=typeof e=="function";return r.forEach(function(i){if(i.type==="declaration"){var l=i.property,o=i.value;s?e(l,o,i):o&&(n=n||{},n[l]=o)}}),n}var of={};Object.defineProperty(of,"__esModule",{value:!0});of.camelCase=void 0;var yO=/^--[a-zA-Z0-9_-]+$/,bO=/-([a-z])/g,vO=/^[^-]+$/,wO=/^-(webkit|moz|ms|o|khtml)-/,kO=/^-(ms)-/,jO=function(t){return!t||vO.test(t)||yO.test(t)},SO=function(t,e){return e.toUpperCase()},Aw=function(t,e){return"".concat(e,"-")},NO=function(t,e){return e===void 0&&(e={}),jO(t)?t:(t=t.toLowerCase(),e.reactCompat?t=t.replace(kO,Aw):t=t.replace(wO,Aw),t.replace(bO,SO))};of.camelCase=NO;var CO=_d&&_d.__importDefault||function(t){return t&&t.__esModule?t:{default:t}},AO=CO($0),EO=of;function Qg(t,e){var n={};return!t||typeof t!="string"||(0,AO.default)(t,function(r,s){r&&s&&(n[(0,EO.camelCase)(r,e)]=s)}),n}Qg.default=Qg;var PO=Qg;const _O=ox(PO),iC=lC("end"),U0=lC("start");function lC(t){return e;function e(n){const r=n&&n.position&&n.position[t]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function MO(t){const e=U0(t),n=iC(t);if(e&&n)return{start:e,end:n}}function nc(t){return!t||typeof t!="object"?"":"position"in t||"type"in t?Ew(t.position):"start"in t||"end"in t?Ew(t):"line"in t||"column"in t?Gg(t):""}function Gg(t){return Pw(t&&t.line)+":"+Pw(t&&t.column)}function Ew(t){return Gg(t&&t.start)+"-"+Gg(t&&t.end)}function Pw(t){return t&&typeof t=="number"?t:1}class wn extends Error{constructor(e,n,r){super(),typeof n=="string"&&(r=n,n=void 0);let s="",i={},l=!1;if(n&&("line"in n&&"column"in n?i={place:n}:"start"in n&&"end"in n?i={place:n}:"type"in n?i={ancestors:[n],place:n.position}:i={...n}),typeof e=="string"?s=e:!i.cause&&e&&(l=!0,s=e.message,i.cause=e),!i.ruleId&&!i.source&&typeof r=="string"){const c=r.indexOf(":");c===-1?i.ruleId=r:(i.source=r.slice(0,c),i.ruleId=r.slice(c+1))}if(!i.place&&i.ancestors&&i.ancestors){const c=i.ancestors[i.ancestors.length-1];c&&(i.place=c.position)}const o=i.place&&"start"in i.place?i.place.start:i.place;this.ancestors=i.ancestors||void 0,this.cause=i.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file="",this.message=s,this.line=o?o.line:void 0,this.name=nc(i.place)||"1:1",this.place=i.place||void 0,this.reason=this.message,this.ruleId=i.ruleId||void 0,this.source=i.source||void 0,this.stack=l&&i.cause&&typeof i.cause.stack=="string"?i.cause.stack:"",this.actual=void 0,this.expected=void 0,this.note=void 0,this.url=void 0}}wn.prototype.file="";wn.prototype.name="";wn.prototype.reason="";wn.prototype.message="";wn.prototype.stack="";wn.prototype.column=void 0;wn.prototype.line=void 0;wn.prototype.ancestors=void 0;wn.prototype.cause=void 0;wn.prototype.fatal=void 0;wn.prototype.place=void 0;wn.prototype.ruleId=void 0;wn.prototype.source=void 0;const H0={}.hasOwnProperty,TO=new Map,RO=/[A-Z]/g,DO=new Set(["table","tbody","thead","tfoot","tr"]),LO=new Set(["td","th"]),aC="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function OO(t,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const n=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=qO(n,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=HO(n,e.jsx,e.jsxs)}const s={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:n,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?z0:nO,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},i=oC(s,t,void 0);return i&&typeof i!="string"?i:s.create(t,s.Fragment,{children:i||void 0},void 0)}function oC(t,e,n){if(e.type==="element")return IO(t,e,n);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return FO(t,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return zO(t,e,n);if(e.type==="mdxjsEsm")return BO(t,e);if(e.type==="root")return $O(t,e,n);if(e.type==="text")return UO(t,e)}function IO(t,e,n){const r=t.schema;let s=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(s=z0,t.schema=s),t.ancestors.push(e);const i=uC(t,e.tagName,!1),l=VO(t,e);let o=V0(t,e);return DO.has(e.tagName)&&(o=o.filter(function(c){return typeof c=="string"?!WL(c):!0})),cC(t,l,i,e),q0(l,o),t.ancestors.pop(),t.schema=r,t.create(e,i,l,n)}function FO(t,e){if(e.data&&e.data.estree&&t.evaluater){const r=e.data.estree.body[0];return r.type,t.evaluater.evaluateExpression(r.expression)}Bc(t,e.position)}function BO(t,e){if(e.data&&e.data.estree&&t.evaluater)return t.evaluater.evaluateProgram(e.data.estree);Bc(t,e.position)}function zO(t,e,n){const r=t.schema;let s=r;e.name==="svg"&&r.space==="html"&&(s=z0,t.schema=s),t.ancestors.push(e);const i=e.name===null?t.Fragment:uC(t,e.name,!0),l=WO(t,e),o=V0(t,e);return cC(t,l,i,e),q0(l,o),t.ancestors.pop(),t.schema=r,t.create(e,i,l,n)}function $O(t,e,n){const r={};return q0(r,V0(t,e)),t.create(e,t.Fragment,r,n)}function UO(t,e){return e.value}function cC(t,e,n,r){typeof n!="string"&&n!==t.Fragment&&t.passNode&&(e.node=r)}function q0(t,e){if(e.length>0){const n=e.length>1?e:e[0];n&&(t.children=n)}}function HO(t,e,n){return r;function r(s,i,l,o){const u=Array.isArray(l.children)?n:e;return o?u(i,l,o):u(i,l)}}function qO(t,e){return n;function n(r,s,i,l){const o=Array.isArray(i.children),c=U0(r);return e(s,i,l,o,{columnNumber:c?c.column-1:void 0,fileName:t,lineNumber:c?c.line:void 0},void 0)}}function VO(t,e){const n={};let r,s;for(s in e.properties)if(s!=="children"&&H0.call(e.properties,s)){const i=KO(t,s,e.properties[s]);if(i){const[l,o]=i;t.tableCellAlignToStyle&&l==="align"&&typeof o=="string"&&LO.has(e.tagName)?r=o:n[l]=o}}if(r){const i=n.style||(n.style={});i[t.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return n}function WO(t,e){const n={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&t.evaluater){const i=r.data.estree.body[0];i.type;const l=i.expression;l.type;const o=l.properties[0];o.type,Object.assign(n,t.evaluater.evaluateExpression(o.argument))}else Bc(t,e.position);else{const s=r.name;let i;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&t.evaluater){const o=r.value.data.estree.body[0];o.type,i=t.evaluater.evaluateExpression(o.expression)}else Bc(t,e.position);else i=r.value===null?!0:r.value;n[s]=i}return n}function V0(t,e){const n=[];let r=-1;const s=t.passKeys?new Map:TO;for(;++r<e.children.length;){const i=e.children[r];let l;if(t.passKeys){const c=i.type==="element"?i.tagName:i.type==="mdxJsxFlowElement"||i.type==="mdxJsxTextElement"?i.name:void 0;if(c){const u=s.get(c)||0;l=c+"-"+u,s.set(c,u+1)}}const o=oC(t,i,l);o!==void 0&&n.push(o)}return n}function KO(t,e,n){const r=ZL(t.schema,e);if(!(n==null||typeof n=="number"&&Number.isNaN(n))){if(Array.isArray(n)&&(n=r.commaSeparated?$L(n):rO(n)),r.property==="style"){let s=typeof n=="object"?n:QO(t,String(n));return t.stylePropertyNameCase==="css"&&(s=GO(s)),["style",s]}return[t.elementAttributeNameCase==="react"&&r.space?XL[r.property]||r.property:r.attribute,n]}}function QO(t,e){try{return _O(e,{reactCompat:!0})}catch(n){if(t.ignoreInvalidStyle)return{};const r=n,s=new wn("Cannot parse `style` attribute",{ancestors:t.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw s.file=t.filePath||void 0,s.url=aC+"#cannot-parse-style-attribute",s}}function uC(t,e,n){let r;if(!n)r={type:"Literal",value:e};else if(e.includes(".")){const s=e.split(".");let i=-1,l;for(;++i<s.length;){const o=bw(s[i])?{type:"Identifier",name:s[i]}:{type:"Literal",value:s[i]};l=l?{type:"MemberExpression",object:l,property:o,computed:!!(i&&o.type==="Literal"),optional:!1}:o}r=l}else r=bw(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const s=r.value;return H0.call(t.components,s)?t.components[s]:s}if(t.evaluater)return t.evaluater.evaluateExpression(r);Bc(t)}function Bc(t,e){const n=new wn("Cannot handle MDX estrees without `createEvaluater`",{ancestors:t.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw n.file=t.filePath||void 0,n.url=aC+"#cannot-handle-mdx-estrees-without-createevaluater",n}function GO(t){const e={};let n;for(n in t)H0.call(t,n)&&(e[XO(n)]=t[n]);return e}function XO(t){let e=t.replace(RO,JO);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function JO(t){return"-"+t.toLowerCase()}const kp={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},YO={};function W0(t,e){const n=YO,r=typeof n.includeImageAlt=="boolean"?n.includeImageAlt:!0,s=typeof n.includeHtml=="boolean"?n.includeHtml:!0;return dC(t,r,s)}function dC(t,e,n){if(ZO(t)){if("value"in t)return t.type==="html"&&!n?"":t.value;if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return _w(t.children,e,n)}return Array.isArray(t)?_w(t,e,n):""}function _w(t,e,n){const r=[];let s=-1;for(;++s<t.length;)r[s]=dC(t[s],e,n);return r.join("")}function ZO(t){return!!(t&&typeof t=="object")}const Mw=document.createElement("i");function K0(t){const e="&"+t+";";Mw.innerHTML=e;const n=Mw.textContent;return n.charCodeAt(n.length-1)===59&&t!=="semi"||n===e?!1:n}function ir(t,e,n,r){const s=t.length;let i=0,l;if(e<0?e=-e>s?0:s+e:e=e>s?s:e,n=n>0?n:0,r.length<1e4)l=Array.from(r),l.unshift(e,n),t.splice(...l);else for(n&&t.splice(e,n);i<r.length;)l=r.slice(i,i+1e4),l.unshift(e,0),t.splice(...l),i+=1e4,e+=1e4}function yr(t,e){return t.length>0?(ir(t,t.length,0,e),t):e}const Tw={}.hasOwnProperty;function hC(t){const e={};let n=-1;for(;++n<t.length;)eI(e,t[n]);return e}function eI(t,e){let n;for(n in e){const s=(Tw.call(t,n)?t[n]:void 0)||(t[n]={}),i=e[n];let l;if(i)for(l in i){Tw.call(s,l)||(s[l]=[]);const o=i[l];tI(s[l],Array.isArray(o)?o:o?[o]:[])}}}function tI(t,e){let n=-1;const r=[];for(;++n<e.length;)(e[n].add==="after"?t:r).push(e[n]);ir(t,0,0,r)}function fC(t,e){const n=Number.parseInt(t,e);return n<9||n===11||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||(n&65535)===65535||(n&65535)===65534||n>1114111?"":String.fromCodePoint(n)}function zr(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const En=Ui(/[A-Za-z]/),bn=Ui(/[\dA-Za-z]/),nI=Ui(/[#-'*+\--9=?A-Z^-~]/);function wh(t){return t!==null&&(t<32||t===127)}const Xg=Ui(/\d/),rI=Ui(/[\dA-Fa-f]/),sI=Ui(/[!-/:-@[-`{-~]/);function Te(t){return t!==null&&t<-2}function ut(t){return t!==null&&(t<0||t===32)}function He(t){return t===-2||t===-1||t===32}const cf=Ui(new RegExp("\\p{P}|\\p{S}","u")),El=Ui(/\s/);function Ui(t){return e;function e(n){return n!==null&&n>-1&&t.test(String.fromCharCode(n))}}function io(t){const e=[];let n=-1,r=0,s=0;for(;++n<t.length;){const i=t.charCodeAt(n);let l="";if(i===37&&bn(t.charCodeAt(n+1))&&bn(t.charCodeAt(n+2)))s=2;else if(i<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(i))||(l=String.fromCharCode(i));else if(i>55295&&i<57344){const o=t.charCodeAt(n+1);i<56320&&o>56319&&o<57344?(l=String.fromCharCode(i,o),s=1):l=""}else l=String.fromCharCode(i);l&&(e.push(t.slice(r,n),encodeURIComponent(l)),r=n+s+1,l=""),s&&(n+=s,s=0)}return e.join("")+t.slice(r)}function Qe(t,e,n,r){const s=r?r-1:Number.POSITIVE_INFINITY;let i=0;return l;function l(c){return He(c)?(t.enter(n),o(c)):e(c)}function o(c){return He(c)&&i++<s?(t.consume(c),o):(t.exit(n),e(c))}}const iI={tokenize:lI};function lI(t){const e=t.attempt(this.parser.constructs.contentInitial,r,s);let n;return e;function r(o){if(o===null){t.consume(o);return}return t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),Qe(t,e,"linePrefix")}function s(o){return t.enter("paragraph"),i(o)}function i(o){const c=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=c),n=c,l(o)}function l(o){if(o===null){t.exit("chunkText"),t.exit("paragraph"),t.consume(o);return}return Te(o)?(t.consume(o),t.exit("chunkText"),i):(t.consume(o),l)}}const aI={tokenize:oI},Rw={tokenize:cI};function oI(t){const e=this,n=[];let r=0,s,i,l;return o;function o(b){if(r<n.length){const k=n[r];return e.containerState=k[1],t.attempt(k[0].continuation,c,u)(b)}return u(b)}function c(b){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,s&&y();const k=e.events.length;let S=k,j;for(;S--;)if(e.events[S][0]==="exit"&&e.events[S][1].type==="chunkFlow"){j=e.events[S][1].end;break}g(r);let E=k;for(;E<e.events.length;)e.events[E][1].end={...j},E++;return ir(e.events,S+1,0,e.events.slice(k)),e.events.length=E,u(b)}return o(b)}function u(b){if(r===n.length){if(!s)return f(b);if(s.currentConstruct&&s.currentConstruct.concrete)return m(b);e.interrupt=!!(s.currentConstruct&&!s._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(Rw,h,d)(b)}function h(b){return s&&y(),g(r),f(b)}function d(b){return e.parser.lazy[e.now().line]=r!==n.length,l=e.now().offset,m(b)}function f(b){return e.containerState={},t.attempt(Rw,p,m)(b)}function p(b){return r++,n.push([e.currentConstruct,e.containerState]),f(b)}function m(b){if(b===null){s&&y(),g(0),t.consume(b);return}return s=s||e.parser.flow(e.now()),t.enter("chunkFlow",{_tokenizer:s,contentType:"flow",previous:i}),x(b)}function x(b){if(b===null){v(t.exit("chunkFlow"),!0),g(0),t.consume(b);return}return Te(b)?(t.consume(b),v(t.exit("chunkFlow")),r=0,e.interrupt=void 0,o):(t.consume(b),x)}function v(b,k){const S=e.sliceStream(b);if(k&&S.push(null),b.previous=i,i&&(i.next=b),i=b,s.defineSkip(b.start),s.write(S),e.parser.lazy[b.start.line]){let j=s.events.length;for(;j--;)if(s.events[j][1].start.offset<l&&(!s.events[j][1].end||s.events[j][1].end.offset>l))return;const E=e.events.length;let A=E,T,N;for(;A--;)if(e.events[A][0]==="exit"&&e.events[A][1].type==="chunkFlow"){if(T){N=e.events[A][1].end;break}T=!0}for(g(r),j=E;j<e.events.length;)e.events[j][1].end={...N},j++;ir(e.events,A+1,0,e.events.slice(E)),e.events.length=j}}function g(b){let k=n.length;for(;k-- >b;){const S=n[k];e.containerState=S[1],S[0].exit.call(e,t)}n.length=b}function y(){s.write([null]),i=void 0,s=void 0,e.containerState._closeFlow=void 0}}function cI(t,e,n){return Qe(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function Xa(t){if(t===null||ut(t)||El(t))return 1;if(cf(t))return 2}function uf(t,e,n){const r=[];let s=-1;for(;++s<t.length;){const i=t[s].resolveAll;i&&!r.includes(i)&&(e=i(e,n),r.push(i))}return e}const Jg={name:"attention",resolveAll:uI,tokenize:dI};function uI(t,e){let n=-1,r,s,i,l,o,c,u,h;for(;++n<t.length;)if(t[n][0]==="enter"&&t[n][1].type==="attentionSequence"&&t[n][1]._close){for(r=n;r--;)if(t[r][0]==="exit"&&t[r][1].type==="attentionSequence"&&t[r][1]._open&&e.sliceSerialize(t[r][1]).charCodeAt(0)===e.sliceSerialize(t[n][1]).charCodeAt(0)){if((t[r][1]._close||t[n][1]._open)&&(t[n][1].end.offset-t[n][1].start.offset)%3&&!((t[r][1].end.offset-t[r][1].start.offset+t[n][1].end.offset-t[n][1].start.offset)%3))continue;c=t[r][1].end.offset-t[r][1].start.offset>1&&t[n][1].end.offset-t[n][1].start.offset>1?2:1;const d={...t[r][1].end},f={...t[n][1].start};Dw(d,-c),Dw(f,c),l={type:c>1?"strongSequence":"emphasisSequence",start:d,end:{...t[r][1].end}},o={type:c>1?"strongSequence":"emphasisSequence",start:{...t[n][1].start},end:f},i={type:c>1?"strongText":"emphasisText",start:{...t[r][1].end},end:{...t[n][1].start}},s={type:c>1?"strong":"emphasis",start:{...l.start},end:{...o.end}},t[r][1].end={...l.start},t[n][1].start={...o.end},u=[],t[r][1].end.offset-t[r][1].start.offset&&(u=yr(u,[["enter",t[r][1],e],["exit",t[r][1],e]])),u=yr(u,[["enter",s,e],["enter",l,e],["exit",l,e],["enter",i,e]]),u=yr(u,uf(e.parser.constructs.insideSpan.null,t.slice(r+1,n),e)),u=yr(u,[["exit",i,e],["enter",o,e],["exit",o,e],["exit",s,e]]),t[n][1].end.offset-t[n][1].start.offset?(h=2,u=yr(u,[["enter",t[n][1],e],["exit",t[n][1],e]])):h=0,ir(t,r-1,n-r+3,u),n=r+u.length-h-2;break}}for(n=-1;++n<t.length;)t[n][1].type==="attentionSequence"&&(t[n][1].type="data");return t}function dI(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,s=Xa(r);let i;return l;function l(c){return i=c,t.enter("attentionSequence"),o(c)}function o(c){if(c===i)return t.consume(c),o;const u=t.exit("attentionSequence"),h=Xa(c),d=!h||h===2&&s||n.includes(c),f=!s||s===2&&h||n.includes(r);return u._open=!!(i===42?d:d&&(s||!f)),u._close=!!(i===42?f:f&&(h||!d)),e(c)}}function Dw(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const hI={name:"autolink",tokenize:fI};function fI(t,e,n){let r=0;return s;function s(p){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),i}function i(p){return En(p)?(t.consume(p),l):p===64?n(p):u(p)}function l(p){return p===43||p===45||p===46||bn(p)?(r=1,o(p)):u(p)}function o(p){return p===58?(t.consume(p),r=0,c):(p===43||p===45||p===46||bn(p))&&r++<32?(t.consume(p),o):(r=0,u(p))}function c(p){return p===62?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):p===null||p===32||p===60||wh(p)?n(p):(t.consume(p),c)}function u(p){return p===64?(t.consume(p),h):nI(p)?(t.consume(p),u):n(p)}function h(p){return bn(p)?d(p):n(p)}function d(p){return p===46?(t.consume(p),r=0,h):p===62?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(p),t.exit("autolinkMarker"),t.exit("autolink"),e):f(p)}function f(p){if((p===45||bn(p))&&r++<63){const m=p===45?f:d;return t.consume(p),m}return n(p)}}const lu={partial:!0,tokenize:pI};function pI(t,e,n){return r;function r(i){return He(i)?Qe(t,s,"linePrefix")(i):s(i)}function s(i){return i===null||Te(i)?e(i):n(i)}}const pC={continuation:{tokenize:gI},exit:xI,name:"blockQuote",tokenize:mI};function mI(t,e,n){const r=this;return s;function s(l){if(l===62){const o=r.containerState;return o.open||(t.enter("blockQuote",{_container:!0}),o.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(l),t.exit("blockQuoteMarker"),i}return n(l)}function i(l){return He(l)?(t.enter("blockQuotePrefixWhitespace"),t.consume(l),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(l))}}function gI(t,e,n){const r=this;return s;function s(l){return He(l)?Qe(t,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(l):i(l)}function i(l){return t.attempt(pC,e,n)(l)}}function xI(t){t.exit("blockQuote")}const mC={name:"characterEscape",tokenize:yI};function yI(t,e,n){return r;function r(i){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(i),t.exit("escapeMarker"),s}function s(i){return sI(i)?(t.enter("characterEscapeValue"),t.consume(i),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(i)}}const gC={name:"characterReference",tokenize:bI};function bI(t,e,n){const r=this;let s=0,i,l;return o;function o(d){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),c}function c(d){return d===35?(t.enter("characterReferenceMarkerNumeric"),t.consume(d),t.exit("characterReferenceMarkerNumeric"),u):(t.enter("characterReferenceValue"),i=31,l=bn,h(d))}function u(d){return d===88||d===120?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(d),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),i=6,l=rI,h):(t.enter("characterReferenceValue"),i=7,l=Xg,h(d))}function h(d){if(d===59&&s){const f=t.exit("characterReferenceValue");return l===bn&&!K0(r.sliceSerialize(f))?n(d):(t.enter("characterReferenceMarker"),t.consume(d),t.exit("characterReferenceMarker"),t.exit("characterReference"),e)}return l(d)&&s++<i?(t.consume(d),h):n(d)}}const Lw={partial:!0,tokenize:wI},Ow={concrete:!0,name:"codeFenced",tokenize:vI};function vI(t,e,n){const r=this,s={partial:!0,tokenize:S};let i=0,l=0,o;return c;function c(j){return u(j)}function u(j){const E=r.events[r.events.length-1];return i=E&&E[1].type==="linePrefix"?E[2].sliceSerialize(E[1],!0).length:0,o=j,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),h(j)}function h(j){return j===o?(l++,t.consume(j),h):l<3?n(j):(t.exit("codeFencedFenceSequence"),He(j)?Qe(t,d,"whitespace")(j):d(j))}function d(j){return j===null||Te(j)?(t.exit("codeFencedFence"),r.interrupt?e(j):t.check(Lw,x,k)(j)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),f(j))}function f(j){return j===null||Te(j)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),d(j)):He(j)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),Qe(t,p,"whitespace")(j)):j===96&&j===o?n(j):(t.consume(j),f)}function p(j){return j===null||Te(j)?d(j):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),m(j))}function m(j){return j===null||Te(j)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),d(j)):j===96&&j===o?n(j):(t.consume(j),m)}function x(j){return t.attempt(s,k,v)(j)}function v(j){return t.enter("lineEnding"),t.consume(j),t.exit("lineEnding"),g}function g(j){return i>0&&He(j)?Qe(t,y,"linePrefix",i+1)(j):y(j)}function y(j){return j===null||Te(j)?t.check(Lw,x,k)(j):(t.enter("codeFlowValue"),b(j))}function b(j){return j===null||Te(j)?(t.exit("codeFlowValue"),y(j)):(t.consume(j),b)}function k(j){return t.exit("codeFenced"),e(j)}function S(j,E,A){let T=0;return N;function N(M){return j.enter("lineEnding"),j.consume(M),j.exit("lineEnding"),I}function I(M){return j.enter("codeFencedFence"),He(M)?Qe(j,R,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(M):R(M)}function R(M){return M===o?(j.enter("codeFencedFenceSequence"),C(M)):A(M)}function C(M){return M===o?(T++,j.consume(M),C):T>=l?(j.exit("codeFencedFenceSequence"),He(M)?Qe(j,_,"whitespace")(M):_(M)):A(M)}function _(M){return M===null||Te(M)?(j.exit("codeFencedFence"),E(M)):A(M)}}}function wI(t,e,n){const r=this;return s;function s(l){return l===null?n(l):(t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),i)}function i(l){return r.parser.lazy[r.now().line]?n(l):e(l)}}const jp={name:"codeIndented",tokenize:jI},kI={partial:!0,tokenize:SI};function jI(t,e,n){const r=this;return s;function s(u){return t.enter("codeIndented"),Qe(t,i,"linePrefix",5)(u)}function i(u){const h=r.events[r.events.length-1];return h&&h[1].type==="linePrefix"&&h[2].sliceSerialize(h[1],!0).length>=4?l(u):n(u)}function l(u){return u===null?c(u):Te(u)?t.attempt(kI,l,c)(u):(t.enter("codeFlowValue"),o(u))}function o(u){return u===null||Te(u)?(t.exit("codeFlowValue"),l(u)):(t.consume(u),o)}function c(u){return t.exit("codeIndented"),e(u)}}function SI(t,e,n){const r=this;return s;function s(l){return r.parser.lazy[r.now().line]?n(l):Te(l)?(t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),s):Qe(t,i,"linePrefix",5)(l)}function i(l){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(l):Te(l)?s(l):n(l)}}const NI={name:"codeText",previous:AI,resolve:CI,tokenize:EI};function CI(t){let e=t.length-4,n=3,r,s;if((t[n][1].type==="lineEnding"||t[n][1].type==="space")&&(t[e][1].type==="lineEnding"||t[e][1].type==="space")){for(r=n;++r<e;)if(t[r][1].type==="codeTextData"){t[n][1].type="codeTextPadding",t[e][1].type="codeTextPadding",n+=2,e-=2;break}}for(r=n-1,e++;++r<=e;)s===void 0?r!==e&&t[r][1].type!=="lineEnding"&&(s=r):(r===e||t[r][1].type==="lineEnding")&&(t[s][1].type="codeTextData",r!==s+2&&(t[s][1].end=t[r-1][1].end,t.splice(s+2,r-s-2),e-=r-s-2,r=s+2),s=void 0);return t}function AI(t){return t!==96||this.events[this.events.length-1][1].type==="characterEscape"}function EI(t,e,n){let r=0,s,i;return l;function l(d){return t.enter("codeText"),t.enter("codeTextSequence"),o(d)}function o(d){return d===96?(t.consume(d),r++,o):(t.exit("codeTextSequence"),c(d))}function c(d){return d===null?n(d):d===32?(t.enter("space"),t.consume(d),t.exit("space"),c):d===96?(i=t.enter("codeTextSequence"),s=0,h(d)):Te(d)?(t.enter("lineEnding"),t.consume(d),t.exit("lineEnding"),c):(t.enter("codeTextData"),u(d))}function u(d){return d===null||d===32||d===96||Te(d)?(t.exit("codeTextData"),c(d)):(t.consume(d),u)}function h(d){return d===96?(t.consume(d),s++,h):s===r?(t.exit("codeTextSequence"),t.exit("codeText"),e(d)):(i.type="codeTextData",u(d))}}class PI{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,n){const r=n??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,n,r){const s=n||0;this.setCursor(Math.trunc(e));const i=this.right.splice(this.right.length-s,Number.POSITIVE_INFINITY);return r&&No(this.left,r),i.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),No(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),No(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const n=this.left.splice(e,Number.POSITIVE_INFINITY);No(this.right,n.reverse())}else{const n=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);No(this.left,n.reverse())}}}function No(t,e){let n=0;if(e.length<1e4)t.push(...e);else for(;n<e.length;)t.push(...e.slice(n,n+1e4)),n+=1e4}function xC(t){const e={};let n=-1,r,s,i,l,o,c,u;const h=new PI(t);for(;++n<h.length;){for(;n in e;)n=e[n];if(r=h.get(n),n&&r[1].type==="chunkFlow"&&h.get(n-1)[1].type==="listItemPrefix"&&(c=r[1]._tokenizer.events,i=0,i<c.length&&c[i][1].type==="lineEndingBlank"&&(i+=2),i<c.length&&c[i][1].type==="content"))for(;++i<c.length&&c[i][1].type!=="content";)c[i][1].type==="chunkText"&&(c[i][1]._isInFirstContentOfListItem=!0,i++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,_I(h,n)),n=e[n],u=!0);else if(r[1]._container){for(i=n,s=void 0;i--;)if(l=h.get(i),l[1].type==="lineEnding"||l[1].type==="lineEndingBlank")l[0]==="enter"&&(s&&(h.get(s)[1].type="lineEndingBlank"),l[1].type="lineEnding",s=i);else if(!(l[1].type==="linePrefix"||l[1].type==="listItemIndent"))break;s&&(r[1].end={...h.get(s)[1].start},o=h.slice(s,n),o.unshift(r),h.splice(s,n-s+1,o))}}return ir(t,0,Number.POSITIVE_INFINITY,h.slice(0)),!u}function _I(t,e){const n=t.get(e)[1],r=t.get(e)[2];let s=e-1;const i=[];let l=n._tokenizer;l||(l=r.parser[n.contentType](n.start),n._contentTypeTextTrailing&&(l._contentTypeTextTrailing=!0));const o=l.events,c=[],u={};let h,d,f=-1,p=n,m=0,x=0;const v=[x];for(;p;){for(;t.get(++s)[1]!==p;);i.push(s),p._tokenizer||(h=r.sliceStream(p),p.next||h.push(null),d&&l.defineSkip(p.start),p._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=!0),l.write(h),p._isInFirstContentOfListItem&&(l._gfmTasklistFirstContentOfListItem=void 0)),d=p,p=p.next}for(p=n;++f<o.length;)o[f][0]==="exit"&&o[f-1][0]==="enter"&&o[f][1].type===o[f-1][1].type&&o[f][1].start.line!==o[f][1].end.line&&(x=f+1,v.push(x),p._tokenizer=void 0,p.previous=void 0,p=p.next);for(l.events=[],p?(p._tokenizer=void 0,p.previous=void 0):v.pop(),f=v.length;f--;){const g=o.slice(v[f],v[f+1]),y=i.pop();c.push([y,y+g.length-1]),t.splice(y,2,g)}for(c.reverse(),f=-1;++f<c.length;)u[m+c[f][0]]=m+c[f][1],m+=c[f][1]-c[f][0]-1;return u}const MI={resolve:RI,tokenize:DI},TI={partial:!0,tokenize:LI};function RI(t){return xC(t),t}function DI(t,e){let n;return r;function r(o){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),s(o)}function s(o){return o===null?i(o):Te(o)?t.check(TI,l,i)(o):(t.consume(o),s)}function i(o){return t.exit("chunkContent"),t.exit("content"),e(o)}function l(o){return t.consume(o),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,s}}function LI(t,e,n){const r=this;return s;function s(l){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),Qe(t,i,"linePrefix")}function i(l){if(l===null||Te(l))return n(l);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(l):t.interrupt(r.parser.constructs.flow,n,e)(l)}}function yC(t,e,n,r,s,i,l,o,c){const u=c||Number.POSITIVE_INFINITY;let h=0;return d;function d(g){return g===60?(t.enter(r),t.enter(s),t.enter(i),t.consume(g),t.exit(i),f):g===null||g===32||g===41||wh(g)?n(g):(t.enter(r),t.enter(l),t.enter(o),t.enter("chunkString",{contentType:"string"}),x(g))}function f(g){return g===62?(t.enter(i),t.consume(g),t.exit(i),t.exit(s),t.exit(r),e):(t.enter(o),t.enter("chunkString",{contentType:"string"}),p(g))}function p(g){return g===62?(t.exit("chunkString"),t.exit(o),f(g)):g===null||g===60||Te(g)?n(g):(t.consume(g),g===92?m:p)}function m(g){return g===60||g===62||g===92?(t.consume(g),p):p(g)}function x(g){return!h&&(g===null||g===41||ut(g))?(t.exit("chunkString"),t.exit(o),t.exit(l),t.exit(r),e(g)):h<u&&g===40?(t.consume(g),h++,x):g===41?(t.consume(g),h--,x):g===null||g===32||g===40||wh(g)?n(g):(t.consume(g),g===92?v:x)}function v(g){return g===40||g===41||g===92?(t.consume(g),x):x(g)}}function bC(t,e,n,r,s,i){const l=this;let o=0,c;return u;function u(p){return t.enter(r),t.enter(s),t.consume(p),t.exit(s),t.enter(i),h}function h(p){return o>999||p===null||p===91||p===93&&!c||p===94&&!o&&"_hiddenFootnoteSupport"in l.parser.constructs?n(p):p===93?(t.exit(i),t.enter(s),t.consume(p),t.exit(s),t.exit(r),e):Te(p)?(t.enter("lineEnding"),t.consume(p),t.exit("lineEnding"),h):(t.enter("chunkString",{contentType:"string"}),d(p))}function d(p){return p===null||p===91||p===93||Te(p)||o++>999?(t.exit("chunkString"),h(p)):(t.consume(p),c||(c=!He(p)),p===92?f:d)}function f(p){return p===91||p===92||p===93?(t.consume(p),o++,d):d(p)}}function vC(t,e,n,r,s,i){let l;return o;function o(f){return f===34||f===39||f===40?(t.enter(r),t.enter(s),t.consume(f),t.exit(s),l=f===40?41:f,c):n(f)}function c(f){return f===l?(t.enter(s),t.consume(f),t.exit(s),t.exit(r),e):(t.enter(i),u(f))}function u(f){return f===l?(t.exit(i),c(l)):f===null?n(f):Te(f)?(t.enter("lineEnding"),t.consume(f),t.exit("lineEnding"),Qe(t,u,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),h(f))}function h(f){return f===l||f===null||Te(f)?(t.exit("chunkString"),u(f)):(t.consume(f),f===92?d:h)}function d(f){return f===l||f===92?(t.consume(f),h):h(f)}}function rc(t,e){let n;return r;function r(s){return Te(s)?(t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),n=!0,r):He(s)?Qe(t,r,n?"linePrefix":"lineSuffix")(s):e(s)}}const OI={name:"definition",tokenize:FI},II={partial:!0,tokenize:BI};function FI(t,e,n){const r=this;let s;return i;function i(p){return t.enter("definition"),l(p)}function l(p){return bC.call(r,t,o,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(p)}function o(p){return s=zr(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),p===58?(t.enter("definitionMarker"),t.consume(p),t.exit("definitionMarker"),c):n(p)}function c(p){return ut(p)?rc(t,u)(p):u(p)}function u(p){return yC(t,h,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(p)}function h(p){return t.attempt(II,d,d)(p)}function d(p){return He(p)?Qe(t,f,"whitespace")(p):f(p)}function f(p){return p===null||Te(p)?(t.exit("definition"),r.parser.defined.push(s),e(p)):n(p)}}function BI(t,e,n){return r;function r(o){return ut(o)?rc(t,s)(o):n(o)}function s(o){return vC(t,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function i(o){return He(o)?Qe(t,l,"whitespace")(o):l(o)}function l(o){return o===null||Te(o)?e(o):n(o)}}const zI={name:"hardBreakEscape",tokenize:$I};function $I(t,e,n){return r;function r(i){return t.enter("hardBreakEscape"),t.consume(i),s}function s(i){return Te(i)?(t.exit("hardBreakEscape"),e(i)):n(i)}}const UI={name:"headingAtx",resolve:HI,tokenize:qI};function HI(t,e){let n=t.length-2,r=3,s,i;return t[r][1].type==="whitespace"&&(r+=2),n-2>r&&t[n][1].type==="whitespace"&&(n-=2),t[n][1].type==="atxHeadingSequence"&&(r===n-1||n-4>r&&t[n-2][1].type==="whitespace")&&(n-=r+1===n?2:4),n>r&&(s={type:"atxHeadingText",start:t[r][1].start,end:t[n][1].end},i={type:"chunkText",start:t[r][1].start,end:t[n][1].end,contentType:"text"},ir(t,r,n-r+1,[["enter",s,e],["enter",i,e],["exit",i,e],["exit",s,e]])),t}function qI(t,e,n){let r=0;return s;function s(h){return t.enter("atxHeading"),i(h)}function i(h){return t.enter("atxHeadingSequence"),l(h)}function l(h){return h===35&&r++<6?(t.consume(h),l):h===null||ut(h)?(t.exit("atxHeadingSequence"),o(h)):n(h)}function o(h){return h===35?(t.enter("atxHeadingSequence"),c(h)):h===null||Te(h)?(t.exit("atxHeading"),e(h)):He(h)?Qe(t,o,"whitespace")(h):(t.enter("atxHeadingText"),u(h))}function c(h){return h===35?(t.consume(h),c):(t.exit("atxHeadingSequence"),o(h))}function u(h){return h===null||h===35||ut(h)?(t.exit("atxHeadingText"),o(h)):(t.consume(h),u)}}const VI=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],Iw=["pre","script","style","textarea"],WI={concrete:!0,name:"htmlFlow",resolveTo:GI,tokenize:XI},KI={partial:!0,tokenize:YI},QI={partial:!0,tokenize:JI};function GI(t){let e=t.length;for(;e--&&!(t[e][0]==="enter"&&t[e][1].type==="htmlFlow"););return e>1&&t[e-2][1].type==="linePrefix"&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2)),t}function XI(t,e,n){const r=this;let s,i,l,o,c;return u;function u(L){return h(L)}function h(L){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(L),d}function d(L){return L===33?(t.consume(L),f):L===47?(t.consume(L),i=!0,x):L===63?(t.consume(L),s=3,r.interrupt?e:P):En(L)?(t.consume(L),l=String.fromCharCode(L),v):n(L)}function f(L){return L===45?(t.consume(L),s=2,p):L===91?(t.consume(L),s=5,o=0,m):En(L)?(t.consume(L),s=4,r.interrupt?e:P):n(L)}function p(L){return L===45?(t.consume(L),r.interrupt?e:P):n(L)}function m(L){const Se="CDATA[";return L===Se.charCodeAt(o++)?(t.consume(L),o===Se.length?r.interrupt?e:R:m):n(L)}function x(L){return En(L)?(t.consume(L),l=String.fromCharCode(L),v):n(L)}function v(L){if(L===null||L===47||L===62||ut(L)){const Se=L===47,we=l.toLowerCase();return!Se&&!i&&Iw.includes(we)?(s=1,r.interrupt?e(L):R(L)):VI.includes(l.toLowerCase())?(s=6,Se?(t.consume(L),g):r.interrupt?e(L):R(L)):(s=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(L):i?y(L):b(L))}return L===45||bn(L)?(t.consume(L),l+=String.fromCharCode(L),v):n(L)}function g(L){return L===62?(t.consume(L),r.interrupt?e:R):n(L)}function y(L){return He(L)?(t.consume(L),y):N(L)}function b(L){return L===47?(t.consume(L),N):L===58||L===95||En(L)?(t.consume(L),k):He(L)?(t.consume(L),b):N(L)}function k(L){return L===45||L===46||L===58||L===95||bn(L)?(t.consume(L),k):S(L)}function S(L){return L===61?(t.consume(L),j):He(L)?(t.consume(L),S):b(L)}function j(L){return L===null||L===60||L===61||L===62||L===96?n(L):L===34||L===39?(t.consume(L),c=L,E):He(L)?(t.consume(L),j):A(L)}function E(L){return L===c?(t.consume(L),c=null,T):L===null||Te(L)?n(L):(t.consume(L),E)}function A(L){return L===null||L===34||L===39||L===47||L===60||L===61||L===62||L===96||ut(L)?S(L):(t.consume(L),A)}function T(L){return L===47||L===62||He(L)?b(L):n(L)}function N(L){return L===62?(t.consume(L),I):n(L)}function I(L){return L===null||Te(L)?R(L):He(L)?(t.consume(L),I):n(L)}function R(L){return L===45&&s===2?(t.consume(L),z):L===60&&s===1?(t.consume(L),q):L===62&&s===4?(t.consume(L),H):L===63&&s===3?(t.consume(L),P):L===93&&s===5?(t.consume(L),V):Te(L)&&(s===6||s===7)?(t.exit("htmlFlowData"),t.check(KI,Y,C)(L)):L===null||Te(L)?(t.exit("htmlFlowData"),C(L)):(t.consume(L),R)}function C(L){return t.check(QI,_,Y)(L)}function _(L){return t.enter("lineEnding"),t.consume(L),t.exit("lineEnding"),M}function M(L){return L===null||Te(L)?C(L):(t.enter("htmlFlowData"),R(L))}function z(L){return L===45?(t.consume(L),P):R(L)}function q(L){return L===47?(t.consume(L),l="",F):R(L)}function F(L){if(L===62){const Se=l.toLowerCase();return Iw.includes(Se)?(t.consume(L),H):R(L)}return En(L)&&l.length<8?(t.consume(L),l+=String.fromCharCode(L),F):R(L)}function V(L){return L===93?(t.consume(L),P):R(L)}function P(L){return L===62?(t.consume(L),H):L===45&&s===2?(t.consume(L),P):R(L)}function H(L){return L===null||Te(L)?(t.exit("htmlFlowData"),Y(L)):(t.consume(L),H)}function Y(L){return t.exit("htmlFlow"),e(L)}}function JI(t,e,n){const r=this;return s;function s(l){return Te(l)?(t.enter("lineEnding"),t.consume(l),t.exit("lineEnding"),i):n(l)}function i(l){return r.parser.lazy[r.now().line]?n(l):e(l)}}function YI(t,e,n){return r;function r(s){return t.enter("lineEnding"),t.consume(s),t.exit("lineEnding"),t.attempt(lu,e,n)}}const ZI={name:"htmlText",tokenize:eF};function eF(t,e,n){const r=this;let s,i,l;return o;function o(P){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(P),c}function c(P){return P===33?(t.consume(P),u):P===47?(t.consume(P),S):P===63?(t.consume(P),b):En(P)?(t.consume(P),A):n(P)}function u(P){return P===45?(t.consume(P),h):P===91?(t.consume(P),i=0,m):En(P)?(t.consume(P),y):n(P)}function h(P){return P===45?(t.consume(P),p):n(P)}function d(P){return P===null?n(P):P===45?(t.consume(P),f):Te(P)?(l=d,q(P)):(t.consume(P),d)}function f(P){return P===45?(t.consume(P),p):d(P)}function p(P){return P===62?z(P):P===45?f(P):d(P)}function m(P){const H="CDATA[";return P===H.charCodeAt(i++)?(t.consume(P),i===H.length?x:m):n(P)}function x(P){return P===null?n(P):P===93?(t.consume(P),v):Te(P)?(l=x,q(P)):(t.consume(P),x)}function v(P){return P===93?(t.consume(P),g):x(P)}function g(P){return P===62?z(P):P===93?(t.consume(P),g):x(P)}function y(P){return P===null||P===62?z(P):Te(P)?(l=y,q(P)):(t.consume(P),y)}function b(P){return P===null?n(P):P===63?(t.consume(P),k):Te(P)?(l=b,q(P)):(t.consume(P),b)}function k(P){return P===62?z(P):b(P)}function S(P){return En(P)?(t.consume(P),j):n(P)}function j(P){return P===45||bn(P)?(t.consume(P),j):E(P)}function E(P){return Te(P)?(l=E,q(P)):He(P)?(t.consume(P),E):z(P)}function A(P){return P===45||bn(P)?(t.consume(P),A):P===47||P===62||ut(P)?T(P):n(P)}function T(P){return P===47?(t.consume(P),z):P===58||P===95||En(P)?(t.consume(P),N):Te(P)?(l=T,q(P)):He(P)?(t.consume(P),T):z(P)}function N(P){return P===45||P===46||P===58||P===95||bn(P)?(t.consume(P),N):I(P)}function I(P){return P===61?(t.consume(P),R):Te(P)?(l=I,q(P)):He(P)?(t.consume(P),I):T(P)}function R(P){return P===null||P===60||P===61||P===62||P===96?n(P):P===34||P===39?(t.consume(P),s=P,C):Te(P)?(l=R,q(P)):He(P)?(t.consume(P),R):(t.consume(P),_)}function C(P){return P===s?(t.consume(P),s=void 0,M):P===null?n(P):Te(P)?(l=C,q(P)):(t.consume(P),C)}function _(P){return P===null||P===34||P===39||P===60||P===61||P===96?n(P):P===47||P===62||ut(P)?T(P):(t.consume(P),_)}function M(P){return P===47||P===62||ut(P)?T(P):n(P)}function z(P){return P===62?(t.consume(P),t.exit("htmlTextData"),t.exit("htmlText"),e):n(P)}function q(P){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(P),t.exit("lineEnding"),F}function F(P){return He(P)?Qe(t,V,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(P):V(P)}function V(P){return t.enter("htmlTextData"),l(P)}}const Q0={name:"labelEnd",resolveAll:sF,resolveTo:iF,tokenize:lF},tF={tokenize:aF},nF={tokenize:oF},rF={tokenize:cF};function sF(t){let e=-1;const n=[];for(;++e<t.length;){const r=t[e][1];if(n.push(t[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const s=r.type==="labelImage"?4:2;r.type="data",e+=s}}return t.length!==n.length&&ir(t,0,t.length,n),t}function iF(t,e){let n=t.length,r=0,s,i,l,o;for(;n--;)if(s=t[n][1],i){if(s.type==="link"||s.type==="labelLink"&&s._inactive)break;t[n][0]==="enter"&&s.type==="labelLink"&&(s._inactive=!0)}else if(l){if(t[n][0]==="enter"&&(s.type==="labelImage"||s.type==="labelLink")&&!s._balanced&&(i=n,s.type!=="labelLink")){r=2;break}}else s.type==="labelEnd"&&(l=n);const c={type:t[i][1].type==="labelLink"?"link":"image",start:{...t[i][1].start},end:{...t[t.length-1][1].end}},u={type:"label",start:{...t[i][1].start},end:{...t[l][1].end}},h={type:"labelText",start:{...t[i+r+2][1].end},end:{...t[l-2][1].start}};return o=[["enter",c,e],["enter",u,e]],o=yr(o,t.slice(i+1,i+r+3)),o=yr(o,[["enter",h,e]]),o=yr(o,uf(e.parser.constructs.insideSpan.null,t.slice(i+r+4,l-3),e)),o=yr(o,[["exit",h,e],t[l-2],t[l-1],["exit",u,e]]),o=yr(o,t.slice(l+1)),o=yr(o,[["exit",c,e]]),ir(t,i,t.length,o),t}function lF(t,e,n){const r=this;let s=r.events.length,i,l;for(;s--;)if((r.events[s][1].type==="labelImage"||r.events[s][1].type==="labelLink")&&!r.events[s][1]._balanced){i=r.events[s][1];break}return o;function o(f){return i?i._inactive?d(f):(l=r.parser.defined.includes(zr(r.sliceSerialize({start:i.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(f),t.exit("labelMarker"),t.exit("labelEnd"),c):n(f)}function c(f){return f===40?t.attempt(tF,h,l?h:d)(f):f===91?t.attempt(nF,h,l?u:d)(f):l?h(f):d(f)}function u(f){return t.attempt(rF,h,d)(f)}function h(f){return e(f)}function d(f){return i._balanced=!0,n(f)}}function aF(t,e,n){return r;function r(d){return t.enter("resource"),t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),s}function s(d){return ut(d)?rc(t,i)(d):i(d)}function i(d){return d===41?h(d):yC(t,l,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(d)}function l(d){return ut(d)?rc(t,c)(d):h(d)}function o(d){return n(d)}function c(d){return d===34||d===39||d===40?vC(t,u,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(d):h(d)}function u(d){return ut(d)?rc(t,h)(d):h(d)}function h(d){return d===41?(t.enter("resourceMarker"),t.consume(d),t.exit("resourceMarker"),t.exit("resource"),e):n(d)}}function oF(t,e,n){const r=this;return s;function s(o){return bC.call(r,t,i,l,"reference","referenceMarker","referenceString")(o)}function i(o){return r.parser.defined.includes(zr(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):n(o)}function l(o){return n(o)}}function cF(t,e,n){return r;function r(i){return t.enter("reference"),t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),s}function s(i){return i===93?(t.enter("referenceMarker"),t.consume(i),t.exit("referenceMarker"),t.exit("reference"),e):n(i)}}const uF={name:"labelStartImage",resolveAll:Q0.resolveAll,tokenize:dF};function dF(t,e,n){const r=this;return s;function s(o){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(o),t.exit("labelImageMarker"),i}function i(o){return o===91?(t.enter("labelMarker"),t.consume(o),t.exit("labelMarker"),t.exit("labelImage"),l):n(o)}function l(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(o):e(o)}}const hF={name:"labelStartLink",resolveAll:Q0.resolveAll,tokenize:fF};function fF(t,e,n){const r=this;return s;function s(l){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(l),t.exit("labelMarker"),t.exit("labelLink"),i}function i(l){return l===94&&"_hiddenFootnoteSupport"in r.parser.constructs?n(l):e(l)}}const Sp={name:"lineEnding",tokenize:pF};function pF(t,e){return n;function n(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),Qe(t,e,"linePrefix")}}const Ad={name:"thematicBreak",tokenize:mF};function mF(t,e,n){let r=0,s;return i;function i(u){return t.enter("thematicBreak"),l(u)}function l(u){return s=u,o(u)}function o(u){return u===s?(t.enter("thematicBreakSequence"),c(u)):r>=3&&(u===null||Te(u))?(t.exit("thematicBreak"),e(u)):n(u)}function c(u){return u===s?(t.consume(u),r++,c):(t.exit("thematicBreakSequence"),He(u)?Qe(t,o,"whitespace")(u):o(u))}}const Fn={continuation:{tokenize:bF},exit:wF,name:"list",tokenize:yF},gF={partial:!0,tokenize:kF},xF={partial:!0,tokenize:vF};function yF(t,e,n){const r=this,s=r.events[r.events.length-1];let i=s&&s[1].type==="linePrefix"?s[2].sliceSerialize(s[1],!0).length:0,l=0;return o;function o(p){const m=r.containerState.type||(p===42||p===43||p===45?"listUnordered":"listOrdered");if(m==="listUnordered"?!r.containerState.marker||p===r.containerState.marker:Xg(p)){if(r.containerState.type||(r.containerState.type=m,t.enter(m,{_container:!0})),m==="listUnordered")return t.enter("listItemPrefix"),p===42||p===45?t.check(Ad,n,u)(p):u(p);if(!r.interrupt||p===49)return t.enter("listItemPrefix"),t.enter("listItemValue"),c(p)}return n(p)}function c(p){return Xg(p)&&++l<10?(t.consume(p),c):(!r.interrupt||l<2)&&(r.containerState.marker?p===r.containerState.marker:p===41||p===46)?(t.exit("listItemValue"),u(p)):n(p)}function u(p){return t.enter("listItemMarker"),t.consume(p),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||p,t.check(lu,r.interrupt?n:h,t.attempt(gF,f,d))}function h(p){return r.containerState.initialBlankLine=!0,i++,f(p)}function d(p){return He(p)?(t.enter("listItemPrefixWhitespace"),t.consume(p),t.exit("listItemPrefixWhitespace"),f):n(p)}function f(p){return r.containerState.size=i+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(p)}}function bF(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(lu,s,i);function s(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,Qe(t,e,"listItemIndent",r.containerState.size+1)(o)}function i(o){return r.containerState.furtherBlankLines||!He(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,l(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(xF,e,l)(o))}function l(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,Qe(t,t.attempt(Fn,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function vF(t,e,n){const r=this;return Qe(t,s,"listItemIndent",r.containerState.size+1);function s(i){const l=r.events[r.events.length-1];return l&&l[1].type==="listItemIndent"&&l[2].sliceSerialize(l[1],!0).length===r.containerState.size?e(i):n(i)}}function wF(t){t.exit(this.containerState.type)}function kF(t,e,n){const r=this;return Qe(t,s,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function s(i){const l=r.events[r.events.length-1];return!He(i)&&l&&l[1].type==="listItemPrefixWhitespace"?e(i):n(i)}}const Fw={name:"setextUnderline",resolveTo:jF,tokenize:SF};function jF(t,e){let n=t.length,r,s,i;for(;n--;)if(t[n][0]==="enter"){if(t[n][1].type==="content"){r=n;break}t[n][1].type==="paragraph"&&(s=n)}else t[n][1].type==="content"&&t.splice(n,1),!i&&t[n][1].type==="definition"&&(i=n);const l={type:"setextHeading",start:{...t[r][1].start},end:{...t[t.length-1][1].end}};return t[s][1].type="setextHeadingText",i?(t.splice(s,0,["enter",l,e]),t.splice(i+1,0,["exit",t[r][1],e]),t[r][1].end={...t[i][1].end}):t[r][1]=l,t.push(["exit",l,e]),t}function SF(t,e,n){const r=this;let s;return i;function i(u){let h=r.events.length,d;for(;h--;)if(r.events[h][1].type!=="lineEnding"&&r.events[h][1].type!=="linePrefix"&&r.events[h][1].type!=="content"){d=r.events[h][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||d)?(t.enter("setextHeadingLine"),s=u,l(u)):n(u)}function l(u){return t.enter("setextHeadingLineSequence"),o(u)}function o(u){return u===s?(t.consume(u),o):(t.exit("setextHeadingLineSequence"),He(u)?Qe(t,c,"lineSuffix")(u):c(u))}function c(u){return u===null||Te(u)?(t.exit("setextHeadingLine"),e(u)):n(u)}}const NF={tokenize:CF};function CF(t){const e=this,n=t.attempt(lu,r,t.attempt(this.parser.constructs.flowInitial,s,Qe(t,t.attempt(this.parser.constructs.flow,s,t.attempt(MI,s)),"linePrefix")));return n;function r(i){if(i===null){t.consume(i);return}return t.enter("lineEndingBlank"),t.consume(i),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}function s(i){if(i===null){t.consume(i);return}return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),e.currentConstruct=void 0,n}}const AF={resolveAll:kC()},EF=wC("string"),PF=wC("text");function wC(t){return{resolveAll:kC(t==="text"?_F:void 0),tokenize:e};function e(n){const r=this,s=this.parser.constructs[t],i=n.attempt(s,l,o);return l;function l(h){return u(h)?i(h):o(h)}function o(h){if(h===null){n.consume(h);return}return n.enter("data"),n.consume(h),c}function c(h){return u(h)?(n.exit("data"),i(h)):(n.consume(h),c)}function u(h){if(h===null)return!0;const d=s[h];let f=-1;if(d)for(;++f<d.length;){const p=d[f];if(!p.previous||p.previous.call(r,r.previous))return!0}return!1}}}function kC(t){return e;function e(n,r){let s=-1,i;for(;++s<=n.length;)i===void 0?n[s]&&n[s][1].type==="data"&&(i=s,s++):(!n[s]||n[s][1].type!=="data")&&(s!==i+2&&(n[i][1].end=n[s-1][1].end,n.splice(i+2,s-i-2),s=i+2),i=void 0);return t?t(n,r):n}}function _F(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||t[n][1].type==="lineEnding")&&t[n-1][1].type==="data"){const r=t[n-1][1],s=e.sliceStream(r);let i=s.length,l=-1,o=0,c;for(;i--;){const u=s[i];if(typeof u=="string"){for(l=u.length;u.charCodeAt(l-1)===32;)o++,l--;if(l)break;l=-1}else if(u===-2)c=!0,o++;else if(u!==-1){i++;break}}if(e._contentTypeTextTrailing&&n===t.length&&(o=0),o){const u={type:n===t.length||c||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:i?l:r.start._bufferIndex+l,_index:r.start._index+i,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...u.start},r.start.offset===r.end.offset?Object.assign(r,u):(t.splice(n,0,["enter",u,e],["exit",u,e]),n+=2)}n++}return t}const MF={42:Fn,43:Fn,45:Fn,48:Fn,49:Fn,50:Fn,51:Fn,52:Fn,53:Fn,54:Fn,55:Fn,56:Fn,57:Fn,62:pC},TF={91:OI},RF={[-2]:jp,[-1]:jp,32:jp},DF={35:UI,42:Ad,45:[Fw,Ad],60:WI,61:Fw,95:Ad,96:Ow,126:Ow},LF={38:gC,92:mC},OF={[-5]:Sp,[-4]:Sp,[-3]:Sp,33:uF,38:gC,42:Jg,60:[hI,ZI],91:hF,92:[zI,mC],93:Q0,95:Jg,96:NI},IF={null:[Jg,AF]},FF={null:[42,95]},BF={null:[]},zF=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:FF,contentInitial:TF,disable:BF,document:MF,flow:DF,flowInitial:RF,insideSpan:IF,string:LF,text:OF},Symbol.toStringTag,{value:"Module"}));function $F(t,e,n){let r={_bufferIndex:-1,_index:0,line:n&&n.line||1,column:n&&n.column||1,offset:n&&n.offset||0};const s={},i=[];let l=[],o=[];const c={attempt:E(S),check:E(j),consume:y,enter:b,exit:k,interrupt:E(j,{interrupt:!0})},u={code:null,containerState:{},defineSkip:x,events:[],now:m,parser:t,previous:null,sliceSerialize:f,sliceStream:p,write:d};let h=e.tokenize.call(u,c);return e.resolveAll&&i.push(e),u;function d(I){return l=yr(l,I),v(),l[l.length-1]!==null?[]:(A(e,0),u.events=uf(i,u.events,u),u.events)}function f(I,R){return HF(p(I),R)}function p(I){return UF(l,I)}function m(){const{_bufferIndex:I,_index:R,line:C,column:_,offset:M}=r;return{_bufferIndex:I,_index:R,line:C,column:_,offset:M}}function x(I){s[I.line]=I.column,N()}function v(){let I;for(;r._index<l.length;){const R=l[r._index];if(typeof R=="string")for(I=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===I&&r._bufferIndex<R.length;)g(R.charCodeAt(r._bufferIndex));else g(R)}}function g(I){h=h(I)}function y(I){Te(I)?(r.line++,r.column=1,r.offset+=I===-3?2:1,N()):I!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===l[r._index].length&&(r._bufferIndex=-1,r._index++)),u.previous=I}function b(I,R){const C=R||{};return C.type=I,C.start=m(),u.events.push(["enter",C,u]),o.push(C),C}function k(I){const R=o.pop();return R.end=m(),u.events.push(["exit",R,u]),R}function S(I,R){A(I,R.from)}function j(I,R){R.restore()}function E(I,R){return C;function C(_,M,z){let q,F,V,P;return Array.isArray(_)?Y(_):"tokenize"in _?Y([_]):H(_);function H(ge){return Ce;function Ce(Ie){const re=Ie!==null&&ge[Ie],J=Ie!==null&&ge.null,Q=[...Array.isArray(re)?re:re?[re]:[],...Array.isArray(J)?J:J?[J]:[]];return Y(Q)(Ie)}}function Y(ge){return q=ge,F=0,ge.length===0?z:L(ge[F])}function L(ge){return Ce;function Ce(Ie){return P=T(),V=ge,ge.partial||(u.currentConstruct=ge),ge.name&&u.parser.constructs.disable.null.includes(ge.name)?we():ge.tokenize.call(R?Object.assign(Object.create(u),R):u,c,Se,we)(Ie)}}function Se(ge){return I(V,P),M}function we(ge){return P.restore(),++F<q.length?L(q[F]):z}}}function A(I,R){I.resolveAll&&!i.includes(I)&&i.push(I),I.resolve&&ir(u.events,R,u.events.length-R,I.resolve(u.events.slice(R),u)),I.resolveTo&&(u.events=I.resolveTo(u.events,u))}function T(){const I=m(),R=u.previous,C=u.currentConstruct,_=u.events.length,M=Array.from(o);return{from:_,restore:z};function z(){r=I,u.previous=R,u.currentConstruct=C,u.events.length=_,o=M,N()}}function N(){r.line in s&&r.column<2&&(r.column=s[r.line],r.offset+=s[r.line]-1)}}function UF(t,e){const n=e.start._index,r=e.start._bufferIndex,s=e.end._index,i=e.end._bufferIndex;let l;if(n===s)l=[t[n].slice(r,i)];else{if(l=t.slice(n,s),r>-1){const o=l[0];typeof o=="string"?l[0]=o.slice(r):l.shift()}i>0&&l.push(t[s].slice(0,i))}return l}function HF(t,e){let n=-1;const r=[];let s;for(;++n<t.length;){const i=t[n];let l;if(typeof i=="string")l=i;else switch(i){case-5:{l="\r";break}case-4:{l=`
`;break}case-3:{l=`\r
`;break}case-2:{l=e?" ":"	";break}case-1:{if(!e&&s)continue;l=" ";break}default:l=String.fromCharCode(i)}s=i===-2,r.push(l)}return r.join("")}function qF(t){const r={constructs:hC([zF,...(t||{}).extensions||[]]),content:s(iI),defined:[],document:s(aI),flow:s(NF),lazy:{},string:s(EF),text:s(PF)};return r;function s(i){return l;function l(o){return $F(r,i,o)}}}function VF(t){for(;!xC(t););return t}const Bw=/[\0\t\n\r]/g;function WF(){let t=1,e="",n=!0,r;return s;function s(i,l,o){const c=[];let u,h,d,f,p;for(i=e+(typeof i=="string"?i.toString():new TextDecoder(l||void 0).decode(i)),d=0,e="",n&&(i.charCodeAt(0)===65279&&d++,n=void 0);d<i.length;){if(Bw.lastIndex=d,u=Bw.exec(i),f=u&&u.index!==void 0?u.index:i.length,p=i.charCodeAt(f),!u){e=i.slice(d);break}if(p===10&&d===f&&r)c.push(-3),r=void 0;else switch(r&&(c.push(-5),r=void 0),d<f&&(c.push(i.slice(d,f)),t+=f-d),p){case 0:{c.push(65533),t++;break}case 9:{for(h=Math.ceil(t/4)*4,c.push(-2);t++<h;)c.push(-1);break}case 10:{c.push(-4),t=1;break}default:r=!0,t=1}d=f+1}return o&&(r&&c.push(-5),e&&c.push(e),c.push(null)),c}}const KF=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function QF(t){return t.replace(KF,GF)}function GF(t,e,n){if(e)return e;if(n.charCodeAt(0)===35){const s=n.charCodeAt(1),i=s===120||s===88;return fC(n.slice(i?2:1),i?16:10)}return K0(n)||t}const jC={}.hasOwnProperty;function XF(t,e,n){return typeof e!="string"&&(n=e,e=void 0),JF(n)(VF(qF(n).document().write(WF()(t,e,!0))))}function JF(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:i(de),autolinkProtocol:T,autolinkEmail:T,atxHeading:i(D),blockQuote:i(J),characterEscape:T,characterReference:T,codeFenced:i(Q),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:i(Q,l),codeText:i(he,l),codeTextData:T,data:T,codeFlowValue:T,definition:i(Re),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:i(De),hardBreakEscape:i(G),hardBreakTrailing:i(G),htmlFlow:i(ae,l),htmlFlowData:T,htmlText:i(ae,l),htmlTextData:T,image:i(je),label:l,link:i(de),listItem:i(Je),listItemValue:f,listOrdered:i(Ae,d),listUnordered:i(Ae),paragraph:i(Ye),reference:L,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:i(D),strong:i(dt),thematicBreak:i(Ft)},exit:{atxHeading:c(),atxHeadingSequence:S,autolink:c(),autolinkEmail:re,autolinkProtocol:Ie,blockQuote:c(),characterEscapeValue:N,characterReferenceMarkerHexadecimal:we,characterReferenceMarkerNumeric:we,characterReferenceValue:ge,characterReference:Ce,codeFenced:c(v),codeFencedFence:x,codeFencedFenceInfo:p,codeFencedFenceMeta:m,codeFlowValue:N,codeIndented:c(g),codeText:c(M),codeTextData:N,data:N,definition:c(),definitionDestinationString:k,definitionLabelString:y,definitionTitleString:b,emphasis:c(),hardBreakEscape:c(R),hardBreakTrailing:c(R),htmlFlow:c(C),htmlFlowData:N,htmlText:c(_),htmlTextData:N,image:c(q),label:V,labelText:F,lineEnding:I,link:c(z),listItem:c(),listOrdered:c(),listUnordered:c(),paragraph:c(),referenceString:Se,resourceDestinationString:P,resourceTitleString:H,resource:Y,setextHeading:c(A),setextHeadingLineSequence:E,setextHeadingText:j,strong:c(),thematicBreak:c()}};SC(e,(t||{}).mdastExtensions||[]);const n={};return r;function r($){let W={type:"root",children:[]};const te={stack:[W],tokenStack:[],config:e,enter:o,exit:u,buffer:l,resume:h,data:n},fe=[];let O=-1;for(;++O<$.length;)if($[O][1].type==="listOrdered"||$[O][1].type==="listUnordered")if($[O][0]==="enter")fe.push(O);else{const Z=fe.pop();O=s($,Z,O)}for(O=-1;++O<$.length;){const Z=e[$[O][0]];jC.call(Z,$[O][1].type)&&Z[$[O][1].type].call(Object.assign({sliceSerialize:$[O][2].sliceSerialize},te),$[O][1])}if(te.tokenStack.length>0){const Z=te.tokenStack[te.tokenStack.length-1];(Z[1]||zw).call(te,void 0,Z[0])}for(W.position={start:Qs($.length>0?$[0][1].start:{line:1,column:1,offset:0}),end:Qs($.length>0?$[$.length-2][1].end:{line:1,column:1,offset:0})},O=-1;++O<e.transforms.length;)W=e.transforms[O](W)||W;return W}function s($,W,te){let fe=W-1,O=-1,Z=!1,ne,ye,B,se;for(;++fe<=te;){const ee=$[fe];switch(ee[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{ee[0]==="enter"?O++:O--,se=void 0;break}case"lineEndingBlank":{ee[0]==="enter"&&(ne&&!se&&!O&&!B&&(B=fe),se=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:se=void 0}if(!O&&ee[0]==="enter"&&ee[1].type==="listItemPrefix"||O===-1&&ee[0]==="exit"&&(ee[1].type==="listUnordered"||ee[1].type==="listOrdered")){if(ne){let le=fe;for(ye=void 0;le--;){const Pe=$[le];if(Pe[1].type==="lineEnding"||Pe[1].type==="lineEndingBlank"){if(Pe[0]==="exit")continue;ye&&($[ye][1].type="lineEndingBlank",Z=!0),Pe[1].type="lineEnding",ye=le}else if(!(Pe[1].type==="linePrefix"||Pe[1].type==="blockQuotePrefix"||Pe[1].type==="blockQuotePrefixWhitespace"||Pe[1].type==="blockQuoteMarker"||Pe[1].type==="listItemIndent"))break}B&&(!ye||B<ye)&&(ne._spread=!0),ne.end=Object.assign({},ye?$[ye][1].start:ee[1].end),$.splice(ye||fe,0,["exit",ne,ee[2]]),fe++,te++}if(ee[1].type==="listItemPrefix"){const le={type:"listItem",_spread:!1,start:Object.assign({},ee[1].start),end:void 0};ne=le,$.splice(fe,0,["enter",le,ee[2]]),fe++,te++,B=void 0,se=!0}}}return $[W][1]._spread=Z,te}function i($,W){return te;function te(fe){o.call(this,$(fe),fe),W&&W.call(this,fe)}}function l(){this.stack.push({type:"fragment",children:[]})}function o($,W,te){this.stack[this.stack.length-1].children.push($),this.stack.push($),this.tokenStack.push([W,te||void 0]),$.position={start:Qs(W.start),end:void 0}}function c($){return W;function W(te){$&&$.call(this,te),u.call(this,te)}}function u($,W){const te=this.stack.pop(),fe=this.tokenStack.pop();if(fe)fe[0].type!==$.type&&(W?W.call(this,$,fe[0]):(fe[1]||zw).call(this,$,fe[0]));else throw new Error("Cannot close `"+$.type+"` ("+nc({start:$.start,end:$.end})+"): its not open");te.position.end=Qs($.end)}function h(){return W0(this.stack.pop())}function d(){this.data.expectingFirstListItemValue=!0}function f($){if(this.data.expectingFirstListItemValue){const W=this.stack[this.stack.length-2];W.start=Number.parseInt(this.sliceSerialize($),10),this.data.expectingFirstListItemValue=void 0}}function p(){const $=this.resume(),W=this.stack[this.stack.length-1];W.lang=$}function m(){const $=this.resume(),W=this.stack[this.stack.length-1];W.meta=$}function x(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function v(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function g(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$.replace(/(\r?\n|\r)$/g,"")}function y($){const W=this.resume(),te=this.stack[this.stack.length-1];te.label=W,te.identifier=zr(this.sliceSerialize($)).toLowerCase()}function b(){const $=this.resume(),W=this.stack[this.stack.length-1];W.title=$}function k(){const $=this.resume(),W=this.stack[this.stack.length-1];W.url=$}function S($){const W=this.stack[this.stack.length-1];if(!W.depth){const te=this.sliceSerialize($).length;W.depth=te}}function j(){this.data.setextHeadingSlurpLineEnding=!0}function E($){const W=this.stack[this.stack.length-1];W.depth=this.sliceSerialize($).codePointAt(0)===61?1:2}function A(){this.data.setextHeadingSlurpLineEnding=void 0}function T($){const te=this.stack[this.stack.length-1].children;let fe=te[te.length-1];(!fe||fe.type!=="text")&&(fe=It(),fe.position={start:Qs($.start),end:void 0},te.push(fe)),this.stack.push(fe)}function N($){const W=this.stack.pop();W.value+=this.sliceSerialize($),W.position.end=Qs($.end)}function I($){const W=this.stack[this.stack.length-1];if(this.data.atHardBreak){const te=W.children[W.children.length-1];te.position.end=Qs($.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(W.type)&&(T.call(this,$),N.call(this,$))}function R(){this.data.atHardBreak=!0}function C(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$}function _(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$}function M(){const $=this.resume(),W=this.stack[this.stack.length-1];W.value=$}function z(){const $=this.stack[this.stack.length-1];if(this.data.inReference){const W=this.data.referenceType||"shortcut";$.type+="Reference",$.referenceType=W,delete $.url,delete $.title}else delete $.identifier,delete $.label;this.data.referenceType=void 0}function q(){const $=this.stack[this.stack.length-1];if(this.data.inReference){const W=this.data.referenceType||"shortcut";$.type+="Reference",$.referenceType=W,delete $.url,delete $.title}else delete $.identifier,delete $.label;this.data.referenceType=void 0}function F($){const W=this.sliceSerialize($),te=this.stack[this.stack.length-2];te.label=QF(W),te.identifier=zr(W).toLowerCase()}function V(){const $=this.stack[this.stack.length-1],W=this.resume(),te=this.stack[this.stack.length-1];if(this.data.inReference=!0,te.type==="link"){const fe=$.children;te.children=fe}else te.alt=W}function P(){const $=this.resume(),W=this.stack[this.stack.length-1];W.url=$}function H(){const $=this.resume(),W=this.stack[this.stack.length-1];W.title=$}function Y(){this.data.inReference=void 0}function L(){this.data.referenceType="collapsed"}function Se($){const W=this.resume(),te=this.stack[this.stack.length-1];te.label=W,te.identifier=zr(this.sliceSerialize($)).toLowerCase(),this.data.referenceType="full"}function we($){this.data.characterReferenceType=$.type}function ge($){const W=this.sliceSerialize($),te=this.data.characterReferenceType;let fe;te?(fe=fC(W,te==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):fe=K0(W);const O=this.stack[this.stack.length-1];O.value+=fe}function Ce($){const W=this.stack.pop();W.position.end=Qs($.end)}function Ie($){N.call(this,$);const W=this.stack[this.stack.length-1];W.url=this.sliceSerialize($)}function re($){N.call(this,$);const W=this.stack[this.stack.length-1];W.url="mailto:"+this.sliceSerialize($)}function J(){return{type:"blockquote",children:[]}}function Q(){return{type:"code",lang:null,meta:null,value:""}}function he(){return{type:"inlineCode",value:""}}function Re(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function De(){return{type:"emphasis",children:[]}}function D(){return{type:"heading",depth:0,children:[]}}function G(){return{type:"break"}}function ae(){return{type:"html",value:""}}function je(){return{type:"image",title:null,url:"",alt:null}}function de(){return{type:"link",title:null,url:"",children:[]}}function Ae($){return{type:"list",ordered:$.type==="listOrdered",start:null,spread:$._spread,children:[]}}function Je($){return{type:"listItem",spread:$._spread,checked:null,children:[]}}function Ye(){return{type:"paragraph",children:[]}}function dt(){return{type:"strong",children:[]}}function It(){return{type:"text",value:""}}function Ft(){return{type:"thematicBreak"}}}function Qs(t){return{line:t.line,column:t.column,offset:t.offset}}function SC(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?SC(t,r):YF(t,r)}}function YF(t,e){let n;for(n in e)if(jC.call(e,n))switch(n){case"canContainEols":{const r=e[n];r&&t[n].push(...r);break}case"transforms":{const r=e[n];r&&t[n].push(...r);break}case"enter":case"exit":{const r=e[n];r&&Object.assign(t[n],r);break}}}function zw(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+nc({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+nc({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+nc({start:e.start,end:e.end})+") is still open")}function ZF(t){const e=this;e.parser=n;function n(r){return XF(r,{...e.data("settings"),...t,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function eB(t,e){const n={type:"element",tagName:"blockquote",properties:{},children:t.wrap(t.all(e),!0)};return t.patch(e,n),t.applyData(e,n)}function tB(t,e){const n={type:"element",tagName:"br",properties:{},children:[]};return t.patch(e,n),[t.applyData(e,n),{type:"text",value:`
`}]}function nB(t,e){const n=e.value?e.value+`
`:"",r={};e.lang&&(r.className=["language-"+e.lang]);let s={type:"element",tagName:"code",properties:r,children:[{type:"text",value:n}]};return e.meta&&(s.data={meta:e.meta}),t.patch(e,s),s=t.applyData(e,s),s={type:"element",tagName:"pre",properties:{},children:[s]},t.patch(e,s),s}function rB(t,e){const n={type:"element",tagName:"del",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function sB(t,e){const n={type:"element",tagName:"em",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function iB(t,e){const n=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),s=io(r.toLowerCase()),i=t.footnoteOrder.indexOf(r);let l,o=t.footnoteCounts.get(r);o===void 0?(o=0,t.footnoteOrder.push(r),l=t.footnoteOrder.length):l=i+1,o+=1,t.footnoteCounts.set(r,o);const c={type:"element",tagName:"a",properties:{href:"#"+n+"fn-"+s,id:n+"fnref-"+s+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(l)}]};t.patch(e,c);const u={type:"element",tagName:"sup",properties:{},children:[c]};return t.patch(e,u),t.applyData(e,u)}function lB(t,e){const n={type:"element",tagName:"h"+e.depth,properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function aB(t,e){if(t.options.allowDangerousHtml){const n={type:"raw",value:e.value};return t.patch(e,n),t.applyData(e,n)}}function NC(t,e){const n=e.referenceType;let r="]";if(n==="collapsed"?r+="[]":n==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const s=t.all(e),i=s[0];i&&i.type==="text"?i.value="["+i.value:s.unshift({type:"text",value:"["});const l=s[s.length-1];return l&&l.type==="text"?l.value+=r:s.push({type:"text",value:r}),s}function oB(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return NC(t,e);const s={src:io(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"img",properties:s,children:[]};return t.patch(e,i),t.applyData(e,i)}function cB(t,e){const n={src:io(e.url)};e.alt!==null&&e.alt!==void 0&&(n.alt=e.alt),e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"img",properties:n,children:[]};return t.patch(e,r),t.applyData(e,r)}function uB(t,e){const n={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};t.patch(e,n);const r={type:"element",tagName:"code",properties:{},children:[n]};return t.patch(e,r),t.applyData(e,r)}function dB(t,e){const n=String(e.identifier).toUpperCase(),r=t.definitionById.get(n);if(!r)return NC(t,e);const s={href:io(r.url||"")};r.title!==null&&r.title!==void 0&&(s.title=r.title);const i={type:"element",tagName:"a",properties:s,children:t.all(e)};return t.patch(e,i),t.applyData(e,i)}function hB(t,e){const n={href:io(e.url)};e.title!==null&&e.title!==void 0&&(n.title=e.title);const r={type:"element",tagName:"a",properties:n,children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function fB(t,e,n){const r=t.all(e),s=n?pB(n):CC(e),i={},l=[];if(typeof e.checked=="boolean"){const h=r[0];let d;h&&h.type==="element"&&h.tagName==="p"?d=h:(d={type:"element",tagName:"p",properties:{},children:[]},r.unshift(d)),d.children.length>0&&d.children.unshift({type:"text",value:" "}),d.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),i.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const h=r[o];(s||o!==0||h.type!=="element"||h.tagName!=="p")&&l.push({type:"text",value:`
`}),h.type==="element"&&h.tagName==="p"&&!s?l.push(...h.children):l.push(h)}const c=r[r.length-1];c&&(s||c.type!=="element"||c.tagName!=="p")&&l.push({type:"text",value:`
`});const u={type:"element",tagName:"li",properties:i,children:l};return t.patch(e,u),t.applyData(e,u)}function pB(t){let e=!1;if(t.type==="list"){e=t.spread||!1;const n=t.children;let r=-1;for(;!e&&++r<n.length;)e=CC(n[r])}return e}function CC(t){const e=t.spread;return e??t.children.length>1}function mB(t,e){const n={},r=t.all(e);let s=-1;for(typeof e.start=="number"&&e.start!==1&&(n.start=e.start);++s<r.length;){const l=r[s];if(l.type==="element"&&l.tagName==="li"&&l.properties&&Array.isArray(l.properties.className)&&l.properties.className.includes("task-list-item")){n.className=["contains-task-list"];break}}const i={type:"element",tagName:e.ordered?"ol":"ul",properties:n,children:t.wrap(r,!0)};return t.patch(e,i),t.applyData(e,i)}function gB(t,e){const n={type:"element",tagName:"p",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function xB(t,e){const n={type:"root",children:t.wrap(t.all(e))};return t.patch(e,n),t.applyData(e,n)}function yB(t,e){const n={type:"element",tagName:"strong",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}function bB(t,e){const n=t.all(e),r=n.shift(),s=[];if(r){const l={type:"element",tagName:"thead",properties:{},children:t.wrap([r],!0)};t.patch(e.children[0],l),s.push(l)}if(n.length>0){const l={type:"element",tagName:"tbody",properties:{},children:t.wrap(n,!0)},o=U0(e.children[1]),c=iC(e.children[e.children.length-1]);o&&c&&(l.position={start:o,end:c}),s.push(l)}const i={type:"element",tagName:"table",properties:{},children:t.wrap(s,!0)};return t.patch(e,i),t.applyData(e,i)}function vB(t,e,n){const r=n?n.children:void 0,i=(r?r.indexOf(e):1)===0?"th":"td",l=n&&n.type==="table"?n.align:void 0,o=l?l.length:e.children.length;let c=-1;const u=[];for(;++c<o;){const d=e.children[c],f={},p=l?l[c]:void 0;p&&(f.align=p);let m={type:"element",tagName:i,properties:f,children:[]};d&&(m.children=t.all(d),t.patch(d,m),m=t.applyData(d,m)),u.push(m)}const h={type:"element",tagName:"tr",properties:{},children:t.wrap(u,!0)};return t.patch(e,h),t.applyData(e,h)}function wB(t,e){const n={type:"element",tagName:"td",properties:{},children:t.all(e)};return t.patch(e,n),t.applyData(e,n)}const $w=9,Uw=32;function kB(t){const e=String(t),n=/\r?\n|\r/g;let r=n.exec(e),s=0;const i=[];for(;r;)i.push(Hw(e.slice(s,r.index),s>0,!0),r[0]),s=r.index+r[0].length,r=n.exec(e);return i.push(Hw(e.slice(s),s>0,!1)),i.join("")}function Hw(t,e,n){let r=0,s=t.length;if(e){let i=t.codePointAt(r);for(;i===$w||i===Uw;)r++,i=t.codePointAt(r)}if(n){let i=t.codePointAt(s-1);for(;i===$w||i===Uw;)s--,i=t.codePointAt(s-1)}return s>r?t.slice(r,s):""}function jB(t,e){const n={type:"text",value:kB(String(e.value))};return t.patch(e,n),t.applyData(e,n)}function SB(t,e){const n={type:"element",tagName:"hr",properties:{},children:[]};return t.patch(e,n),t.applyData(e,n)}const NB={blockquote:eB,break:tB,code:nB,delete:rB,emphasis:sB,footnoteReference:iB,heading:lB,html:aB,imageReference:oB,image:cB,inlineCode:uB,linkReference:dB,link:hB,listItem:fB,list:mB,paragraph:gB,root:xB,strong:yB,table:bB,tableCell:wB,tableRow:vB,text:jB,thematicBreak:SB,toml:Ku,yaml:Ku,definition:Ku,footnoteDefinition:Ku};function Ku(){}const AC=-1,df=0,sc=1,kh=2,G0=3,X0=4,J0=5,Y0=6,EC=7,PC=8,qw=typeof self=="object"?self:globalThis,CB=(t,e)=>{const n=(s,i)=>(t.set(i,s),s),r=s=>{if(t.has(s))return t.get(s);const[i,l]=e[s];switch(i){case df:case AC:return n(l,s);case sc:{const o=n([],s);for(const c of l)o.push(r(c));return o}case kh:{const o=n({},s);for(const[c,u]of l)o[r(c)]=r(u);return o}case G0:return n(new Date(l),s);case X0:{const{source:o,flags:c}=l;return n(new RegExp(o,c),s)}case J0:{const o=n(new Map,s);for(const[c,u]of l)o.set(r(c),r(u));return o}case Y0:{const o=n(new Set,s);for(const c of l)o.add(r(c));return o}case EC:{const{name:o,message:c}=l;return n(new qw[o](c),s)}case PC:return n(BigInt(l),s);case"BigInt":return n(Object(BigInt(l)),s);case"ArrayBuffer":return n(new Uint8Array(l).buffer,l);case"DataView":{const{buffer:o}=new Uint8Array(l);return n(new DataView(o),l)}}return n(new qw[i](l),s)};return r},Vw=t=>CB(new Map,t)(0),Ul="",{toString:AB}={},{keys:EB}=Object,Co=t=>{const e=typeof t;if(e!=="object"||!t)return[df,e];const n=AB.call(t).slice(8,-1);switch(n){case"Array":return[sc,Ul];case"Object":return[kh,Ul];case"Date":return[G0,Ul];case"RegExp":return[X0,Ul];case"Map":return[J0,Ul];case"Set":return[Y0,Ul];case"DataView":return[sc,n]}return n.includes("Array")?[sc,n]:n.includes("Error")?[EC,n]:[kh,n]},Qu=([t,e])=>t===df&&(e==="function"||e==="symbol"),PB=(t,e,n,r)=>{const s=(l,o)=>{const c=r.push(l)-1;return n.set(o,c),c},i=l=>{if(n.has(l))return n.get(l);let[o,c]=Co(l);switch(o){case df:{let h=l;switch(c){case"bigint":o=PC,h=l.toString();break;case"function":case"symbol":if(t)throw new TypeError("unable to serialize "+c);h=null;break;case"undefined":return s([AC],l)}return s([o,h],l)}case sc:{if(c){let f=l;return c==="DataView"?f=new Uint8Array(l.buffer):c==="ArrayBuffer"&&(f=new Uint8Array(l)),s([c,[...f]],l)}const h=[],d=s([o,h],l);for(const f of l)h.push(i(f));return d}case kh:{if(c)switch(c){case"BigInt":return s([c,l.toString()],l);case"Boolean":case"Number":case"String":return s([c,l.valueOf()],l)}if(e&&"toJSON"in l)return i(l.toJSON());const h=[],d=s([o,h],l);for(const f of EB(l))(t||!Qu(Co(l[f])))&&h.push([i(f),i(l[f])]);return d}case G0:return s([o,l.toISOString()],l);case X0:{const{source:h,flags:d}=l;return s([o,{source:h,flags:d}],l)}case J0:{const h=[],d=s([o,h],l);for(const[f,p]of l)(t||!(Qu(Co(f))||Qu(Co(p))))&&h.push([i(f),i(p)]);return d}case Y0:{const h=[],d=s([o,h],l);for(const f of l)(t||!Qu(Co(f)))&&h.push(i(f));return d}}const{message:u}=l;return s([o,{name:c,message:u}],l)};return i},Ww=(t,{json:e,lossy:n}={})=>{const r=[];return PB(!(e||n),!!e,new Map,r)(t),r},jh=typeof structuredClone=="function"?(t,e)=>e&&("json"in e||"lossy"in e)?Vw(Ww(t,e)):structuredClone(t):(t,e)=>Vw(Ww(t,e));function _B(t,e){const n=[{type:"text",value:""}];return e>1&&n.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),n}function MB(t,e){return"Back to reference "+(t+1)+(e>1?"-"+e:"")}function TB(t){const e=typeof t.options.clobberPrefix=="string"?t.options.clobberPrefix:"user-content-",n=t.options.footnoteBackContent||_B,r=t.options.footnoteBackLabel||MB,s=t.options.footnoteLabel||"Footnotes",i=t.options.footnoteLabelTagName||"h2",l=t.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let c=-1;for(;++c<t.footnoteOrder.length;){const u=t.footnoteById.get(t.footnoteOrder[c]);if(!u)continue;const h=t.all(u),d=String(u.identifier).toUpperCase(),f=io(d.toLowerCase());let p=0;const m=[],x=t.footnoteCounts.get(d);for(;x!==void 0&&++p<=x;){m.length>0&&m.push({type:"text",value:" "});let y=typeof n=="string"?n:n(c,p);typeof y=="string"&&(y={type:"text",value:y}),m.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+f+(p>1?"-"+p:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(c,p),className:["data-footnote-backref"]},children:Array.isArray(y)?y:[y]})}const v=h[h.length-1];if(v&&v.type==="element"&&v.tagName==="p"){const y=v.children[v.children.length-1];y&&y.type==="text"?y.value+=" ":v.children.push({type:"text",value:" "}),v.children.push(...m)}else h.push(...m);const g={type:"element",tagName:"li",properties:{id:e+"fn-"+f},children:t.wrap(h,!0)};t.patch(u,g),o.push(g)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:i,properties:{...jh(l),id:"footnote-label"},children:[{type:"text",value:s}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:t.wrap(o,!0)},{type:"text",value:`
`}]}}const hf=function(t){if(t==null)return OB;if(typeof t=="function")return ff(t);if(typeof t=="object")return Array.isArray(t)?RB(t):DB(t);if(typeof t=="string")return LB(t);throw new Error("Expected function, string, or object as test")};function RB(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=hf(t[n]);return ff(r);function r(...s){let i=-1;for(;++i<e.length;)if(e[i].apply(this,s))return!0;return!1}}function DB(t){const e=t;return ff(n);function n(r){const s=r;let i;for(i in t)if(s[i]!==e[i])return!1;return!0}}function LB(t){return ff(e);function e(n){return n&&n.type===t}}function ff(t){return e;function e(n,r,s){return!!(IB(n)&&t.call(this,n,typeof r=="number"?r:void 0,s||void 0))}}function OB(){return!0}function IB(t){return t!==null&&typeof t=="object"&&"type"in t}const _C=[],FB=!0,Yg=!1,BB="skip";function MC(t,e,n,r){let s;typeof e=="function"&&typeof n!="function"?(r=n,n=e):s=e;const i=hf(s),l=r?-1:1;o(t,void 0,[])();function o(c,u,h){const d=c&&typeof c=="object"?c:{};if(typeof d.type=="string"){const p=typeof d.tagName=="string"?d.tagName:typeof d.name=="string"?d.name:void 0;Object.defineProperty(f,"name",{value:"node ("+(c.type+(p?"<"+p+">":""))+")"})}return f;function f(){let p=_C,m,x,v;if((!e||i(c,u,h[h.length-1]||void 0))&&(p=zB(n(c,h)),p[0]===Yg))return p;if("children"in c&&c.children){const g=c;if(g.children&&p[0]!==BB)for(x=(r?g.children.length:-1)+l,v=h.concat(g);x>-1&&x<g.children.length;){const y=g.children[x];if(m=o(y,x,v)(),m[0]===Yg)return m;x=typeof m[1]=="number"?m[1]:x+l}}return p}}}function zB(t){return Array.isArray(t)?t:typeof t=="number"?[FB,t]:t==null?_C:[t]}function Z0(t,e,n,r){let s,i,l;typeof e=="function"&&typeof n!="function"?(i=void 0,l=e,s=n):(i=e,l=n,s=r),MC(t,i,o,s);function o(c,u){const h=u[u.length-1],d=h?h.children.indexOf(c):void 0;return l(c,d,h)}}const Zg={}.hasOwnProperty,$B={};function UB(t,e){const n=e||$B,r=new Map,s=new Map,i=new Map,l={...NB,...n.handlers},o={all:u,applyData:qB,definitionById:r,footnoteById:s,footnoteCounts:i,footnoteOrder:[],handlers:l,one:c,options:n,patch:HB,wrap:WB};return Z0(t,function(h){if(h.type==="definition"||h.type==="footnoteDefinition"){const d=h.type==="definition"?r:s,f=String(h.identifier).toUpperCase();d.has(f)||d.set(f,h)}}),o;function c(h,d){const f=h.type,p=o.handlers[f];if(Zg.call(o.handlers,f)&&p)return p(o,h,d);if(o.options.passThrough&&o.options.passThrough.includes(f)){if("children"in h){const{children:x,...v}=h,g=jh(v);return g.children=o.all(h),g}return jh(h)}return(o.options.unknownHandler||VB)(o,h,d)}function u(h){const d=[];if("children"in h){const f=h.children;let p=-1;for(;++p<f.length;){const m=o.one(f[p],h);if(m){if(p&&f[p-1].type==="break"&&(!Array.isArray(m)&&m.type==="text"&&(m.value=Kw(m.value)),!Array.isArray(m)&&m.type==="element")){const x=m.children[0];x&&x.type==="text"&&(x.value=Kw(x.value))}Array.isArray(m)?d.push(...m):d.push(m)}}}return d}}function HB(t,e){t.position&&(e.position=MO(t))}function qB(t,e){let n=e;if(t&&t.data){const r=t.data.hName,s=t.data.hChildren,i=t.data.hProperties;if(typeof r=="string")if(n.type==="element")n.tagName=r;else{const l="children"in n?n.children:[n];n={type:"element",tagName:r,properties:{},children:l}}n.type==="element"&&i&&Object.assign(n.properties,jh(i)),"children"in n&&n.children&&s!==null&&s!==void 0&&(n.children=s)}return n}function VB(t,e){const n=e.data||{},r="value"in e&&!(Zg.call(n,"hProperties")||Zg.call(n,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:t.all(e)};return t.patch(e,r),t.applyData(e,r)}function WB(t,e){const n=[];let r=-1;for(e&&n.push({type:"text",value:`
`});++r<t.length;)r&&n.push({type:"text",value:`
`}),n.push(t[r]);return e&&t.length>0&&n.push({type:"text",value:`
`}),n}function Kw(t){let e=0,n=t.charCodeAt(e);for(;n===9||n===32;)e++,n=t.charCodeAt(e);return t.slice(e)}function Qw(t,e){const n=UB(t,e),r=n.one(t,void 0),s=TB(n),i=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return s&&i.children.push({type:"text",value:`
`},s),i}function KB(t,e){return t&&"run"in t?async function(n,r){const s=Qw(n,{file:r,...e});await t.run(s,r)}:function(n,r){return Qw(n,{file:r,...t||e})}}function Gw(t){if(t)throw t}var Ed=Object.prototype.hasOwnProperty,TC=Object.prototype.toString,Xw=Object.defineProperty,Jw=Object.getOwnPropertyDescriptor,Yw=function(e){return typeof Array.isArray=="function"?Array.isArray(e):TC.call(e)==="[object Array]"},Zw=function(e){if(!e||TC.call(e)!=="[object Object]")return!1;var n=Ed.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&Ed.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!n&&!r)return!1;var s;for(s in e);return typeof s>"u"||Ed.call(e,s)},e1=function(e,n){Xw&&n.name==="__proto__"?Xw(e,n.name,{enumerable:!0,configurable:!0,value:n.newValue,writable:!0}):e[n.name]=n.newValue},t1=function(e,n){if(n==="__proto__")if(Ed.call(e,n)){if(Jw)return Jw(e,n).value}else return;return e[n]},QB=function t(){var e,n,r,s,i,l,o=arguments[0],c=1,u=arguments.length,h=!1;for(typeof o=="boolean"&&(h=o,o=arguments[1]||{},c=2),(o==null||typeof o!="object"&&typeof o!="function")&&(o={});c<u;++c)if(e=arguments[c],e!=null)for(n in e)r=t1(o,n),s=t1(e,n),o!==s&&(h&&s&&(Zw(s)||(i=Yw(s)))?(i?(i=!1,l=r&&Yw(r)?r:[]):l=r&&Zw(r)?r:{},e1(o,{name:n,newValue:t(h,l,s)})):typeof s<"u"&&e1(o,{name:n,newValue:s}));return o};const Np=ox(QB);function ex(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function GB(){const t=[],e={run:n,use:r};return e;function n(...s){let i=-1;const l=s.pop();if(typeof l!="function")throw new TypeError("Expected function as last argument, not "+l);o(null,...s);function o(c,...u){const h=t[++i];let d=-1;if(c){l(c);return}for(;++d<s.length;)(u[d]===null||u[d]===void 0)&&(u[d]=s[d]);s=u,h?XB(h,o)(...u):l(null,...u)}}function r(s){if(typeof s!="function")throw new TypeError("Expected `middelware` to be a function, not "+s);return t.push(s),e}}function XB(t,e){let n;return r;function r(...l){const o=t.length>l.length;let c;o&&l.push(s);try{c=t.apply(this,l)}catch(u){const h=u;if(o&&n)throw h;return s(h)}o||(c&&c.then&&typeof c.then=="function"?c.then(i,s):c instanceof Error?s(c):i(c))}function s(l,...o){n||(n=!0,e(l,...o))}function i(l){s(null,l)}}const es={basename:JB,dirname:YB,extname:ZB,join:ez,sep:"/"};function JB(t,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');au(t);let n=0,r=-1,s=t.length,i;if(e===void 0||e.length===0||e.length>t.length){for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else r<0&&(i=!0,r=s+1);return r<0?"":t.slice(n,r)}if(e===t)return"";let l=-1,o=e.length-1;for(;s--;)if(t.codePointAt(s)===47){if(i){n=s+1;break}}else l<0&&(i=!0,l=s+1),o>-1&&(t.codePointAt(s)===e.codePointAt(o--)?o<0&&(r=s):(o=-1,r=l));return n===r?r=l:r<0&&(r=t.length),t.slice(n,r)}function YB(t){if(au(t),t.length===0)return".";let e=-1,n=t.length,r;for(;--n;)if(t.codePointAt(n)===47){if(r){e=n;break}}else r||(r=!0);return e<0?t.codePointAt(0)===47?"/":".":e===1&&t.codePointAt(0)===47?"//":t.slice(0,e)}function ZB(t){au(t);let e=t.length,n=-1,r=0,s=-1,i=0,l;for(;e--;){const o=t.codePointAt(e);if(o===47){if(l){r=e+1;break}continue}n<0&&(l=!0,n=e+1),o===46?s<0?s=e:i!==1&&(i=1):s>-1&&(i=-1)}return s<0||n<0||i===0||i===1&&s===n-1&&s===r+1?"":t.slice(s,n)}function ez(...t){let e=-1,n;for(;++e<t.length;)au(t[e]),t[e]&&(n=n===void 0?t[e]:n+"/"+t[e]);return n===void 0?".":tz(n)}function tz(t){au(t);const e=t.codePointAt(0)===47;let n=nz(t,!e);return n.length===0&&!e&&(n="."),n.length>0&&t.codePointAt(t.length-1)===47&&(n+="/"),e?"/"+n:n}function nz(t,e){let n="",r=0,s=-1,i=0,l=-1,o,c;for(;++l<=t.length;){if(l<t.length)o=t.codePointAt(l);else{if(o===47)break;o=47}if(o===47){if(!(s===l-1||i===1))if(s!==l-1&&i===2){if(n.length<2||r!==2||n.codePointAt(n.length-1)!==46||n.codePointAt(n.length-2)!==46){if(n.length>2){if(c=n.lastIndexOf("/"),c!==n.length-1){c<0?(n="",r=0):(n=n.slice(0,c),r=n.length-1-n.lastIndexOf("/")),s=l,i=0;continue}}else if(n.length>0){n="",r=0,s=l,i=0;continue}}e&&(n=n.length>0?n+"/..":"..",r=2)}else n.length>0?n+="/"+t.slice(s+1,l):n=t.slice(s+1,l),r=l-s-1;s=l,i=0}else o===46&&i>-1?i++:i=-1}return n}function au(t){if(typeof t!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const rz={cwd:sz};function sz(){return"/"}function tx(t){return!!(t!==null&&typeof t=="object"&&"href"in t&&t.href&&"protocol"in t&&t.protocol&&t.auth===void 0)}function iz(t){if(typeof t=="string")t=new URL(t);else if(!tx(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(t.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return lz(t)}function lz(t){if(t.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=t.pathname;let n=-1;for(;++n<e.length;)if(e.codePointAt(n)===37&&e.codePointAt(n+1)===50){const r=e.codePointAt(n+2);if(r===70||r===102){const s=new TypeError("File URL path must not include encoded / characters");throw s.code="ERR_INVALID_FILE_URL_PATH",s}}return decodeURIComponent(e)}const Cp=["history","path","basename","stem","extname","dirname"];class RC{constructor(e){let n;e?tx(e)?n={path:e}:typeof e=="string"||az(e)?n={value:e}:n=e:n={},this.cwd="cwd"in n?"":rz.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<Cp.length;){const i=Cp[r];i in n&&n[i]!==void 0&&n[i]!==null&&(this[i]=i==="history"?[...n[i]]:n[i])}let s;for(s in n)Cp.includes(s)||(this[s]=n[s])}get basename(){return typeof this.path=="string"?es.basename(this.path):void 0}set basename(e){Ep(e,"basename"),Ap(e,"basename"),this.path=es.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?es.dirname(this.path):void 0}set dirname(e){n1(this.basename,"dirname"),this.path=es.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?es.extname(this.path):void 0}set extname(e){if(Ap(e,"extname"),n1(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=es.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){tx(e)&&(e=iz(e)),Ep(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?es.basename(this.path,this.extname):void 0}set stem(e){Ep(e,"stem"),Ap(e,"stem"),this.path=es.join(this.dirname||"",e+(this.extname||""))}fail(e,n,r){const s=this.message(e,n,r);throw s.fatal=!0,s}info(e,n,r){const s=this.message(e,n,r);return s.fatal=void 0,s}message(e,n,r){const s=new wn(e,n,r);return this.path&&(s.name=this.path+":"+s.name,s.file=this.path),s.fatal=!1,this.messages.push(s),s}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function Ap(t,e){if(t&&t.includes(es.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+es.sep+"`")}function Ep(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function n1(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}function az(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const oz=function(t){const r=this.constructor.prototype,s=r[t],i=function(){return s.apply(i,arguments)};return Object.setPrototypeOf(i,r),i},cz={}.hasOwnProperty;class ey extends oz{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=GB()}copy(){const e=new ey;let n=-1;for(;++n<this.attachers.length;){const r=this.attachers[n];e.use(...r)}return e.data(Np(!0,{},this.namespace)),e}data(e,n){return typeof e=="string"?arguments.length===2?(Mp("data",this.frozen),this.namespace[e]=n,this):cz.call(this.namespace,e)&&this.namespace[e]||void 0:e?(Mp("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[n,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const s=n.call(e,...r);typeof s=="function"&&this.transformers.use(s)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const n=Gu(e),r=this.parser||this.Parser;return Pp("parse",r),r(String(n),n)}process(e,n){const r=this;return this.freeze(),Pp("process",this.parser||this.Parser),_p("process",this.compiler||this.Compiler),n?s(void 0,n):new Promise(s);function s(i,l){const o=Gu(e),c=r.parse(o);r.run(c,o,function(h,d,f){if(h||!d||!f)return u(h);const p=d,m=r.stringify(p,f);hz(m)?f.value=m:f.result=m,u(h,f)});function u(h,d){h||!d?l(h):i?i(d):n(void 0,d)}}}processSync(e){let n=!1,r;return this.freeze(),Pp("processSync",this.parser||this.Parser),_p("processSync",this.compiler||this.Compiler),this.process(e,s),s1("processSync","process",n),r;function s(i,l){n=!0,Gw(i),r=l}}run(e,n,r){r1(e),this.freeze();const s=this.transformers;return!r&&typeof n=="function"&&(r=n,n=void 0),r?i(void 0,r):new Promise(i);function i(l,o){const c=Gu(n);s.run(e,c,u);function u(h,d,f){const p=d||e;h?o(h):l?l(p):r(void 0,p,f)}}}runSync(e,n){let r=!1,s;return this.run(e,n,i),s1("runSync","run",r),s;function i(l,o){Gw(l),s=o,r=!0}}stringify(e,n){this.freeze();const r=Gu(n),s=this.compiler||this.Compiler;return _p("stringify",s),r1(e),s(e,r)}use(e,...n){const r=this.attachers,s=this.namespace;if(Mp("use",this.frozen),e!=null)if(typeof e=="function")c(e,n);else if(typeof e=="object")Array.isArray(e)?o(e):l(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function i(u){if(typeof u=="function")c(u,[]);else if(typeof u=="object")if(Array.isArray(u)){const[h,...d]=u;c(h,d)}else l(u);else throw new TypeError("Expected usable value, not `"+u+"`")}function l(u){if(!("plugins"in u)&&!("settings"in u))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(u.plugins),u.settings&&(s.settings=Np(!0,s.settings,u.settings))}function o(u){let h=-1;if(u!=null)if(Array.isArray(u))for(;++h<u.length;){const d=u[h];i(d)}else throw new TypeError("Expected a list of plugins, not `"+u+"`")}function c(u,h){let d=-1,f=-1;for(;++d<r.length;)if(r[d][0]===u){f=d;break}if(f===-1)r.push([u,...h]);else if(h.length>0){let[p,...m]=h;const x=r[f][1];ex(x)&&ex(p)&&(p=Np(!0,x,p)),r[f]=[u,p,...m]}}}}const uz=new ey().freeze();function Pp(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `parser`")}function _p(t,e){if(typeof e!="function")throw new TypeError("Cannot `"+t+"` without `compiler`")}function Mp(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function r1(t){if(!ex(t)||typeof t.type!="string")throw new TypeError("Expected node, got `"+t+"`")}function s1(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function Gu(t){return dz(t)?t:new RC(t)}function dz(t){return!!(t&&typeof t=="object"&&"message"in t&&"messages"in t)}function hz(t){return typeof t=="string"||fz(t)}function fz(t){return!!(t&&typeof t=="object"&&"byteLength"in t&&"byteOffset"in t)}const pz="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",i1=[],l1={allowDangerousHtml:!0},mz=/^(https?|ircs?|mailto|xmpp)$/i,gz=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function xz(t){const e=yz(t),n=bz(t);return vz(e.runSync(e.parse(n),n),t)}function yz(t){const e=t.rehypePlugins||i1,n=t.remarkPlugins||i1,r=t.remarkRehypeOptions?{...t.remarkRehypeOptions,...l1}:l1;return uz().use(ZF).use(n).use(KB,r).use(e)}function bz(t){const e=t.children||"",n=new RC;return typeof e=="string"&&(n.value=e),n}function vz(t,e){const n=e.allowedElements,r=e.allowElement,s=e.components,i=e.disallowedElements,l=e.skipHtml,o=e.unwrapDisallowed,c=e.urlTransform||wz;for(const h of gz)Object.hasOwn(e,h.from)&&(""+h.from+(h.to?"use `"+h.to+"` instead":"remove it")+pz+h.id,void 0);return Z0(t,u),OO(t,{Fragment:a.Fragment,components:s,ignoreInvalidStyle:!0,jsx:a.jsx,jsxs:a.jsxs,passKeys:!0,passNode:!0});function u(h,d,f){if(h.type==="raw"&&f&&typeof d=="number")return l?f.children.splice(d,1):f.children[d]={type:"text",value:h.value},d;if(h.type==="element"){let p;for(p in kp)if(Object.hasOwn(kp,p)&&Object.hasOwn(h.properties,p)){const m=h.properties[p],x=kp[p];(x===null||x.includes(h.tagName))&&(h.properties[p]=c(String(m||""),p,h))}}if(h.type==="element"){let p=n?!n.includes(h.tagName):i?i.includes(h.tagName):!1;if(!p&&r&&typeof d=="number"&&(p=!r(h,d,f)),p&&f&&typeof d=="number")return o&&h.children?f.children.splice(d,1,...h.children):f.children.splice(d,1),d}}}function wz(t){const e=t.indexOf(":"),n=t.indexOf("?"),r=t.indexOf("#"),s=t.indexOf("/");return e===-1||s!==-1&&e>s||n!==-1&&e>n||r!==-1&&e>r||mz.test(t.slice(0,e))?t:""}function a1(t,e){const n=String(t);if(typeof e!="string")throw new TypeError("Expected character");let r=0,s=n.indexOf(e);for(;s!==-1;)r++,s=n.indexOf(e,s+e.length);return r}function kz(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function jz(t,e,n){const s=hf((n||{}).ignore||[]),i=Sz(e);let l=-1;for(;++l<i.length;)MC(t,"text",o);function o(u,h){let d=-1,f;for(;++d<h.length;){const p=h[d],m=f?f.children:void 0;if(s(p,m?m.indexOf(p):void 0,f))return;f=p}if(f)return c(u,h)}function c(u,h){const d=h[h.length-1],f=i[l][0],p=i[l][1];let m=0;const v=d.children.indexOf(u);let g=!1,y=[];f.lastIndex=0;let b=f.exec(u.value);for(;b;){const k=b.index,S={index:b.index,input:b.input,stack:[...h,u]};let j=p(...b,S);if(typeof j=="string"&&(j=j.length>0?{type:"text",value:j}:void 0),j===!1?f.lastIndex=k+1:(m!==k&&y.push({type:"text",value:u.value.slice(m,k)}),Array.isArray(j)?y.push(...j):j&&y.push(j),m=k+b[0].length,g=!0),!f.global)break;b=f.exec(u.value)}return g?(m<u.value.length&&y.push({type:"text",value:u.value.slice(m)}),d.children.splice(v,1,...y)):y=[u],v+y.length}}function Sz(t){const e=[];if(!Array.isArray(t))throw new TypeError("Expected find and replace tuple or list of tuples");const n=!t[0]||Array.isArray(t[0])?t:[t];let r=-1;for(;++r<n.length;){const s=n[r];e.push([Nz(s[0]),Cz(s[1])])}return e}function Nz(t){return typeof t=="string"?new RegExp(kz(t),"g"):t}function Cz(t){return typeof t=="function"?t:function(){return t}}const Tp="phrasing",Rp=["autolink","link","image","label"];function Az(){return{transforms:[Dz],enter:{literalAutolink:Pz,literalAutolinkEmail:Dp,literalAutolinkHttp:Dp,literalAutolinkWww:Dp},exit:{literalAutolink:Rz,literalAutolinkEmail:Tz,literalAutolinkHttp:_z,literalAutolinkWww:Mz}}}function Ez(){return{unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:Tp,notInConstruct:Rp},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:Tp,notInConstruct:Rp},{character:":",before:"[ps]",after:"\\/",inConstruct:Tp,notInConstruct:Rp}]}}function Pz(t){this.enter({type:"link",title:null,url:"",children:[]},t)}function Dp(t){this.config.enter.autolinkProtocol.call(this,t)}function _z(t){this.config.exit.autolinkProtocol.call(this,t)}function Mz(t){this.config.exit.data.call(this,t);const e=this.stack[this.stack.length-1];e.type,e.url="http://"+this.sliceSerialize(t)}function Tz(t){this.config.exit.autolinkEmail.call(this,t)}function Rz(t){this.exit(t)}function Dz(t){jz(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,Lz],[new RegExp("(?<=^|\\s|\\p{P}|\\p{S})([-.\\w+]+)@([-\\w]+(?:\\.[-\\w]+)+)","gu"),Oz]],{ignore:["link","linkReference"]})}function Lz(t,e,n,r,s){let i="";if(!DC(s)||(/^w/i.test(e)&&(n=e+n,e="",i="http://"),!Iz(n)))return!1;const l=Fz(n+r);if(!l[0])return!1;const o={type:"link",title:null,url:i+e+l[0],children:[{type:"text",value:e+l[0]}]};return l[1]?[o,{type:"text",value:l[1]}]:o}function Oz(t,e,n,r){return!DC(r,!0)||/[-\d_]$/.test(n)?!1:{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function Iz(t){const e=t.split(".");return!(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))}function Fz(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],r=n.indexOf(")");const s=a1(t,"(");let i=a1(t,")");for(;r!==-1&&s>i;)t+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),i++;return[t,n]}function DC(t,e){const n=t.input.charCodeAt(t.index-1);return(t.index===0||El(n)||cf(n))&&(!e||n!==47)}LC.peek=Kz;function Bz(){this.buffer()}function zz(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function $z(){this.buffer()}function Uz(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function Hz(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=zr(this.sliceSerialize(t)).toLowerCase(),n.label=e}function qz(t){this.exit(t)}function Vz(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.type,n.identifier=zr(this.sliceSerialize(t)).toLowerCase(),n.label=e}function Wz(t){this.exit(t)}function Kz(){return"["}function LC(t,e,n,r){const s=n.createTracker(r);let i=s.move("[^");const l=n.enter("footnoteReference"),o=n.enter("reference");return i+=s.move(n.safe(n.associationId(t),{after:"]",before:i})),o(),l(),i+=s.move("]"),i}function Qz(){return{enter:{gfmFootnoteCallString:Bz,gfmFootnoteCall:zz,gfmFootnoteDefinitionLabelString:$z,gfmFootnoteDefinition:Uz},exit:{gfmFootnoteCallString:Hz,gfmFootnoteCall:qz,gfmFootnoteDefinitionLabelString:Vz,gfmFootnoteDefinition:Wz}}}function Gz(t){let e=!1;return t&&t.firstLineBlank&&(e=!0),{handlers:{footnoteDefinition:n,footnoteReference:LC},unsafe:[{character:"[",inConstruct:["label","phrasing","reference"]}]};function n(r,s,i,l){const o=i.createTracker(l);let c=o.move("[^");const u=i.enter("footnoteDefinition"),h=i.enter("label");return c+=o.move(i.safe(i.associationId(r),{before:c,after:"]"})),h(),c+=o.move("]:"),r.children&&r.children.length>0&&(o.shift(4),c+=o.move((e?`
`:" ")+i.indentLines(i.containerFlow(r,o.current()),e?OC:Xz))),u(),c}}function Xz(t,e,n){return e===0?t:OC(t,e,n)}function OC(t,e,n){return(n?"":"    ")+t}const Jz=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"];IC.peek=n8;function Yz(){return{canContainEols:["delete"],enter:{strikethrough:e8},exit:{strikethrough:t8}}}function Zz(){return{unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:Jz}],handlers:{delete:IC}}}function e8(t){this.enter({type:"delete",children:[]},t)}function t8(t){this.exit(t)}function IC(t,e,n,r){const s=n.createTracker(r),i=n.enter("strikethrough");let l=s.move("~~");return l+=n.containerPhrasing(t,{...s.current(),before:l,after:"~"}),l+=s.move("~~"),i(),l}function n8(){return"~"}function r8(t){return t.length}function s8(t,e){const n=e||{},r=(n.align||[]).concat(),s=n.stringLength||r8,i=[],l=[],o=[],c=[];let u=0,h=-1;for(;++h<t.length;){const x=[],v=[];let g=-1;for(t[h].length>u&&(u=t[h].length);++g<t[h].length;){const y=i8(t[h][g]);if(n.alignDelimiters!==!1){const b=s(y);v[g]=b,(c[g]===void 0||b>c[g])&&(c[g]=b)}x.push(y)}l[h]=x,o[h]=v}let d=-1;if(typeof r=="object"&&"length"in r)for(;++d<u;)i[d]=o1(r[d]);else{const x=o1(r);for(;++d<u;)i[d]=x}d=-1;const f=[],p=[];for(;++d<u;){const x=i[d];let v="",g="";x===99?(v=":",g=":"):x===108?v=":":x===114&&(g=":");let y=n.alignDelimiters===!1?1:Math.max(1,c[d]-v.length-g.length);const b=v+"-".repeat(y)+g;n.alignDelimiters!==!1&&(y=v.length+y+g.length,y>c[d]&&(c[d]=y),p[d]=y),f[d]=b}l.splice(1,0,f),o.splice(1,0,p),h=-1;const m=[];for(;++h<l.length;){const x=l[h],v=o[h];d=-1;const g=[];for(;++d<u;){const y=x[d]||"";let b="",k="";if(n.alignDelimiters!==!1){const S=c[d]-(v[d]||0),j=i[d];j===114?b=" ".repeat(S):j===99?S%2?(b=" ".repeat(S/2+.5),k=" ".repeat(S/2-.5)):(b=" ".repeat(S/2),k=b):k=" ".repeat(S)}n.delimiterStart!==!1&&!d&&g.push("|"),n.padding!==!1&&!(n.alignDelimiters===!1&&y==="")&&(n.delimiterStart!==!1||d)&&g.push(" "),n.alignDelimiters!==!1&&g.push(b),g.push(y),n.alignDelimiters!==!1&&g.push(k),n.padding!==!1&&g.push(" "),(n.delimiterEnd!==!1||d!==u-1)&&g.push("|")}m.push(n.delimiterEnd===!1?g.join("").replace(/ +$/,""):g.join(""))}return m.join(`
`)}function i8(t){return t==null?"":String(t)}function o1(t){const e=typeof t=="string"?t.codePointAt(0):0;return e===67||e===99?99:e===76||e===108?108:e===82||e===114?114:0}function l8(t,e,n,r){const s=n.enter("blockquote"),i=n.createTracker(r);i.move("> "),i.shift(2);const l=n.indentLines(n.containerFlow(t,i.current()),a8);return s(),l}function a8(t,e,n){return">"+(n?"":" ")+t}function o8(t,e){return c1(t,e.inConstruct,!0)&&!c1(t,e.notInConstruct,!1)}function c1(t,e,n){if(typeof e=="string"&&(e=[e]),!e||e.length===0)return n;let r=-1;for(;++r<e.length;)if(t.includes(e[r]))return!0;return!1}function u1(t,e,n,r){let s=-1;for(;++s<n.unsafe.length;)if(n.unsafe[s].character===`
`&&o8(n.stack,n.unsafe[s]))return/[ \t]/.test(r.before)?"":" ";return`\\
`}function c8(t,e){const n=String(t);let r=n.indexOf(e),s=r,i=0,l=0;if(typeof e!="string")throw new TypeError("Expected substring");for(;r!==-1;)r===s?++i>l&&(l=i):i=1,s=r+e.length,r=n.indexOf(e,s);return l}function u8(t,e){return!!(e.options.fences===!1&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function d8(t){const e=t.options.fence||"`";if(e!=="`"&&e!=="~")throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}function h8(t,e,n,r){const s=d8(n),i=t.value||"",l=s==="`"?"GraveAccent":"Tilde";if(u8(t,n)){const d=n.enter("codeIndented"),f=n.indentLines(i,f8);return d(),f}const o=n.createTracker(r),c=s.repeat(Math.max(c8(i,s)+1,3)),u=n.enter("codeFenced");let h=o.move(c);if(t.lang){const d=n.enter(`codeFencedLang${l}`);h+=o.move(n.safe(t.lang,{before:h,after:" ",encode:["`"],...o.current()})),d()}if(t.lang&&t.meta){const d=n.enter(`codeFencedMeta${l}`);h+=o.move(" "),h+=o.move(n.safe(t.meta,{before:h,after:`
`,encode:["`"],...o.current()})),d()}return h+=o.move(`
`),i&&(h+=o.move(i+`
`)),h+=o.move(c),u(),h}function f8(t,e,n){return(n?"":"    ")+t}function ty(t){const e=t.options.quote||'"';if(e!=='"'&&e!=="'")throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function p8(t,e,n,r){const s=ty(n),i=s==='"'?"Quote":"Apostrophe",l=n.enter("definition");let o=n.enter("label");const c=n.createTracker(r);let u=c.move("[");return u+=c.move(n.safe(n.associationId(t),{before:u,after:"]",...c.current()})),u+=c.move("]: "),o(),!t.url||/[\0- \u007F]/.test(t.url)?(o=n.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(n.safe(t.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(o=n.enter("destinationRaw"),u+=c.move(n.safe(t.url,{before:u,after:t.title?" ":`
`,...c.current()}))),o(),t.title&&(o=n.enter(`title${i}`),u+=c.move(" "+s),u+=c.move(n.safe(t.title,{before:u,after:s,...c.current()})),u+=c.move(s),o()),l(),u}function m8(t){const e=t.options.emphasis||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}function zc(t){return"&#x"+t.toString(16).toUpperCase()+";"}function Sh(t,e,n){const r=Xa(t),s=Xa(e);return r===void 0?s===void 0?n==="_"?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!0}:r===1?s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!0}:{inside:!1,outside:!1}:s===void 0?{inside:!1,outside:!1}:s===1?{inside:!0,outside:!1}:{inside:!1,outside:!1}}FC.peek=g8;function FC(t,e,n,r){const s=m8(n),i=n.enter("emphasis"),l=n.createTracker(r),o=l.move(s);let c=l.move(n.containerPhrasing(t,{after:s,before:o,...l.current()}));const u=c.charCodeAt(0),h=Sh(r.before.charCodeAt(r.before.length-1),u,s);h.inside&&(c=zc(u)+c.slice(1));const d=c.charCodeAt(c.length-1),f=Sh(r.after.charCodeAt(0),d,s);f.inside&&(c=c.slice(0,-1)+zc(d));const p=l.move(s);return i(),n.attentionEncodeSurroundingInfo={after:f.outside,before:h.outside},o+c+p}function g8(t,e,n){return n.options.emphasis||"*"}function x8(t,e){let n=!1;return Z0(t,function(r){if("value"in r&&/\r?\n|\r/.test(r.value)||r.type==="break")return n=!0,Yg}),!!((!t.depth||t.depth<3)&&W0(t)&&(e.options.setext||n))}function y8(t,e,n,r){const s=Math.max(Math.min(6,t.depth||1),1),i=n.createTracker(r);if(x8(t,n)){const h=n.enter("headingSetext"),d=n.enter("phrasing"),f=n.containerPhrasing(t,{...i.current(),before:`
`,after:`
`});return d(),h(),f+`
`+(s===1?"=":"-").repeat(f.length-(Math.max(f.lastIndexOf("\r"),f.lastIndexOf(`
`))+1))}const l="#".repeat(s),o=n.enter("headingAtx"),c=n.enter("phrasing");i.move(l+" ");let u=n.containerPhrasing(t,{before:"# ",after:`
`,...i.current()});return/^[\t ]/.test(u)&&(u=zc(u.charCodeAt(0))+u.slice(1)),u=u?l+" "+u:l,n.options.closeAtx&&(u+=" "+l),c(),o(),u}BC.peek=b8;function BC(t){return t.value||""}function b8(){return"<"}zC.peek=v8;function zC(t,e,n,r){const s=ty(n),i=s==='"'?"Quote":"Apostrophe",l=n.enter("image");let o=n.enter("label");const c=n.createTracker(r);let u=c.move("![");return u+=c.move(n.safe(t.alt,{before:u,after:"]",...c.current()})),u+=c.move("]("),o(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(o=n.enter("destinationLiteral"),u+=c.move("<"),u+=c.move(n.safe(t.url,{before:u,after:">",...c.current()})),u+=c.move(">")):(o=n.enter("destinationRaw"),u+=c.move(n.safe(t.url,{before:u,after:t.title?" ":")",...c.current()}))),o(),t.title&&(o=n.enter(`title${i}`),u+=c.move(" "+s),u+=c.move(n.safe(t.title,{before:u,after:s,...c.current()})),u+=c.move(s),o()),u+=c.move(")"),l(),u}function v8(){return"!"}$C.peek=w8;function $C(t,e,n,r){const s=t.referenceType,i=n.enter("imageReference");let l=n.enter("label");const o=n.createTracker(r);let c=o.move("![");const u=n.safe(t.alt,{before:c,after:"]",...o.current()});c+=o.move(u+"]["),l();const h=n.stack;n.stack=[],l=n.enter("reference");const d=n.safe(n.associationId(t),{before:c,after:"]",...o.current()});return l(),n.stack=h,i(),s==="full"||!u||u!==d?c+=o.move(d+"]"):s==="shortcut"?c=c.slice(0,-1):c+=o.move("]"),c}function w8(){return"!"}UC.peek=k8;function UC(t,e,n){let r=t.value||"",s="`",i=-1;for(;new RegExp("(^|[^`])"+s+"([^`]|$)").test(r);)s+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++i<n.unsafe.length;){const l=n.unsafe[i],o=n.compilePattern(l);let c;if(l.atBreak)for(;c=o.exec(r);){let u=c.index;r.charCodeAt(u)===10&&r.charCodeAt(u-1)===13&&u--,r=r.slice(0,u)+" "+r.slice(c.index+1)}}return s+r+s}function k8(){return"`"}function HC(t,e){const n=W0(t);return!!(!e.options.resourceLink&&t.url&&!t.title&&t.children&&t.children.length===1&&t.children[0].type==="text"&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}qC.peek=j8;function qC(t,e,n,r){const s=ty(n),i=s==='"'?"Quote":"Apostrophe",l=n.createTracker(r);let o,c;if(HC(t,n)){const h=n.stack;n.stack=[],o=n.enter("autolink");let d=l.move("<");return d+=l.move(n.containerPhrasing(t,{before:d,after:">",...l.current()})),d+=l.move(">"),o(),n.stack=h,d}o=n.enter("link"),c=n.enter("label");let u=l.move("[");return u+=l.move(n.containerPhrasing(t,{before:u,after:"](",...l.current()})),u+=l.move("]("),c(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(c=n.enter("destinationLiteral"),u+=l.move("<"),u+=l.move(n.safe(t.url,{before:u,after:">",...l.current()})),u+=l.move(">")):(c=n.enter("destinationRaw"),u+=l.move(n.safe(t.url,{before:u,after:t.title?" ":")",...l.current()}))),c(),t.title&&(c=n.enter(`title${i}`),u+=l.move(" "+s),u+=l.move(n.safe(t.title,{before:u,after:s,...l.current()})),u+=l.move(s),c()),u+=l.move(")"),o(),u}function j8(t,e,n){return HC(t,n)?"<":"["}VC.peek=S8;function VC(t,e,n,r){const s=t.referenceType,i=n.enter("linkReference");let l=n.enter("label");const o=n.createTracker(r);let c=o.move("[");const u=n.containerPhrasing(t,{before:c,after:"]",...o.current()});c+=o.move(u+"]["),l();const h=n.stack;n.stack=[],l=n.enter("reference");const d=n.safe(n.associationId(t),{before:c,after:"]",...o.current()});return l(),n.stack=h,i(),s==="full"||!u||u!==d?c+=o.move(d+"]"):s==="shortcut"?c=c.slice(0,-1):c+=o.move("]"),c}function S8(){return"["}function ny(t){const e=t.options.bullet||"*";if(e!=="*"&&e!=="+"&&e!=="-")throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function N8(t){const e=ny(t),n=t.options.bulletOther;if(!n)return e==="*"?"-":"*";if(n!=="*"&&n!=="+"&&n!=="-")throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}function C8(t){const e=t.options.bulletOrdered||".";if(e!=="."&&e!==")")throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function WC(t){const e=t.options.rule||"*";if(e!=="*"&&e!=="-"&&e!=="_")throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function A8(t,e,n,r){const s=n.enter("list"),i=n.bulletCurrent;let l=t.ordered?C8(n):ny(n);const o=t.ordered?l==="."?")":".":N8(n);let c=e&&n.bulletLastUsed?l===n.bulletLastUsed:!1;if(!t.ordered){const h=t.children?t.children[0]:void 0;if((l==="*"||l==="-")&&h&&(!h.children||!h.children[0])&&n.stack[n.stack.length-1]==="list"&&n.stack[n.stack.length-2]==="listItem"&&n.stack[n.stack.length-3]==="list"&&n.stack[n.stack.length-4]==="listItem"&&n.indexStack[n.indexStack.length-1]===0&&n.indexStack[n.indexStack.length-2]===0&&n.indexStack[n.indexStack.length-3]===0&&(c=!0),WC(n)===l&&h){let d=-1;for(;++d<t.children.length;){const f=t.children[d];if(f&&f.type==="listItem"&&f.children&&f.children[0]&&f.children[0].type==="thematicBreak"){c=!0;break}}}}c&&(l=o),n.bulletCurrent=l;const u=n.containerFlow(t,r);return n.bulletLastUsed=l,n.bulletCurrent=i,s(),u}function E8(t){const e=t.options.listItemIndent||"one";if(e!=="tab"&&e!=="one"&&e!=="mixed")throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}function P8(t,e,n,r){const s=E8(n);let i=n.bulletCurrent||ny(n);e&&e.type==="list"&&e.ordered&&(i=(typeof e.start=="number"&&e.start>-1?e.start:1)+(n.options.incrementListMarker===!1?0:e.children.indexOf(t))+i);let l=i.length+1;(s==="tab"||s==="mixed"&&(e&&e.type==="list"&&e.spread||t.spread))&&(l=Math.ceil(l/4)*4);const o=n.createTracker(r);o.move(i+" ".repeat(l-i.length)),o.shift(l);const c=n.enter("listItem"),u=n.indentLines(n.containerFlow(t,o.current()),h);return c(),u;function h(d,f,p){return f?(p?"":" ".repeat(l))+d:(p?i:i+" ".repeat(l-i.length))+d}}function _8(t,e,n,r){const s=n.enter("paragraph"),i=n.enter("phrasing"),l=n.containerPhrasing(t,r);return i(),s(),l}const M8=hf(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function T8(t,e,n,r){return(t.children.some(function(l){return M8(l)})?n.containerPhrasing:n.containerFlow).call(n,t,r)}function R8(t){const e=t.options.strong||"*";if(e!=="*"&&e!=="_")throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}KC.peek=D8;function KC(t,e,n,r){const s=R8(n),i=n.enter("strong"),l=n.createTracker(r),o=l.move(s+s);let c=l.move(n.containerPhrasing(t,{after:s,before:o,...l.current()}));const u=c.charCodeAt(0),h=Sh(r.before.charCodeAt(r.before.length-1),u,s);h.inside&&(c=zc(u)+c.slice(1));const d=c.charCodeAt(c.length-1),f=Sh(r.after.charCodeAt(0),d,s);f.inside&&(c=c.slice(0,-1)+zc(d));const p=l.move(s+s);return i(),n.attentionEncodeSurroundingInfo={after:f.outside,before:h.outside},o+c+p}function D8(t,e,n){return n.options.strong||"*"}function L8(t,e,n,r){return n.safe(t.value,r)}function O8(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}function I8(t,e,n){const r=(WC(n)+(n.options.ruleSpaces?" ":"")).repeat(O8(n));return n.options.ruleSpaces?r.slice(0,-1):r}const QC={blockquote:l8,break:u1,code:h8,definition:p8,emphasis:FC,hardBreak:u1,heading:y8,html:BC,image:zC,imageReference:$C,inlineCode:UC,link:qC,linkReference:VC,list:A8,listItem:P8,paragraph:_8,root:T8,strong:KC,text:L8,thematicBreak:I8};function F8(){return{enter:{table:B8,tableData:d1,tableHeader:d1,tableRow:$8},exit:{codeText:U8,table:z8,tableData:Lp,tableHeader:Lp,tableRow:Lp}}}function B8(t){const e=t._align;this.enter({type:"table",align:e.map(function(n){return n==="none"?null:n}),children:[]},t),this.data.inTable=!0}function z8(t){this.exit(t),this.data.inTable=void 0}function $8(t){this.enter({type:"tableRow",children:[]},t)}function Lp(t){this.exit(t)}function d1(t){this.enter({type:"tableCell",children:[]},t)}function U8(t){let e=this.resume();this.data.inTable&&(e=e.replace(/\\([\\|])/g,H8));const n=this.stack[this.stack.length-1];n.type,n.value=e,this.exit(t)}function H8(t,e){return e==="|"?e:t}function q8(t){const e=t||{},n=e.tableCellPadding,r=e.tablePipeAlign,s=e.stringLength,i=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:`
`,inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[	 :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{inlineCode:f,table:l,tableCell:c,tableRow:o}};function l(p,m,x,v){return u(h(p,x,v),p.align)}function o(p,m,x,v){const g=d(p,x,v),y=u([g]);return y.slice(0,y.indexOf(`
`))}function c(p,m,x,v){const g=x.enter("tableCell"),y=x.enter("phrasing"),b=x.containerPhrasing(p,{...v,before:i,after:i});return y(),g(),b}function u(p,m){return s8(p,{align:m,alignDelimiters:r,padding:n,stringLength:s})}function h(p,m,x){const v=p.children;let g=-1;const y=[],b=m.enter("table");for(;++g<v.length;)y[g]=d(v[g],m,x);return b(),y}function d(p,m,x){const v=p.children;let g=-1;const y=[],b=m.enter("tableRow");for(;++g<v.length;)y[g]=c(v[g],p,m,x);return b(),y}function f(p,m,x){let v=QC.inlineCode(p,m,x);return x.stack.includes("tableCell")&&(v=v.replace(/\|/g,"\\$&")),v}}function V8(){return{exit:{taskListCheckValueChecked:h1,taskListCheckValueUnchecked:h1,paragraph:K8}}}function W8(){return{unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:Q8}}}function h1(t){const e=this.stack[this.stack.length-2];e.type,e.checked=t.type==="taskListCheckValueChecked"}function K8(t){const e=this.stack[this.stack.length-2];if(e&&e.type==="listItem"&&typeof e.checked=="boolean"){const n=this.stack[this.stack.length-1];n.type;const r=n.children[0];if(r&&r.type==="text"){const s=e.children;let i=-1,l;for(;++i<s.length;){const o=s[i];if(o.type==="paragraph"){l=o;break}}l===n&&(r.value=r.value.slice(1),r.value.length===0?n.children.shift():n.position&&r.position&&typeof r.position.start.offset=="number"&&(r.position.start.column++,r.position.start.offset++,n.position.start=Object.assign({},r.position.start)))}}this.exit(t)}function Q8(t,e,n,r){const s=t.children[0],i=typeof t.checked=="boolean"&&s&&s.type==="paragraph",l="["+(t.checked?"x":" ")+"] ",o=n.createTracker(r);i&&o.move(l);let c=QC.listItem(t,e,n,{...r,...o.current()});return i&&(c=c.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,u)),c;function u(h){return h+l}}function G8(){return[Az(),Qz(),Yz(),F8(),V8()]}function X8(t){return{extensions:[Ez(),Gz(t),Zz(),q8(t),W8()]}}const J8={tokenize:r$,partial:!0},GC={tokenize:s$,partial:!0},XC={tokenize:i$,partial:!0},JC={tokenize:l$,partial:!0},Y8={tokenize:a$,partial:!0},YC={name:"wwwAutolink",tokenize:t$,previous:eA},ZC={name:"protocolAutolink",tokenize:n$,previous:tA},Vs={name:"emailAutolink",tokenize:e$,previous:nA},ys={};function Z8(){return{text:ys}}let Vi=48;for(;Vi<123;)ys[Vi]=Vs,Vi++,Vi===58?Vi=65:Vi===91&&(Vi=97);ys[43]=Vs;ys[45]=Vs;ys[46]=Vs;ys[95]=Vs;ys[72]=[Vs,ZC];ys[104]=[Vs,ZC];ys[87]=[Vs,YC];ys[119]=[Vs,YC];function e$(t,e,n){const r=this;let s,i;return l;function l(d){return!nx(d)||!nA.call(r,r.previous)||ry(r.events)?n(d):(t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),o(d))}function o(d){return nx(d)?(t.consume(d),o):d===64?(t.consume(d),c):n(d)}function c(d){return d===46?t.check(Y8,h,u)(d):d===45||d===95||bn(d)?(i=!0,t.consume(d),c):h(d)}function u(d){return t.consume(d),s=!0,c}function h(d){return i&&s&&En(r.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(d)):n(d)}}function t$(t,e,n){const r=this;return s;function s(l){return l!==87&&l!==119||!eA.call(r,r.previous)||ry(r.events)?n(l):(t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(J8,t.attempt(GC,t.attempt(XC,i),n),n)(l))}function i(l){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(l)}}function n$(t,e,n){const r=this;let s="",i=!1;return l;function l(d){return(d===72||d===104)&&tA.call(r,r.previous)&&!ry(r.events)?(t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),s+=String.fromCodePoint(d),t.consume(d),o):n(d)}function o(d){if(En(d)&&s.length<5)return s+=String.fromCodePoint(d),t.consume(d),o;if(d===58){const f=s.toLowerCase();if(f==="http"||f==="https")return t.consume(d),c}return n(d)}function c(d){return d===47?(t.consume(d),i?u:(i=!0,c)):n(d)}function u(d){return d===null||wh(d)||ut(d)||El(d)||cf(d)?n(d):t.attempt(GC,t.attempt(XC,h),n)(d)}function h(d){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(d)}}function r$(t,e,n){let r=0;return s;function s(l){return(l===87||l===119)&&r<3?(r++,t.consume(l),s):l===46&&r===3?(t.consume(l),i):n(l)}function i(l){return l===null?n(l):e(l)}}function s$(t,e,n){let r,s,i;return l;function l(u){return u===46||u===95?t.check(JC,c,o)(u):u===null||ut(u)||El(u)||u!==45&&cf(u)?c(u):(i=!0,t.consume(u),l)}function o(u){return u===95?r=!0:(s=r,r=void 0),t.consume(u),l}function c(u){return s||r||!i?n(u):e(u)}}function i$(t,e){let n=0,r=0;return s;function s(l){return l===40?(n++,t.consume(l),s):l===41&&r<n?i(l):l===33||l===34||l===38||l===39||l===41||l===42||l===44||l===46||l===58||l===59||l===60||l===63||l===93||l===95||l===126?t.check(JC,e,i)(l):l===null||ut(l)||El(l)?e(l):(t.consume(l),s)}function i(l){return l===41&&r++,t.consume(l),s}}function l$(t,e,n){return r;function r(o){return o===33||o===34||o===39||o===41||o===42||o===44||o===46||o===58||o===59||o===63||o===95||o===126?(t.consume(o),r):o===38?(t.consume(o),i):o===93?(t.consume(o),s):o===60||o===null||ut(o)||El(o)?e(o):n(o)}function s(o){return o===null||o===40||o===91||ut(o)||El(o)?e(o):r(o)}function i(o){return En(o)?l(o):n(o)}function l(o){return o===59?(t.consume(o),r):En(o)?(t.consume(o),l):n(o)}}function a$(t,e,n){return r;function r(i){return t.consume(i),s}function s(i){return bn(i)?n(i):e(i)}}function eA(t){return t===null||t===40||t===42||t===95||t===91||t===93||t===126||ut(t)}function tA(t){return!En(t)}function nA(t){return!(t===47||nx(t))}function nx(t){return t===43||t===45||t===46||t===95||bn(t)}function ry(t){let e=t.length,n=!1;for(;e--;){const r=t[e][1];if((r.type==="labelLink"||r.type==="labelImage")&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}const o$={tokenize:g$,partial:!0};function c$(){return{document:{91:{name:"gfmFootnoteDefinition",tokenize:f$,continuation:{tokenize:p$},exit:m$}},text:{91:{name:"gfmFootnoteCall",tokenize:h$},93:{name:"gfmPotentialFootnoteCall",add:"after",tokenize:u$,resolveTo:d$}}}}function u$(t,e,n){const r=this;let s=r.events.length;const i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let l;for(;s--;){const c=r.events[s][1];if(c.type==="labelImage"){l=c;break}if(c.type==="gfmFootnoteCall"||c.type==="labelLink"||c.type==="label"||c.type==="image"||c.type==="link")break}return o;function o(c){if(!l||!l._balanced)return n(c);const u=zr(r.sliceSerialize({start:l.end,end:r.now()}));return u.codePointAt(0)!==94||!i.includes(u.slice(1))?n(c):(t.enter("gfmFootnoteCallLabelMarker"),t.consume(c),t.exit("gfmFootnoteCallLabelMarker"),e(c))}}function d$(t,e){let n=t.length;for(;n--;)if(t[n][1].type==="labelImage"&&t[n][0]==="enter"){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},s={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};s.end.column++,s.end.offset++,s.end._bufferIndex++;const i={type:"gfmFootnoteCallString",start:Object.assign({},s.end),end:Object.assign({},t[t.length-1][1].start)},l={type:"chunkString",contentType:"string",start:Object.assign({},i.start),end:Object.assign({},i.end)},o=[t[n+1],t[n+2],["enter",r,e],t[n+3],t[n+4],["enter",s,e],["exit",s,e],["enter",i,e],["enter",l,e],["exit",l,e],["exit",i,e],t[t.length-2],t[t.length-1],["exit",r,e]];return t.splice(n,t.length-n+1,...o),t}function h$(t,e,n){const r=this,s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let i=0,l;return o;function o(d){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),c}function c(d){return d!==94?n(d):(t.enter("gfmFootnoteCallMarker"),t.consume(d),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",u)}function u(d){if(i>999||d===93&&!l||d===null||d===91||ut(d))return n(d);if(d===93){t.exit("chunkString");const f=t.exit("gfmFootnoteCallString");return s.includes(zr(r.sliceSerialize(f)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(d),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(d)}return ut(d)||(l=!0),i++,t.consume(d),d===92?h:u}function h(d){return d===91||d===92||d===93?(t.consume(d),i++,u):u(d)}}function f$(t,e,n){const r=this,s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let i,l=0,o;return c;function c(m){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionLabelMarker"),u}function u(m){return m===94?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",h):n(m)}function h(m){if(l>999||m===93&&!o||m===null||m===91||ut(m))return n(m);if(m===93){t.exit("chunkString");const x=t.exit("gfmFootnoteDefinitionLabelString");return i=zr(r.sliceSerialize(x)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(m),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),f}return ut(m)||(o=!0),l++,t.consume(m),m===92?d:h}function d(m){return m===91||m===92||m===93?(t.consume(m),l++,h):h(m)}function f(m){return m===58?(t.enter("definitionMarker"),t.consume(m),t.exit("definitionMarker"),s.includes(i)||s.push(i),Qe(t,p,"gfmFootnoteDefinitionWhitespace")):n(m)}function p(m){return e(m)}}function p$(t,e,n){return t.check(lu,e,t.attempt(o$,e,n))}function m$(t){t.exit("gfmFootnoteDefinition")}function g$(t,e,n){const r=this;return Qe(t,s,"gfmFootnoteDefinitionIndent",5);function s(i){const l=r.events[r.events.length-1];return l&&l[1].type==="gfmFootnoteDefinitionIndent"&&l[2].sliceSerialize(l[1],!0).length===4?e(i):n(i)}}function x$(t){let n=(t||{}).singleTilde;const r={name:"strikethrough",tokenize:i,resolveAll:s};return n==null&&(n=!0),{text:{126:r},insideSpan:{null:[r]},attentionMarkers:{null:[126]}};function s(l,o){let c=-1;for(;++c<l.length;)if(l[c][0]==="enter"&&l[c][1].type==="strikethroughSequenceTemporary"&&l[c][1]._close){let u=c;for(;u--;)if(l[u][0]==="exit"&&l[u][1].type==="strikethroughSequenceTemporary"&&l[u][1]._open&&l[c][1].end.offset-l[c][1].start.offset===l[u][1].end.offset-l[u][1].start.offset){l[c][1].type="strikethroughSequence",l[u][1].type="strikethroughSequence";const h={type:"strikethrough",start:Object.assign({},l[u][1].start),end:Object.assign({},l[c][1].end)},d={type:"strikethroughText",start:Object.assign({},l[u][1].end),end:Object.assign({},l[c][1].start)},f=[["enter",h,o],["enter",l[u][1],o],["exit",l[u][1],o],["enter",d,o]],p=o.parser.constructs.insideSpan.null;p&&ir(f,f.length,0,uf(p,l.slice(u+1,c),o)),ir(f,f.length,0,[["exit",d,o],["enter",l[c][1],o],["exit",l[c][1],o],["exit",h,o]]),ir(l,u-1,c-u+3,f),c=u+f.length-2;break}}for(c=-1;++c<l.length;)l[c][1].type==="strikethroughSequenceTemporary"&&(l[c][1].type="data");return l}function i(l,o,c){const u=this.previous,h=this.events;let d=0;return f;function f(m){return u===126&&h[h.length-1][1].type!=="characterEscape"?c(m):(l.enter("strikethroughSequenceTemporary"),p(m))}function p(m){const x=Xa(u);if(m===126)return d>1?c(m):(l.consume(m),d++,p);if(d<2&&!n)return c(m);const v=l.exit("strikethroughSequenceTemporary"),g=Xa(m);return v._open=!g||g===2&&!!x,v._close=!x||x===2&&!!g,o(m)}}}class y${constructor(){this.map=[]}add(e,n,r){b$(this,e,n,r)}consume(e){if(this.map.sort(function(i,l){return i[0]-l[0]}),this.map.length===0)return;let n=this.map.length;const r=[];for(;n>0;)n-=1,r.push(e.slice(this.map[n][0]+this.map[n][1]),this.map[n][2]),e.length=this.map[n][0];r.push(e.slice()),e.length=0;let s=r.pop();for(;s;){for(const i of s)e.push(i);s=r.pop()}this.map.length=0}}function b$(t,e,n,r){let s=0;if(!(n===0&&r.length===0)){for(;s<t.map.length;){if(t.map[s][0]===e){t.map[s][1]+=n,t.map[s][2].push(...r);return}s+=1}t.map.push([e,n,r])}}function v$(t,e){let n=!1;const r=[];for(;e<t.length;){const s=t[e];if(n){if(s[0]==="enter")s[1].type==="tableContent"&&r.push(t[e+1][1].type==="tableDelimiterMarker"?"left":"none");else if(s[1].type==="tableContent"){if(t[e-1][1].type==="tableDelimiterMarker"){const i=r.length-1;r[i]=r[i]==="left"?"center":"right"}}else if(s[1].type==="tableDelimiterRow")break}else s[0]==="enter"&&s[1].type==="tableDelimiterRow"&&(n=!0);e+=1}return r}function w$(){return{flow:{null:{name:"table",tokenize:k$,resolveAll:j$}}}}function k$(t,e,n){const r=this;let s=0,i=0,l;return o;function o(N){let I=r.events.length-1;for(;I>-1;){const _=r.events[I][1].type;if(_==="lineEnding"||_==="linePrefix")I--;else break}const R=I>-1?r.events[I][1].type:null,C=R==="tableHead"||R==="tableRow"?j:c;return C===j&&r.parser.lazy[r.now().line]?n(N):C(N)}function c(N){return t.enter("tableHead"),t.enter("tableRow"),u(N)}function u(N){return N===124||(l=!0,i+=1),h(N)}function h(N){return N===null?n(N):Te(N)?i>1?(i=0,r.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(N),t.exit("lineEnding"),p):n(N):He(N)?Qe(t,h,"whitespace")(N):(i+=1,l&&(l=!1,s+=1),N===124?(t.enter("tableCellDivider"),t.consume(N),t.exit("tableCellDivider"),l=!0,h):(t.enter("data"),d(N)))}function d(N){return N===null||N===124||ut(N)?(t.exit("data"),h(N)):(t.consume(N),N===92?f:d)}function f(N){return N===92||N===124?(t.consume(N),d):d(N)}function p(N){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(N):(t.enter("tableDelimiterRow"),l=!1,He(N)?Qe(t,m,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(N):m(N))}function m(N){return N===45||N===58?v(N):N===124?(l=!0,t.enter("tableCellDivider"),t.consume(N),t.exit("tableCellDivider"),x):S(N)}function x(N){return He(N)?Qe(t,v,"whitespace")(N):v(N)}function v(N){return N===58?(i+=1,l=!0,t.enter("tableDelimiterMarker"),t.consume(N),t.exit("tableDelimiterMarker"),g):N===45?(i+=1,g(N)):N===null||Te(N)?k(N):S(N)}function g(N){return N===45?(t.enter("tableDelimiterFiller"),y(N)):S(N)}function y(N){return N===45?(t.consume(N),y):N===58?(l=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(N),t.exit("tableDelimiterMarker"),b):(t.exit("tableDelimiterFiller"),b(N))}function b(N){return He(N)?Qe(t,k,"whitespace")(N):k(N)}function k(N){return N===124?m(N):N===null||Te(N)?!l||s!==i?S(N):(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(N)):S(N)}function S(N){return n(N)}function j(N){return t.enter("tableRow"),E(N)}function E(N){return N===124?(t.enter("tableCellDivider"),t.consume(N),t.exit("tableCellDivider"),E):N===null||Te(N)?(t.exit("tableRow"),e(N)):He(N)?Qe(t,E,"whitespace")(N):(t.enter("data"),A(N))}function A(N){return N===null||N===124||ut(N)?(t.exit("data"),E(N)):(t.consume(N),N===92?T:A)}function T(N){return N===92||N===124?(t.consume(N),A):A(N)}}function j$(t,e){let n=-1,r=!0,s=0,i=[0,0,0,0],l=[0,0,0,0],o=!1,c=0,u,h,d;const f=new y$;for(;++n<t.length;){const p=t[n],m=p[1];p[0]==="enter"?m.type==="tableHead"?(o=!1,c!==0&&(f1(f,e,c,u,h),h=void 0,c=0),u={type:"table",start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(n,0,[["enter",u,e]])):m.type==="tableRow"||m.type==="tableDelimiterRow"?(r=!0,d=void 0,i=[0,0,0,0],l=[0,n+1,0,0],o&&(o=!1,h={type:"tableBody",start:Object.assign({},m.start),end:Object.assign({},m.end)},f.add(n,0,[["enter",h,e]])),s=m.type==="tableDelimiterRow"?2:h?3:1):s&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")?(r=!1,l[2]===0&&(i[1]!==0&&(l[0]=l[1],d=Xu(f,e,i,s,void 0,d),i=[0,0,0,0]),l[2]=n)):m.type==="tableCellDivider"&&(r?r=!1:(i[1]!==0&&(l[0]=l[1],d=Xu(f,e,i,s,void 0,d)),i=l,l=[i[1],n,0,0])):m.type==="tableHead"?(o=!0,c=n):m.type==="tableRow"||m.type==="tableDelimiterRow"?(c=n,i[1]!==0?(l[0]=l[1],d=Xu(f,e,i,s,n,d)):l[1]!==0&&(d=Xu(f,e,l,s,n,d)),s=0):s&&(m.type==="data"||m.type==="tableDelimiterMarker"||m.type==="tableDelimiterFiller")&&(l[3]=n)}for(c!==0&&f1(f,e,c,u,h),f.consume(e.events),n=-1;++n<e.events.length;){const p=e.events[n];p[0]==="enter"&&p[1].type==="table"&&(p[1]._align=v$(e.events,n))}return t}function Xu(t,e,n,r,s,i){const l=r===1?"tableHeader":r===2?"tableDelimiter":"tableData",o="tableContent";n[0]!==0&&(i.end=Object.assign({},Vl(e.events,n[0])),t.add(n[0],0,[["exit",i,e]]));const c=Vl(e.events,n[1]);if(i={type:l,start:Object.assign({},c),end:Object.assign({},c)},t.add(n[1],0,[["enter",i,e]]),n[2]!==0){const u=Vl(e.events,n[2]),h=Vl(e.events,n[3]),d={type:o,start:Object.assign({},u),end:Object.assign({},h)};if(t.add(n[2],0,[["enter",d,e]]),r!==2){const f=e.events[n[2]],p=e.events[n[3]];if(f[1].end=Object.assign({},p[1].end),f[1].type="chunkText",f[1].contentType="text",n[3]>n[2]+1){const m=n[2]+1,x=n[3]-n[2]-1;t.add(m,x,[])}}t.add(n[3]+1,0,[["exit",d,e]])}return s!==void 0&&(i.end=Object.assign({},Vl(e.events,s)),t.add(s,0,[["exit",i,e]]),i=void 0),i}function f1(t,e,n,r,s){const i=[],l=Vl(e.events,n);s&&(s.end=Object.assign({},l),i.push(["exit",s,e])),r.end=Object.assign({},l),i.push(["exit",r,e]),t.add(n+1,0,i)}function Vl(t,e){const n=t[e],r=n[0]==="enter"?"start":"end";return n[1][r]}const S$={name:"tasklistCheck",tokenize:C$};function N$(){return{text:{91:S$}}}function C$(t,e,n){const r=this;return s;function s(c){return r.previous!==null||!r._gfmTasklistFirstContentOfListItem?n(c):(t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),i)}function i(c){return ut(c)?(t.enter("taskListCheckValueUnchecked"),t.consume(c),t.exit("taskListCheckValueUnchecked"),l):c===88||c===120?(t.enter("taskListCheckValueChecked"),t.consume(c),t.exit("taskListCheckValueChecked"),l):n(c)}function l(c){return c===93?(t.enter("taskListCheckMarker"),t.consume(c),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),o):n(c)}function o(c){return Te(c)?e(c):He(c)?t.check({tokenize:A$},e,n)(c):n(c)}}function A$(t,e,n){return Qe(t,r,"whitespace");function r(s){return s===null?n(s):e(s)}}function E$(t){return hC([Z8(),c$(),x$(t),w$(),N$()])}const P$={};function _$(t){const e=this,n=t||P$,r=e.data(),s=r.micromarkExtensions||(r.micromarkExtensions=[]),i=r.fromMarkdownExtensions||(r.fromMarkdownExtensions=[]),l=r.toMarkdownExtensions||(r.toMarkdownExtensions=[]);s.push(E$(n)),i.push(G8()),l.push(X8(n))}const Ju=43200,p1=1440,m1=Symbol.for("constructDateFrom");function sy(t,e){return typeof t=="function"?t(e):t&&typeof t=="object"&&m1 in t?t[m1](e):t instanceof Date?new t.constructor(e):new Date(e)}function Ii(t,e){return sy(t,t)}let M$={};function T$(){return M$}function g1(t){const e=Ii(t),n=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return n.setUTCFullYear(e.getFullYear()),+t-+n}function iy(t,...e){const n=sy.bind(null,t||e.find(r=>typeof r=="object"));return e.map(n)}function Pd(t,e){const n=+Ii(t)-+Ii(e);return n<0?-1:n>0?1:n}function R$(t){return sy(t,Date.now())}function D$(t,e,n){const[r,s]=iy(n==null?void 0:n.in,t,e),i=r.getFullYear()-s.getFullYear(),l=r.getMonth()-s.getMonth();return i*12+l}function L$(t){return e=>{const r=(t?Math[t]:Math.trunc)(e);return r===0?0:r}}function O$(t,e){return+Ii(t)-+Ii(e)}function I$(t,e){const n=Ii(t);return n.setHours(23,59,59,999),n}function F$(t,e){const n=Ii(t),r=n.getMonth();return n.setFullYear(n.getFullYear(),r+1,0),n.setHours(23,59,59,999),n}function B$(t,e){const n=Ii(t);return+I$(n)==+F$(n)}function z$(t,e,n){const[r,s,i]=iy(n==null?void 0:n.in,t,t,e),l=Pd(s,i),o=Math.abs(D$(s,i));if(o<1)return 0;s.getMonth()===1&&s.getDate()>27&&s.setDate(30),s.setMonth(s.getMonth()-l*o);let c=Pd(s,i)===-l;B$(r)&&o===1&&Pd(r,i)===1&&(c=!1);const u=l*(o-+c);return u===0?0:u}function $$(t,e,n){const r=O$(t,e)/1e3;return L$(n==null?void 0:n.roundingMethod)(r)}const U$={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},H$=(t,e,n)=>{let r;const s=U$[t];return typeof s=="string"?r=s:e===1?r=s.one:r=s.other.replace("{{count}}",e.toString()),n!=null&&n.addSuffix?n.comparison&&n.comparison>0?"in "+r:r+" ago":r};function Op(t){return(e={})=>{const n=e.width?String(e.width):t.defaultWidth;return t.formats[n]||t.formats[t.defaultWidth]}}const q$={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},V$={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},W$={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},K$={date:Op({formats:q$,defaultWidth:"full"}),time:Op({formats:V$,defaultWidth:"full"}),dateTime:Op({formats:W$,defaultWidth:"full"})},Q$={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},G$=(t,e,n,r)=>Q$[t];function Ao(t){return(e,n)=>{const r=n!=null&&n.context?String(n.context):"standalone";let s;if(r==="formatting"&&t.formattingValues){const l=t.defaultFormattingWidth||t.defaultWidth,o=n!=null&&n.width?String(n.width):l;s=t.formattingValues[o]||t.formattingValues[l]}else{const l=t.defaultWidth,o=n!=null&&n.width?String(n.width):t.defaultWidth;s=t.values[o]||t.values[l]}const i=t.argumentCallback?t.argumentCallback(e):e;return s[i]}}const X$={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},J$={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Y$={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Z$={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},e7={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},t7={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},n7=(t,e)=>{const n=Number(t),r=n%100;if(r>20||r<10)switch(r%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd"}return n+"th"},r7={ordinalNumber:n7,era:Ao({values:X$,defaultWidth:"wide"}),quarter:Ao({values:J$,defaultWidth:"wide",argumentCallback:t=>t-1}),month:Ao({values:Y$,defaultWidth:"wide"}),day:Ao({values:Z$,defaultWidth:"wide"}),dayPeriod:Ao({values:e7,defaultWidth:"wide",formattingValues:t7,defaultFormattingWidth:"wide"})};function Eo(t){return(e,n={})=>{const r=n.width,s=r&&t.matchPatterns[r]||t.matchPatterns[t.defaultMatchWidth],i=e.match(s);if(!i)return null;const l=i[0],o=r&&t.parsePatterns[r]||t.parsePatterns[t.defaultParseWidth],c=Array.isArray(o)?i7(o,d=>d.test(l)):s7(o,d=>d.test(l));let u;u=t.valueCallback?t.valueCallback(c):c,u=n.valueCallback?n.valueCallback(u):u;const h=e.slice(l.length);return{value:u,rest:h}}}function s7(t,e){for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&e(t[n]))return n}function i7(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return n}function l7(t){return(e,n={})=>{const r=e.match(t.matchPattern);if(!r)return null;const s=r[0],i=e.match(t.parsePattern);if(!i)return null;let l=t.valueCallback?t.valueCallback(i[0]):i[0];l=n.valueCallback?n.valueCallback(l):l;const o=e.slice(s.length);return{value:l,rest:o}}}const a7=/^(\d+)(th|st|nd|rd)?/i,o7=/\d+/i,c7={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},u7={any:[/^b/i,/^(a|c)/i]},d7={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},h7={any:[/1/i,/2/i,/3/i,/4/i]},f7={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},p7={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},m7={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},g7={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},x7={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},y7={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},b7={ordinalNumber:l7({matchPattern:a7,parsePattern:o7,valueCallback:t=>parseInt(t,10)}),era:Eo({matchPatterns:c7,defaultMatchWidth:"wide",parsePatterns:u7,defaultParseWidth:"any"}),quarter:Eo({matchPatterns:d7,defaultMatchWidth:"wide",parsePatterns:h7,defaultParseWidth:"any",valueCallback:t=>t+1}),month:Eo({matchPatterns:f7,defaultMatchWidth:"wide",parsePatterns:p7,defaultParseWidth:"any"}),day:Eo({matchPatterns:m7,defaultMatchWidth:"wide",parsePatterns:g7,defaultParseWidth:"any"}),dayPeriod:Eo({matchPatterns:x7,defaultMatchWidth:"any",parsePatterns:y7,defaultParseWidth:"any"})},v7={code:"en-US",formatDistance:H$,formatLong:K$,formatRelative:G$,localize:r7,match:b7,options:{weekStartsOn:0,firstWeekContainsDate:1}};function w7(t,e,n){const r=T$(),s=(n==null?void 0:n.locale)??r.locale??v7,i=2520,l=Pd(t,e);if(isNaN(l))throw new RangeError("Invalid time value");const o=Object.assign({},n,{addSuffix:n==null?void 0:n.addSuffix,comparison:l}),[c,u]=iy(n==null?void 0:n.in,...l>0?[e,t]:[t,e]),h=$$(u,c),d=(g1(u)-g1(c))/1e3,f=Math.round((h-d)/60);let p;if(f<2)return n!=null&&n.includeSeconds?h<5?s.formatDistance("lessThanXSeconds",5,o):h<10?s.formatDistance("lessThanXSeconds",10,o):h<20?s.formatDistance("lessThanXSeconds",20,o):h<40?s.formatDistance("halfAMinute",0,o):h<60?s.formatDistance("lessThanXMinutes",1,o):s.formatDistance("xMinutes",1,o):f===0?s.formatDistance("lessThanXMinutes",1,o):s.formatDistance("xMinutes",f,o);if(f<45)return s.formatDistance("xMinutes",f,o);if(f<90)return s.formatDistance("aboutXHours",1,o);if(f<p1){const m=Math.round(f/60);return s.formatDistance("aboutXHours",m,o)}else{if(f<i)return s.formatDistance("xDays",1,o);if(f<Ju){const m=Math.round(f/p1);return s.formatDistance("xDays",m,o)}else if(f<Ju*2)return p=Math.round(f/Ju),s.formatDistance("aboutXMonths",p,o)}if(p=z$(u,c),p<12){const m=Math.round(f/Ju);return s.formatDistance("xMonths",m,o)}else{const m=p%12,x=Math.trunc(p/12);return m<3?s.formatDistance("aboutXYears",x,o):m<9?s.formatDistance("overXYears",x,o):s.formatDistance("almostXYears",x+1,o)}}function rx(t,e){return w7(t,R$(t),e)}class k7{constructor(){Rt(this,"ws",null);Rt(this,"projectId",null);Rt(this,"channelId",null);Rt(this,"listeners",new Map);Rt(this,"isConnecting",!1)}on(e,n){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(n)}off(e,n){const r=this.listeners.get(e);r&&(r.delete(n),r.size===0&&this.listeners.delete(e))}emit(e,n){const r=this.listeners.get(e);r&&r.forEach(s=>{try{s(n)}catch(i){console.error("discussionWebsocket listener error",i)}})}handleMessage(e){try{const n=JSON.parse(e);if(!n||typeof n.type!="string")return;this.emit(n.type,n)}catch(n){console.error("Failed to parse discussion websocket payload",n)}}async connect(e,n,r){if(this.isConnecting||this.ws&&this.ws.readyState===WebSocket.OPEN&&this.projectId===e&&this.channelId===n)return;this.disconnect(),this.isConnecting=!0,this.projectId=e,this.channelId=n;const s=encodeURIComponent(r||"demo"),i=typeof window<"u"?window.location.origin:"http://localhost:3000",o=(kl||i).replace(/^http/,"ws"),c=i.replace(/^http/,"ws"),u=`/api/v1/projects/${e}/discussion/channels/${n}/ws?token=${s}`,h=Array.from(new Set([`${o}${u}`,`${c}${u}`,`ws://localhost:8000${u}`]));let d=!1;await new Promise((f,p)=>{let m=0;const x=()=>{const g=h[m];try{this.ws=new WebSocket(g)}catch(y){v(y instanceof Error?y:new Error("WebSocket init failed"));return}this.ws.onopen=()=>{d=!0,this.isConnecting=!1,f()},this.ws.onmessage=y=>{typeof y.data=="string"&&this.handleMessage(y.data)},this.ws.onerror=y=>{this.emit("ws_error",{event:y}),v(new Error("WebSocket error"))},this.ws.onclose=y=>{this.emit("ws_closed",{code:y.code,reason:y.reason}),d?this.cleanupSocket():v(new Error(`WebSocket closed: ${y.code}`))}},v=g=>{if(!d){if(m<h.length-1){m+=1,x();return}this.cleanupSocket(),this.isConnecting=!1,p(g)}};x()})}disconnect(){if(this.isConnecting=!1,this.ws){this.ws.onopen=null,this.ws.onclose=null,this.ws.onerror=null,this.ws.onmessage=null;try{this.ws.close()}catch(e){console.error("Error closing discussion websocket",e)}}this.cleanupSocket()}cleanupSocket(){this.ws=null}getConnectionInfo(){var e;return{projectId:this.projectId,channelId:this.channelId,connected:((e=this.ws)==null?void 0:e.readyState)===WebSocket.OPEN}}}const Po=new k7,j7=({onSend:t,placeholder:e="Type your message...",replyingTo:n,onCancelReply:r,editingMessage:s,onCancelEdit:i,isSubmitting:l=!1,reasoningEnabled:o=!1,onToggleReasoning:c,reasoningPending:u=!1})=>{const[h,d]=w.useState(""),f=w.useRef(null);w.useEffect(()=>{var x;s?(d(s.content),(x=f.current)==null||x.focus()):d("")},[s]),w.useEffect(()=>{f.current&&(f.current.style.height="auto",f.current.style.height=`${f.current.scrollHeight}px`)},[h]),w.useEffect(()=>{!l&&f.current&&f.current.focus()},[l]);const p=x=>{x.preventDefault();const v=h.trim();!v||l||(t(v),d(""),f.current&&(f.current.style.height="auto",f.current.focus()))},m=x=>{x.key==="Enter"&&!x.shiftKey&&(x.preventDefault(),p(x))};return a.jsxs("div",{className:"border-t border-gray-200 bg-white p-4",children:[(n||s)&&a.jsxs("div",{className:"mb-2 flex items-center justify-between rounded-lg bg-gray-50 px-3 py-2",children:[a.jsx("span",{className:"text-sm text-gray-600",children:s?a.jsx(a.Fragment,{children:"Editing message"}):a.jsxs(a.Fragment,{children:["Replying to ",a.jsx("span",{className:"font-medium",children:n==null?void 0:n.userName})]})}),a.jsx("button",{onClick:s?i:r,className:"text-gray-400 hover:text-gray-600",children:a.jsx(Jt,{className:"h-4 w-4"})})]}),a.jsxs("form",{onSubmit:p,className:"flex gap-2",children:[a.jsx("textarea",{ref:f,value:h,onChange:x=>d(x.target.value),onKeyDown:m,placeholder:e,disabled:l,rows:1,className:"min-h-[2.5rem] max-h-32 flex-1 resize-none rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 disabled:bg-gray-50 disabled:text-gray-500"}),c&&a.jsx("button",{type:"button",onClick:c,disabled:l||u,className:`flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg border border-gray-200 bg-white transition ${o?"shadow-[0_0_0_1px_rgba(251,191,36,0.35)]":"hover:bg-gray-50"}`,title:"Toggle reasoning mode for Scholar AI",children:u?a.jsx("span",{className:"text-xs",children:""}):a.jsx(Ec,{className:`h-4 w-4 transition ${o?"text-amber-500":"text-gray-500"}`})}),a.jsx("button",{type:"submit",disabled:!h.trim()||l,className:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:a.jsx(oS,{className:"h-4 w-4"})})]}),a.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:["Press ",a.jsx("kbd",{className:"rounded bg-gray-100 px-1 py-0.5",children:"Enter"})," to send, ",a.jsx("kbd",{className:"rounded bg-gray-100 px-1 py-0.5",children:"Shift+Enter"})," for new line. Start with ",a.jsx("span",{className:"font-semibold",children:"/"})," to ask Scholar AI; use the bulb icon to enable reasoning when needed."]})]})};function rA(t){var e,n,r="";if(typeof t=="string"||typeof t=="number")r+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(e=0;e<s;e++)t[e]&&(n=rA(t[e]))&&(r&&(r+=" "),r+=n)}else for(n in t)t[n]&&(r&&(r+=" "),r+=n);return r}function _i(){for(var t,e,n=0,r="",s=arguments.length;n<s;n++)(t=arguments[n])&&(e=rA(t))&&(r&&(r+=" "),r+=e);return r}const x1=({message:t,currentUserId:e,onReply:n,onEdit:r,onDelete:s,isReply:i=!1})=>{const[l,o]=w.useState(!1),c=t.user_id===e,u=c&&!t.is_deleted,h=t.user.name||t.user.email.split("@")[0],d=rx(new Date(t.created_at),{addSuffix:!0});return a.jsx("div",{className:_i("group relative",i?"ml-12 mt-3":"mt-4"),children:a.jsxs("div",{className:"flex gap-3",children:[a.jsx("div",{className:"flex-shrink-0",children:a.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-indigo-100 text-sm font-medium text-indigo-600",children:h.charAt(0).toUpperCase()})}),a.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[a.jsxs("div",{className:"mb-1 flex items-center gap-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:h}),a.jsx("span",{className:"text-xs text-gray-500",children:d}),t.is_edited&&a.jsx("span",{className:"text-xs text-gray-400",children:"(edited)"})]}),a.jsx("div",{className:_i("inline-block max-w-fit rounded-2xl px-4 py-2 transition",c?"bg-indigo-100 shadow-sm ring-1 ring-indigo-200":"bg-gray-50 ring-1 ring-gray-200"),children:a.jsx("div",{className:_i("whitespace-pre-wrap break-words text-sm",c?"text-indigo-900":"text-gray-700"),children:t.content})}),a.jsxs("div",{className:"mt-1 flex items-center gap-3",children:[!t.is_deleted&&n&&a.jsxs("button",{onClick:()=>n(t),className:"inline-flex items-center gap-1 text-xs text-gray-500 hover:text-indigo-600",children:[a.jsx(fT,{className:"h-3 w-3"}),"Reply"]}),t.reply_count>0&&a.jsxs("span",{className:"text-xs text-gray-500",children:[t.reply_count," ",t.reply_count===1?"reply":"replies"]})]})]}),a.jsxs("div",{className:"relative flex-shrink-0",children:[a.jsx("button",{onClick:()=>o(!l),className:"rounded-full p-1 text-gray-400 opacity-0 transition group-hover:opacity-100 hover:bg-gray-100 hover:text-gray-600",children:a.jsx(f5,{className:"h-4 w-4"})}),l&&a.jsxs("div",{className:"absolute right-0 top-6 z-10 w-32 rounded-lg border border-gray-200 bg-white shadow-lg",children:[u&&r&&a.jsxs("button",{onClick:()=>{r(t),o(!1)},className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[a.jsx(sT,{className:"h-3 w-3"}),"Edit"]}),s&&a.jsxs("button",{onClick:()=>{s(t.id),o(!1)},className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[a.jsx(nr,{className:"h-3 w-3"}),"Delete"]})]})]})]})})},S7=({thread:t,currentUserId:e,onReply:n,onEdit:r,onDelete:s})=>{const[i,l]=w.useState(!0),o=t.replies&&t.replies.length>0;return a.jsxs("div",{className:"border-b border-gray-100 pb-4 last:border-b-0",children:[a.jsx(x1,{message:t.message,currentUserId:e,onReply:n,onEdit:r,onDelete:s}),o&&a.jsxs("div",{className:"mt-2",children:[a.jsx("button",{onClick:()=>l(!i),className:"ml-12 inline-flex items-center gap-1 text-xs font-medium text-indigo-600 hover:text-indigo-700",children:i?a.jsxs(a.Fragment,{children:[a.jsx(GM,{className:"h-3 w-3"}),"Hide replies (",t.replies.length,")"]}):a.jsxs(a.Fragment,{children:[a.jsx(Qh,{className:"h-3 w-3"}),"Show replies (",t.replies.length,")"]})}),i&&a.jsx("div",{className:"space-y-2",children:t.replies.map(c=>a.jsx(x1,{message:c,currentUserId:e,onEdit:r,onDelete:s,isReply:!0},c.id))})]})]})},N7=({channels:t,activeChannelId:e,onSelectChannel:n,onCreateChannel:r,isCreating:s=!1,onArchiveToggle:i})=>a.jsxs("aside",{className:"flex h-full w-60 flex-col border-r border-gray-200 bg-gray-50",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-4 py-3",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ma,{className:"h-4 w-4 text-indigo-600"}),a.jsx("span",{className:"text-sm font-semibold text-gray-800",children:"Channels"})]}),a.jsxs("button",{type:"button",onClick:r,disabled:s,className:"inline-flex items-center gap-1 rounded-full border border-indigo-200 px-3 py-1 text-xs font-medium text-indigo-600 transition hover:bg-indigo-50 disabled:cursor-not-allowed disabled:opacity-60",children:[a.jsx(xn,{className:"h-3.5 w-3.5"}),"New"]})]}),a.jsx("div",{className:"flex-1 overflow-y-auto",children:t.length===0?a.jsx("div",{className:"px-4 py-6 text-center text-xs text-gray-500",children:"No channels yet. Create one to get started."}):a.jsx("ul",{className:"space-y-1 px-2 py-3",children:t.map(l=>{var h,d;const o=l.id===e,c=((h=l.stats)==null?void 0:h.total_threads)??0,u=((d=l.stats)==null?void 0:d.total_messages)??0;return a.jsx("li",{children:a.jsx("div",{className:_i("group relative rounded-xl transition",o?"bg-white shadow-sm ring-1 ring-indigo-200":"hover:bg-white"),children:a.jsxs("button",{type:"button",onClick:()=>n(l.id),className:"w-full px-3 py-3 text-left",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:l.name}),a.jsxs("div",{className:"flex items-center gap-2",children:[l.is_default&&a.jsx("span",{className:"text-[10px] uppercase tracking-wide text-indigo-500",children:"Default"}),i&&!l.is_default&&a.jsx("button",{type:"button",className:_i("rounded-full p-1 text-gray-400 transition hover:bg-gray-200 hover:text-gray-700",o?"inline-flex":"hidden group-hover:inline-flex"),onClick:f=>{f.stopPropagation(),i(l)},title:l.is_archived?"Unarchive channel":"Archive channel","aria-label":l.is_archived?`Unarchive ${l.name}`:`Archive ${l.name}`,children:l.is_archived?a.jsx(Jo,{className:"h-4 w-4"}):a.jsx(EM,{className:"h-4 w-4"})})]})]}),l.description&&a.jsx("p",{className:"mt-1 line-clamp-2 text-xs text-gray-500",children:l.description}),a.jsxs("div",{className:"mt-2 flex items-center gap-3 text-[11px] text-gray-500",children:[a.jsxs("span",{children:[c," ",c===1?"thread":"threads"]}),a.jsx("span",{children:""}),a.jsxs("span",{children:[u," ",u===1?"message":"messages"]}),l.is_archived&&a.jsx("span",{className:"text-[10px] uppercase tracking-wide text-amber-500",children:"Archived"})]})]})})},l.id)})})})]}),ic={paper:"Project paper",reference:"Related paper",meeting:"Transcript"},C7=t=>{switch(t){case"paper":return a.jsx(ln,{className:"h-4 w-4 text-indigo-500"});case"reference":return a.jsx(FM,{className:"h-4 w-4 text-amber-500"});case"meeting":default:return a.jsx(hs,{className:"h-4 w-4 text-emerald-500"})}},y1=t=>{var e;return((e=t.details)==null?void 0:e.title)||(t.resource_type==="paper"?"Research paper":t.resource_type==="reference"?"Related paper":"Transcript")},b1=[{label:ic.paper,value:"paper"},{label:ic.reference,value:"reference"},{label:ic.meeting,value:"meeting"}],Pl=(t,e=280)=>t.length<=e?t:`${t.slice(0,e-3).trimEnd()}...`,A7=t=>t?t.map(e=>({id:e.id,label:e.title||"Untitled paper",subtitle:e.summary?Pl(e.summary):e.abstract?Pl(e.abstract):void 0,meta:[e.status,e.year?String(e.year):void 0].filter(Boolean)})):[],E7=t=>t?t.filter(e=>!!e.reference).map(e=>{const n=e.reference,r=[];return n.year&&r.push(String(n.year)),n.source&&r.push(n.source),{id:e.reference_id,label:n.title||"Reference",subtitle:n.summary?Pl(n.summary):n.abstract?Pl(n.abstract):void 0,meta:r}}):[],P7=t=>t?t.map(e=>{const n=e.created_at?new Date(e.created_at):void 0,r=e.summary?e.summary:n?`Meeting on ${n.toLocaleDateString()}`:"Meeting",s=[];return s.push(e.status),e.transcript&&s.push("Transcript available"),{id:e.id,label:r,subtitle:e.summary?Pl(e.summary):void 0,meta:s}}):[],v1=t=>{const e=t.details||{},n=[];return t.resource_type==="paper"?e.status&&n.push(e.status):t.resource_type==="reference"&&e.source&&n.push(e.source),n},_7=({projectId:t,loading:e,error:n,resources:r,onCreateResource:s,onRemoveResource:i,isSubmitting:l=!1,isCollapsed:o=!1,onToggleCollapse:c})=>{const[u,h]=w.useState(!1),[d,f]=w.useState("paper"),[p,m]=w.useState([]),[x,v]=w.useState("");w.useEffect(()=>{o&&(h(!1),m([]),v(""))},[o]);const g=Tt({queryKey:["projectDiscussionPapers",t],queryFn:async()=>(await rt.getPapers({projectId:t,limit:200})).data.papers,enabled:!!t,staleTime:6e4}),y=Tt({queryKey:["projectDiscussionReferences",t],queryFn:async()=>(await An.list(t,{status:"approved"})).data.references,enabled:!!t,staleTime:6e4}),b=Tt({queryKey:["projectDiscussionMeetings",t],queryFn:async()=>(await Hl.listMeetings(t)).data.meetings,enabled:!!t,staleTime:6e4}),k=w.useMemo(()=>d==="paper"?A7(g.data):d==="reference"?E7(y.data):P7(b.data),[d,g.data,y.data,b.data]),S=w.useMemo(()=>{if(!p.length)return[];const q=new Set(p);return k.filter(F=>q.has(F.id))},[k,p]),j=w.useMemo(()=>{const q={paper:new Set,reference:new Set,meeting:new Set};return r.forEach(F=>{F.paper_id&&q.paper.add(F.paper_id),F.reference_id&&q.reference.add(F.reference_id),F.meeting_id&&q.meeting.add(F.meeting_id)}),q},[r]),E=d==="paper"?g.isLoading:d==="reference"?y.isLoading:b.isLoading,A=d==="paper"?g.error:d==="reference"?y.error:b.error,T=w.useMemo(()=>l||E?!1:p.length>0,[l,E,p]),N=q=>{q.preventDefault(),T&&(p.forEach(F=>{const V={resource_type:d};d==="paper"?V.paper_id=F:d==="reference"?V.reference_id=F:d==="meeting"&&(V.meeting_id=F),s(V)}),m([]),h(!1))},I=q=>{window.confirm("Remove this resource from the channel?")&&i(q)},R=ic[d],C=w.useMemo(()=>{const q=x.trim().toLowerCase();return q?r.filter(F=>{var Y,L;const V=y1(F).toLowerCase(),P=(L=(Y=F.details)==null?void 0:Y.summary)==null?void 0:L.toLowerCase(),H=v1(F).join(" ").toLowerCase();return V.includes(q)||(P?P.includes(q):!1)||H.includes(q)}):r},[x,r]),_=w.useMemo(()=>{const q={paper:[],reference:[],meeting:[]};return C.forEach(F=>{var V;(V=q[F.resource_type])==null||V.push(F)}),q},[C]),M=C.length>0,z=q=>{var ge,Ce;const F=q.resource_type==="reference",V=F?[]:v1(q),P=y1(q).trim(),H=(Ce=(ge=q.details)==null?void 0:ge.summary)==null?void 0:Ce.trim(),Y=P.toLowerCase(),L=H==null?void 0:H.toLowerCase(),Se=!F&&!!H&&L!==Y,we=Pl(P,80);return a.jsxs("li",{className:"flex items-start gap-2.5 rounded-lg border border-gray-100 bg-gray-50/70 p-2.5 text-[13px] text-gray-700",children:[a.jsx("div",{className:"mt-0.5 flex h-7 w-7 items-center justify-center rounded-full bg-white shadow",children:C7(q.resource_type)}),a.jsxs("div",{className:"min-w-0 flex-1 space-y-1",children:[a.jsx("p",{className:"text-[13px] font-semibold text-gray-900",title:P,children:we}),Se&&H&&a.jsx("p",{className:"line-clamp-2 text-[11px] leading-relaxed text-gray-500",children:Pl(H,140)}),!F&&a.jsxs("div",{className:"flex flex-wrap items-center gap-1.5 text-[10px] uppercase tracking-wide text-gray-400",children:[a.jsx("span",{className:"font-medium text-indigo-500/90",children:ic[q.resource_type]}),V.map(Ie=>a.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-[10px] text-gray-500",children:Ie},Ie))]})]}),a.jsx("button",{type:"button",onClick:()=>I(q.id),className:"rounded-full p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-600",title:"Unlink resource",children:a.jsx(Jt,{className:"h-4 w-4"})})]},q.id)};return a.jsxs("div",{className:"flex flex-col rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[c&&a.jsx("button",{type:"button",onClick:c,className:"rounded-full border border-gray-200 p-1 text-gray-500 transition hover:bg-gray-100 hover:text-gray-700","aria-label":o?"Expand resources panel":"Collapse resources panel",children:a.jsx(Qh,{className:_i("h-4 w-4 transition-transform",o?"-rotate-90":"rotate-0")})}),a.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Channel resources"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[a.jsx("span",{children:r.length}),a.jsxs("button",{type:"button",onClick:()=>{o&&c&&c(),h(q=>!q),m([])},className:"inline-flex items-center gap-1 rounded-full border border-indigo-200 px-2.5 py-1 text-xs font-medium text-indigo-600 transition hover:bg-indigo-50",disabled:l,children:[a.jsx(xn,{className:"h-3.5 w-3.5"}),"Link"]})]})]}),!o&&a.jsxs("div",{className:"mt-3 space-y-3 overflow-y-auto max-h-72",children:[u&&a.jsxs("form",{className:"mb-4 space-y-3 rounded-lg border border-indigo-100 bg-indigo-50/40 p-3",onSubmit:N,children:[a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("label",{className:"text-xs font-medium uppercase tracking-wide text-gray-600",htmlFor:"resource-type",children:"Resource type"}),a.jsx("select",{id:"resource-type",value:d,onChange:q=>{const F=q.target.value;f(F),m([])},className:"rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",children:b1.map(q=>a.jsx("option",{value:q.value,children:q.label},q.value))})]}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("label",{className:"text-xs font-medium uppercase tracking-wide text-gray-600",htmlFor:"resource-value",children:R}),E?a.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-dashed border-gray-300 bg-white px-3 py-2 text-sm text-gray-500",children:[a.jsx(gt,{className:"h-4 w-4 animate-spin text-indigo-500"}),"Loading ",R.toLowerCase(),"s..."]}):A?a.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-2 text-xs text-red-700",children:["Unable to load ",R.toLowerCase(),"s."]}):k.length===0?a.jsxs("div",{className:"rounded-lg border border-dashed border-gray-300 bg-white px-3 py-2 text-xs text-gray-500",children:["No ",R.toLowerCase(),"s available for this project."]}):a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-wide text-gray-400",children:[a.jsxs("span",{children:["Select ",R.toLowerCase(),"s"]}),p.length>0&&a.jsxs("span",{className:"rounded-full bg-indigo-50 px-2 py-0.5 text-[10px] font-medium text-indigo-600",children:[p.length," selected"]})]}),a.jsx("div",{className:"max-h-48 space-y-1 overflow-y-auto rounded-lg border border-gray-200 bg-white p-1",children:k.map(q=>{const V=j[d].has(q.id),P=p.includes(q.id);return a.jsxs("label",{className:_i("flex cursor-pointer items-start gap-2 rounded-md px-2 py-1.5 text-sm transition",V?"bg-gray-100 text-gray-400":P?"bg-indigo-50 text-indigo-700":"hover:bg-gray-100"),children:[a.jsx("input",{type:"checkbox",className:"mt-0.5 h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500",disabled:V,checked:P,onChange:()=>{m(H=>H.includes(q.id)?H.filter(Y=>Y!==q.id):[...H,q.id])}}),a.jsxs("div",{className:"min-w-0 flex-1",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsx("span",{className:"font-medium",children:q.label}),V&&a.jsx("span",{className:"text-[10px] uppercase tracking-wide text-gray-400",children:"Linked"})]}),q.subtitle&&a.jsx("p",{className:"mt-1 line-clamp-2 text-[11px] text-gray-500",children:q.subtitle}),q.meta&&q.meta.length>0&&a.jsx("p",{className:"mt-1 text-[10px] uppercase tracking-wide text-gray-400",children:q.meta.join("  ")})]})]},q.id)})})]}),S.length>0&&a.jsxs("div",{className:"space-y-1 text-xs text-gray-500",children:[a.jsx("p",{className:"font-medium text-gray-600",children:"Selected"}),a.jsx("ul",{className:"space-y-1",children:S.map(q=>a.jsxs("li",{className:"flex items-center justify-between gap-2 rounded-md bg-gray-100 px-2 py-1",children:[a.jsx("span",{className:"truncate text-[11px] text-gray-600",children:q.label}),a.jsx("button",{type:"button",onClick:()=>m(F=>F.filter(V=>V!==q.id)),className:"rounded-full p-1 text-gray-400 hover:bg-gray-200 hover:text-gray-600","aria-label":`Remove ${q.label}`,children:a.jsx(Jt,{className:"h-3.5 w-3.5"})})]},q.id))})]})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>{h(!1),m([])},className:"rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50",disabled:l,children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:!T,className:"inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-indigo-700 disabled:cursor-not-allowed disabled:bg-indigo-300",children:[l&&a.jsx(gt,{className:"h-4 w-4 animate-spin"}),"Link resource"]})]})]}),e&&a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx(gt,{className:"h-5 w-5 animate-spin text-indigo-500"})}),n&&!e&&a.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-xs text-red-700",children:"Unable to load channel resources."}),!e&&!n&&r.length===0&&a.jsx("div",{className:"rounded-lg border border-dashed border-gray-200 bg-gray-50 p-4 text-xs text-gray-500",children:"No linked resources yet. Attach project papers, related papers, or meeting transcripts to keep this conversation anchored."}),!e&&!n&&r.length>0&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"sticky top-0 z-10 bg-white pb-2",children:[a.jsx("label",{className:"mb-1 block text-[11px] font-medium uppercase tracking-wide text-gray-400",htmlFor:"channel-resource-filter",children:"Filter resources"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("input",{id:"channel-resource-filter",type:"search",value:x,onChange:q=>v(q.target.value),placeholder:"Search by title or summary",className:"flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"}),x.trim()&&a.jsx("button",{type:"button",onClick:()=>v(""),className:"rounded-lg border border-gray-200 px-2.5 py-1 text-xs font-medium text-gray-600 hover:bg-gray-100",children:"Clear"})]})]}),!M&&a.jsx("div",{className:"rounded-lg border border-dashed border-gray-200 bg-gray-50 p-4 text-xs text-gray-500",children:"No resources match your filter. Adjust the search to see more results."}),M&&a.jsx("div",{className:"space-y-4",children:b1.map(({value:q,label:F})=>{const V=_[q];return!V||V.length===0?null:a.jsxs("section",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-center justify-between text-[11px] uppercase tracking-wide text-gray-400",children:[a.jsx("span",{children:F}),a.jsx("span",{className:"rounded-full bg-gray-200 px-2 py-0.5 text-[10px] text-gray-600",children:V.length})]}),a.jsx("ul",{className:"space-y-3",children:V.map(P=>z(P))})]},q)})})]})]})]})},M7=t=>{switch(t){case"completed":return a.jsx(ZM,{className:"h-4 w-4 text-emerald-500"});case"in_progress":return a.jsx(l5,{className:"h-4 w-4 text-sky-500"});case"cancelled":return a.jsx(iS,{className:"h-4 w-4 text-rose-500"});case"open":default:return a.jsx(s5,{className:"h-4 w-4 text-gray-400"})}},T7=({tasks:t,loading:e,error:n,onCreateTask:r,onUpdateTask:s,onDeleteTask:i,allowCreate:l,defaultMessageId:o,isCollapsed:c=!1,onToggleCollapse:u})=>{const[h,d]=w.useState(!1),[f,p]=w.useState(""),[m,x]=w.useState("");w.useEffect(()=>{c&&d(!1)},[c]);const v=w.useMemo(()=>{const b=["open","in_progress","completed","cancelled"];return[...t].sort((k,S)=>b.indexOf(k.status)-b.indexOf(S.status))},[t]),g=b=>{if(b.preventDefault(),!f.trim()){alert("Task title is required.");return}r({title:f.trim(),description:m.trim()||void 0,message_id:o??void 0}),p(""),x(""),d(!1)},y=b=>{const k=["open","in_progress","completed","cancelled"],S=k.indexOf(b);return k[(S+1)%k.length]};return a.jsxs("div",{className:"flex flex-col rounded-xl border border-gray-200 bg-white p-4 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[u&&a.jsx("button",{type:"button",onClick:u,className:"rounded-full border border-gray-200 p-1 text-gray-500 transition hover:bg-gray-100 hover:text-gray-700","aria-label":c?"Expand tasks panel":"Collapse tasks panel",children:a.jsx(Qh,{className:_i("h-4 w-4 transition-transform",c?"-rotate-90":"rotate-0")})}),a.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Channel tasks"})]}),a.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500",children:[a.jsx("span",{children:t.length}),!c&&l&&a.jsxs("button",{type:"button",onClick:()=>d(b=>!b),className:"inline-flex items-center gap-1 rounded-full border border-indigo-200 px-3 py-1 text-xs font-medium text-indigo-600 transition hover:bg-indigo-50",children:[a.jsx(xn,{className:"h-3.5 w-3.5"}),"New task"]})]})]}),!c&&a.jsxs("div",{className:"mt-3 space-y-3 overflow-y-auto max-h-72",children:[e&&a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsx(gt,{className:"h-5 w-5 animate-spin text-indigo-500"})}),n&&!e&&a.jsx("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-xs text-red-700",children:"Unable to load channel tasks."}),!e&&!n&&t.length===0&&!h&&a.jsx("div",{className:"rounded-lg border border-dashed border-gray-200 bg-gray-50 p-4 text-xs text-gray-500",children:"No tasks yet. Track action items from this channel to keep the team aligned."}),h&&l&&a.jsxs("form",{className:"mb-4 space-y-3 rounded-lg border border-indigo-100 bg-indigo-50/40 p-3",onSubmit:g,children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"task-title",className:"text-xs font-medium uppercase tracking-wide text-gray-600",children:"Task title"}),a.jsx("input",{id:"task-title",type:"text",value:f,onChange:b=>p(b.target.value),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",maxLength:255,placeholder:"Capture the next action",required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"task-description",className:"text-xs font-medium uppercase tracking-wide text-gray-600",children:["Description ",a.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),a.jsx("textarea",{id:"task-description",value:m,onChange:b=>x(b.target.value),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",rows:3,maxLength:2e3,placeholder:"Add details or context for the assignee"})]}),a.jsxs("div",{className:"flex justify-end gap-2",children:[a.jsx("button",{type:"button",onClick:()=>d(!1),className:"rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50",children:"Cancel"}),a.jsx("button",{type:"submit",className:"inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-indigo-700",children:"Create task"})]})]}),!e&&!n&&v.length>0&&a.jsx("ul",{className:"space-y-3",children:v.map(b=>a.jsx("li",{className:"rounded-lg border border-gray-100 bg-gray-50/60 p-3",children:a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("button",{type:"button",onClick:()=>s(b.id,{status:y(b.status)}),className:"mt-0.5 rounded-full border border-gray-200 bg-white p-1 transition hover:bg-gray-100",title:"Advance status",children:M7(b.status)}),a.jsxs("div",{className:"min-w-0",children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:b.title}),b.description&&a.jsx("p",{className:"mt-1 text-xs text-gray-500",children:b.description}),a.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-[10px] uppercase tracking-wide text-gray-400",children:[a.jsxs("span",{children:["Status: ",b.status.replace("_"," ")]}),b.due_date&&a.jsxs("span",{children:["Due ",new Date(b.due_date).toLocaleDateString()]})]})]})]}),a.jsx("button",{type:"button",onClick:()=>i(b.id),className:"rounded-full p-1 text-gray-400 transition hover:bg-gray-100 hover:text-gray-600",title:"Delete task",children:a.jsx(iS,{className:"h-4 w-4"})})]})},b.id))})]})]})},sx=t=>t.replace(/<actions>[\s\S]*?<\/actions>/gi,"").replace(/<actions>[\s\S]*$/gi,"").trimEnd(),Yu=t=>{const e=new Map;return t.forEach(n=>{if(!n)return;const r=`${n.origin}:${n.origin_id}`.toLowerCase(),s=typeof n.label=="string"?n.label.trim():"";s&&e.set(r,s)}),e},Zu=(t,e)=>{if(!t)return"";const n=t.replace(/\[(resource|message):([^\]]+)\]/gi,(r,s,i)=>{const l=`${s}:${i}`.toLowerCase(),o=e.get(l);return o?`**${o}**`:""});return sx(n).replace(/[ \t]+$/gm,"").replace(/\n{3,}/g,`

`).trim()},_o=()=>typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,R7=()=>{const{project:t}=qr(),{user:e}=Ln(),n=qs(),r=w.useRef(null),s=w.useRef({}),i=w.useRef({}),l=`assistantHistory:${t.id}`,o=w.useCallback(B=>B?`${l}:${B}`:null,[l]),c=w.useCallback(B=>Array.isArray(B)?B.map(se=>{var Fe;if(!se||typeof se!="object")return null;const ee=se,le=ee.createdAt?new Date(ee.createdAt):new Date,Pe=ee.completedAt?new Date(ee.completedAt):void 0;return{id:ee.id||_o(),question:ee.question||"",response:ee.response||{message:"",citations:[],reasoning_used:!1,model:"",usage:void 0,suggested_actions:[]},createdAt:le,completedAt:Pe,appliedActions:ee.appliedActions||[],status:ee.status==="streaming"?"complete":ee.status||"complete",displayMessage:ee.displayMessage||((Fe=ee.response)==null?void 0:Fe.message)||"",author:ee.author}}).filter(Boolean):[],[]),[u,h]=w.useState(null),[d,f]=w.useState(null),[p,m]=w.useState(null),[x,v]=w.useState(!1),[g,y]=w.useState(""),[b,k]=w.useState(""),[S,j]=w.useState(!1),[E,A]=w.useState([]),[T,N]=w.useState(null),I=w.useMemo(()=>{if(!e)return"You";const B=[e.first_name,e.last_name].filter(Boolean).join(" ").trim();return B||e.email||"You"},[e==null?void 0:e.first_name,e==null?void 0:e.last_name,e==null?void 0:e.email]),R=w.useCallback(B=>{var ee,le,Pe;if(console.log(" resolveAuthorLabel called with:",JSON.stringify(B,null,2)),!B)return"Someone";if(!!(B.id&&(e!=null&&e.id)&&B.id===e.id))return console.log(" Same user, returning:",I),I||"You";if(typeof B.name=="string"&&B.name.trim())return console.log(" String name, returning:",B.name.trim()),B.name.trim();if(B.name&&typeof B.name=="object"){const Fe=B.name;if(console.log(" Name object:",Fe),(ee=Fe.display)!=null&&ee.trim())return console.log(" Using display field:",Fe.display.trim()),Fe.display.trim();const Ee=((le=Fe.first)==null?void 0:le.trim())||"",Ue=((Pe=Fe.last)==null?void 0:Pe.trim())||"",it=[Ee,Ue].filter(Boolean).join(" ");if(console.log(" Combined first+last:",it,"(first:",Ee,"last:",Ue,")"),Ee||Ue)return it}return console.log(" Fallback to Someone"),"Someone"},[e==null?void 0:e.id,I]),C=w.useCallback((B,se)=>{s.current[B]&&(window.clearTimeout(s.current[B]),delete s.current[B]);const ee=se||"";if(!ee){A(Fe=>Fe.map(Ee=>Ee.id===B?{...Ee,displayMessage:"",status:"complete",completedAt:Ee.completedAt??new Date}:Ee));return}let le=0;const Pe=()=>{le+=1;const Fe=ee.slice(0,le);if(A(Ee=>Ee.map(Ue=>Ue.id===B?{...Ue,displayMessage:Fe,status:le>=ee.length?"complete":"streaming",completedAt:le>=ee.length?Ue.completedAt??new Date:Ue.completedAt}:Ue)),le<ee.length){const Ee=Math.max(15,Math.min(60,Math.floor(1e3/ee.length)));s.current[B]=window.setTimeout(Pe,Ee)}else delete s.current[B]};A(Fe=>Fe.map(Ee=>Ee.id===B?{...Ee,displayMessage:"",status:"streaming",completedAt:Ee.completedAt}:Ee)),s.current[B]=window.setTimeout(Pe,40)},[A]);w.useEffect(()=>()=>{Object.values(s.current).forEach(B=>window.clearTimeout(B)),s.current={},i.current={}},[]);const _=Tt({queryKey:["projectDiscussionChannels",t.id],queryFn:async()=>(await dn.listChannels(t.id)).data}),M=Tt({queryKey:["projectDiscussionAssistantHistory",t.id,p],queryFn:async()=>p?(await dn.listAssistantHistory(t.id,p)).data:[],enabled:!!p}),z=w.useMemo(()=>M.data?M.data.map(B=>{const se=B.created_at?new Date(B.created_at):new Date,ee=B.response,le=Yu(ee.citations);return{id:B.id,question:B.question,response:ee,createdAt:se,completedAt:se,appliedActions:[],status:"complete",displayMessage:Zu(ee.message,le),author:B.author??void 0}}):[],[M.data]);w.useEffect(()=>{N(null)},[p]),w.useEffect(()=>{p&&A(B=>{const se=new Set(z.map(Pe=>Pe.id)),ee=B.filter(Pe=>!se.has(Pe.id));return[...z,...ee].sort((Pe,Fe)=>Pe.createdAt.getTime()-Fe.createdAt.getTime())})},[z,p]),w.useEffect(()=>{if(!T)return;const B=se=>{se.key==="Escape"&&N(null)};return window.addEventListener("keydown",B),()=>window.removeEventListener("keydown",B)},[T]);const q=_.data??[],F=w.useMemo(()=>q.filter(B=>!B.is_default),[q]);w.useEffect(()=>{if(p&&F.some(se=>se.id===p))return;const B=F.find(se=>!se.is_archived)??F[0];B?m(B.id):p&&m(null)},[F,p]),w.useEffect(()=>{if(h(null),f(null),j(!1),Object.values(s.current).forEach(B=>window.clearTimeout(B)),s.current={},i.current={},typeof window>"u"){A([]);return}if(!p){A([]);return}try{const B=o(p),se=B?window.localStorage.getItem(B):null;if(!se){A([]);return}const ee=JSON.parse(se);A(c(ee))}catch(B){console.error("Failed to load assistant history from storage",B),A([])}},[p,o,c]);const{data:V,isLoading:P,isError:H,error:Y}=Tt({queryKey:["projectDiscussion",t.id,p],queryFn:async()=>(await dn.listThreads(t.id,{channelId:p??void 0})).data,enabled:!!p,refetchInterval:1e4}),L=w.useMemo(()=>V?[...V].reverse():[],[V]),Se=w.useMemo(()=>{const B=L.map(se=>({kind:"thread",timestamp:new Date(se.message.created_at).getTime(),thread:se}));return E.forEach(se=>{B.push({kind:"assistant",timestamp:se.createdAt.getTime(),exchange:se})}),B.sort((se,ee)=>se.timestamp-ee.timestamp)},[L,E]),{data:we}=Tt({queryKey:["projectDiscussionStats",t.id,p],queryFn:async()=>(await dn.getStats(t.id,{channelId:p??void 0})).data,enabled:!!p,refetchInterval:3e4}),ge=w.useCallback(B=>{var se;if(!(!B||B.project_id!==t.id)&&!(!p||B.channel_id!==p)){if(B.event==="assistant_reply"){const ee=B.exchange;if(!ee||(se=ee.author)!=null&&se.id&&(e!=null&&e.id)&&ee.author.id===e.id)return;const le=ee.id||_o();A(Pe=>{if(Pe.some(lt=>lt.id===le))return Pe;const Fe=ee.response||{message:"",citations:[],reasoning_used:!1,model:"",usage:void 0,suggested_actions:[]},Ee=ee.created_at?new Date(ee.created_at):new Date,Ue=Yu(Fe.citations||[]),it=Zu(Fe.message||"",Ue),tt={id:le,question:ee.question||"",response:Fe,createdAt:Ee,completedAt:Ee,appliedActions:[],status:"complete",displayMessage:it,author:ee.author};return[...Pe,tt]}),n.invalidateQueries({queryKey:["projectDiscussionAssistantHistory",t.id,p],exact:!1});return}(B.event==="message_created"||B.event==="message_updated"||B.event==="message_deleted")&&(n.invalidateQueries({queryKey:["projectDiscussion",t.id,p]}),n.invalidateQueries({queryKey:["projectDiscussionStats",t.id,p]}))}},[t.id,p,n,e==null?void 0:e.id]);w.useEffect(()=>(Po.on("discussion_event",ge),()=>{Po.off("discussion_event",ge)}),[ge]),w.useEffect(()=>{let B=!1;if(!p){Po.disconnect();return}return(async()=>{try{const ee=await lh();if(B)return;await Po.connect(t.id,p,ee)}catch(ee){console.error("Failed to connect to discussion websocket",ee)}})(),()=>{B=!0,Po.disconnect()}},[t.id,p]);const Ce=at({mutationFn:async({name:B,description:se})=>{const ee={name:B,description:se&&se.trim().length>0?se.trim():void 0};return(await dn.createChannel(t.id,ee)).data},onSuccess:B=>{n.invalidateQueries({queryKey:["projectDiscussionChannels",t.id]}),n.invalidateQueries({queryKey:["projectDiscussionStats",t.id,B.id]}),n.invalidateQueries({queryKey:["projectDiscussion",t.id,B.id]}),m(B.id),v(!1),y(""),k("")},onError:B=>{console.error("Failed to create channel:",B),alert("Failed to create channel. Please try again.")}}),Ie=at({mutationFn:async({channelId:B,payload:se})=>(await dn.updateChannel(t.id,B,se)).data,onSuccess:B=>{if(n.invalidateQueries({queryKey:["projectDiscussionChannels",t.id]}),n.invalidateQueries({queryKey:["projectDiscussionStats",t.id,B.id]}),n.invalidateQueries({queryKey:["projectDiscussion",t.id,B.id]}),B.is_archived&&p===B.id){const ee=F.filter(le=>le.id!==B.id&&!le.is_archived)[0]??null;m(ee?ee.id:null)}},onError:B=>{console.error("Failed to update channel:",B),alert("Unable to update channel right now. Please try again.")}}),re=Tt({queryKey:["projectDiscussionChannelResources",t.id,p],queryFn:async()=>p?(await dn.listChannelResources(t.id,p)).data:[],enabled:!!p,staleTime:3e4}),J=Tt({queryKey:["projectDiscussionTasks",t.id,p],queryFn:async()=>p?(await dn.listTasks(t.id,{channelId:p})).data:[],enabled:!!p,staleTime:15e3}),Q=at({mutationFn:async B=>{if(!p)throw new Error("Channel not selected");return(await dn.createTask(t.id,p,B)).data},onSuccess:()=>{n.invalidateQueries({queryKey:["projectDiscussionTasks",t.id,p]})},onError:B=>{console.error("Failed to create task:",B),alert("Unable to create task right now. Please try again.")}}),he=at({mutationFn:async({taskId:B,payload:se})=>(await dn.updateTask(t.id,B,se)).data,onSuccess:()=>{n.invalidateQueries({queryKey:["projectDiscussionTasks",t.id,p]})},onError:B=>{console.error("Failed to update task:",B),alert("Unable to update task right now.")}}),Re=at({mutationFn:async B=>{await dn.deleteTask(t.id,B)},onSuccess:()=>{n.invalidateQueries({queryKey:["projectDiscussionTasks",t.id,p]})},onError:B=>{console.error("Failed to delete task:",B),alert("Unable to delete task right now.")}}),De=at({mutationFn:async B=>{if(!p)throw new Error("Channel not selected");return(await dn.createChannelResource(t.id,p,B)).data},onSuccess:()=>{n.invalidateQueries({queryKey:["projectDiscussionChannelResources",t.id,p]})},onError:B=>{console.error("Failed to link resource:",B),alert("Unable to link this resource right now.")}}),D=at({mutationFn:async B=>{if(!p)throw new Error("Channel not selected");await dn.deleteChannelResource(t.id,p,B)},onSuccess:()=>{n.invalidateQueries({queryKey:["projectDiscussionChannelResources",t.id,p]})},onError:B=>{console.error("Failed to unlink resource:",B),alert("Unable to unlink this resource right now.")}}),G=at({mutationFn:async B=>{var In;if(!p)throw new Error("Channel not selected");const se=sn(`/projects/${t.id}/discussion/channels/${p}/assistant?stream=true`),ee={"Content-Type":"application/json",Accept:"text/event-stream"},le=typeof window<"u"?localStorage.getItem("access_token"):null;le&&(ee.Authorization=`Bearer ${le}`);const Pe=JSON.stringify({question:B.question,reasoning:B.reasoning}),Fe=async()=>fetch(se,{method:"POST",headers:ee,body:Pe,credentials:"include"});let Ee=await Fe();if(Ee.status===401||Ee.status===403)try{const vt=await lh();ee.Authorization=`Bearer ${vt}`,Ee=await Fe()}catch(vt){throw console.error("Assistant auth refresh failed",vt),new Error("Assistant authentication failed; please sign in again.")}if(!Ee.ok)throw new Error(`Assistant request failed with status ${Ee.status}`);const Ue=Ee.headers.get("content-type")||"";if(!Ee.body||!Ue.includes("text/event-stream"))return await Ee.json();const it=Ee.body.getReader(),tt=new TextDecoder("utf-8");let lt="",Xn="",On=null;const ao=vt=>{const Bt=sx(Xn);return{message:(vt?Bt?`${Bt}

_${vt}_`:vt:Bt)||"Scholar AI did not return a response.",citations:[],reasoning_used:B.reasoning,model:"",usage:void 0,suggested_actions:[]}};e:for(;;){const{value:vt,done:Bt}=await it.read();if(Bt)break;for(lt+=tt.decode(vt,{stream:!0});;){const Zt=lt.indexOf(`

`);if(Zt===-1)break;const Wr=lt.slice(0,Zt);lt=lt.slice(Zt+2);const Dl=Wr.split(`
`).find(Wt=>Wt.startsWith("data:"));if(!Dl)continue;const oo=Dl.replace(/^data:\s*/,"").trim();if(oo)try{const Wt=JSON.parse(oo);if(Wt.type==="token"&&typeof Wt.content=="string"){i.current[B.id]=!0,Xn+=Wt.content;const Ll=sx(Xn);A(xf=>xf.map(co=>co.id===B.id?{...co,displayMessage:Ll,status:"streaming"}:co))}else if(Wt.type==="result"&&Wt.payload)On=Wt.payload;else if(Wt.type==="error"){const Ll=((In=Wt.message)==null?void 0:In.trim())||"Scholar AI encountered an issue while replying.";On=ao(Ll);break e}}catch(Wt){console.error("Failed to parse assistant stream event",Wt)}}}if(lt.trim())try{const vt=lt.trim();if(vt.startsWith("data:")){const Bt=vt.replace(/^data:\s*/,"").trim();if(Bt){const Zt=JSON.parse(Bt);(Zt==null?void 0:Zt.type)==="result"&&Zt.payload&&(On=Zt.payload)}}}catch(vt){console.error("Failed to parse trailing assistant stream event",vt)}try{await it.cancel()}catch(vt){console.debug("Assistant stream reader cancel failed (safe to ignore)",vt)}return On||(On=ao()),On},onMutate:async B=>{if(!p)throw new Error("Channel not selected");const se=B.id||_o(),ee={id:se,question:B.question,response:{message:"",citations:[],reasoning_used:B.reasoning,model:"",usage:void 0,suggested_actions:[]},createdAt:new Date,appliedActions:[],status:"pending",displayMessage:"",author:{id:e==null?void 0:e.id,name:{display:I,first:e==null?void 0:e.first_name,last:e==null?void 0:e.last_name}}};return A(le=>[...le,ee]),{entryId:se}},onSuccess:(B,se,ee)=>{const le=(ee==null?void 0:ee.entryId)||_o(),Pe=new Date;A(it=>it.some(lt=>lt.id===le)?it.map(lt=>lt.id===le?{...lt,response:B,completedAt:Pe,status:"streaming",displayMessage:i.current[le]?lt.displayMessage:"",author:lt.author||{id:e==null?void 0:e.id,name:{display:I,first:e==null?void 0:e.first_name,last:e==null?void 0:e.last_name}}}:lt):[...it,{id:le,question:se.question,response:B,createdAt:Pe,completedAt:Pe,appliedActions:[],status:"streaming",displayMessage:"",author:{id:e==null?void 0:e.id,name:{display:I,first:e==null?void 0:e.first_name,last:e==null?void 0:e.last_name}}}]);const Fe=Yu(B.citations),Ee=Zu(B.message,Fe);if(i.current[le]){A(it=>it.map(tt=>tt.id===le?{...tt,displayMessage:Ee,status:"complete",completedAt:tt.completedAt??Pe,author:tt.author||{id:e==null?void 0:e.id,name:{display:I,first:e==null?void 0:e.first_name,last:e==null?void 0:e.last_name}}}:tt)),delete i.current[le];return}C(le,Ee)},onError:(B,se,ee)=>{console.error("Failed to invoke assistant:",B),ee!=null&&ee.entryId&&(A(le=>le.filter(Pe=>Pe.id!==ee.entryId)),delete i.current[ee.entryId]),alert("Unable to reach Scholar AI right now. Please try again.")}}),ae=(B,se,ee)=>{var Pe,Fe,Ee;if(!p){alert("Select a channel before accepting assistant suggestions.");return}const le=`${B.id}:${ee}`;if(!B.appliedActions.includes(le)){if(se.action_type==="create_task"){const Ue=String(((Pe=se.payload)==null?void 0:Pe.title)||"").trim();if(!Ue){alert("The assistant suggestion is missing a task title. Please create the task manually.");return}const it=(Fe=se.payload)!=null&&Fe.description?String(se.payload.description):void 0,tt=(Ee=se.payload)!=null&&Ee.message_id?String(se.payload.message_id):void 0;if(!window.confirm(`Create task "${Ue}"?`))return;const lt={title:Ue,description:it||void 0,message_id:tt||void 0};Q.mutate(lt,{onSuccess:()=>{A(Xn=>Xn.map(On=>On.id===B.id?{...On,appliedActions:[...On.appliedActions,le]}:On))},onError:Xn=>{console.error("Failed to create task from assistant suggestion:",Xn),alert("Unable to create task right now. Please try again.")}});return}alert("This assistant suggestion type is not yet supported.")}},je=at({mutationFn:async B=>(await dn.createMessage(t.id,{content:B,channel_id:p??void 0,parent_id:(u==null?void 0:u.id)||null})).data,onSuccess:B=>{p&&n.setQueryData(["projectDiscussion",t.id,p],se=>{const ee=se??[];if(!B.parent_id)return ee.some(Ue=>Ue.message.id===B.id)?ee:[{message:B,replies:[]},...ee];let le=!1;const Pe=ee.map(Fe=>{if(Fe.message.id!==B.parent_id)return Fe;const Ee=Fe.replies??[];if(Ee.some(it=>it.id===B.id))return Fe;le=!0;const Ue=[...Ee,B].sort((it,tt)=>new Date(it.created_at).getTime()-new Date(tt.created_at).getTime());return{...Fe,message:{...Fe.message,reply_count:Fe.message.reply_count+1},replies:Ue}});return le?Pe:ee}),n.invalidateQueries({queryKey:["projectDiscussion",t.id,p]}),n.invalidateQueries({queryKey:["projectDiscussionStats",t.id,p]}),h(null)},onError:B=>{console.error("Failed to send message:",B),alert("Failed to send message. Please try again.")}}),de=at({mutationFn:async({messageId:B,content:se})=>(await dn.updateMessage(t.id,B,{content:se})).data,onSuccess:()=>{n.invalidateQueries({queryKey:["projectDiscussion",t.id,p]}),f(null)},onError:B=>{console.error("Failed to update message:",B),alert("Failed to update message. Please try again.")}}),Ae=at({mutationFn:async B=>{await dn.deleteMessage(t.id,B)},onSuccess:()=>{n.invalidateQueries({queryKey:["projectDiscussion",t.id,p]}),n.invalidateQueries({queryKey:["projectDiscussionStats",t.id,p]})},onError:B=>{console.error("Failed to delete message:",B),alert("Failed to delete message. Please try again.")}});w.useEffect(()=>{var B;(B=r.current)==null||B.scrollIntoView({behavior:"smooth"})},[Se]),w.useEffect(()=>{if(typeof window>"u"||!p)return;const B=o(p);if(!B)return;const se=E.map(ee=>({...ee,createdAt:ee.createdAt.toISOString(),completedAt:ee.completedAt?ee.completedAt.toISOString():null}));try{window.localStorage.setItem(B,JSON.stringify(se))}catch(ee){console.error("Failed to persist assistant history",ee)}},[E,p,o]);const Je=B=>{const se=B.trim();if(se){if(se.startsWith("/")){if(!p){alert("Select a channel before asking Scholar AI.");return}const ee=se.slice(1).trim();if(!ee){alert("Add a command after the slash (e.g., /reason What should we do next?).");return}const le=ee.indexOf(" "),Pe=(le===-1?ee:ee.slice(0,le)).toLowerCase(),Fe=le===-1?"":ee.slice(le+1).trim();let Ee=ee,Ue=S;if(Pe==="reason"||Pe==="reasoning"||Pe==="r")Ue=!0,Ee=Fe;else{const tt=ee.toLowerCase();tt.startsWith("reason ")?(Ue=!0,Ee=ee.slice(7).trim()):tt.startsWith("reasoning ")&&(Ue=!0,Ee=ee.slice(10).trim())}if(!Ee){alert("Add a question after the slash (e.g., /reason What is next?) to ask Scholar AI.");return}const it=_o();G.mutate({id:it,question:Ee,reasoning:Ue});return}if(!p&&!d){alert("Select a channel before sending messages.");return}d?de.mutate({messageId:d.id,content:se}):je.mutate(se)}},Ye=B=>{h({id:B.id,userName:B.user.name||B.user.email}),f(null)},dt=B=>{f({id:B.id,content:B.content}),h(null)},It=B=>{window.confirm("Are you sure you want to delete this message?")&&Ae.mutate(B)},Ft=()=>{h(null)},$=()=>{f(null)},W=()=>{y(""),k(""),v(!0)},te=()=>{v(!1)},fe=B=>{if(B.preventDefault(),!g.trim()){alert("Channel name is required.");return}Ce.mutate({name:g.trim(),description:b.trim()||void 0})},O=F.find(B=>B.id===p)??null,Z=E.length>0,ne=()=>P||_.isLoading?a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(gt,{className:"mx-auto h-8 w-8 animate-spin text-indigo-600"}),a.jsx("p",{className:"mt-2 text-sm text-gray-600",children:"Loading discussion..."})]})}):H?a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-center",children:[a.jsx(Cc,{className:"mx-auto h-8 w-8 text-red-600"}),a.jsx("p",{className:"mt-2 text-sm font-medium text-red-900",children:"Failed to load discussion"}),a.jsx("p",{className:"mt-1 text-xs text-red-700",children:(Y==null?void 0:Y.message)||"Please try again later"})]})}):!(L.length>0)&&!Z?a.jsx("div",{className:"flex h-full items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx(ma,{className:"mx-auto h-12 w-12 text-gray-300"}),a.jsx("h3",{className:"mt-4 text-sm font-medium text-gray-900",children:"No messages yet"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Start the conversation by sending a message or ask Scholar AI for help."})]})}):a.jsxs("div",{className:"space-y-4",children:[Se.map(se=>{if(se.kind==="assistant"){const{exchange:le}=se;console.log("Rendering AI exchange:",le.id,"author:",le.author);const Pe=Yu(le.response.citations),Fe=Zu(le.response.message,Pe),Ee=rx(le.createdAt,{addSuffix:!0}),Ue=le.completedAt?rx(le.completedAt,{addSuffix:!0}):Ee,it=le.displayMessage||Fe,tt=!it&&le.status!=="complete",lt=R(le.author);console.log("authorLabel result:",lt);const Xn=lt.trim().charAt(0).toUpperCase()||"U";return a.jsx("div",{className:"border-b border-gray-100 pb-4 last:border-b-0",children:a.jsxs("div",{className:"space-y-4 pt-4",children:[a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-indigo-100 text-sm font-medium text-indigo-600",children:Xn}),a.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[a.jsxs("div",{className:"mb-1 flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:lt}),a.jsx("span",{className:"text-xs text-gray-500",children:Ee}),a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-indigo-100 px-2 py-0.5 text-[10px] font-medium text-indigo-700",children:[a.jsx(rS,{className:"h-3 w-3"}),"AI prompt"]})]}),a.jsx("div",{className:"inline-block max-w-fit rounded-2xl bg-purple-50/70 px-4 py-2 shadow-sm ring-2 ring-purple-200 transition",children:a.jsx("p",{className:"text-sm text-gray-700",children:le.question})})]}),a.jsx("div",{className:"relative flex-shrink-0 w-6"})]}),a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-indigo-100 text-sm font-medium text-indigo-600",children:"AI"}),a.jsxs("div",{className:"flex min-w-0 flex-1 flex-col",children:[a.jsxs("div",{className:"mb-1 flex flex-wrap items-center gap-2",children:[a.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Scholar AI"}),a.jsx("span",{className:"text-xs text-gray-500",children:Ue}),le.response.reasoning_used&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-0.5 text-[10px] font-medium text-emerald-600",children:[a.jsx(vr,{className:"h-3 w-3"}),"Reasoning"]})]}),a.jsx("div",{className:"inline-block max-w-fit rounded-2xl bg-white px-4 py-2 transition",children:tt?a.jsxs("div",{className:"flex items-center gap-2 text-sm text-indigo-600",children:[a.jsx(gt,{className:"h-4 w-4 animate-spin"}),"Scholar AI is composing"]}):a.jsx("div",{className:"prose prose-sm max-w-none text-gray-900 prose-headings:text-gray-900 prose-p:leading-relaxed prose-li:marker:text-gray-400",children:a.jsx(xz,{remarkPlugins:[_$],children:it})})}),!tt&&le.response.citations.length>0&&a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:"Sources"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:le.response.citations.map(In=>a.jsx("span",{className:"rounded-full bg-indigo-50 px-2 py-0.5 text-xs text-indigo-600",children:In.label},`${le.id}-${In.origin}-${In.origin_id}`))})]}),!tt&&le.response.suggested_actions&&le.response.suggested_actions.length>0&&a.jsxs("div",{className:"mt-2 space-y-1",children:[a.jsx("p",{className:"text-[11px] uppercase tracking-wide text-gray-400",children:"Suggested actions"}),a.jsx("div",{className:"flex flex-wrap gap-2",children:le.response.suggested_actions.map((In,vt)=>{const Bt=`${le.id}:${vt}`,Zt=le.appliedActions.includes(Bt);return a.jsx("button",{type:"button",onClick:()=>ae(le,In,vt),disabled:Zt||Q.isPending,className:`inline-flex items-center gap-1 rounded-full border px-3 py-1 text-xs font-medium transition ${Zt?"border-emerald-300 bg-emerald-50 text-emerald-600":"border-indigo-200 bg-white text-indigo-600 hover:bg-indigo-50"}`,children:Zt?"Completed":In.summary},Bt)})})]}),!tt&&a.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3 text-[11px] text-gray-400",children:[le.response.model&&a.jsxs("span",{children:["Model: ",le.response.model]}),le.response.usage&&typeof le.response.usage.total_tokens=="number"&&a.jsxs("span",{children:["Total tokens: ",le.response.usage.total_tokens]})]})]}),a.jsx("div",{className:"relative flex-shrink-0 w-6"})]})]})},le.id)}const{thread:ee}=se;return a.jsx(S7,{thread:ee,currentUserId:(e==null?void 0:e.id)||"",onReply:Ye,onEdit:dt,onDelete:It},ee.message.id)}),a.jsx("div",{ref:r})]}),ye=B=>{if(B.is_default)return;const se=B.is_archived?"unarchive":"archive";window.confirm(`Are you sure you want to ${se} ${B.name}?`)&&Ie.mutate({channelId:B.id,payload:{is_archived:!B.is_archived}})};return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"flex h-[calc(100vh-160px)] min-h-[32rem] w-full gap-3 overflow-hidden",children:[a.jsx(N7,{channels:F,activeChannelId:p,onSelectChannel:m,onCreateChannel:W,isCreating:Ce.isPending,onArchiveToggle:ye}),a.jsxs("div",{className:"flex flex-1 min-h-0 min-w-0 flex-col rounded-2xl border border-gray-200 bg-white shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 p-4",children:[a.jsxs("div",{className:"flex flex-col gap-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ma,{className:"h-5 w-5 text-indigo-600"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:O?O.name:"Project Discussion"})]}),(O==null?void 0:O.description)&&a.jsx("p",{className:"text-xs text-gray-500",children:O.description})]}),a.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[a.jsx("button",{type:"button",onClick:()=>N("resources"),className:"inline-flex items-center gap-2 rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 transition hover:bg-indigo-50",disabled:!O,children:"Channel resources"}),a.jsx("button",{type:"button",onClick:()=>N("tasks"),className:"inline-flex items-center gap-2 rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 transition hover:bg-indigo-50",disabled:!O,children:"Channel tasks"}),we&&a.jsxs(a.Fragment,{children:[a.jsxs("span",{children:[we.total_threads," threads"]}),a.jsxs("span",{children:[we.total_messages," messages"]})]}),O&&O.is_archived&&a.jsx("span",{className:"inline-flex items-center rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-700",children:"Archived"})]})]}),O?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"flex flex-1 min-h-0 overflow-hidden p-4",children:a.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto pr-2",children:ne()})}),a.jsx(j7,{onSend:Je,placeholder:"Type a message use / to ask Scholar AI for help",replyingTo:u,onCancelReply:Ft,editingMessage:d,onCancelEdit:$,isSubmitting:je.isPending||de.isPending,reasoningEnabled:S,onToggleReasoning:()=>j(B=>!B),reasoningPending:G.isPending})]}):a.jsx("div",{className:"flex flex-1 items-center justify-center px-6 py-10",children:a.jsxs("div",{className:"text-center",children:[a.jsx(ma,{className:"mx-auto h-12 w-12 text-gray-300"}),a.jsx("h3",{className:"mt-4 text-base font-semibold text-gray-900",children:"Create a channel to start the conversation"}),a.jsx("p",{className:"mt-2 text-sm text-gray-500",children:"Organize discussions by topic, meeting, or workstream. Once a channel is created, messages and AI tools will appear here."}),a.jsxs("button",{type:"button",onClick:W,className:"mt-4 inline-flex items-center gap-2 rounded-full border border-indigo-200 px-4 py-2 text-sm font-medium text-indigo-600 transition hover:bg-indigo-50",children:[a.jsx(xn,{className:"h-4 w-4"}),"New channel"]})]})})]})]}),T&&O&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-gray-900/40 backdrop-blur-sm px-4",onClick:()=>N(null),children:a.jsxs("div",{className:"relative w-full max-w-3xl overflow-hidden rounded-2xl bg-white shadow-2xl",onClick:B=>B.stopPropagation(),children:[a.jsxs("div",{className:"flex items-start justify-between border-b border-gray-200 px-5 py-4",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:T==="resources"?"Channel resources":"Channel tasks"}),a.jsx("p",{className:"text-xs text-gray-500",children:T==="resources"?`Manage linked resources for ${O.name}`:`Track action items for ${O.name}`})]}),a.jsx("button",{type:"button",onClick:()=>N(null),className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-gray-500 hover:bg-gray-100","aria-label":"Close channel dialog",children:a.jsx(Jt,{className:"h-4 w-4"})})]}),a.jsx("div",{className:"max-h-[70vh] overflow-y-auto px-5 py-4",children:T==="resources"?a.jsx(_7,{projectId:t.id,loading:re.isLoading,error:re.isError?re.error:null,resources:re.data??[],onCreateResource:B=>De.mutate(B),onRemoveResource:B=>D.mutate(B),isSubmitting:De.isPending||D.isPending}):a.jsx(T7,{tasks:J.data??[],loading:J.isLoading||Q.isPending,error:J.isError?J.error:null,onCreateTask:B=>Q.mutate(B),onUpdateTask:(B,se)=>he.mutate({taskId:B,payload:se}),onDeleteTask:B=>Re.mutate(B),allowCreate:!!p,defaultMessageId:(u==null?void 0:u.id)??(d==null?void 0:d.id)??null})})]})}),x&&a.jsx("div",{className:"fixed inset-0 z-40 flex items-center justify-center bg-gray-900/40 backdrop-blur-sm",children:a.jsxs("div",{className:"w-full max-w-md rounded-2xl bg-white p-6 shadow-xl",children:[a.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Create new channel"}),a.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Organize conversations by topic, meeting, or workstream."}),a.jsxs("form",{className:"mt-4 space-y-4",onSubmit:fe,children:[a.jsxs("div",{children:[a.jsx("label",{htmlFor:"channel-name",className:"text-xs font-medium uppercase tracking-wide text-gray-600",children:"Channel name"}),a.jsx("input",{id:"channel-name",type:"text",value:g,onChange:B=>y(B.target.value),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"e.g. Brainstorming",maxLength:255,required:!0})]}),a.jsxs("div",{children:[a.jsxs("label",{htmlFor:"channel-description",className:"text-xs font-medium uppercase tracking-wide text-gray-600",children:["Description ",a.jsx("span",{className:"text-gray-400",children:"(optional)"})]}),a.jsx("textarea",{id:"channel-description",value:b,onChange:B=>k(B.target.value),className:"mt-1 w-full rounded-lg border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",rows:3,maxLength:2e3,placeholder:"Describe the focus of this channel"})]}),a.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[a.jsx("button",{type:"button",onClick:te,className:"rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50",disabled:Ce.isPending,children:"Cancel"}),a.jsxs("button",{type:"submit",disabled:Ce.isPending,className:"inline-flex items-center gap-2 rounded-lg bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-indigo-700 disabled:cursor-not-allowed disabled:bg-indigo-300",children:[Ce.isPending&&a.jsx(gt,{className:"h-4 w-4 animate-spin"}),"Create channel"]})]})]})]})})]})},ed=t=>{if(!t)return"";const e=new Date(t);return`${e.toLocaleDateString()} ${e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},w1=t=>{switch(t){case"live":return"Live";case"scheduled":return"Scheduled";case"ended":return"Ended";case"cancelled":return"Cancelled";default:return t}},k1=t=>{switch(t){case"live":return"bg-emerald-100 text-emerald-700";case"scheduled":return"bg-sky-100 text-sky-700";case"ended":return"bg-gray-200 text-gray-700";case"cancelled":return"bg-amber-100 text-amber-700";default:return"bg-gray-100 text-gray-600"}},Ip=(t,e,n="t")=>{try{const r=new URL(t);return r.searchParams.set(n,e),r.toString()}catch(r){return console.warn("Failed to append token to URL",r),t}},D7=()=>{var P;const{project:t}=qr(),e=qs(),[n,r]=g4(),s=t==null?void 0:t.id,[i,l]=w.useState(null),[o,c]=w.useState(null),[u,h]=w.useState(null),d=w.useCallback(H=>{if(!H)return"";if(typeof H=="string")return H;if(Array.isArray(H))return H.map(Y=>{if(Y&&typeof Y=="object"&&"text"in Y){const L=Y.text;return typeof L=="string"?L:JSON.stringify(Y)}return typeof Y=="string"?Y:JSON.stringify(Y)}).join(`
`);if(typeof H=="object"){const Y=H;return typeof Y.text=="string"?Y.text:Array.isArray(Y.segments)?Y.segments.map(L=>typeof L.text=="string"?L.text:"").filter(Boolean).join(`
`):JSON.stringify(H,null,2)}return String(H)},[]),f=Tt({queryKey:["project",s,"sync-sessions"],queryFn:async()=>s?(await Hl.listSyncSessions(s)).data:{sessions:[]},enabled:!!s}),p=((P=f.data)==null?void 0:P.sessions)??[],m=p.filter(H=>H.status==="live"),x=p.filter(H=>H.status==="scheduled"),v=p.filter(H=>H.status==="ended"),g=p.filter(H=>H.status==="cancelled"),y=n.get("view")||"summary",b=m[0]||x[0]||v[0]||g[0]||null,[k,S]=w.useState(n.get("session")??(b==null?void 0:b.id)),j=p.find(H=>H.id===k)||null,E=u||(y==="chat"?j:null),A=w.useRef(y);w.useEffect(()=>{!k&&b&&S(b.id)},[k,b]),w.useEffect(()=>{const H=n.get("session");H&&H!==k&&S(H)},[n,k]),w.useEffect(()=>{const H=new URLSearchParams(n);k?H.set("session",k):H.delete("session"),(k&&n.get("session")!==k||!k&&n.get("session"))&&r(H,{replace:!0})},[k,n,r]),w.useEffect(()=>{k&&!p.some(H=>H.id===k)&&(S(b==null?void 0:b.id),l(null))},[k,p,b]),w.useEffect(()=>{i&&j&&i.session_id!==j.id&&l(null)},[i,j]);const T=w.useCallback((H,Y)=>{if(S(L=>L===H.id?L:H.id),h(H),Y!=null&&Y.syncUrl){const L=new URLSearchParams(n);L.set("session",H.id),L.set("view","chat"),r(L,{replace:!0})}},[n,r]),N=w.useCallback(H=>{if(h(null),H!=null&&H.syncUrl){const Y=new URLSearchParams(n);Y.delete("view"),r(Y,{replace:!0})}},[n,r]);w.useEffect(()=>{if(y==="chat"){const H=n.get("session"),Y=H?p.find(L=>L.id===H):j||null;Y&&T(Y)}else A.current==="chat"&&y!=="chat"&&N();A.current=y},[y,n,p,j,T,N]);const I=at({mutationFn:async()=>s?(await Hl.createSyncSession(s,{provider:"daily",status:"live"})).data:null,onSuccess:H=>{H!=null&&H.id&&S(H.id),e.invalidateQueries({queryKey:["project",s,"sync-sessions"]})}}),R=at({mutationFn:async H=>{if(!s)throw new Error("Missing project");return(await Hl.endSyncSession(s,H.id,{status:"ended"})).data},onSuccess:()=>{l(null),e.invalidateQueries({queryKey:["project",s,"sync-sessions"]})}}),C=at({mutationFn:async H=>{if(!(!s||H.length===0))for(const Y of H)await Hl.deleteSyncSession(s,Y)},onSuccess:()=>{e.invalidateQueries({queryKey:["project",s,"sync-sessions"]})}}),{mutate:_,isPending:M,variables:z}=at({mutationFn:async({session:H})=>{if(!s)throw new Error("Missing project");return(await Hl.createCallToken(s,H.id)).data},onSuccess:(H,Y)=>{l(H),console.log("[SyncSpace] Received call token",H);const L=H.join_url||(H.room_url?Ip(H.room_url,H.token):null);if(Y!=null&&Y.openWindow&&L)if(Y.targetWindow&&!Y.targetWindow.closed)try{Y.targetWindow.location.href=L,Y.targetWindow.opener=null}catch(Se){console.warn("Failed to reuse call window",Se),window.open(L,"_blank","noopener")}else window.open(L,"_blank","noopener")}});w.useEffect(()=>{i&&j&&j.status!=="live"&&l(null)},[i,j]);const q=H=>{T(H)},F=H=>{const Y=H.recording,L=H.id===k,Se=H.status==="live",we=(i==null?void 0:i.session_id)===H.id?i:null,ge=Se?(we==null?void 0:we.join_url)||(we!=null&&we.room_url?Ip(we.room_url,we.token):null):null,Ce=(we==null?void 0:we.join_url)||(we!=null&&we.room_url?Ip(we.room_url,we.token):null),Ie=o===H.id,re=(Y==null?void 0:Y.audio_url)||null,J=(()=>{if(!re)return null;if(re.startsWith("http://")||re.startsWith("https://"))return re;try{const he=new URL(kl);return he.pathname=re.startsWith("/")?re:`/${re}`,he.toString()}catch(he){return console.warn("Failed to build recording URL",he),re}})(),Q=(()=>{if(!Y)return a.jsx("span",{className:"text-xs text-gray-500",children:"Attach a recording to bind the transcript here."});const he=Y.status;if(he==="transcribing")return a.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-indigo-600",children:[a.jsx(gt,{className:"h-3 w-3 animate-spin"})," Transcription in progress"]});if(he==="uploaded")return a.jsx("span",{className:"text-xs text-gray-500",children:"Preparing transcription"});if(he==="failed")return a.jsx("span",{className:"text-xs text-rose-600",children:"Transcription failed. Try attaching the recording again."});if(Y.transcript){const Re=d(Y.transcript);return a.jsxs("div",{className:"flex flex-col gap-1",children:[Re&&a.jsx("button",{type:"button",onClick:()=>c(Ie?null:H.id),className:"self-start text-xs font-medium text-indigo-600 hover:text-indigo-500",children:Ie?"Hide transcript":"View transcript"}),Ie&&Re&&a.jsx("div",{className:"max-h-60 w-full overflow-y-auto rounded-lg border border-gray-200 bg-gray-50 p-3 text-xs text-gray-700",children:a.jsx("pre",{className:"whitespace-pre-wrap break-words",children:Re})})]})}return a.jsx("span",{className:"text-xs text-gray-500",children:"Transcript not available yet."})})();return a.jsxs("div",{className:`rounded-2xl border ${L?"border-indigo-200 bg-indigo-50/60":"border-gray-200 bg-white"} p-5 shadow-sm transition-colors`,children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("div",{className:`${k1(H.status)} inline-flex items-center rounded-full px-3 py-1 text-xs font-semibold capitalize leading-none`,children:w1(H.status)}),a.jsxs("div",{className:"text-xs text-gray-500",children:["Started ",ed(H.started_at||H.created_at)]}),H.ended_at&&a.jsxs("div",{className:"text-xs text-gray-500",children:["Completed ",ed(H.ended_at)]})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("button",{type:"button",onClick:()=>S(H.id),className:"inline-flex items-center gap-2 rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 hover:bg-indigo-50",children:"View details"}),a.jsx("button",{type:"button",onClick:()=>q(H),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-gray-100",children:"View transcript"}),Se&&a.jsxs("button",{type:"button",onClick:()=>{if(S(H.id),we&&Ce)window.open(Ce,"_blank","noopener");else{const he=window.open("","_blank");_({session:H,openWindow:!0,targetWindow:he??void 0})}},disabled:M&&(z==null?void 0:z.session.id)===H.id,className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:[M&&(z==null?void 0:z.session.id)===H.id?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(sg,{className:"h-3.5 w-3.5"}),"Open call window"]}),Se&&a.jsxs("button",{type:"button",onClick:()=>R.mutate(H),disabled:R.isPending,className:"inline-flex items-center gap-2 rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 hover:bg-indigo-50 disabled:cursor-not-allowed disabled:opacity-60",children:[R.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(Kh,{className:"h-3.5 w-3.5"}),R.isPending?"Ending":"End session"]})]})]}),a.jsxs("div",{className:"mt-4 space-y-2 text-sm text-gray-600",children:[a.jsxs("div",{children:["Provider: ",H.provider||""]}),a.jsxs("div",{children:["Room ID: ",H.provider_room_id||""]}),ge&&a.jsxs("div",{className:"break-all text-xs text-gray-500",children:["Call URL: ",ge]}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{children:"Transcript:"}),Q]}),J&&a.jsx("div",{children:a.jsxs("a",{href:J,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 hover:bg-indigo-50",children:[a.jsx(tp,{className:"h-3.5 w-3.5"})," Open call recording"]})})]})]},H.id)},V=H=>{const Y=()=>{N({syncUrl:y==="chat"})},L=H.recording,Se=L?d(L.transcript):"",we=ed(H.started_at||H.created_at),ge=H.ended_at?ed(H.ended_at):null,Ce=k1(H.status),Ie=(L==null?void 0:L.audio_url)||null,re=(()=>{if(!Ie)return null;if(Ie.startsWith("http://")||Ie.startsWith("https://"))return Ie;try{const J=new URL(kl);return J.pathname=Ie.startsWith("/")?Ie:`/${Ie}`,J.toString()}catch(J){return console.warn("Failed to build recording URL",J),Ie}})();return a.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center px-4 py-6 sm:px-6",children:[a.jsx("div",{className:"absolute inset-0 bg-gray-900/30",onClick:Y,"aria-hidden":"true"}),a.jsxs("div",{className:"relative flex h-[80vh] w-full max-w-3xl flex-col overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-xl",children:[a.jsxs("div",{className:"flex items-start justify-between gap-4 border-b border-gray-200 px-6 py-5",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Session details"}),a.jsx("span",{className:`${Ce} inline-flex items-center rounded-full px-3 py-1 text-[11px] font-semibold capitalize`,children:w1(H.status)})]}),a.jsxs("p",{className:"text-xs text-gray-500",children:["Started ",we]}),ge&&a.jsxs("p",{className:"text-xs text-gray-500",children:["Ended ",ge]})]}),a.jsx("button",{type:"button",onClick:Y,className:"inline-flex h-9 w-9 items-center justify-center rounded-full border border-gray-200 text-gray-500 transition hover:bg-gray-100","aria-label":"Close session details",children:a.jsx(Jt,{className:"h-4 w-4"})})]}),a.jsxs("div",{className:"flex-1 overflow-y-auto bg-gray-50 px-6 py-6",children:[a.jsxs("section",{className:"space-y-3 rounded-xl border border-gray-200 bg-white p-5",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Call information"}),a.jsxs("dl",{className:"grid grid-cols-1 gap-3 text-sm text-gray-600 sm:grid-cols-2",children:[a.jsxs("div",{children:[a.jsx("dt",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Provider"}),a.jsx("dd",{children:H.provider||""})]}),a.jsxs("div",{children:[a.jsx("dt",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Room ID"}),a.jsx("dd",{children:H.provider_room_id||""})]}),a.jsxs("div",{children:[a.jsx("dt",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Started by"}),a.jsx("dd",{children:H.started_by||""})]}),a.jsxs("div",{children:[a.jsx("dt",{className:"text-xs uppercase tracking-wide text-gray-400",children:"Recording status"}),a.jsx("dd",{children:(L==null?void 0:L.status)??""})]})]}),re&&a.jsxs("a",{href:re,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-2 self-start rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 hover:bg-indigo-50",children:[a.jsx(tp,{className:"h-3.5 w-3.5"})," Open recording"]})]}),a.jsxs("section",{className:"mt-6 space-y-3 rounded-xl border border-gray-200 bg-white p-5",children:[a.jsx("h3",{className:"text-sm font-semibold text-gray-900",children:"Transcript"}),Se?a.jsx("div",{className:"max-h-72 overflow-y-auto rounded-lg border border-gray-200 bg-gray-50 p-4 text-xs text-gray-700",children:a.jsx("pre",{className:"whitespace-pre-wrap break-words",children:Se})}):a.jsx("p",{className:"text-xs text-gray-500",children:"Transcript will appear here once the recording has been processed."})]})]})]})]})};return a.jsxs("div",{className:"space-y-6",children:[a.jsx("section",{className:"rounded-2xl border border-indigo-100 bg-white p-6 shadow-sm",children:a.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{className:"flex items-center gap-3 text-indigo-700",children:[a.jsx(sg,{className:"h-6 w-6"}),a.jsxs("div",{children:[a.jsx("h1",{className:"text-xl font-semibold text-indigo-900",children:"Sync Space"}),a.jsx("p",{className:"text-sm text-indigo-600",children:"Start a live call, keep the transcript, and let GPT-5 craft follow-ups for your team."})]})]}),a.jsxs("button",{type:"button",onClick:()=>I.mutate(),disabled:I.isPending||!s,className:"inline-flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-60",children:[I.isPending?a.jsx(gt,{className:"h-4 w-4 animate-spin"}):a.jsx(tp,{className:"h-4 w-4"}),I.isPending?"Starting...":"Start a call"]})]})}),a.jsxs("div",{className:"space-y-4",children:[f.isLoading&&a.jsx("div",{className:"h-32 animate-pulse rounded-2xl border border-gray-200 bg-white"}),!f.isLoading&&p.length===0&&a.jsx("div",{className:"rounded-2xl border border-dashed border-gray-200 bg-white p-6 text-sm text-gray-500",children:"No sync sessions yet. Start your first call to unlock collaborative notes and AI summaries."}),[...m,...x].map(H=>F(H)),v.length>0&&a.jsx("div",{className:"flex items-center justify-end",children:a.jsxs("button",{type:"button",onClick:()=>C.mutate(v.map(H=>H.id)),disabled:C.isPending,className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:[C.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(vr,{className:"h-3.5 w-3.5"}),C.isPending?"Clearing":"Clear ended sessions"]})}),[...v,...g].map(H=>F(H))]}),E&&V(E)]})},L7=()=>{const{project:t,currentRole:e}=qr(),n=Qn(),{data:r,isLoading:s}=Tt({queryKey:["project-papers",t.id],queryFn:async()=>(await rt.getPapers({projectId:t.id,limit:200})).data}),i=w.useMemo(()=>(r==null?void 0:r.papers)??[],[r]),l=e!=="viewer";return a.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ln,{className:"h-4 w-4 text-indigo-600"}),a.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Project papers"})]}),l&&a.jsxs("button",{type:"button",onClick:()=>n(`/projects/${t.id}/papers/new`),className:"inline-flex items-center gap-2 rounded-full bg-indigo-600 px-3 py-1.5 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(xn,{className:"h-4 w-4"}),"New paper"]})]}),s?a.jsx("div",{className:"mt-6 space-y-3",children:Array.from({length:3}).map((o,c)=>a.jsx("div",{className:"h-20 animate-pulse rounded-lg bg-gray-100"},c))}):i.length===0?a.jsx("div",{className:"mt-6 rounded-xl border border-dashed border-gray-300 bg-gray-50 p-8 text-sm text-gray-500",children:l?"No papers linked yet. Create one to start writing within this project scope.":"No papers linked yet. Ask an editor or admin to create the first draft."}):a.jsx("div",{className:"mt-6 grid gap-3",children:i.map(o=>a.jsxs(sr,{to:`/projects/${t.id}/papers/${o.id}`,className:"flex items-center justify-between rounded-xl border border-gray-200 bg-white px-4 py-3 shadow-sm transition hover:border-indigo-200 hover:shadow-md",children:[a.jsxs("div",{children:[a.jsx("p",{className:"text-sm font-medium text-gray-900",children:o.title}),a.jsx("p",{className:"text-xs text-gray-500",children:o.status??"draft"})]}),a.jsxs("span",{className:"text-xs text-gray-400",children:["Updated ",new Date(o.updated_at).toLocaleDateString()]})]},o.id))})]})},ix=[{label:"Semantic Scholar",value:"semantic_scholar"},{label:"arXiv",value:"arxiv"},{label:"Crossref",value:"crossref"},{label:"OpenAlex",value:"openalex"},{label:"PubMed",value:"pubmed"},{label:"ScienceDirect",value:"sciencedirect"}],ly=ix.map(t=>t.value),Js=5,oa=24*60,O7=t=>{if(!t)return null;const e=Number(t);return Number.isFinite(e)?Math.max(Js,e)/60:null},I7=t=>{const e=t===""?oa:Number(t);if(!Number.isFinite(e)||e<=0)return"Auto-refresh off";if(e<60)return`Auto-refresh every ${Math.round(e)} min`;const n=e/60;if(n<24)return`Auto-refresh every ${Number.isInteger(n)?n:Number(n.toFixed(1))} h`;const r=n/24,s=Number.isInteger(r)?r:Number(r.toFixed(1));return`Auto-refresh every ${s} day${s===1?"":"s"}`},j1=[{value:"pending",label:"Pending"},{value:"promoted",label:"Promoted"},{value:"dismissed",label:"Dismissed"},{value:"all",label:"All"}],S1=t=>{const e=t.trim();return!e||e.toLowerCase()==="ai"?"":e},F7={query:"",sources:ly,maxResults:"",relevanceThreshold:""},Fp={query:"",sources:ly,autoRefresh:!1,refreshIntervalMinutes:String(oa),maxResults:"20",relevanceThreshold:""},Wi=t=>t?new Date(t).toLocaleString():"",N1=t=>{switch(t){case"pending":return"bg-yellow-50 text-yellow-700 border border-yellow-200";case"promoted":return"bg-emerald-50 text-emerald-700 border border-emerald-200";case"dismissed":return"bg-rose-50 text-rose-700 border border-rose-200";default:return"bg-gray-100 text-gray-600"}},C1=t=>{switch(t){case"pending":return"Pending";case"promoted":return"Promoted";case"dismissed":return"Dismissed";case"all":return"All";default:return t}},A1=t=>t.split(",").map(e=>e.trim()).filter(Boolean),B7=()=>{var te,fe;const{project:t,currentRole:e}=qr(),n=qs(),r=e==="viewer",s=O=>{if(O==null)return null;let Z="bg-gray-100 text-gray-700";return O>=.7?Z="bg-emerald-100 text-emerald-700":O>=.4?Z="bg-amber-100 text-amber-700":Z="bg-rose-100 text-rose-700",a.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ${Z}`,children:["Score ",O.toFixed(2)]})},i=w.useMemo(()=>{var O;return((O=t==null?void 0:t.idea)==null?void 0:O.trim())??""},[t]),l=w.useMemo(()=>t!=null&&t.keywords?Array.isArray(t.keywords)?t.keywords.filter(Boolean).join(", "):t.keywords:"",[t]),[o,c]=w.useState(F7),[u,h]=w.useState(Fp),[d,f]=w.useState("pending"),[p,m]=w.useState(null),[x,v]=w.useState(null),[g,y]=w.useState(null),[b,k]=w.useState(null),[S,j]=w.useState("manual"),[E,A]=w.useState(!1),[T,N]=w.useState([]),I=w.useRef(!1),R=w.useRef(!1),C=O=>{c(Z=>O(Z))},_=O=>{R.current=!0,h(Z=>O(Z))},M=Tt({queryKey:["project",t.id,"discoverySettings"],queryFn:async()=>(await ws.getSettings(t.id)).data,enabled:!r}),z=Tt({queryKey:["project",t.id,"discoveryResults",d],queryFn:async()=>(await ws.listResults(t.id,{status:d==="all"?void 0:d,limit:50})).data,enabled:!r}),q=Tt({queryKey:["project",t.id,"referenceSuggestionsForDiscovery"],queryFn:async()=>{var O;try{return(await An.listSuggestions(t.id)).data.suggestions??[]}catch(Z){if(((O=Z.response)==null?void 0:O.status)===404)return[];throw Z}},staleTime:6e4,enabled:!r}),F=w.useMemo(()=>{var O;return((O=z.data)==null?void 0:O.results)??[]},[z.data]),V=w.useMemo(()=>F.filter(O=>O.run_type==="manual"),[F]),P=w.useMemo(()=>V.filter(O=>O.status!=="promoted"),[V]),H=w.useMemo(()=>F.filter(O=>O.run_type==="auto"),[F]),Y=w.useMemo(()=>M.data??(t==null?void 0:t.discovery_preferences)??null,[t==null?void 0:t.discovery_preferences,M.data]),L=w.useMemo(()=>{if(!Y)return{enabled:!1,intervalMinutes:oa,lastRunAt:null};const O=Y.refresh_interval_hours!=null?Math.max(Js,Math.round(Number(Y.refresh_interval_hours)*60)):oa;return{enabled:!!Y.auto_refresh_enabled,intervalMinutes:O,lastRunAt:Y.last_run_at??null}},[Y]),Se=w.useMemo(()=>{const O=q.data??[],Z=new Set;return O.forEach(ne=>{var se,ee,le,Pe;const ye=(ee=(se=ne.reference)==null?void 0:se.doi)==null?void 0:ee.toLowerCase();ye&&Z.add(`doi:${ye}`);const B=(Pe=(le=ne.reference)==null?void 0:le.title)==null?void 0:Pe.toLowerCase();B&&Z.add(`title:${B}`)}),Z},[q.data]),we=w.useMemo(()=>H.filter(O=>{const Z=O.doi?`doi:${O.doi.toLowerCase()}`:null;if(Z&&Se.has(Z))return!1;const ne=O.title?`title:${O.title.toLowerCase()}`:null;return!(ne&&Se.has(ne))}),[H,Se]),ge=Math.max(0,H.length-we.length);w.useEffect(()=>{if(!(t!=null&&t.id)||r||!L.enabled)return;const Z=Math.max(Js,L.intervalMinutes)*6e4,ne=L.lastRunAt?new Date(L.lastRunAt).getTime():0;let ye,B=!1;const se=async le=>{if(!B){B=!0;try{await An.refreshSuggestions(t.id),await Promise.all([n.invalidateQueries({queryKey:["project",t.id,"discoveryResults"]}),n.invalidateQueries({queryKey:["project",t.id,"discoveryPendingCount"]}),n.invalidateQueries({queryKey:["project",t.id,"referenceSuggestionsForDiscovery"]}),n.invalidateQueries({queryKey:["project",t.id,"discoverySettings"]})])}catch(Pe){console.warn("Auto discovery refresh failed",{reason:le,error:Pe})}finally{B=!1}}},ee=Date.now();return(!ne||ee-ne>=Z)&&se("initial"),ye=setInterval(()=>{se("interval")},Z),()=>{ye&&clearInterval(ye)}},[L,r,t==null?void 0:t.id,n]);const Ce=O=>{if(!O)return"Unable to save preferences right now.";if(typeof O=="string")return O;if(Array.isArray(O)){const Z=O.map(ne=>{if(typeof ne=="string")return ne;if(ne&&typeof ne=="object"){const ye=ne.loc,B=Array.isArray(ye)?ye.join("."):ye,se=ne.msg;if(typeof se=="string")return B?`${B}: ${se}`:se}return null}).filter(Boolean);if(Z.length)return Z.join(`
`)}if(typeof O=="object")try{return JSON.stringify(O)}catch(Z){console.warn("Failed to serialize error detail",Z)}return"Unable to save preferences right now."};w.useEffect(()=>{if(!t)return;const O=Y??void 0;h(Z=>{if(R.current&&I.current)return Z;const ne=(O==null?void 0:O.query)!==void 0,ye=(O==null?void 0:O.sources)!==void 0,B=(O==null?void 0:O.auto_refresh_enabled)!==void 0,se=(O==null?void 0:O.refresh_interval_hours)!==void 0,ee=(O==null?void 0:O.max_results)!==void 0,le=(O==null?void 0:O.relevance_threshold)!==void 0,Pe=ne?(O==null?void 0:O.query)??"":Z.query||i,Fe=ye?(O==null?void 0:O.sources)??[]:Z.sources,Ee=Fe&&Fe.length?Fe:ly,Ue=(O==null?void 0:O.refresh_interval_hours)!=null?Number(O.refresh_interval_hours):null,it=se?Ue!=null&&Number.isFinite(Ue)?String(Math.max(Js,Math.round(Ue*60))):"":Z.refreshIntervalMinutes||String(oa),tt=B?!!(O!=null&&O.auto_refresh_enabled):Z.autoRefresh,lt=ee?(O==null?void 0:O.max_results)!=null?String(O.max_results):"":Z.maxResults||Fp.maxResults,Xn=le?(O==null?void 0:O.relevance_threshold)!=null?String(O.relevance_threshold):"":Z.relevanceThreshold;return I.current=!0,R.current=!1,{query:Pe,sources:Ee,autoRefresh:tt,refreshIntervalMinutes:it,maxResults:lt,relevanceThreshold:Xn}})},[t,i,l,Y]),w.useEffect(()=>{if(!E){N([]);return}N(O=>O.filter(Z=>P.some(ne=>ne.id===Z)))},[E,P]);const Ie=at({onMutate:()=>{m(null),v(null)},mutationFn:async()=>{const O=S1(l||""),Z=O?A1(O):[],ne=O7(u.refreshIntervalMinutes),ye={query:u.query.trim()||null,keywords:Z.length?Z:null,sources:u.sources.length?u.sources:null,auto_refresh_enabled:u.autoRefresh,refresh_interval_hours:u.autoRefresh?ne:null,max_results:u.maxResults?Number(u.maxResults):null,relevance_threshold:u.relevanceThreshold?Number(u.relevanceThreshold):null};return(await ws.updateSettings(t.id,ye)).data},onSuccess:()=>{R.current=!1,m("Discovery preferences saved."),v(null),n.invalidateQueries({queryKey:["project",t.id,"discoverySettings"]})},onError:O=>{var ye,B;m(null);const Z=O,ne=Ce((B=(ye=Z==null?void 0:Z.response)==null?void 0:ye.data)==null?void 0:B.detail);v(ne)}}),re=at({mutationFn:async O=>(await ws.promoteResult(t.id,O)).data,onSuccess:()=>{n.invalidateQueries({queryKey:["project",t.id,"discoveryResults"]}),n.invalidateQueries({queryKey:["project",t.id,"discoveryPendingCount"]}),n.invalidateQueries({queryKey:["project",t.id,"referenceSuggestions"]}),n.invalidateQueries({queryKey:["project",t.id,"discoverySettings"]})}}),J=at({mutationFn:async O=>(await ws.dismissResult(t.id,O)).data,onSuccess:()=>{n.invalidateQueries({queryKey:["project",t.id,"discoveryResults"]}),n.invalidateQueries({queryKey:["project",t.id,"discoveryPendingCount"]})}}),Q=at({mutationFn:async O=>{await Promise.all(O.map(Z=>ws.deleteResult(t.id,Z)))},onSuccess:()=>{n.invalidateQueries({queryKey:["project",t.id,"discoveryResults"]}),n.invalidateQueries({queryKey:["project",t.id,"discoveryPendingCount"]}),n.invalidateQueries({queryKey:["project",t.id,"referenceSuggestions"]}),N([]),A(!1)}}),he=Q.isPending,Re=at({onMutate:()=>{y(null),k(null)},mutationFn:async()=>{const O=S1(l||""),Z=O?A1(O):[],ne={query:o.query.trim()||null,keywords:Z.length?Z:null,sources:o.sources.length?o.sources:null,max_results:o.maxResults?Number(o.maxResults):null,relevance_threshold:o.relevanceThreshold?Number(o.relevanceThreshold):null};return(await ws.runDiscovery(t.id,ne)).data},onSuccess:O=>{k(null);const Z=(O==null?void 0:O.results_created)??0;y(Z===0?"No new discovery results  everything in your project already matches this search.":null),n.invalidateQueries({queryKey:["project",t.id,"discoveryResults"]}),n.invalidateQueries({queryKey:["project",t.id,"discoveryPendingCount"]}),n.invalidateQueries({queryKey:["project",t.id,"referenceSuggestions"]})},onError:O=>{var ye,B;const Z=O,ne=Ce((B=(ye=Z==null?void 0:Z.response)==null?void 0:ye.data)==null?void 0:B.detail);k(ne)}}),De=at({mutationFn:async()=>(await ws.clearDismissedResults(t.id)).data,onSuccess:()=>{y("Dismissed discovery results cleared."),k(null),n.invalidateQueries({queryKey:["project",t.id,"discoveryResults"]}),n.invalidateQueries({queryKey:["project",t.id,"discoveryPendingCount"]}),n.invalidateQueries({queryKey:["project",t.id,"referenceSuggestions"]})},onError:()=>{y(null),k("Unable to clear dismissed results right now.")}}),D=()=>{A(O=>(O&&N([]),!O))},G=O=>{N(Z=>Z.includes(O)?Z.filter(ne=>ne!==O):[...Z,O])},ae=()=>{if(!P.length){N([]);return}T.length===P.length?N([]):N(P.map(O=>O.id))},je=()=>{!T.length||he||Q.mutate(T)},de=t.discovery_preferences,Ae=((te=M.data)==null?void 0:te.last_result_count)??(de==null?void 0:de.last_result_count)??0,Je=((fe=M.data)==null?void 0:fe.last_run_at)??(de==null?void 0:de.last_run_at),Ye=(O,Z)=>{if(O.includes(Z)){const ne=O.filter(ye=>ye!==Z);return ne.length?ne:O}return[...O,Z]},dt=O=>{C(Z=>({...Z,sources:Ye(Z.sources,O)}))},It=O=>{_(Z=>({...Z,sources:Ye(Z.sources,O)}))},Ft=()=>{R.current=!1,I.current=!1,h(Fp),m(null),v(null)},$=()=>a.jsxs("div",{className:"space-y-6",children:[a.jsxs("section",{className:"space-y-4 rounded-2xl border border-indigo-100 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-3 text-indigo-700",children:[a.jsx(Ec,{className:"h-5 w-5"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-semibold",children:"Manual discovery"}),a.jsxs("p",{className:"text-xs text-indigo-600/80",children:["Tweak the next run without changing your saved preferences. Persistent settings now live in the",a.jsx("span",{className:"font-medium",children:" Active search feed"})," tab."]})]})]}),b&&a.jsx("div",{className:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:b}),g&&a.jsx("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs text-emerald-700",children:g}),a.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[a.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Base query",a.jsx("input",{type:"text",value:o.query,onChange:O=>C(Z=>({...Z,query:O.target.value})),placeholder:"e.g. generative AI for systematic reviews",className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"})]}),l&&a.jsxs("div",{className:"text-xs font-medium text-gray-700",children:["Project keywords",a.jsx("div",{className:"mt-1 rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-800",children:l.split(",").map(O=>O.trim()).filter(Boolean).join(", ")||"No keywords provided"})]}),a.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Max results per run",a.jsx("input",{type:"number",min:1,max:100,value:o.maxResults,onChange:O=>C(Z=>({...Z,maxResults:O.target.value})),placeholder:"20",className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"})]}),a.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Relevance threshold (0-1)",a.jsx("input",{type:"number",min:0,max:1,step:.05,value:o.relevanceThreshold,onChange:O=>C(Z=>({...Z,relevanceThreshold:O.target.value})),placeholder:"0.5",className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"})]})]}),a.jsxs("div",{className:"text-xs font-medium text-gray-700",children:["Sources",a.jsx("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:ix.map(O=>{const Z=o.sources.includes(O.value);return a.jsxs("label",{className:"flex items-center gap-2 rounded-md border border-gray-200 px-3 py-2 text-xs text-gray-600 hover:border-indigo-200",children:[a.jsx("input",{type:"checkbox",checked:Z,onChange:()=>dt(O.value),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),O.label]},O.value)})})]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[a.jsxs("button",{type:"button",onClick:()=>Re.mutate(),disabled:Re.isPending,className:"inline-flex items-center gap-2 rounded-full bg-green-700 px-4 py-2 font-medium text-white hover:bg-green-800 disabled:cursor-not-allowed disabled:opacity-60",children:[Re.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(vr,{className:"h-3.5 w-3.5"}),Re.isPending?"Running...":"Run Discovery"]}),a.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full bg-gray-100 px-3 py-1.5 text-xs text-gray-600",children:[a.jsx(mn,{className:"h-3.5 w-3.5"})," Last run ",Wi(Je),"  ",Ae," pending"]})]})]}),a.jsxs("section",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[a.jsx(vr,{className:"h-4 w-4 text-indigo-600"}),"Manual results"]}),a.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-gray-600",children:[a.jsxs("div",{className:"inline-flex items-center gap-1 rounded-full border border-gray-200 px-2 py-1",children:[a.jsx(E5,{className:"h-3.5 w-3.5"})," Status"]}),j1.map(O=>a.jsx("button",{type:"button",onClick:()=>f(O.value),className:`inline-flex items-center rounded-full px-3 py-1.5 ${d===O.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:O.label},O.value)),a.jsxs("button",{type:"button",onClick:()=>z.refetch(),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-gray-100",children:[a.jsx(Jo,{className:"h-3.5 w-3.5"})," Refresh"]}),d==="dismissed"&&a.jsxs("button",{type:"button",onClick:()=>De.mutate(),disabled:De.isPending,className:"inline-flex items-center gap-2 rounded-full border border-rose-200 px-3 py-1.5 text-xs font-medium text-rose-600 hover:bg-rose-50 disabled:cursor-not-allowed disabled:opacity-60",children:[De.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(nr,{className:"h-3.5 w-3.5"}),"Clear dismissed"]})]})]}),a.jsxs("div",{className:"space-y-3",children:[z.isLoading&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-16 w-full animate-pulse rounded-xl bg-gray-100"}),a.jsx("div",{className:"h-16 w-full animate-pulse rounded-xl bg-gray-100"})]}),!z.isLoading&&V.length===0&&a.jsx("div",{className:"rounded-xl border border-dashed border-gray-200 px-4 py-12 text-center text-xs text-gray-500",children:"No manual runs recorded for this project yet."}),!z.isLoading&&V.length>0&&a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between",children:[a.jsx("span",{className:"text-xs text-gray-500",children:E?`${T.length} selected`:`${V.length} result${V.length===1?"":"s"}`}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsxs("button",{type:"button",onClick:D,disabled:!P.length||he,className:`inline-flex items-center gap-2 rounded-full px-3 py-1.5 text-xs font-medium ${E?"border border-gray-300 text-gray-600 hover:bg-gray-100":"border border-rose-200 text-rose-600 hover:bg-rose-50"} disabled:cursor-not-allowed disabled:opacity-60`,children:[E?a.jsx(Jt,{className:"h-3.5 w-3.5"}):a.jsx(nr,{className:"h-3.5 w-3.5"}),E?"Cancel selection":"Delete results"]}),E&&a.jsxs(a.Fragment,{children:[a.jsx("button",{type:"button",onClick:ae,className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-600 hover:bg-gray-100",children:T.length===P.length?"Clear selection":"Select all"}),a.jsxs("button",{type:"button",onClick:je,disabled:!T.length||he,className:"inline-flex items-center gap-2 rounded-full border border-rose-200 px-3 py-1.5 text-xs font-medium text-rose-600 hover:bg-rose-50 disabled:cursor-not-allowed disabled:opacity-60",children:[he?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(nr,{className:"h-3.5 w-3.5"}),"Delete selected"]})]})]})]}),V.map(O=>{const Z=O.status!=="promoted",ne=T.includes(O.id),ye=!!(O.has_pdf??O.pdf_url),B=!!O.is_open_access,se=O.pdf_url??void 0;return a.jsxs("article",{className:`space-y-3 rounded-xl border px-4 py-4 text-sm text-gray-700 transition ${E&&ne?"border-rose-300 bg-rose-50/40":"border-gray-200 bg-white"}`,children:[a.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-base font-semibold text-gray-900",children:O.title??"Untitled result"}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-500",children:[a.jsx("span",{children:O.source}),O.doi&&a.jsxs("span",{className:"truncate",children:["DOI: ",O.doi]}),O.published_year&&a.jsx("span",{children:O.published_year}),ye&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-1 text-emerald-700",children:[a.jsx(Pu,{className:"h-3 w-3"})," PDF available"]}),B&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-1 text-sky-700",children:[a.jsx(ng,{className:"h-3 w-3"})," Open access"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2 self-start",children:[s(O.relevance_score),a.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${N1(O.status)}`,children:C1(O.status)}),E&&Z&&a.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-gray-500",children:[a.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-gray-300 text-rose-600 focus:ring-rose-500",checked:ne,onChange:()=>G(O.id)}),"Select"]})]})]}),O.summary&&a.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:O.summary}),a.jsxs("div",{className:"flex flex-col gap-2 text-xs text-gray-500 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1 text-gray-600",children:[a.jsx(mn,{className:"h-3 w-3"})," Discovered ",Wi(O.created_at)]}),se&&a.jsxs("a",{href:se,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2 py-1 text-emerald-700 hover:bg-emerald-200",children:[a.jsx(Pu,{className:"h-3 w-3"})," View PDF"]}),a.jsx("a",{href:O.source_url||(O.doi?`https://doi.org/${O.doi}`:"#"),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full bg-indigo-100 px-2 py-1 text-indigo-700 hover:bg-indigo-200",children:"View Source"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[!E&&O.status==="pending"&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",onClick:()=>re.mutate(O.id),disabled:re.isPending,className:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-3 py-1.5 font-medium text-white hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",children:[re.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(ql,{className:"h-3.5 w-3.5"}),"Add to project"]}),a.jsxs("button",{type:"button",onClick:()=>J.mutate(O.id),disabled:J.isPending,className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:[J.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(Jt,{className:"h-3.5 w-3.5"}),"Dismiss"]})]}),O.status!=="pending"&&O.promoted_at&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-1 text-emerald-700",children:[a.jsx(ql,{className:"h-3 w-3"})," Promoted ",Wi(O.promoted_at)]}),O.status==="dismissed"&&O.dismissed_at&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-rose-50 px-2 py-1 text-rose-700",children:[a.jsx(Jt,{className:"h-3 w-3"})," Dismissed ",Wi(O.dismissed_at)]})]})]})]},O.id)})]})]})]})]}),W=()=>{const O=u.autoRefresh?I7(u.refreshIntervalMinutes):"Auto-refresh off",Z=R.current;return a.jsxs("div",{className:"space-y-6",children:[a.jsxs("section",{className:"space-y-4 rounded-2xl border border-indigo-100 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center gap-3 text-indigo-700",children:[a.jsx(vr,{className:"h-5 w-5"}),a.jsxs("div",{children:[a.jsx("h2",{className:"text-base font-semibold",children:"Active feed preferences"}),a.jsx("p",{className:"text-xs text-indigo-600/80",children:"Configure the background discovery job that keeps Related Papers fresh."})]})]}),a.jsxs("div",{className:"inline-flex items-center gap-2 rounded-full bg-indigo-50 px-3 py-1.5 text-xs text-indigo-700",children:[a.jsx(mn,{className:"h-3.5 w-3.5"})," ",O]}),x&&a.jsx("div",{className:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-xs text-rose-700",children:x}),p&&a.jsx("div",{className:"rounded-lg border border-emerald-200 bg-emerald-50 px-3 py-2 text-xs text-emerald-700",children:p}),a.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[a.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Base query",a.jsx("input",{type:"text",value:u.query,onChange:ne=>_(ye=>({...ye,query:ne.target.value})),placeholder:"e.g. multimodal summarization for biomedical reviews",className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"})]}),l?a.jsxs("div",{className:"text-xs font-medium text-gray-700",children:["Project keywords",a.jsx("div",{className:"mt-1 rounded-md border border-gray-200 bg-gray-50 px-3 py-2 text-sm text-gray-800",children:l.split(",").map(ne=>ne.trim()).filter(Boolean).join(", ")})]}):a.jsxs("div",{className:"text-xs font-medium text-gray-500",children:["Project keywords",a.jsx("div",{className:"mt-1 rounded-md border border-dashed border-gray-200 px-3 py-2 text-sm",children:"No keywords set on project"})]}),a.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Max results per run",a.jsx("input",{type:"number",min:1,max:100,value:u.maxResults,onChange:ne=>_(ye=>({...ye,maxResults:ne.target.value})),placeholder:"20",className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"})]}),a.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Relevance threshold (0-1)",a.jsx("input",{type:"number",min:0,max:1,step:.05,value:u.relevanceThreshold,onChange:ne=>_(ye=>({...ye,relevanceThreshold:ne.target.value})),placeholder:"0.5",className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500"})]})]}),a.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[a.jsxs("label",{className:"flex items-center gap-2 text-xs font-medium text-gray-700",children:[a.jsx("input",{type:"checkbox",checked:u.autoRefresh,onChange:ne=>_(ye=>({...ye,autoRefresh:ne.target.checked})),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),"Enable background auto-refresh"]}),a.jsxs("label",{className:"text-xs font-medium text-gray-700",children:["Refresh interval (minutes, minimum ",Js,")",a.jsx("input",{type:"number",min:Js,step:5,value:u.refreshIntervalMinutes,onChange:ne=>_(ye=>({...ye,refreshIntervalMinutes:ne.target.value})),onBlur:ne=>{const ye=ne.target.value;if(ye==="")return;const B=Number(ye);Number.isFinite(B)&&B<Js&&_(se=>({...se,refreshIntervalMinutes:String(Js)}))},placeholder:String(oa),disabled:!u.autoRefresh,className:"mt-1 w-full rounded-md border border-gray-200 px-3 py-2 text-sm text-gray-900 focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500 disabled:bg-gray-50"})]})]}),a.jsxs("div",{className:"text-xs font-medium text-gray-700",children:["Sources",a.jsx("div",{className:"mt-3 grid gap-2 sm:grid-cols-2",children:ix.map(ne=>{const ye=u.sources.includes(ne.value);return a.jsxs("label",{className:"flex items-center gap-2 rounded-md border border-gray-200 px-3 py-2 text-xs text-gray-600 hover:border-indigo-200",children:[a.jsx("input",{type:"checkbox",checked:ye,onChange:()=>It(ne.value),className:"h-4 w-4 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),ne.label]},ne.value)})})]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[a.jsxs("button",{type:"button",onClick:()=>Ie.mutate(),disabled:Ie.isPending||!Z,className:"inline-flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-60",children:[Ie.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(ql,{className:"h-3.5 w-3.5"}),"Save preferences"]}),a.jsxs("button",{type:"button",onClick:Ft,disabled:Ie.isPending,className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-4 py-2 font-medium text-gray-600 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:[a.jsx(Jo,{className:"h-3.5 w-3.5"})," Reset to saved"]}),Z&&!Ie.isPending&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-amber-50 px-3 py-1.5 text-amber-700",children:[a.jsx(vr,{className:"h-3 w-3"})," Unsaved changes"]})]})]}),a.jsxs("section",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-gray-900",children:[a.jsx(mn,{className:"h-4 w-4 text-indigo-600"}),"Active search feed"]}),a.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-gray-600",children:[a.jsx("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1",children:O}),a.jsx("div",{className:"flex items-center gap-2",children:j1.map(ne=>a.jsx("button",{type:"button",onClick:()=>f(ne.value),className:`inline-flex items-center rounded-full px-3 py-1.5 ${d===ne.value?"bg-indigo-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:ne.label},ne.value))}),a.jsxs("button",{type:"button",onClick:()=>z.refetch(),className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100",children:[a.jsx(Jo,{className:"h-3.5 w-3.5"})," Refresh"]}),d==="dismissed"&&a.jsxs("button",{type:"button",onClick:()=>De.mutate(),disabled:De.isPending,className:"inline-flex items-center gap-2 rounded-full border border-rose-200 px-3 py-1.5 font-medium text-rose-600 hover:bg-rose-50 disabled:cursor-not-allowed disabled:opacity-60",children:[De.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(nr,{className:"h-3.5 w-3.5"}),"Clear dismissed"]})]})]}),!u.autoRefresh&&a.jsxs("div",{className:"rounded-lg border border-indigo-100 bg-indigo-50 px-3 py-2 text-xs text-indigo-700",children:["Turn on ",a.jsx("span",{className:"font-medium",children:"Enable background auto-refresh"})," above to let ScholarHub refresh this feed automatically."]}),ge>0&&a.jsxs("div",{className:"rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-xs text-amber-700",children:["Hiding ",ge," duplicate suggestion",ge===1?"":"s"," already shown in Related Papers."]}),a.jsxs("div",{className:"space-y-3",children:[z.isLoading&&a.jsxs("div",{className:"space-y-2",children:[a.jsx("div",{className:"h-16 w-full animate-pulse rounded-xl bg-gray-100"}),a.jsx("div",{className:"h-16 w-full animate-pulse rounded-xl bg-gray-100"})]}),!z.isLoading&&we.length===0&&a.jsx("div",{className:"rounded-xl border border-dashed border-gray-200 px-4 py-12 text-center text-xs text-gray-500",children:u.autoRefresh?"No new suggestions from the active feed yet. They will appear here as soon as the background run finishes.":"Turn on auto-refresh to populate this feed with background discovery suggestions."}),!z.isLoading&&we.length>0&&a.jsx("div",{className:"space-y-3",children:we.map(ne=>{const ye=!!(ne.has_pdf??ne.pdf_url),B=!!ne.is_open_access,se=ne.pdf_url??void 0;return a.jsxs("article",{className:"space-y-3 rounded-xl border border-gray-200 px-4 py-4 text-sm text-gray-700",children:[a.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-base font-semibold text-gray-900",children:ne.title??"Untitled result"}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-500",children:[a.jsx("span",{children:ne.source}),ne.doi&&a.jsxs("span",{className:"truncate",children:["DOI: ",ne.doi]}),ne.published_year&&a.jsx("span",{children:ne.published_year}),ne.relevance_score!=null&&a.jsxs("span",{children:["Score: ",ne.relevance_score.toFixed(2)]}),ye&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-1 text-emerald-700",children:[a.jsx(Pu,{className:"h-3 w-3"})," PDF available"]}),B&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-sky-50 px-2 py-1 text-sky-700",children:[a.jsx(ng,{className:"h-3 w-3"})," Open access"]})]})]}),a.jsxs("div",{className:"flex items-center gap-2 self-start",children:[s(ne.relevance_score),a.jsx("span",{className:`inline-flex items-center rounded-full px-3 py-1 text-xs font-medium ${N1(ne.status)}`,children:C1(ne.status)})]})]}),ne.summary&&a.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:ne.summary}),a.jsxs("div",{className:"flex flex-col gap-2 text-xs text-gray-500 sm:flex-row sm:items-center sm:justify-between",children:[a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-gray-100 px-2 py-1 text-gray-600",children:[a.jsx(mn,{className:"h-3 w-3"})," Discovered ",Wi(ne.created_at)]}),se&&a.jsxs("a",{href:se,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full bg-emerald-100 px-2 py-1 text-emerald-700 hover:bg-emerald-200",children:[a.jsx(Pu,{className:"h-3 w-3"})," View PDF"]}),a.jsx("a",{href:ne.source_url||(ne.doi?`https://doi.org/${ne.doi}`:"#"),target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 rounded-full bg-indigo-100 px-2 py-1 text-indigo-700 hover:bg-indigo-200",children:"View Source"})]}),a.jsxs("div",{className:"flex items-center gap-2",children:[ne.status==="pending"&&a.jsxs(a.Fragment,{children:[a.jsxs("button",{type:"button",onClick:()=>re.mutate(ne.id),disabled:re.isPending,className:"inline-flex items-center gap-2 rounded-full bg-emerald-600 px-3 py-1.5 font-medium text-white hover:bg-emerald-700 disabled:cursor-not-allowed disabled:opacity-60",children:[re.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(ql,{className:"h-3.5 w-3.5"}),"Add to project"]}),a.jsxs("button",{type:"button",onClick:()=>J.mutate(ne.id),disabled:J.isPending,className:"inline-flex items-center gap-2 rounded-full border border-gray-200 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100 disabled:cursor-not-allowed disabled:opacity-60",children:[J.isPending?a.jsx(gt,{className:"h-3.5 w-3.5 animate-spin"}):a.jsx(Jt,{className:"h-3.5 w-3.5"}),"Dismiss"]})]}),ne.status!=="pending"&&ne.promoted_at&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-emerald-50 px-2 py-1 text-emerald-700",children:[a.jsx(ql,{className:"h-3 w-3"})," Promoted ",Wi(ne.promoted_at)]}),ne.status==="dismissed"&&ne.dismissed_at&&a.jsxs("span",{className:"inline-flex items-center gap-1 rounded-full bg-rose-50 px-2 py-1 text-rose-700",children:[a.jsx(Jt,{className:"h-3 w-3"})," Dismissed ",Wi(ne.dismissed_at)]})]})]})]},ne.id)})})]})]})]})};return r?a.jsx(l0,{to:`/projects/${t.id}/related-papers`,replace:!0}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("div",{className:"inline-flex items-center gap-2 rounded-2xl border border-gray-200 bg-white p-2 shadow-sm text-sm",children:[a.jsx("button",{type:"button",onClick:()=>j("manual"),className:`rounded-full px-4 py-2 font-medium transition-colors ${S==="manual"?"bg-indigo-600 text-white shadow":"text-gray-600 hover:bg-gray-100"}`,children:"Manual discovery"}),a.jsx("button",{type:"button",onClick:()=>j("active"),className:`rounded-full px-4 py-2 font-medium transition-colors ${S==="active"?"bg-indigo-600 text-white shadow":"text-gray-600 hover:bg-gray-100"}`,children:"Active search feed"})]}),S==="manual"?$():W()]})},z7=({isOpen:t,onClose:e,onSubmit:n,title:r="Add Manual Reference"})=>{const[s,i]=w.useState(""),[l,o]=w.useState(""),[c,u]=w.useState(""),[h,d]=w.useState(""),[f,p]=w.useState(""),[m,x]=w.useState(""),[v,g]=w.useState(""),[y,b]=w.useState(null),[k,S]=w.useState(!1),[j,E]=w.useState(null),A=()=>{i(""),o(""),u(""),d(""),p(""),x(""),g(""),b(null),E(null)},T=()=>{k||(A(),e())},N=async I=>{var R,C;if(I.preventDefault(),!s.trim()){E("Title is required");return}S(!0),E(null);try{await n({title:s.trim(),authors:l.split(",").map(_=>_.trim()).filter(Boolean),year:c?Number(c):void 0,doi:h||void 0,url:f||void 0,journal:m||void 0,abstract:v||void 0,pdfFile:y}),A(),e()}catch(_){const M=(C=(R=_==null?void 0:_.response)==null?void 0:R.data)==null?void 0:C.detail;typeof M=="string"?E(M):M!=null&&M.message?E(M.message):E(_.message||"Unable to add reference right now.")}finally{S(!1)}};return t?a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 px-4",children:a.jsxs("div",{className:"w-full max-w-2xl overflow-hidden rounded-xl bg-white shadow-xl",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-5 py-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:r}),a.jsx("button",{type:"button",onClick:T,className:"rounded-full p-1 text-gray-400 hover:text-gray-600",title:"Close",children:a.jsx(Jt,{className:"h-5 w-5"})})]}),a.jsxs("form",{onSubmit:N,className:"space-y-5 px-5 py-4",children:[j&&a.jsx("div",{className:"rounded-md border border-red-200 bg-red-50 px-3 py-2 text-sm text-red-700",children:j}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-title",children:"Title *"}),a.jsx("input",{id:"ref-title",type:"text",value:s,onChange:I=>i(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Enter paper title",disabled:k,required:!0})]}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-authors",children:"Authors"}),a.jsx("input",{id:"ref-authors",type:"text",value:l,onChange:I=>o(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Comma-separated list",disabled:k})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-year",children:"Year"}),a.jsx("input",{id:"ref-year",type:"number",value:c,onChange:I=>u(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"2024",disabled:k,min:"0"})]})]}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-doi",children:"DOI"}),a.jsx("input",{id:"ref-doi",type:"text",value:h,onChange:I=>d(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"10.1234/abcd.5678",disabled:k})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-url",children:"URL"}),a.jsx("input",{id:"ref-url",type:"url",value:f,onChange:I=>p(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"https://example.com",disabled:k})]})]}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-journal",children:"Journal / Source"}),a.jsx("input",{id:"ref-journal",type:"text",value:m,onChange:I=>x(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",placeholder:"Journal name",disabled:k})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-pdf",children:"Attach PDF (optional)"}),a.jsxs("label",{className:`flex cursor-pointer items-center justify-between rounded-md border border-dashed border-gray-300 px-3 py-2 text-sm text-gray-600 ${k?"opacity-60":"hover:border-indigo-400 hover:text-indigo-600"}`,children:[a.jsx("span",{className:"truncate",children:y?y.name:"Choose file"}),a.jsxs("span",{className:"flex items-center gap-1 text-indigo-600",children:[a.jsx(IT,{className:"h-4 w-4"}),"Browse"]}),a.jsx("input",{id:"ref-pdf",type:"file",accept:"application/pdf",className:"hidden",disabled:k,onChange:I=>{var C;const R=(C=I.target.files)==null?void 0:C[0];b(R??null)}})]}),a.jsx("p",{className:"text-xs text-gray-400",children:"PDF is optional and helps AI enrichment."})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx("label",{className:"text-sm font-medium text-gray-700",htmlFor:"ref-abstract",children:"Abstract"}),a.jsx("textarea",{id:"ref-abstract",value:v,onChange:I=>g(I.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-indigo-500 focus:outline-none focus:ring-1 focus:ring-indigo-500",rows:4,placeholder:"Optional short abstract or summary",disabled:k})]}),a.jsxs("div",{className:"flex items-center justify-end gap-3 border-t border-gray-100 pt-4",children:[a.jsx("button",{type:"button",onClick:T,className:"inline-flex items-center rounded-full border border-gray-200 px-4 py-2 text-sm font-medium text-gray-600 hover:bg-gray-100",disabled:k,children:"Cancel"}),a.jsx("button",{type:"submit",className:"inline-flex items-center rounded-full bg-indigo-600 px-4 py-2 text-sm font-medium text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:opacity-60",disabled:k,children:k?"Saving":"Add related paper"})]})]})]})}):null},$7=()=>{var re;const{project:t}=qr(),{user:e}=Ln(),n=qs(),[r,s]=w.useState(!1),[i,l]=w.useState(null),[o,c]=w.useState(null),[u,h]=w.useState(null),[d,f]=w.useState(null),[p,m]=w.useState(!1),[x,v]=w.useState(!1),[g,y]=w.useState(null),b=w.useRef(null),k=w.useRef(null),S=w.useRef(null),j=Tt({queryKey:["project",t.id,"relatedReferences"],queryFn:async()=>{var J;try{return(await An.list(t.id,{status:"approved"})).data}catch(Q){if(((J=Q.response)==null?void 0:J.status)===404)return{disabled:!0,references:[]};throw Q}}}),E=j.data,A=E?"disabled"in E&&E.disabled:!1,T=(E==null?void 0:E.references)??[],N=e==null?void 0:e.id,I=t.created_by===N,R=(re=t.members)==null?void 0:re.find(J=>J.user_id===N),C=I||((R==null?void 0:R.role)||"").toLowerCase()==="owner"?"admin":((R==null?void 0:R.role)||"").toLowerCase(),_=["admin","editor"].includes(C),M=["admin","editor"].includes(C),z=async J=>{var ae;const he=(await gr.create({title:J.title,authors:J.authors,year:J.year,doi:J.doi,url:J.url,journal:J.journal,abstract:J.abstract,source:"manual",is_open_access:void 0})).data,Re=(he==null?void 0:he.id)||(he==null?void 0:he.reference_id)||(he==null?void 0:he.referenceId)||((ae=he==null?void 0:he.reference)==null?void 0:ae.id)||"";if(!Re)throw new Error("Reference was created but returned no id.");J.pdfFile&&await gr.uploadPdf(Re,J.pdfFile);const D=(await An.createSuggestion(t.id,Re,1)).data,G=D==null?void 0:D.id;G&&await An.approveSuggestion(t.id,G),await n.invalidateQueries({queryKey:["project",t.id,"relatedReferences"]})},q=J=>{M&&(l(J),S.current&&(S.current.value="",S.current.click()))},F=async J=>{var he;if(!M){l(null),S.current&&(S.current.value="");return}const Q=(he=J.target.files)==null?void 0:he[0];if(!Q||!i){l(null),S.current&&(S.current.value="");return}try{c(i),await gr.uploadPdf(i,Q),await n.invalidateQueries({queryKey:["project",t.id,"relatedReferences"]})}catch(Re){console.error("Failed to upload PDF",Re),alert("Failed to upload PDF. Please try again.")}finally{c(null),l(null),S.current&&(S.current.value="")}},V=async J=>{if(M)try{h(J),await gr.ingestPdf(J),await n.invalidateQueries({queryKey:["project",t.id,"relatedReferences"]})}catch(Q){console.error("Failed to ingest existing PDF",Q),alert("Unable to ingest the existing PDF. Please try again or upload a new file.")}finally{h(null)}},P=()=>{k.current&&(clearTimeout(k.current),k.current=null),y(null),b.current=null},H=()=>{k.current&&clearTimeout(k.current),k.current=setTimeout(()=>{P()},6500)},Y=J=>{b.current=J;const Q=J.title?`Deleted ${J.title}`:"Related paper deleted";y(J.referenceId?{message:`${Q}.`,actionLabel:"Undo",onAction:L}:{message:`${Q}.`}),H()},L=async()=>{if(!b.current||!b.current.referenceId){P();return}try{const Q=(await An.createSuggestion(t.id,b.current.referenceId,1)).data,he=Q==null?void 0:Q.id;he&&(await An.approveSuggestion(t.id,he),await n.invalidateQueries({queryKey:["project",t.id,"relatedReferences"]})),P()}catch(J){console.error("Failed to undo delete",J),y({message:"Unable to restore the related paper. Please try again."}),H()}},Se=async()=>{if(!(!d||!M))try{v(!0),await An.remove(t.id,d.projectReferenceId),await n.invalidateQueries({queryKey:["project",t.id,"relatedReferences"]}),Y(d)}catch(J){console.error("Failed to remove related paper",J),y({message:"Unable to remove the related paper right now. Please try again."}),H()}finally{v(!1),m(!1),f(null)}},we=async()=>{!g||!g.onAction||(k.current&&(clearTimeout(k.current),k.current=null),await g.onAction())};w.useEffect(()=>()=>{k.current&&clearTimeout(k.current)},[]);const ge={emerald:"border border-emerald-200 bg-emerald-50 text-emerald-700",amber:"border border-amber-200 bg-amber-50 text-amber-700",slate:"border border-slate-200 bg-slate-100 text-slate-600",sky:"border border-sky-200 bg-sky-50 text-sky-700",purple:"border border-purple-200 bg-purple-50 text-purple-700"},Ce=({label:J,tone:Q,icon:he})=>a.jsxs("span",{className:`inline-flex items-center gap-1 rounded-full px-2.5 py-1 text-xs font-medium ${ge[Q]}`,children:[he,J]}),Ie=J=>{if(!J)return null;try{return new Date(J).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}catch{return null}};return j.isLoading?a.jsxs("div",{className:"flex items-center gap-3 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm text-sm text-gray-600",children:[a.jsx(gt,{className:"h-4 w-4 animate-spin text-indigo-600"}),"Loading project intelligence"]}):A?a.jsx("div",{className:"rounded-2xl border border-dashed border-gray-200 bg-white p-6 text-sm text-gray-500",children:a.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx(Cc,{className:"h-4 w-4"}),"Project reference intelligence is currently disabled for this environment."]})}):a.jsxs("div",{className:"space-y-6",children:[a.jsxs("section",{className:"space-y-4 rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(hs,{className:"h-4 w-4 text-indigo-600"}),a.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Related papers"})]}),_&&a.jsxs("button",{type:"button",onClick:()=>s(!0),className:"inline-flex items-center gap-1 rounded-full border border-indigo-200 px-3 py-1.5 text-xs font-medium text-indigo-600 hover:bg-indigo-50",children:[a.jsx(xn,{className:"h-3.5 w-3.5"}),"Add related paper"]})]}),T.length===0?a.jsx("div",{className:"rounded-xl border border-dashed border-gray-300 bg-gray-50 p-6 text-sm text-gray-500",children:"No approved related papers yet. Review suggestions from the Discovery tab to build this list."}):a.jsx("ul",{className:"space-y-3",children:T.map(J=>{const Q=J.reference,he=Q!=null&&Q.status?{tone:Q.status==="analyzed"?"emerald":Q.status==="ingested"?"amber":"slate",label:Q.status==="pending"?"Analysis Pending PDF":Q.status==="ingested"?"Analysis: ingested":`Analysis: ${Q.status.replace(/_/g," ")}`,icon:Q.status==="analyzed"?a.jsx(vr,{className:"h-3.5 w-3.5"}):a.jsx(ln,{className:"h-3.5 w-3.5"})}:null,Re=(Q==null?void 0:Q.document_download_url)||null,De=Ie(J.decided_at),D=typeof J.confidence=="number"?Math.round(Math.min(Math.max(J.confidence,0),1)*100):null,G=(Q==null?void 0:Q.summary)||(Q==null?void 0:Q.abstract),ae=(Q==null?void 0:Q.id)||J.reference_id||null,je=!!(Q!=null&&Q.document_id),de=!!(Q!=null&&Q.pdf_url||Re||je),Ae=!!(M&&ae&&(Q!=null&&Q.pdf_url)&&!(Q!=null&&Q.pdf_processed)),Je=!!(M&&ae&&!de);return a.jsx("li",{className:"rounded-xl border border-gray-200 bg-white p-5 text-sm text-gray-700 shadow-sm transition hover:border-indigo-200",children:a.jsxs("div",{className:"flex flex-col gap-4",children:[a.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-start md:justify-between",children:[a.jsxs("div",{className:"space-y-1 md:max-w-3xl",children:[a.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[a.jsx("p",{className:"font-semibold text-gray-900",children:(Q==null?void 0:Q.title)??"Untitled reference"}),(Q==null?void 0:Q.year)&&a.jsx(Ce,{label:`Year ${Q.year}`,tone:"slate",icon:a.jsx(ln,{className:"h-3 w-3"})}),(Q==null?void 0:Q.source)&&a.jsx(Ce,{label:Q.source,tone:"slate",icon:a.jsx(hs,{className:"h-3 w-3"})})]}),(Q==null?void 0:Q.authors)&&Q.authors.length>0&&a.jsx("p",{className:"text-xs text-gray-500",children:Q.authors.join(", ")}),(Q==null?void 0:Q.journal)&&a.jsx("p",{className:"text-xs text-gray-500",children:Q.journal})]}),a.jsxs("div",{className:"mt-2 flex items-center gap-3 sm:gap-4 md:mt-0",children:[Je?a.jsx("button",{type:"button",className:"inline-flex h-9 items-center rounded-full bg-amber-500 px-3 text-xs font-semibold uppercase tracking-wide text-white transition hover:bg-amber-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-amber-400 disabled:cursor-not-allowed disabled:bg-amber-300",onClick:()=>ae&&q(ae),disabled:!!o,children:o===ae?"Uploading":"Upload PDF"}):a.jsx("span",{className:"inline-flex h-9 items-center rounded-full bg-emerald-50 px-3 text-[11px] font-semibold uppercase tracking-wide text-emerald-600",children:"PDF on file"}),M&&a.jsx("button",{type:"button",className:"inline-flex h-9 w-9 items-center justify-center rounded-full text-rose-600 transition hover:bg-rose-50 hover:text-rose-700 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-1 focus-visible:outline-rose-500",onClick:()=>{f({projectReferenceId:J.id,referenceId:ae,title:(Q==null?void 0:Q.title)??"Related paper"}),m(!0)},"aria-label":"Delete related paper",title:"Delete",children:a.jsx(nr,{className:"h-3.5 w-3.5"})})]})]}),(G||J.papers&&J.papers.length>0)&&a.jsxs("div",{className:"space-y-2",children:[G&&a.jsx("p",{className:"text-xs text-gray-600 line-clamp-3 whitespace-pre-line",children:G}),J.papers&&J.papers.length>0&&a.jsxs("p",{className:"text-xs text-gray-500",children:["Appears in:"," ",J.papers.map(Ye=>Ye.title??"Untitled paper").join(", ")]})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[he&&a.jsx(Ce,{label:he.label,tone:he.tone,icon:he.icon}),(Q==null?void 0:Q.is_open_access)&&a.jsx(Ce,{label:"Open access",tone:"sky",icon:a.jsx(ng,{className:"h-3.5 w-3.5"})}),D!==null&&a.jsx(Ce,{label:`Confidence ${D}%`,tone:"purple",icon:a.jsx(vr,{className:"h-3.5 w-3.5"})}),Ae&&ae&&a.jsxs("button",{type:"button",className:"inline-flex items-center gap-1 rounded-full border border-emerald-200 bg-emerald-50 px-3 py-1.5 text-xs font-medium text-emerald-700 transition hover:bg-emerald-100 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-emerald-500 disabled:cursor-not-allowed disabled:opacity-60",disabled:!!u,onClick:()=>V(ae),children:[a.jsx(vr,{className:"h-3.5 w-3.5"}),u===ae?"Ingesting":"Ingest existing PDF"]})]}),a.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-2 text-xs text-gray-500",children:[(Q==null?void 0:Q.doi)&&a.jsxs("a",{href:Q.doi.startsWith("http")?Q.doi:`https://doi.org/${Q.doi}`,className:"inline-flex items-center gap-1 hover:text-indigo-600",target:"_blank",rel:"noopener noreferrer",children:[a.jsx(ln,{className:"h-3 w-3"}),"DOI"]}),(Q==null?void 0:Q.url)&&a.jsxs("a",{href:Q.url,className:"inline-flex items-center gap-1 hover:text-indigo-600",target:"_blank",rel:"noopener noreferrer",children:[a.jsx(Io,{className:"h-3 w-3"}),"Source link"]}),De&&a.jsxs("span",{className:"inline-flex items-center gap-1",children:[a.jsx(ln,{className:"h-3 w-3"})," Decided ",De]})]})]})},J.id)})})]}),a.jsx("input",{ref:S,type:"file",accept:"application/pdf",className:"hidden",onChange:F}),_&&a.jsx(z7,{isOpen:r,onClose:()=>s(!1),onSubmit:z,title:"Add Related Paper"}),a.jsx(F0,{isOpen:p,onClose:()=>{x||(m(!1),f(null))},onConfirm:Se,title:"Delete this item?",description:"This related paper will be removed from the project. You can undo this action for a short time after deletion.",confirmLabel:x?"Deleting":"Delete",cancelLabel:"Cancel",confirmButtonColor:"red",confirmTone:"danger",isSubmitting:x}),g&&a.jsx("div",{className:"fixed bottom-6 right-6 z-40",children:a.jsxs("div",{className:"flex items-center gap-3 rounded-lg bg-gray-900 px-4 py-3 text-sm text-white shadow-xl",children:[a.jsx("span",{className:"max-w-xs leading-snug",children:g.message}),g.actionLabel&&g.onAction&&a.jsx("button",{type:"button",className:"inline-flex items-center justify-center rounded border border-white/40 px-3 py-1 text-xs font-semibold uppercase tracking-wide transition hover:bg-white hover:text-gray-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white",onClick:we,children:g.actionLabel}),a.jsx("button",{type:"button",className:"inline-flex h-8 w-8 items-center justify-center rounded-full text-white/80 transition hover:bg-white/10 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-white","aria-label":"Dismiss notification",onClick:P,children:"X"})]})})]})},U7=()=>{const{project:t}=qr(),e=t==null?void 0:t.id,n=Tt({queryKey:["project",e,"notifications"],queryFn:async()=>e?(await mM.listProjectNotifications(e)).data.notifications:[],enabled:!!e,staleTime:3e4}),r=n.data??[],s=d=>{if(!d)return"";const f=new Date(d);return Number.isNaN(f.getTime())?"":`${f.toLocaleDateString()} ${f.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}`},i=d=>{if(!d)return"";const f=new Date(d);if(Number.isNaN(f.getTime()))return"";const p=Date.now()-f.getTime(),m=60*1e3,x=60*m,v=24*x,g=7*v;if(p<m)return"just now";if(p<x)return`${Math.floor(p/m)} min ago`;if(p<v){const y=Math.floor(p/x);return`${y} hr${y===1?"":"s"} ago`}if(p<g){const y=Math.floor(p/v);return`${y} day${y===1?"":"s"} ago`}return f.toLocaleDateString()},l=d=>d?d.charAt(0).toUpperCase()+d.slice(1):"unknown",o=d=>{if(d==null||Number.isNaN(Number(d)))return null;const f=Math.max(0,Math.floor(Number(d))),p=Math.floor(f/60),m=f%60;return p===0?`${m}s`:`${p}m ${m.toString().padStart(2,"0")}s`},c=({key:d,icon:f,iconClassName:p,title:m,subtitle:x,badges:v,recordedAt:g,recordedRelative:y,meta:b,content:k})=>{const S=j=>{switch(j){case"positive":return"bg-emerald-100 text-emerald-700";case"warning":return"bg-amber-100 text-amber-700";case"danger":return"bg-rose-100 text-rose-700";case"neutral":return"bg-gray-100 text-gray-600";default:return"bg-indigo-100 text-indigo-600"}};return a.jsx("li",{className:"rounded-2xl border border-gray-200 bg-white p-5 shadow-sm",children:a.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-start md:gap-5",children:[a.jsxs("div",{className:"flex items-center gap-3 md:w-56",children:[a.jsx("span",{className:`flex h-10 w-10 items-center justify-center rounded-full ${p}`,children:f}),a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"text-sm font-semibold text-gray-900",children:m}),x&&a.jsx("p",{className:"text-xs text-gray-500",children:x})]})]}),a.jsxs("div",{className:"flex-1 space-y-3",children:[a.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-gray-400",children:[y&&a.jsx("span",{title:g,children:y}),v==null?void 0:v.map(j=>a.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ${S(j.tone)}`,children:j.label},j.label)),b]}),k]})]})},d)},u=d=>{const f=d.payload??{},p=typeof f.recorded_at=="string"?f.recorded_at:d.created_at,m=s(p),x=i(p);if(d.type.startsWith("sync-session.")){const v=typeof f.action=="string"?f.action:d.type.split(".").pop()??"updated",g=f.actor??{},y=typeof g.name=="string"&&g.name.trim()?g.name:typeof g.email=="string"?g.email:"Team member",b=typeof f.provider=="string"?f.provider:"daily",k=typeof f.status=="string"?f.status:null,S=typeof f.started_at=="string"?f.started_at:null,j=typeof f.ended_at=="string"?f.ended_at:null,E=o(typeof f.duration_seconds=="number"?f.duration_seconds:Number(f.duration_seconds)),A=(typeof k=="string"?k:v).toLowerCase(),T=l(A);return c({key:d.id,icon:a.jsx(sg,{className:"h-4 w-4"}),iconClassName:"bg-sky-100 text-sky-600",title:`Call ${v}`,subtitle:`${y}  ${b}`,badges:T?[{label:T,tone:A==="cancelled"?"danger":A==="ended"?"neutral":"positive"}]:void 0,recordedAt:m,recordedRelative:x,meta:a.jsxs("div",{className:"flex items-center gap-2 text-[11px] text-gray-400",children:[S&&a.jsxs("span",{title:s(S),children:["Started ",i(S)]}),j&&a.jsxs("span",{title:s(j),children:["Ended ",i(j)]}),E&&a.jsxs("span",{className:"text-gray-500",children:["Duration ",E]})]}),content:a.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3 text-sm text-gray-700",children:[a.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Session summary"}),a.jsxs("p",{className:"mt-1 text-sm text-gray-700",children:["Status: ",l(k??v),"."]})]})})}if(d.type.startsWith("paper.")){const v=typeof f.action=="string"?f.action:d.type.split(".").pop()??"updated",g=f.actor??{},y=typeof g.name=="string"&&g.name.trim()?g.name:typeof g.email=="string"?g.email:"Contributor",b=typeof f.paper_title=="string"?f.paper_title:"Untitled paper",k=Array.isArray(f.updated_fields)?f.updated_fields.filter(A=>typeof A=="string"):[],S=d.type==="paper.created",j=S?a.jsx(j5,{className:"h-4 w-4"}):a.jsx(ev,{className:"h-4 w-4"}),E=S?"bg-emerald-100 text-emerald-700":"bg-amber-100 text-amber-700";return c({key:d.id,icon:j,iconClassName:E,title:`Paper ${v}`,subtitle:y,badges:!S&&k.length>0?[{label:`Fields: ${k.join(", ")}`,tone:"neutral"}]:void 0,recordedAt:m,recordedRelative:x,content:a.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3",children:[a.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Paper"}),a.jsx("p",{className:"mt-1 text-sm text-gray-700",children:b})]})})}if(d.type==="project.updated"){const v=f.actor??{},g=typeof v.name=="string"&&v.name.trim()?v.name:typeof v.email=="string"?v.email:"Project owner",y=Array.isArray(f.updated_fields)?f.updated_fields.filter(k=>typeof k=="string"):[],b=typeof f.project_title=="string"&&f.project_title?f.project_title:t.title;return c({key:d.id,icon:a.jsx(m0,{className:"h-4 w-4"}),iconClassName:"bg-indigo-100 text-indigo-600",title:"Project updated",subtitle:g,badges:y.length>0?[{label:y.join(", "),tone:"neutral"}]:void 0,recordedAt:m,recordedRelative:x,content:a.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3 text-sm text-gray-700",children:[a.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Project"}),a.jsx("p",{className:"mt-1 text-sm text-gray-700",children:b})]})})}if(d.type.startsWith("project-reference.")){const v=f.actor??{},g=typeof v.name=="string"&&v.name.trim()?v.name:typeof v.email=="string"?v.email:"Team member",y=typeof f.reference_title=="string"&&f.reference_title?f.reference_title:"Untitled reference",b=typeof f.paper_title=="string"&&f.paper_title?f.paper_title:null,k=typeof f.confidence=="number"?`${Math.round(f.confidence*100)}%`:null,S=typeof f.source=="string"?f.source:null,j=d.type.split(".").pop()??"updated",E=[];return k&&E.push({label:`Confidence ${k}`,tone:"positive"}),S&&E.push({label:l(S.replace("-"," ")),tone:"neutral"}),c({key:d.id,icon:a.jsx(ev,{className:"h-4 w-4"}),iconClassName:"bg-purple-100 text-purple-700",title:`Related paper ${j}`,subtitle:g,badges:E,recordedAt:m,recordedRelative:x,content:a.jsxs("div",{className:"space-y-3",children:[a.jsxs("div",{className:"rounded-lg border border-gray-100 bg-gray-50 p-3",children:[a.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-gray-500",children:"Related paper"}),a.jsx("p",{className:"mt-1 text-sm text-gray-700",children:y})]}),b&&a.jsxs("div",{className:"rounded-lg border border-indigo-100 bg-indigo-50 p-3 text-sm text-indigo-700",children:[a.jsx("p",{className:"text-[10px] font-semibold uppercase tracking-wide text-indigo-500",children:"Linked paper"}),a.jsx("p",{className:"mt-1 text-sm",children:b})]})]})})}return c({key:d.id,icon:a.jsx(Cc,{className:"h-5 w-5"}),iconClassName:"bg-gray-100 text-gray-500",title:d.type,subtitle:"Activity details not yet captured",recordedAt:m,recordedRelative:x})},h=w.useMemo(()=>{if(n.isLoading)return a.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-gray-200 bg-white px-4 py-3 text-sm text-gray-500",children:[a.jsx(gt,{className:"h-4 w-4 animate-spin text-indigo-600"}),"Fetching recent activity"]});if(n.isError)return a.jsxs("div",{className:"flex items-start gap-2 rounded-xl border border-rose-200 bg-rose-50 px-4 py-3 text-sm text-rose-600",children:[a.jsx(Cc,{className:"mt-0.5 h-4 w-4"}),"Unable to load updates right now. Please refresh and try again."]});if(r.length===0)return a.jsx("div",{className:"rounded-xl border border-dashed border-gray-300 bg-gray-50 p-8 text-sm text-gray-500",children:"Project activity will appear here once teammates start collaborating (calls, paper edits, references, and more)."});const d=r.slice(0,20);return a.jsx("ol",{className:"space-y-4",children:d.map(f=>u(f))})},[r,n.isError,n.isLoading]);return a.jsxs("div",{className:"rounded-2xl border border-gray-200 bg-white p-6 shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between gap-2",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(LM,{className:"h-4 w-4 text-indigo-600"}),a.jsx("h2",{className:"text-base font-semibold text-gray-900",children:"Updates & activity"})]}),a.jsxs("span",{className:"text-xs text-gray-400",children:["Project feed for ",t.title]})]}),a.jsx("div",{className:"mt-6 space-y-4",children:h})]})},H7=()=>{const{projectId:t,paperId:e}=$i(),n=Qn(),{user:r}=Ln(),{project:s}=qr(),[i,l]=w.useState(null),[o,c]=w.useState([]),[u,h]=w.useState([]),[d,f]=w.useState(!0),[p,m]=w.useState(null),[x,v]=w.useState(!1),[g,y]=w.useState(!1),[b,k]=w.useState(!1),[S,j]=w.useState(!1),[E,A]=w.useState(!1),T=(s==null?void 0:s.members)??[],N=r==null?void 0:r.id,I=w.useMemo(()=>{if(!s||!N)return"viewer";if(s.created_by===N)return"admin";const D=T.find(ae=>ae.user_id===N);if(!D||(D.status||"").toLowerCase()!=="accepted")return"viewer";const G=(D.role||"").toLowerCase();return G==="owner"?"admin":G==="reviewer"?"viewer":G==="admin"||G==="editor"?G:"viewer"},[s,T,N]),R=["admin","editor"].includes(I),C=I==="admin",_=["admin","editor"].includes(I),M=()=>{i&&n(z(`/papers/${i.id}/view`))},z=(D="")=>{const G=t||(s==null?void 0:s.id)||(i==null?void 0:i.project_id);return G?`/projects/${G}${D}`:`/projects${D}`},q=()=>{n(z())},[F,V]=w.useState({}),P=w.useRef(null);w.useEffect(()=>{e&&H()},[e]),w.useEffect(()=>{!e||!(s!=null&&s.id)||Y()},[e,s==null?void 0:s.id]),w.useEffect(()=>{!R&&x&&v(!1)},[R,x]),w.useEffect(()=>{if(!E)return;const D=G=>{P.current&&!P.current.contains(G.target)&&A(!1)};return document.addEventListener("mousedown",D),()=>document.removeEventListener("mousedown",D)},[E]),w.useEffect(()=>{x&&A(!1)},[x]);const H=async()=>{var D,G;if(e){f(!0);try{const je=(await rt.getPaper(e)).data;l(je),V({title:je.title,abstract:je.abstract,status:je.status,paper_type:je.paper_type,keywords:je.keywords,references:je.references,is_public:je.is_public});try{const de=await gM.getDocuments(e,0,50);c(de.data.documents)}catch(de){const Ae=de;((D=Ae==null?void 0:Ae.response)==null?void 0:D.status)===403?c([]):(console.error("Error loading paper documents:",de),c([]))}}catch(ae){const je=ae;if(je){const de=(G=je.response)==null?void 0:G.status;if(de===404){n("/projects");return}m(de===403?"You do not have permission to view this paper.":"Failed to load paper.")}else console.error("Error loading paper data:",ae),m("Failed to load paper.")}finally{f(!1)}}},Y=async()=>{var D;try{if(!(s!=null&&s.id)||!e)return;const G=await An.listPaperReferences(s.id,e);h(((D=G.data)==null?void 0:D.references)||[])}catch(G){console.error("Error loading references:",G),h([])}},L=async()=>{if(i){if(!R){alert("You do not have permission to update this paper.");return}try{y(!0);const D=await rt.updatePaper(i.id,F);l(D.data),v(!1)}catch(D){console.error("Error updating paper:",D),alert("Error updating paper. Please try again.")}finally{y(!1)}}},Se=()=>{V({title:i==null?void 0:i.title,abstract:i==null?void 0:i.abstract,status:i==null?void 0:i.status,paper_type:i==null?void 0:i.paper_type,keywords:i==null?void 0:i.keywords,references:i==null?void 0:i.references,is_public:i==null?void 0:i.is_public}),v(!1)},we=()=>{if(!R){alert("You do not have permission to edit this paper.");return}const D=t||(i==null?void 0:i.project_id);D&&n(`/projects/${D}/papers/${e}/editor`)},ge=()=>{if(!C){alert("You do not have permission to delete this paper.");return}k(!0)},Ce=async()=>{if(i){if(!C){k(!1),alert("You do not have permission to delete this paper.");return}try{await rt.deletePaper(i.id),n(z())}catch(D){console.error("Error deleting paper:",D),alert("Error deleting paper. Please try again.")}finally{k(!1)}}},Ie=D=>{switch(D){case"completed":return"bg-green-100 text-green-800";case"in_progress":return"bg-yellow-100 text-yellow-800";case"published":return"bg-indigo-100 text-indigo-800";case"draft":default:return"bg-gray-100 text-gray-800"}},re=D=>({research:"Research",review:"Literature Review",case_study:"Case Study",methodology:"Methodology",theoretical:"Theoretical",experimental:"Experimental"})[D]||D,J=D=>{const G=(D||"").toLowerCase();return G==="admin"||G==="editor"||G==="viewer"?G:G==="owner"?"admin":"viewer"},Q=D=>{switch(D){case"admin":return a.jsx(g0,{className:"h-4 w-4 text-purple-600"});case"editor":return a.jsx(Gh,{className:"h-4 w-4 text-green-600"});default:return a.jsx(Ac,{className:"h-4 w-4 text-gray-500"})}},he=w.useMemo(()=>{const D={admin:0,editor:1,viewer:2};return[...T].sort((G,ae)=>{var Ae,Je;const je=G.user_id===(s==null?void 0:s.created_by)?"admin":J(G.role),de=ae.user_id===(s==null?void 0:s.created_by)?"admin":J(ae.role);return D[je]===D[de]?(((Ae=G.user)==null?void 0:Ae.email)||"").localeCompare(((Je=ae.user)==null?void 0:Je.email)||""):D[je]-D[de]})},[T,s==null?void 0:s.created_by]),Re=w.useMemo(()=>i!=null&&i.keywords?Array.isArray(i.keywords)?i.keywords.map(D=>D.trim()).filter(Boolean):i.keywords.split(",").map(D=>D.trim()).filter(Boolean):[],[i==null?void 0:i.keywords]),De=w.useMemo(()=>typeof F.keywords=="string"?F.keywords:Array.isArray(F.keywords)?F.keywords.join(", "):Array.isArray(i==null?void 0:i.keywords)?(i==null?void 0:i.keywords).join(", "):(i==null?void 0:i.keywords)||"",[F.keywords,i==null?void 0:i.keywords]);return d?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"}),a.jsx("p",{className:"mt-4 text-gray-600",children:"Loading paper..."})]})}):p?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsxs("div",{className:"bg-yellow-100 border border-yellow-300 text-yellow-800 px-4 py-3 rounded mb-4",children:[a.jsx("h2",{className:"text-lg font-semibold mb-1",children:"Unable to open paper"}),a.jsx("p",{className:"text-sm",children:p})]}),a.jsx("button",{onClick:q,className:"px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition-colors",children:"Back to Papers"})]})}):i?a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("header",{className:"bg-white border-b shadow-sm",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4",children:a.jsxs("div",{className:"flex items-start justify-between gap-4",children:[a.jsxs("div",{className:"flex items-start gap-4 min-w-0",children:[a.jsx(sr,{to:z(),className:"text-gray-400 hover:text-gray-600",children:a.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),a.jsxs("div",{className:"space-y-2 min-w-0",children:[s&&a.jsx("div",{className:"text-xs text-indigo-600 font-medium",children:a.jsx(sr,{to:`/projects/${s.id}`,className:"hover:underline",children:s.title})}),x?a.jsx("input",{value:F.title||"",onChange:D=>V(G=>({...G,title:D.target.value})),className:"w-full text-xl font-semibold text-gray-900 border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Paper title"}):a.jsx("h1",{className:"text-xl font-semibold text-gray-900 truncate",title:i.title,children:i.title||"Paper Details"}),x?a.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs",children:[a.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx("span",{children:"Status"}),a.jsxs("select",{value:F.status||i.status,onChange:D=>V(G=>({...G,status:D.target.value})),className:"border border-gray-300 rounded px-2 py-1",children:[a.jsx("option",{value:"draft",children:"Draft"}),a.jsx("option",{value:"in_progress",children:"In Progress"}),a.jsx("option",{value:"completed",children:"Completed"}),a.jsx("option",{value:"published",children:"Published"})]})]}),a.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx("span",{children:"Type"}),a.jsxs("select",{value:F.paper_type||i.paper_type,onChange:D=>V(G=>({...G,paper_type:D.target.value})),className:"border border-gray-300 rounded px-2 py-1",children:[a.jsx("option",{value:"research",children:"Research"}),a.jsx("option",{value:"review",children:"Literature Review"}),a.jsx("option",{value:"case_study",children:"Case Study"}),a.jsx("option",{value:"methodology",children:"Methodology"}),a.jsx("option",{value:"theoretical",children:"Theoretical"}),a.jsx("option",{value:"experimental",children:"Experimental"})]})]}),a.jsxs("label",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx("span",{children:"Visibility"}),a.jsxs("select",{value:F.is_public??i.is_public?"true":"false",onChange:D=>V(G=>({...G,is_public:D.target.value==="true"})),className:"border border-gray-300 rounded px-2 py-1",children:[a.jsx("option",{value:"true",children:"Public"}),a.jsx("option",{value:"false",children:"Private"})]})]})]}):a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-600",children:[a.jsx("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded-full ${Ie(i.status)}`,children:i.status.replace("_"," ")}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:[a.jsx(hs,{className:"w-3 h-3"}),re(i.paper_type)]}),i.year?a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:[a.jsx(UM,{className:"w-3 h-3"}),i.year]}):null,i.doi?a.jsxs("a",{href:`https://doi.org/${i.doi}`,target:"_blank",rel:"noreferrer",className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-indigo-50 text-indigo-700 hover:bg-indigo-100",children:[a.jsx($5,{className:"w-3 h-3"})," DOI"]}):null,a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-100 text-gray-700",children:["Docs: ",o.length]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-50 text-gray-600",children:["Created: ",new Date(i.created_at).toLocaleDateString()]}),a.jsxs("span",{className:"inline-flex items-center gap-1 px-2 py-0.5 rounded-full bg-gray-50 text-gray-600",children:["Updated: ",new Date(i.updated_at).toLocaleDateString()]})]})]})]}),a.jsx("div",{className:"flex items-center gap-2",children:x?a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:Se,className:"inline-flex items-center gap-2 px-3 py-2 text-sm text-gray-600 border border-gray-200 rounded hover:bg-gray-50",children:[a.jsx(Jt,{className:"w-4 h-4"}),"Cancel"]}),a.jsxs("button",{onClick:L,disabled:g,className:"inline-flex items-center gap-2 px-3 py-2 text-sm text-white bg-indigo-600 rounded hover:bg-indigo-700 disabled:opacity-60",children:[a.jsx(aS,{className:"w-4 h-4"}),g?"Saving":"Save changes"]})]}):a.jsxs(a.Fragment,{children:[a.jsxs("button",{onClick:M,className:"inline-flex items-center gap-2 rounded-md border border-indigo-200 px-4 py-2 text-sm font-medium text-indigo-600 hover:bg-indigo-50",children:[a.jsx(Ac,{className:"w-4 h-4"}),"View paper"]}),R&&a.jsxs("button",{onClick:we,className:"inline-flex items-center gap-2 rounded-md bg-indigo-600 px-4 py-2 text-sm font-medium text-white shadow-sm hover:bg-indigo-700",children:[a.jsx(ln,{className:"w-4 h-4"}),"Open editor"]}),(R||C)&&a.jsxs("div",{className:"relative",ref:P,children:[a.jsx("button",{onClick:()=>A(D=>!D),className:"inline-flex items-center justify-center rounded-md border border-gray-200 p-2 text-gray-600 hover:bg-gray-50","aria-haspopup":"menu","aria-expanded":E,"aria-label":"Paper actions",children:a.jsx(m5,{className:"w-4 h-4"})}),E&&a.jsxs("div",{className:"absolute right-0 z-20 mt-2 w-48 rounded-lg border border-gray-200 bg-white py-2 shadow-lg",children:[R&&a.jsxs("button",{onClick:()=>{A(!1),v(!0)},className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[a.jsx(lT,{className:"h-4 w-4 text-gray-500"}),"Edit details"]}),a.jsxs("button",{onClick:()=>{A(!1)},className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-gray-700 hover:bg-gray-50",children:[a.jsx(vT,{className:"h-4 w-4 text-gray-500"}),"Share"]}),C&&a.jsxs("button",{onClick:()=>{A(!1),ge()},className:"flex w-full items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50",children:[a.jsx(nr,{className:"h-4 w-4"}),"Delete paper"]})]})]})]})})]})})}),a.jsx("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[a.jsxs("section",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Overview"}),x?a.jsx("textarea",{value:F.abstract||"",onChange:D=>V(G=>({...G,abstract:D.target.value})),rows:4,className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Tell collaborators what this paper is about..."}):a.jsx("p",{className:"text-gray-600",children:i.abstract||"No abstract provided yet."})]}),a.jsxs("section",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3 mb-4",children:[a.jsxs("div",{children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Attached references"}),a.jsx("p",{className:"text-sm text-gray-600",children:"References stay aligned with the project library and surface key details here."})]}),_?a.jsx("button",{onClick:()=>j(!0),className:"inline-flex items-center gap-2 px-3 py-2 text-sm text-white bg-indigo-600 rounded hover:bg-indigo-700",children:"Manage"}):null]}),u.length===0?a.jsx("p",{className:"text-gray-600 text-sm",children:"No references attached yet. Pull approved references from the project library to cite them here."}):a.jsx("ul",{className:"space-y-3",children:u.map(D=>{var G;return a.jsx("li",{className:"rounded-md border border-gray-200 bg-white/70 p-4 shadow-sm",children:a.jsxs("div",{className:"flex flex-col gap-3 text-sm",children:[a.jsxs("div",{className:"space-y-1",children:[a.jsx("p",{className:"font-medium text-gray-900",title:D.title||void 0,children:D.title||"Untitled reference"}),a.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-gray-500",children:[(G=D.authors)!=null&&G.length?a.jsx("span",{children:D.authors.join(", ")}):null,D.year?a.jsxs("span",{children:[" ",D.year]}):null,D.journal?a.jsxs("span",{children:[" ",D.journal]}):null]})]}),D.abstract?a.jsx("p",{className:"text-xs text-gray-600 line-clamp-3",children:D.abstract}):null,a.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-indigo-600",children:[D.doi?a.jsx("a",{href:`https://doi.org/${D.doi}`,target:"_blank",rel:"noreferrer",className:"hover:underline",children:"DOI"}):D.url?a.jsx("a",{href:D.url,target:"_blank",rel:"noreferrer",className:"hover:underline",children:"Link"}):null,D.project_reference_status&&D.project_reference_status!=="approved"?a.jsxs("span",{className:"text-amber-600",children:["Status: ",D.project_reference_status]}):null]}),a.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[D.attached_at?a.jsxs("span",{children:["Attached ",new Date(D.attached_at).toLocaleDateString()]}):a.jsx("span",{}),_&&D.project_reference_id?a.jsx("button",{onClick:async()=>{if(!(!(s!=null&&s.id)||!e||!D.project_reference_id))try{await An.detachFromPaper(s.id,D.project_reference_id,e),await Y()}catch(ae){console.error("Error detaching reference",ae),alert("Unable to detach this reference right now.")}},className:"rounded border border-gray-300 px-2 py-1 font-medium text-red-600 hover:bg-red-50",children:"Detach"}):null]})]})},D.paper_reference_id)})})]})]}),a.jsxs("div",{className:"space-y-6",children:[a.jsxs("section",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[a.jsx(tu,{className:"h-4 w-4 text-indigo-600"}),a.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Team"})]}),a.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Paper access follows the project roster."}),he.length===0?a.jsx("div",{className:"rounded-lg border border-dashed border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-500",children:"No collaborators yet."}):a.jsx("ul",{className:"space-y-3",children:he.map(D=>{var Ye,dt,It,Ft,$;const G=J(D.role),ae=(D.status||"accepted").toLowerCase(),je=ae==="invited",de=ae==="declined",Ae=D.user_id===(s==null?void 0:s.created_by),Je=((Ye=D.user)==null?void 0:Ye.display_name)||[(dt=D.user)==null?void 0:dt.first_name,(It=D.user)==null?void 0:It.last_name].filter(Boolean).join(" ").trim()||((Ft=D.user)==null?void 0:Ft.email)||D.user_id;return a.jsx("li",{className:"flex flex-col gap-3 rounded-lg border border-gray-200 bg-white px-4 py-3 shadow-sm sm:flex-row sm:items-center sm:justify-between",children:a.jsxs("div",{className:"flex items-start gap-3",children:[a.jsx("div",{className:"mt-1 flex h-8 w-8 items-center justify-center rounded-full bg-gray-100",children:Q(G)}),a.jsxs("div",{className:"min-w-0",children:[a.jsxs("p",{className:"flex items-center gap-2 truncate text-sm font-semibold text-gray-900",children:[a.jsx("span",{className:"truncate",children:Je}),D.user_id===N&&a.jsx("span",{className:"text-[10px] uppercase tracking-wide text-indigo-500",children:"You"}),Ae&&a.jsx(lS,{className:"h-3 w-3 text-yellow-500","aria-label":"Project owner"}),je&&a.jsx(mn,{className:"h-3 w-3 text-amber-500","aria-label":"Invitation pending"})]}),(($=D.user)==null?void 0:$.email)&&a.jsx("p",{className:"truncate text-xs text-gray-500",children:D.user.email}),ae!=="accepted"&&a.jsxs("p",{className:`mt-1 text-xs ${je?"text-amber-600":de?"text-red-600":"text-gray-500"}`,children:["Status: ",ae]})]})]})},D.id||D.user_id)})})]}),a.jsxs("section",{className:"bg-white rounded-lg shadow-sm p-6",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Keywords"}),x?a.jsx("input",{value:De,onChange:D=>V(G=>({...G,keywords:D.target.value})),className:"w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"e.g. generative AI, survey design"}):Re.length===0?a.jsx("p",{className:"text-gray-600 text-sm",children:"No keywords yet."}):a.jsx("div",{className:"flex flex-wrap gap-2",children:Re.map(D=>a.jsx("span",{className:"px-3 py-1 text-xs bg-indigo-50 text-indigo-700 rounded-full",children:D},D))})]})]})]})}),s!=null&&s.id&&e?a.jsx(cS,{isOpen:S,projectId:s.id,paperId:e,attachedProjectReferenceIds:u.map(D=>D.project_reference_id).filter(D=>!!D),onClose:()=>j(!1),onUpdated:async()=>{j(!1),await Y()}}):null,a.jsx(F0,{isOpen:b,onClose:()=>k(!1),onConfirm:Ce,title:"Delete Research Paper",message:"Are you sure you want to delete this research paper? This action cannot be undone.",confirmText:"Delete Paper",cancelText:"Cancel",confirmButtonColor:"red",icon:"warning"})]}):a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-3",children:"Paper Not Found"}),a.jsx("p",{className:"text-gray-600 mb-6",children:"The paper you're looking for doesn't exist or you don't have access to it."}),a.jsx(sr,{className:"text-indigo-600 hover:text-indigo-800",to:z(),children:" Back to projects"})]})})},Bp={};typeof import.meta<"u"&&(Bp!=null&&Bp.VITE_METRICS_ENDPOINT)||sn("/metrics");async function td(t,e={}){}const q7=t=>{let{state:e}=t,n=e.doc.lineAt(e.selection.main.from),r=oy(t.state,n.from);return r.line?V7(t):r.block?K7(t):!1};function ay(t,e){return({state:n,dispatch:r})=>{if(n.readOnly)return!1;let s=t(e,n);return s?(r(n.update(s)),!0):!1}}const V7=ay(X7,0),W7=ay(sA,0),K7=ay((t,e)=>sA(t,e,G7(e)),0);function oy(t,e){let n=t.languageDataAt("commentTokens",e,1);return n.length?n[0]:{}}const Mo=50;function Q7(t,{open:e,close:n},r,s){let i=t.sliceDoc(r-Mo,r),l=t.sliceDoc(s,s+Mo),o=/\s*$/.exec(i)[0].length,c=/^\s*/.exec(l)[0].length,u=i.length-o;if(i.slice(u-e.length,u)==e&&l.slice(c,c+n.length)==n)return{open:{pos:r-o,margin:o&&1},close:{pos:s+c,margin:c&&1}};let h,d;s-r<=2*Mo?h=d=t.sliceDoc(r,s):(h=t.sliceDoc(r,r+Mo),d=t.sliceDoc(s-Mo,s));let f=/^\s*/.exec(h)[0].length,p=/\s*$/.exec(d)[0].length,m=d.length-p-n.length;return h.slice(f,f+e.length)==e&&d.slice(m,m+n.length)==n?{open:{pos:r+f+e.length,margin:/\s/.test(h.charAt(f+e.length))?1:0},close:{pos:s-p-n.length,margin:/\s/.test(d.charAt(m-1))?1:0}}:null}function G7(t){let e=[];for(let n of t.selection.ranges){let r=t.doc.lineAt(n.from),s=n.to<=r.to?r:t.doc.lineAt(n.to);s.from>r.from&&s.from==n.to&&(s=n.to==r.to+1?r:t.doc.lineAt(n.to-1));let i=e.length-1;i>=0&&e[i].to>r.from?e[i].to=s.to:e.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:s.to})}return e}function sA(t,e,n=e.selection.ranges){let r=n.map(i=>oy(e,i.from).block);if(!r.every(i=>i))return null;let s=n.map((i,l)=>Q7(e,r[l],i.from,i.to));if(t!=2&&!s.every(i=>i))return{changes:e.changes(n.map((i,l)=>s[l]?[]:[{from:i.from,insert:r[l].open+" "},{from:i.to,insert:" "+r[l].close}]))};if(t!=1&&s.some(i=>i)){let i=[];for(let l=0,o;l<s.length;l++)if(o=s[l]){let c=r[l],{open:u,close:h}=o;i.push({from:u.pos-c.open.length,to:u.pos+u.margin},{from:h.pos-h.margin,to:h.pos+c.close.length})}return{changes:i}}return null}function X7(t,e,n=e.selection.ranges){let r=[],s=-1;for(let{from:i,to:l}of n){let o=r.length,c=1e9,u=oy(e,i).line;if(u){for(let h=i;h<=l;){let d=e.doc.lineAt(h);if(d.from>s&&(i==l||l>d.from)){s=d.from;let f=/^\s*/.exec(d.text)[0].length,p=f==d.length,m=d.text.slice(f,f+u.length)==u?f:-1;f<d.text.length&&f<c&&(c=f),r.push({line:d,comment:m,token:u,indent:f,empty:p,single:!1})}h=d.to+1}if(c<1e9)for(let h=o;h<r.length;h++)r[h].indent<r[h].line.text.length&&(r[h].indent=c);r.length==o+1&&(r[o].single=!0)}}if(t!=2&&r.some(i=>i.comment<0&&(!i.empty||i.single))){let i=[];for(let{line:o,token:c,indent:u,empty:h,single:d}of r)(d||!h)&&i.push({from:o.from+u,insert:c+" "});let l=e.changes(i);return{changes:l,selection:e.selection.map(l,1)}}else if(t!=1&&r.some(i=>i.comment>=0)){let i=[];for(let{line:l,comment:o,token:c}of r)if(o>=0){let u=l.from+o,h=u+c.length;l.text[h-l.from]==" "&&h++,i.push({from:u,to:h})}return{changes:i}}return null}function lo(t,e){return pe.create(t.ranges.map(e),t.mainIndex)}function bs(t,e){return t.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function Vr({state:t,dispatch:e},n){let r=lo(t.selection,n);return r.eq(t.selection,!0)?!1:(e(bs(t,r)),!0)}function pf(t,e){return pe.cursor(e?t.to:t.from)}function iA(t,e){return Vr(t,n=>n.empty?t.moveByChar(n,e):pf(n,e))}function kn(t){return t.textDirectionAt(t.state.selection.main.head)==Et.LTR}const lA=t=>iA(t,!kn(t)),aA=t=>iA(t,kn(t));function oA(t,e){return Vr(t,n=>n.empty?t.moveByGroup(n,e):pf(n,e))}const J7=t=>oA(t,!kn(t)),Y7=t=>oA(t,kn(t));function Z7(t,e,n){if(e.type.prop(n))return!0;let r=e.to-e.from;return r&&(r>2||/[^\s,.;:]/.test(t.sliceDoc(e.from,e.to)))||e.firstChild}function mf(t,e,n){let r=ms(t).resolveInner(e.head),s=n?We.closedBy:We.openedBy;for(let c=e.head;;){let u=n?r.childAfter(c):r.childBefore(c);if(!u)break;Z7(t,u,s)?r=u:c=n?u.to:u.from}let i=r.type.prop(s),l,o;return i&&(l=n?aa(t,r.from,1):aa(t,r.to,-1))&&l.matched?o=n?l.end.to:l.end.from:o=n?r.to:r.from,pe.cursor(o,n?-1:1)}const e9=t=>Vr(t,e=>mf(t.state,e,!kn(t))),t9=t=>Vr(t,e=>mf(t.state,e,kn(t)));function cA(t,e){return Vr(t,n=>{if(!n.empty)return pf(n,e);let r=t.moveVertically(n,e);return r.head!=n.head?r:t.moveToLineBoundary(n,e)})}const uA=t=>cA(t,!1),dA=t=>cA(t,!0);function hA(t){let e=t.scrollDOM.clientHeight<t.scrollDOM.scrollHeight-2,n=0,r=0,s;if(e){for(let i of t.state.facet(Oe.scrollMargins)){let l=i(t);l!=null&&l.top&&(n=Math.max(l==null?void 0:l.top,n)),l!=null&&l.bottom&&(r=Math.max(l==null?void 0:l.bottom,r))}s=t.scrollDOM.clientHeight-n-r}else s=(t.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:r,selfScroll:e,height:Math.max(t.defaultLineHeight,s-5)}}function fA(t,e){let n=hA(t),{state:r}=t,s=lo(r.selection,l=>l.empty?t.moveVertically(l,e,n.height):pf(l,e));if(s.eq(r.selection))return!1;let i;if(n.selfScroll){let l=t.coordsAtPos(r.selection.main.head),o=t.scrollDOM.getBoundingClientRect(),c=o.top+n.marginTop,u=o.bottom-n.marginBottom;l&&l.top>c&&l.bottom<u&&(i=Oe.scrollIntoView(s.main.head,{y:"start",yMargin:l.top-c}))}return t.dispatch(bs(r,s),{effects:i}),!0}const E1=t=>fA(t,!1),lx=t=>fA(t,!0);function Hi(t,e,n){let r=t.lineBlockAt(e.head),s=t.moveToLineBoundary(e,n);if(s.head==e.head&&s.head!=(n?r.to:r.from)&&(s=t.moveToLineBoundary(e,n,!1)),!n&&s.head==r.from&&r.length){let i=/^\s*/.exec(t.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;i&&e.head!=r.from+i&&(s=pe.cursor(r.from+i))}return s}const n9=t=>Vr(t,e=>Hi(t,e,!0)),r9=t=>Vr(t,e=>Hi(t,e,!1)),s9=t=>Vr(t,e=>Hi(t,e,!kn(t))),i9=t=>Vr(t,e=>Hi(t,e,kn(t))),l9=t=>Vr(t,e=>pe.cursor(t.lineBlockAt(e.head).from,1)),a9=t=>Vr(t,e=>pe.cursor(t.lineBlockAt(e.head).to,-1));function o9(t,e,n){let r=!1,s=lo(t.selection,i=>{let l=aa(t,i.head,-1)||aa(t,i.head,1)||i.head>0&&aa(t,i.head-1,1)||i.head<t.doc.length&&aa(t,i.head+1,-1);if(!l||!l.end)return i;r=!0;let o=l.start.from==i.head?l.end.to:l.end.from;return pe.cursor(o)});return r?(e(bs(t,s)),!0):!1}const c9=({state:t,dispatch:e})=>o9(t,e);function Pr(t,e){let n=lo(t.state.selection,r=>{let s=e(r);return pe.range(r.anchor,s.head,s.goalColumn,s.bidiLevel||void 0)});return n.eq(t.state.selection)?!1:(t.dispatch(bs(t.state,n)),!0)}function pA(t,e){return Pr(t,n=>t.moveByChar(n,e))}const mA=t=>pA(t,!kn(t)),gA=t=>pA(t,kn(t));function xA(t,e){return Pr(t,n=>t.moveByGroup(n,e))}const u9=t=>xA(t,!kn(t)),d9=t=>xA(t,kn(t)),h9=t=>Pr(t,e=>mf(t.state,e,!kn(t))),f9=t=>Pr(t,e=>mf(t.state,e,kn(t)));function yA(t,e){return Pr(t,n=>t.moveVertically(n,e))}const bA=t=>yA(t,!1),vA=t=>yA(t,!0);function wA(t,e){return Pr(t,n=>t.moveVertically(n,e,hA(t).height))}const P1=t=>wA(t,!1),_1=t=>wA(t,!0),p9=t=>Pr(t,e=>Hi(t,e,!0)),m9=t=>Pr(t,e=>Hi(t,e,!1)),g9=t=>Pr(t,e=>Hi(t,e,!kn(t))),x9=t=>Pr(t,e=>Hi(t,e,kn(t))),y9=t=>Pr(t,e=>pe.cursor(t.lineBlockAt(e.head).from)),b9=t=>Pr(t,e=>pe.cursor(t.lineBlockAt(e.head).to)),M1=({state:t,dispatch:e})=>(e(bs(t,{anchor:0})),!0),T1=({state:t,dispatch:e})=>(e(bs(t,{anchor:t.doc.length})),!0),R1=({state:t,dispatch:e})=>(e(bs(t,{anchor:t.selection.main.anchor,head:0})),!0),D1=({state:t,dispatch:e})=>(e(bs(t,{anchor:t.selection.main.anchor,head:t.doc.length})),!0),v9=({state:t,dispatch:e})=>(e(t.update({selection:{anchor:0,head:t.doc.length},userEvent:"select"})),!0),w9=({state:t,dispatch:e})=>{let n=gf(t).map(({from:r,to:s})=>pe.range(r,Math.min(s+1,t.doc.length)));return e(t.update({selection:pe.create(n),userEvent:"select"})),!0},k9=({state:t,dispatch:e})=>{let n=lo(t.selection,r=>{let s=ms(t),i=s.resolveStack(r.from,1);if(r.empty){let l=s.resolveStack(r.from,-1);l.node.from>=i.node.from&&l.node.to<=i.node.to&&(i=l)}for(let l=i;l;l=l.next){let{node:o}=l;if((o.from<r.from&&o.to>=r.to||o.to>r.to&&o.from<=r.from)&&l.next)return pe.range(o.to,o.from)}return r});return n.eq(t.selection)?!1:(e(bs(t,n)),!0)},j9=({state:t,dispatch:e})=>{let n=t.selection,r=null;return n.ranges.length>1?r=pe.create([n.main]):n.main.empty||(r=pe.create([pe.cursor(n.main.head)])),r?(e(bs(t,r)),!0):!1};function ou(t,e){if(t.state.readOnly)return!1;let n="delete.selection",{state:r}=t,s=r.changeByRange(i=>{let{from:l,to:o}=i;if(l==o){let c=e(i);c<l?(n="delete.backward",c=nd(t,c,!1)):c>l&&(n="delete.forward",c=nd(t,c,!0)),l=Math.min(l,c),o=Math.max(o,c)}else l=nd(t,l,!1),o=nd(t,o,!0);return l==o?{range:i}:{changes:{from:l,to:o},range:pe.cursor(l,l<i.head?-1:1)}});return s.changes.empty?!1:(t.dispatch(r.update(s,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?Oe.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function nd(t,e,n){if(t instanceof Oe)for(let r of t.state.facet(Oe.atomicRanges).map(s=>s(t)))r.between(e,e,(s,i)=>{s<e&&i>e&&(e=n?i:s)});return e}const kA=(t,e,n)=>ou(t,r=>{let s=r.from,{state:i}=t,l=i.doc.lineAt(s),o,c;if(n&&!e&&s>l.from&&s<l.from+200&&!/[^ \t]/.test(o=l.text.slice(0,s-l.from))){if(o[o.length-1]=="	")return s-1;let u=Yh(o,i.tabSize),h=u%Al(i)||Al(i);for(let d=0;d<h&&o[o.length-1-d]==" ";d++)s--;c=s}else c=Pn(l.text,s-l.from,e,e)+l.from,c==s&&l.number!=(e?i.doc.lines:1)?c+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(l.text.slice(c-l.from,s-l.from))&&(c=Pn(l.text,c-l.from,!1,!1)+l.from);return c}),ax=t=>kA(t,!1,!0),jA=t=>kA(t,!0,!1),SA=(t,e)=>ou(t,n=>{let r=n.head,{state:s}=t,i=s.doc.lineAt(r),l=s.charCategorizer(r);for(let o=null;;){if(r==(e?i.to:i.from)){r==n.head&&i.number!=(e?s.doc.lines:1)&&(r+=e?1:-1);break}let c=Pn(i.text,r-i.from,e)+i.from,u=i.text.slice(Math.min(r,c)-i.from,Math.max(r,c)-i.from),h=l(u);if(o!=null&&h!=o)break;(u!=" "||r!=n.head)&&(o=h),r=c}return r}),NA=t=>SA(t,!1),S9=t=>SA(t,!0),N9=t=>ou(t,e=>{let n=t.lineBlockAt(e.head).to;return e.head<n?n:Math.min(t.state.doc.length,e.head+1)}),C9=t=>ou(t,e=>{let n=t.moveToLineBoundary(e,!1).head;return e.head>n?n:Math.max(0,e.head-1)}),A9=t=>ou(t,e=>{let n=t.moveToLineBoundary(e,!0).head;return e.head<n?n:Math.min(t.state.doc.length,e.head+1)}),E9=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:Ge.of(["",""])},range:pe.cursor(r.from)}));return e(t.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},P9=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=t.changeByRange(r=>{if(!r.empty||r.from==0||r.from==t.doc.length)return{range:r};let s=r.from,i=t.doc.lineAt(s),l=s==i.from?s-1:Pn(i.text,s-i.from,!1)+i.from,o=s==i.to?s+1:Pn(i.text,s-i.from,!0)+i.from;return{changes:{from:l,to:o,insert:t.doc.slice(s,o).append(t.doc.slice(l,s))},range:pe.cursor(o)}});return n.changes.empty?!1:(e(t.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function gf(t){let e=[],n=-1;for(let r of t.selection.ranges){let s=t.doc.lineAt(r.from),i=t.doc.lineAt(r.to);if(!r.empty&&r.to==i.from&&(i=t.doc.lineAt(r.to-1)),n>=s.number){let l=e[e.length-1];l.to=i.to,l.ranges.push(r)}else e.push({from:s.from,to:i.to,ranges:[r]});n=i.number+1}return e}function CA(t,e,n){if(t.readOnly)return!1;let r=[],s=[];for(let i of gf(t)){if(n?i.to==t.doc.length:i.from==0)continue;let l=t.doc.lineAt(n?i.to+1:i.from-1),o=l.length+1;if(n){r.push({from:i.to,to:l.to},{from:i.from,insert:l.text+t.lineBreak});for(let c of i.ranges)s.push(pe.range(Math.min(t.doc.length,c.anchor+o),Math.min(t.doc.length,c.head+o)))}else{r.push({from:l.from,to:i.from},{from:i.to,insert:t.lineBreak+l.text});for(let c of i.ranges)s.push(pe.range(c.anchor-o,c.head-o))}}return r.length?(e(t.update({changes:r,scrollIntoView:!0,selection:pe.create(s,t.selection.mainIndex),userEvent:"move.line"})),!0):!1}const _9=({state:t,dispatch:e})=>CA(t,e,!1),M9=({state:t,dispatch:e})=>CA(t,e,!0);function AA(t,e,n){if(t.readOnly)return!1;let r=[];for(let s of gf(t))n?r.push({from:s.from,insert:t.doc.slice(s.from,s.to)+t.lineBreak}):r.push({from:s.to,insert:t.lineBreak+t.doc.slice(s.from,s.to)});return e(t.update({changes:r,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const T9=({state:t,dispatch:e})=>AA(t,e,!1),R9=({state:t,dispatch:e})=>AA(t,e,!0),D9=t=>{if(t.state.readOnly)return!1;let{state:e}=t,n=e.changes(gf(e).map(({from:s,to:i})=>(s>0?s--:i<e.doc.length&&i++,{from:s,to:i}))),r=lo(e.selection,s=>{let i;if(t.lineWrapping){let l=t.lineBlockAt(s.head),o=t.coordsAtPos(s.head,s.assoc||1);o&&(i=l.bottom+t.documentTop-o.bottom+t.defaultLineHeight/2)}return t.moveVertically(s,!0,i)}).map(n);return t.dispatch({changes:n,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function L9(t,e){if(/\(\)|\[\]|\{\}/.test(t.sliceDoc(e-1,e+1)))return{from:e,to:e};let n=ms(t).resolveInner(e),r=n.childBefore(e),s=n.childAfter(e),i;return r&&s&&r.to<=e&&s.from>=e&&(i=r.type.prop(We.closedBy))&&i.indexOf(s.name)>-1&&t.doc.lineAt(r.to).from==t.doc.lineAt(s.from).from&&!/\S/.test(t.sliceDoc(r.to,s.from))?{from:r.to,to:s.from}:null}const L1=EA(!1),O9=EA(!0);function EA(t){return({state:e,dispatch:n})=>{if(e.readOnly)return!1;let r=e.changeByRange(s=>{let{from:i,to:l}=s,o=e.doc.lineAt(i),c=!t&&i==l&&L9(e,i);t&&(i=l=(l<=o.to?o:e.doc.lineAt(l)).to);let u=new rf(e,{simulateBreak:i,simulateDoubleBreak:!!c}),h=zN(u,i);for(h==null&&(h=Yh(/^\s*/.exec(e.doc.lineAt(i).text)[0],e.tabSize));l<o.to&&/\s/.test(o.text[l-o.from]);)l++;c?{from:i,to:l}=c:i>o.from&&i<o.from+100&&!/\S/.test(o.text.slice(0,i))&&(i=o.from);let d=["",vh(e,h)];return c&&d.push(vh(e,u.lineIndent(o.from,-1))),{changes:{from:i,to:l,insert:Ge.of(d)},range:pe.cursor(i+1+d[1].length)}});return n(e.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function cy(t,e){let n=-1;return t.changeByRange(r=>{let s=[];for(let l=r.from;l<=r.to;){let o=t.doc.lineAt(l);o.number>n&&(r.empty||r.to>o.from)&&(e(o,s,r),n=o.number),l=o.to+1}let i=t.changes(s);return{changes:s,range:pe.range(i.mapPos(r.anchor,1),i.mapPos(r.head,1))}})}const I9=({state:t,dispatch:e})=>{if(t.readOnly)return!1;let n=Object.create(null),r=new rf(t,{overrideIndentation:i=>{let l=n[i];return l??-1}}),s=cy(t,(i,l,o)=>{let c=zN(r,i.from);if(c==null)return;/\S/.test(i.text)||(c=0);let u=/^\s*/.exec(i.text)[0],h=vh(t,c);(u!=h||o.from<i.from+u.length)&&(n[i.from]=c,l.push({from:i.from,to:i.from+u.length,insert:h}))});return s.changes.empty||e(t.update(s,{userEvent:"indent"})),!0},PA=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(cy(t,(n,r)=>{r.push({from:n.from,insert:t.facet(R0)})}),{userEvent:"input.indent"})),!0),_A=({state:t,dispatch:e})=>t.readOnly?!1:(e(t.update(cy(t,(n,r)=>{let s=/^\s*/.exec(n.text)[0];if(!s)return;let i=Yh(s,t.tabSize),l=0,o=vh(t,Math.max(0,i-Al(t)));for(;l<s.length&&l<o.length&&s.charCodeAt(l)==o.charCodeAt(l);)l++;r.push({from:n.from+l,to:n.from+s.length,insert:o.slice(l)})}),{userEvent:"delete.dedent"})),!0),F9=t=>(t.setTabFocusMode(),!0),B9=[{key:"Ctrl-b",run:lA,shift:mA,preventDefault:!0},{key:"Ctrl-f",run:aA,shift:gA},{key:"Ctrl-p",run:uA,shift:bA},{key:"Ctrl-n",run:dA,shift:vA},{key:"Ctrl-a",run:l9,shift:y9},{key:"Ctrl-e",run:a9,shift:b9},{key:"Ctrl-d",run:jA},{key:"Ctrl-h",run:ax},{key:"Ctrl-k",run:N9},{key:"Ctrl-Alt-h",run:NA},{key:"Ctrl-o",run:E9},{key:"Ctrl-t",run:P9},{key:"Ctrl-v",run:lx}],z9=[{key:"ArrowLeft",run:lA,shift:mA,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:J7,shift:u9,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:s9,shift:g9,preventDefault:!0},{key:"ArrowRight",run:aA,shift:gA,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:Y7,shift:d9,preventDefault:!0},{mac:"Cmd-ArrowRight",run:i9,shift:x9,preventDefault:!0},{key:"ArrowUp",run:uA,shift:bA,preventDefault:!0},{mac:"Cmd-ArrowUp",run:M1,shift:R1},{mac:"Ctrl-ArrowUp",run:E1,shift:P1},{key:"ArrowDown",run:dA,shift:vA,preventDefault:!0},{mac:"Cmd-ArrowDown",run:T1,shift:D1},{mac:"Ctrl-ArrowDown",run:lx,shift:_1},{key:"PageUp",run:E1,shift:P1},{key:"PageDown",run:lx,shift:_1},{key:"Home",run:r9,shift:m9,preventDefault:!0},{key:"Mod-Home",run:M1,shift:R1},{key:"End",run:n9,shift:p9,preventDefault:!0},{key:"Mod-End",run:T1,shift:D1},{key:"Enter",run:L1,shift:L1},{key:"Mod-a",run:v9},{key:"Backspace",run:ax,shift:ax},{key:"Delete",run:jA},{key:"Mod-Backspace",mac:"Alt-Backspace",run:NA},{key:"Mod-Delete",mac:"Alt-Delete",run:S9},{mac:"Mod-Backspace",run:C9},{mac:"Mod-Delete",run:A9}].concat(B9.map(t=>({mac:t.key,run:t.run,shift:t.shift}))),$9=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:e9,shift:h9},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:t9,shift:f9},{key:"Alt-ArrowUp",run:_9},{key:"Shift-Alt-ArrowUp",run:T9},{key:"Alt-ArrowDown",run:M9},{key:"Shift-Alt-ArrowDown",run:R9},{key:"Escape",run:j9},{key:"Mod-Enter",run:O9},{key:"Alt-l",mac:"Ctrl-l",run:w9},{key:"Mod-i",run:k9,preventDefault:!0},{key:"Mod-[",run:_A},{key:"Mod-]",run:PA},{key:"Mod-Alt-\\",run:I9},{key:"Shift-Mod-k",run:D9},{key:"Shift-Mod-\\",run:c9},{key:"Mod-/",run:q7},{key:"Alt-A",run:W7},{key:"Ctrl-m",mac:"Shift-Alt-m",run:F9}].concat(z9),U9={key:"Tab",run:PA,shift:_A},H9=sf.define([{tag:Ne.comment,color:"var(--latex-editor-comment)",fontStyle:"italic"},{tag:[Ne.string,Ne.special(Ne.string)],color:"var(--latex-editor-string)"},{tag:[Ne.tagName,Ne.macroName],color:"var(--latex-editor-command)",fontWeight:"600"},{tag:Ne.keyword,color:"var(--latex-editor-keyword)",fontWeight:"600"},{tag:[Ne.atom,Ne.bool],color:"var(--latex-editor-math)"},{tag:[Ne.number,Ne.integer,Ne.float],color:"var(--latex-editor-number)"},{tag:Ne.operator,color:"var(--latex-editor-operator)"},{tag:Ne.bracket,color:"var(--latex-editor-bracket)"},{tag:[Ne.variableName,Ne.definition(Ne.variableName)],color:"var(--latex-editor-text)"},{tag:Ne.special(Ne.variableName),color:"var(--latex-editor-math)"}]),q9=[Oe.theme({"&":{backgroundColor:"var(--latex-editor-bg)",color:"var(--latex-editor-fg)"},".cm-editor":{fontSize:"var(--latex-editor-font-size)"},".cm-scroller":{overflow:"auto",fontFamily:"var(--latex-editor-font-family)",lineHeight:"1.58",backgroundColor:"var(--latex-editor-bg)"},".cm-content":{padding:"12px 16px",minHeight:"100%",maxHeight:"none",fontFamily:"var(--latex-editor-font-family)"},".cm-gutters":{backgroundColor:"var(--latex-editor-gutter-bg)",color:"var(--latex-editor-gutter-fg)",borderRight:"1px solid var(--latex-editor-gutter-border)"},".cm-lineNumbers .cm-gutterElement":{padding:"0 12px"},".cm-activeLineGutter":{backgroundColor:"var(--latex-editor-active-line-bg)",color:"var(--latex-editor-active-line-fg)"},".cm-activeLine":{backgroundColor:"var(--latex-editor-active-line-bg)"},".cm-selectionBackground, &.cm-focused .cm-selectionBackground":{backgroundColor:"var(--latex-editor-selection-bg) !important"},"&.cm-editor.cm-focused":{outline:"1px solid var(--latex-editor-focus-ring)",outlineOffset:"0"},".cm-foldPlaceholder":{backgroundColor:"var(--latex-editor-fold-bg)",color:"var(--latex-editor-fold-fg)",border:"1px solid var(--latex-editor-fold-border)",borderRadius:"3px",padding:"0 4px"},".cm-tooltip":{backgroundColor:"var(--latex-editor-tooltip-bg)",color:"var(--latex-editor-tooltip-fg)",border:"1px solid var(--latex-editor-tooltip-border)"},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"var(--latex-editor-tooltip-bg)"}}),Oe.baseTheme({".cm-cursor, .cm-dropCursor":{borderLeftColor:"var(--latex-editor-caret)"},"&.cm-editor":{color:"var(--latex-editor-fg)"},".cm-selectionMatch":{backgroundColor:"var(--latex-editor-selection-match)"},".cm-content":{caretColor:"var(--latex-editor-caret)"},".cm-sel-spell-error":{textDecoration:"underline wavy var(--latex-editor-spell)"},".cm-content span.cm-comment":{color:"var(--latex-editor-comment)",fontStyle:"italic"},".cm-content span.cm-string":{color:"var(--latex-editor-string)"},".cm-content span.cm-builtin, .cm-content span.cm-tag":{color:"var(--latex-editor-command)",fontWeight:600},".cm-content span.cm-variableName":{color:"var(--latex-editor-text)"},".cm-content span.cm-keyword":{color:"var(--latex-editor-keyword)"},".cm-content span.cm-atom":{color:"var(--latex-editor-math)"},".cm-content span.cm-number":{color:"var(--latex-editor-number)"},".cm-content span.cm-bracket":{color:"var(--latex-editor-bracket)"},".cm-content span.cm-operator":{color:"var(--latex-editor-operator)"}}),hL(H9,{fallback:!0})];function $o({value:t,onChange:e,onSave:n,templateTitle:r,fullHeight:s=!1,paperId:i,readOnly:l=!1,disableSave:o=!1,onNavigateBack:c},u){const h=w.useCallback((...re)=>{try{window.__SH_DEBUG_LTX&&console.debug("[LaTeXEditor]",...re)}catch{}},[]),d=w.useRef(null),f=w.useRef(null),[p,m]=w.useState(!1),x=w.useRef(!1),v=w.useRef(t||""),g=w.useRef(null),[y,b]=w.useState("idle"),[k,S]=w.useState(null),[j,E]=w.useState("idle"),[A,T]=w.useState(null),[N,I]=w.useState([]),[R,C]=w.useState(null),_=w.useRef(null),M=w.useRef(null),z=w.useRef(0),q=w.useRef(null),F=w.useRef(e);w.useEffect(()=>{F.current=e},[e]);const V=w.useCallback(()=>{g.current!==null&&(window.clearTimeout(g.current),g.current=null);const re=F.current;re&&re(v.current)},[]),P=w.useCallback(()=>{g.current!==null&&window.clearTimeout(g.current),g.current=window.setTimeout(()=>{g.current=null;const re=F.current;re&&re(v.current)},220)},[]);w.useEffect(()=>()=>{if(g.current!==null){window.clearTimeout(g.current),g.current=null;const re=F.current;re&&re(v.current)}},[]);const H=w.useMemo(()=>[O6(),w6(),N6(),lf.define(JN),EN.of([U9,...$9]),Oe.lineWrapping,q9,Oe.updateListener.of(re=>{var Q;if(!re.docChanged)return;try{(Q=re.transactions)==null||Q.forEach(he=>{he.scrollIntoView&&(he.scrollIntoView=!1)})}catch{}x.current=!0;const J=re.state.doc.toString();v.current=J,h("docChanged len=",J.length),P(),Promise.resolve().then(()=>{x.current=!1})})],[P,h]),Y=w.useCallback(re=>{const J=Ze.create({doc:v.current||"",extensions:H}),Q=new Oe({state:J,parent:re});f.current=Q,m(!0)},[H]),L=w.useCallback(re=>{var J,Q;if(re!==d.current){if(re===null){try{(J=f.current)==null||J.destroy()}catch{}f.current=null,d.current=null,m(!1);return}d.current=re;try{(Q=f.current)==null||Q.destroy()}catch{}f.current=null,m(!1),requestAnimationFrame(()=>{if(d.current)try{Y(d.current)}catch{}})}},[Y]);w.useEffect(()=>{const re=f.current,J=t||"";if(!re){v.current=J;return}if(x.current)return;const Q=re.state.doc.toString();if(Q===J){v.current=J;return}h("prop sync to editor, len=",J.length),v.current=J,re.dispatch({changes:{from:0,to:Q.length,insert:J}})},[t,h]),w.useImperativeHandle(u,()=>({getSelection:()=>{try{const re=f.current;if(!re)return"";const J=re.state.selection.main;return re.state.doc.sliceString(J.from,J.to)}catch{return""}},replaceSelection:re=>{try{const J=f.current;if(!J)return;const Q=J.state.selection.main;J.dispatch({changes:{from:Q.from,to:Q.to,insert:re||""}}),J.focus()}catch{}},setValue:re=>{try{const J=f.current;if(!J)return;const Q=J.state.doc.toString();J.dispatch({changes:{from:0,to:Q.length,insert:re||""}})}catch{}},focus:()=>{var re;try{(re=f.current)==null||re.focus()}catch{}}}),[]),w.useEffect(()=>{const re=()=>{try{const he=f.current;if(!he)return;const Re=he.state.doc.toString();if(/\\bibliography\{/.test(Re))return;const De=["","% Bibliography","\\bibliographystyle{plain}","\\bibliography{main}",""].join(`
`),D=Re.lastIndexOf("\\end{document}"),G=D>=0?D:he.state.doc.length;he.dispatch({changes:{from:G,to:G,insert:De}}),he.focus()}catch{}},J=he=>{var Re;try{const De=f.current;if(!De)return;const D=he,G=Array.isArray((Re=D.detail)==null?void 0:Re.keys)?D.detail.keys:[];if(!G.length)return;const ae=De.state.doc.toString(),je=`\\nocite{${Array.from(new Set(G)).join(",")}}
`,de=ae.lastIndexOf("\\end{document}"),Ae=de>=0?de:De.state.doc.length;De.dispatch({changes:{from:Ae,to:Ae,insert:`
`+je}}),De.focus()}catch{}},Q=he=>{var Re;try{const De=f.current;if(!De)return;const G=(Re=he.detail)==null?void 0:Re.key;if(!G)return;const ae=De.state.selection.main,je=`\\cite{${G}}`;De.dispatch({changes:{from:ae.from,to:ae.to,insert:je}}),De.focus()}catch{}};return window.addEventListener("SH_LATEX_INSERT_BIB",re),window.addEventListener("SH_LATEX_INSERT_NOCITE",J),window.addEventListener("SH_LATEX_INSERT_CITE",Q),()=>{window.removeEventListener("SH_LATEX_INSERT_BIB",re),window.removeEventListener("SH_LATEX_INSERT_NOCITE",J),window.removeEventListener("SH_LATEX_INSERT_CITE",Q)}},[]);const Se="flex flex-1 min-h-0 flex-col bg-slate-900 text-slate-100",we=w.useCallback(re=>{if(!re)return re||"";if(/^https?:/i.test(re))return re;const J=re.startsWith("/")?re:`/${re}`;return`${kl}${J}`},[]),ge=w.useCallback(()=>{const re=M.current;if(re&&re.startsWith("blob:"))try{URL.revokeObjectURL(re)}catch{}M.current=null},[]),Ce=w.useCallback((re,J)=>{const Q=_.current;if(!(!Q||!Q.contentWindow))try{Q.contentWindow.postMessage({type:"loadFile",url:re,rev:J},"*"),console.log("[LaTeX] Posted PDF to iframe:",{rev:J,url:re.substring(0,50)})}catch(he){console.error("[LaTeX] Failed to post PDF to iframe:",he)}},[]),Ie=w.useCallback(async()=>{if(l){T("Compile disabled in read-only mode"),E("error");return}const re=i??window.__SH_ACTIVE_PAPER_ID??null;if(I([]),T(null),E("compiling"),q.current)try{q.current.abort()}catch{}V();const J=new AbortController;q.current=J;const Q=`${Date.now()}-${Math.floor(Math.random()*1e6)}`;try{await td("CompileClicked",{srcLen:v.current.length,projectId:re,buildId:Q})}catch{}const he=performance.now();let Re=null,De=!1;try{let D=v.current||"";try{const dt=f.current;dt&&(D=dt.state.doc.toString())}catch{}v.current=D;try{await td("CompileStart",{approxLen:D.length,buildId:Q,projectId:re})}catch{}const G=await fetch(sn("/latex/compile/stream"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")||""}`},body:JSON.stringify({latex_source:D,paper_id:re,include_bibtex:!0,job_label:Q}),signal:J.signal});if(!G.ok||!G.body)throw new Error(`Compile failed: ${G.status} ${G.statusText}`);const ae=G.body.getReader(),je=new TextDecoder;let de="";const Ae=$o._compileSeq||($o._compileSeq={current:0});Ae.current+=1;const Je=Ae.current;for(;;){const{value:dt,done:It}=await ae.read();if(It)break;de+=je.decode(dt,{stream:!0});const Ft=de.split(`

`);de=Ft.pop()||"";for(const $ of Ft){const W=$.trim();if(W.startsWith("data:"))try{const te=JSON.parse(W.replace(/^data:\s*/,""));if(te.type==="log"){const fe=typeof te.line=="string"?te.line:"";fe&&(I(O=>O.length>200?[...O.slice(-199),fe]:[...O,fe]),!Re&&/error:/i.test(fe)&&(Re=fe))}else if(te.type==="error"){const fe=te.message||"Compilation error";Re=Re||fe}else if(te.type==="final"&&te.pdf_url){console.log("[LaTeX] Received final event with PDF URL:",te.pdf_url);const fe=we(te.pdf_url);console.log("[LaTeX] Resolved PDF URL:",fe);const O=localStorage.getItem("access_token")||"",Z=await fetch(fe,{headers:O?{Authorization:`Bearer ${O}`}:void 0});if(console.log("[LaTeX] PDF fetch response:",Z.status,Z.ok),!Z.ok)throw new Error(`Failed to fetch PDF (${Z.status})`);const ne=await Z.blob();if(console.log("[LaTeX] PDF blob size:",ne.size,"mySeq:",Je,"currentSeq:",$o._compileSeq.current),Je!==$o._compileSeq.current){console.log("[LaTeX] Skipping stale compile result");continue}const ye=URL.createObjectURL(ne);console.log("[LaTeX] Created blob URL:",ye),ge(),M.current=ye,Ce(ye,Je),z.current=Je,De=!0}}catch{}}}const Ye=Math.round(performance.now()-he);try{await td("CompileEnd",{buildId:Q,durationMs:Ye,projectId:re,success:De})}catch{}De?(E("success"),T(null),C(Date.now())):(E("error"),T(Re||"Compilation failed"))}catch(D){if(J.signal.aborted)return;const G=(D==null?void 0:D.message)||"Compilation failed";E("error"),T(G)}finally{q.current===J&&(q.current=null)}},[sn,ge,V,i,Ce,l,we]);return w.useEffect(()=>{const re=J=>{const Q=J.data;if(!Q||Q.type!=="viewer-ready")return;const he=_.current;if(!he||J.source!==he.contentWindow)return;const Re=M.current,De=z.current;!Re||!De||Ce(Re,De)};return window.addEventListener("message",re),()=>{window.removeEventListener("message",re)}},[Ce]),w.useEffect(()=>()=>{if(q.current)try{q.current.abort()}catch{}ge()},[ge]),w.useEffect(()=>{l||Ie()},[Ie,l]),a.jsxs("div",{className:Se,children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-slate-800 px-3 py-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[c&&a.jsx("button",{"aria-label":"Back to paper details",onClick:c,className:"inline-flex h-9 w-9 items-center justify-center rounded-md border border-slate-700 bg-slate-800 text-slate-200 hover:bg-slate-700",children:""}),a.jsx("span",{className:"text-sm font-semibold",children:r||"LaTeX Source"})]}),a.jsxs("div",{className:"flex items-center gap-3 text-xs",children:[a.jsx("button",{type:"button",className:`inline-flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm font-medium transition-colors ${j==="compiling"?"border-indigo-400 bg-indigo-500/90 text-white":"border-slate-600 bg-slate-800 hover:bg-slate-700 text-slate-100"}`,onClick:()=>Ie(),disabled:j==="compiling",children:j==="compiling"?"Compiling":"Compile"}),j==="error"&&A&&a.jsx("span",{className:"text-rose-200 max-w-xs truncate",title:A,children:A}),j==="success"&&R&&a.jsxs("span",{className:"text-emerald-200",children:["Compiled ",Math.max(1,Math.round((Date.now()-R)/1e3)),"s ago"]}),y==="saving"&&a.jsx("span",{className:"text-indigo-200",children:"Saving"}),y==="success"&&a.jsx("span",{className:"text-emerald-200",children:"Draft saved"}),y==="error"&&k&&a.jsx("span",{className:"text-rose-200",title:k,children:k}),!(o||l)&&a.jsx("button",{type:"button",className:`inline-flex items-center gap-2 rounded-md border px-3 py-1.5 text-sm font-medium transition-colors ${l?"cursor-not-allowed border-slate-700/60 bg-slate-800/40 text-slate-500":y==="saving"?"border-indigo-400 bg-indigo-500/90 text-white":y==="error"?"border-rose-400 bg-rose-500/80 text-white hover:bg-rose-500":"border-slate-600 bg-slate-800 hover:bg-slate-700 text-slate-100"}`,onClick:async()=>{var re;if(!(o||l||y==="saving")){V(),b("saving"),S(null);try{const J=((re=f.current)==null?void 0:re.state.doc.toString())||"",Q={authoring_mode:"latex",latex_source:J},he=i??window.__SH_ACTIVE_PAPER_ID;if(n)await n(J,Q);else{if(!he)throw new Error("Missing paper id");await rt.updatePaperContent(he,{content_json:Q})}try{td("LatexSaveClicked",{len:J.length})}catch{}b("success"),setTimeout(()=>b("idle"),2e3)}catch(J){console.warn("Save failed",J),b("error"),S((J==null?void 0:J.message)||"Save failed")}}},disabled:o||l,children:y==="saving"?"Saving":y==="success"?"Saved":y==="error"?"Retry Save":"Save Draft"})]})]}),a.jsxs("div",{className:"flex-1 min-h-0 overflow-auto bg-white relative",children:[a.jsx("div",{ref:L,className:"min-h-full"}),!p&&a.jsx("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center text-xs text-gray-500 bg-white/80",children:"Initializing editor"})]}),a.jsxs("div",{className:"mt-3 rounded-md border border-slate-200 bg-white shadow-sm",children:[a.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-3 py-2 text-xs text-slate-500",children:[a.jsx("span",{className:"font-medium text-slate-600",children:"PDF Preview"}),j==="compiling"&&a.jsx("span",{className:"text-indigo-500",children:"Updating"}),j==="success"&&R&&a.jsxs("span",{children:["Updated ",Math.max(1,Math.round((Date.now()-R)/1e3)),"s ago"]}),j==="error"&&A&&a.jsx("span",{className:"text-rose-500",title:A,children:"Compile failed"})]}),a.jsx("div",{className:"h-[45vh] overflow-hidden",children:a.jsx("iframe",{ref:_,id:"latex-preview-frame",title:"Compiled PDF",src:"/pdf-viewer.html","data-loaded":"false",className:"h-full w-full"})}),N.length>0&&a.jsx("div",{className:"max-h-40 overflow-auto border-t border-slate-200 bg-slate-50 px-3 py-2 text-[11px] text-slate-600",children:N.slice(-60).map((re,J)=>a.jsx("div",{className:"whitespace-pre-wrap",children:re},J))})]})]})}const V9=w.forwardRef($o),W9=Wc.memo(V9),K9=w.forwardRef(function(e,n){const{contentJson:r,onContentChange:s,onReady:i,onDirtyChange:l,className:o,paperId:c,paperTitle:u,lockedSectionKeys:h,branchName:d="draft",readOnly:f=!1,onNavigateBack:p}=e,m=(...A)=>{try{window.__SH_DEBUG_LTX&&console.debug("[LatexAdapter]",...A)}catch{}},x=w.useRef(null),[v,g]=w.useState(()=>{const A=r&&typeof r=="object"&&r.latex_source||"";let T=typeof A=="string"?A:"";if(c)try{const N=localStorage.getItem(`paper:${c}:draft`);if(typeof N=="string"&&N.length>0){T=N;try{m("restored draft from storage",{len:N.length})}catch{}}}catch{}return T}),y=w.useRef(null),[b]=w.useState(null),k=w.useRef(v),S=w.useRef(Date.now());w.useEffect(()=>{const A=r&&typeof r=="object"&&r.latex_source||"";let T=typeof A=="string"?A:"";if(c)try{const N=localStorage.getItem(`paper:${c}:draft`);if(typeof N=="string"&&N.length>0){T=N;try{m("prop change: using stored draft",{len:N.length})}catch{}}}catch{}if(typeof T=="string"&&T!==v){try{m("prop contentJson change",{len:(T||"").length})}catch{}g(T),k.current=T||"",S.current=Date.now()}},[r,c]),w.useImperativeHandle(n,()=>({getSelection:async()=>{var A,T;try{return await((T=(A=x.current)==null?void 0:A.getSelection)==null?void 0:T.call(A))}catch{return""}},insertText:async A=>{var T,N;if(!f)try{await((N=(T=x.current)==null?void 0:T.replaceSelection)==null?void 0:N.call(T,A))}catch{}},replaceSelection:async A=>{var T,N;if(!f)try{await((N=(T=x.current)==null?void 0:T.replaceSelection)==null?void 0:N.call(T,A))}catch{}},setContent:async A=>{var T,N;try{const I=typeof A=="string"?A:"";try{console.debug("[LatexAdapter] setContent called:",{length:I.length})}catch{}g(I),k.current=I,S.current=Date.now();try{await((N=(T=x.current)==null?void 0:T.setValue)==null?void 0:N.call(T,I,{suppressChange:!0}))}catch{}}catch(I){console.warn("[LatexAdapter] setContent failed:",I)}},insertHTML:async A=>{var T,N;if(!f)try{await((N=(T=x.current)==null?void 0:T.replaceSelection)==null?void 0:N.call(T,A))}catch{}},save:async()=>{if(!f)try{const A=typeof v=="string"?v:"";if(!c)return;await rt.updatePaperContent(c,{content_json:{authoring_mode:"latex",latex_source:A}})}catch(A){throw A}},focus:()=>{var A,T;try{(T=(A=x.current)==null?void 0:A.focus)==null||T.call(A)}catch{}},getCurrentCommitId:async()=>{try{return b}catch{return null}},scrollToLine:async A=>{var T,N;try{(N=(T=x.current)==null?void 0:T.scrollToLine)==null||N.call(T,A)}catch{}},replaceLines:async(A,T,N)=>{var I,R;if(!f)try{(R=(I=x.current)==null?void 0:I.replaceLines)==null||R.call(I,A,T,N)}catch{}}}),[b,v,c,f]);const j=A=>{if(f){g(A);try{s(A||"",{authoring_mode:"latex",latex_source:A||""})}catch{}return}g(A);try{s(A||"",{authoring_mode:"latex",latex_source:A||""})}catch{}if(d==="draft"){try{l==null||l(!0)}catch{}y.current&&window.clearTimeout(y.current),y.current=window.setTimeout(()=>{try{l==null||l(!1)}catch{}try{const T=k.current||"",N=A||"",I=Math.abs(N.length-T.length),R=Math.max(T.length,1),C=I/R,_=Date.now()-S.current;if(C>=.2&&_>12e4&&c){k.current=N,S.current=Date.now();try{localStorage.removeItem(`paper:${c}:draft`)}catch{}}}catch{}},3e3)}try{c&&(localStorage.setItem(`paper:${c}:draft`,A||""),m("draft saved",{len:(A||"").length}))}catch{}},E=async(A,T)=>{if(!f){if(!c)throw new Error("No paper ID available");await rt.updatePaperContent(c,{content_json:T});try{m("manual save (draft)")}catch{}g(A),k.current=A,S.current=Date.now();try{c&&localStorage.removeItem(`paper:${c}:draft`)}catch{}}};return w.useEffect(()=>{i==null||i(async()=>{})},[]),w.useEffect(()=>()=>{y.current&&(window.clearTimeout(y.current),y.current=null)},[]),a.jsx("div",{className:`flex flex-1 min-h-0 ${o||""}`,children:a.jsx(W9,{ref:x,value:v,onChange:j,onSave:E,templateTitle:u,fullHeight:!0,paperId:c,uncontrolled:!1,lockedSectionKeys:h||[],branchName:d||"draft",readOnly:f,disableSave:f,allowAutoVersion:!1,onNavigateBack:p})})}),Q9=Wc.memo(K9),O1=()=>{const{projectId:t,paperId:e}=$i(),n=Qn(),{currentRole:r}=qr(),[s,i]=w.useState(null),[l,o]=w.useState(!0),[c,u]=w.useState(null),h="idle",d=()=>{const y=t||(s==null?void 0:s.project_id);n(y?`/projects/${y}`:"/projects")},[f,p]=w.useState(null),m=w.useRef(null);w.useEffect(()=>{e&&(i(null),p(null),x())},[e]),w.useEffect(()=>{if(r==="viewer"&&e){const y=t||(s==null?void 0:s.project_id);y?n(`/projects/${y}/papers/${e}/view`,{replace:!0}):d()}},[r,e,t,s==null?void 0:s.project_id]),w.useEffect(()=>()=>{m.current&&window.clearTimeout(m.current)},[]),w.useEffect(()=>{var y;if(s)try{const b=(y=s.content_json)==null?void 0:y.authoring_mode;p(b==="latex"?s.content_json:null)}catch{p(null)}},[s]);const x=async()=>{var y,b,k;if(e)try{o(!0);const S=await rt.getPaper(e);console.debug("[PaperEditor] Loaded paper",{paperId:e,htmlLen:(((y=S==null?void 0:S.data)==null?void 0:y.content)||"").length,hasJson:!!((b=S==null?void 0:S.data)!=null&&b.content_json)}),i(S.data);try{const j=(k=S.data.content_json)==null?void 0:k.authoring_mode;p(j==="latex"?S.data.content_json:null)}catch{p(null)}}catch(S){console.error("Error loading paper:",S),u("Failed to load paper")}finally{o(!1)}};if(l)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-4 border-blue-200 border-t-blue-600 mx-auto"}),a.jsx("p",{className:"mt-6 text-lg text-gray-600 font-medium",children:"Loading paper..."})]})});if(c)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsxs("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:[a.jsx("svg",{className:"w-6 h-6 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:a.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),a.jsx("p",{className:"font-medium",children:"Error Loading Paper"}),a.jsx("p",{className:"text-sm mt-1",children:c})]}),a.jsxs("div",{className:"space-y-3",children:[a.jsx("button",{onClick:x,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"}),a.jsx("button",{onClick:d,className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700 transition-colors ml-2",children:"Back to Papers"})]})]})});if(!s)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Paper not found"}),a.jsx("p",{className:"text-gray-600 mb-4",children:"The paper you're looking for doesn't exist."}),a.jsx("button",{onClick:d,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Back to Papers"})]})});const v=!!(s!=null&&s.content_json&&typeof s.content_json=="object"&&s.content_json.authoring_mode==="latex"||f&&typeof f=="object"&&f.authoring_mode==="latex"),g=r==="admin"?"admin":r==="editor"?"editor":"viewer";return a.jsxs("div",{children:[!v&&h!=="idle",v?a.jsx("div",{className:"fixed inset-0",children:a.jsx(I0,{paperId:s.id,projectId:t||s.project_id||void 0,paperTitle:s.title,initialContent:"",initialContentJson:f||s.content_json,Adapter:Q9,fullBleed:!0,initialPaperRole:g})}):a.jsx("div",{className:"fixed inset-0",children:a.jsx(af,{paperId:s.id,paperTitle:s.title,content:s.content||"",contentJson:s.content_json,onContentChange:()=>{},onSelectionChange:()=>{},className:"h-full w-full",readOnly:g==="viewer",onNavigateBack:()=>n(t?`/projects/${t}`:"/projects")})})]})},G9=({latexSource:t,paperId:e})=>{const[n,r]=w.useState("idle"),[s,i]=w.useState(null),[l,o]=w.useState([]),[c,u]=w.useState(!1),h=w.useRef(null),d=w.useRef(null),f=w.useRef(0),p=w.useRef(null),m=w.useRef(0),x=w.useCallback(()=>{const k=p.current;if(k&&k.startsWith("blob:"))try{URL.revokeObjectURL(k)}catch{}p.current=null},[]),v=w.useCallback((k,S)=>{var T,N,I;if(!k)return;const j=h.current;if(!j)return;const E=()=>{var R;try{(R=j.contentWindow)==null||R.postMessage({type:"loadFile",url:k,rev:S},"*")}catch(C){console.warn("[LatexPdfViewer] Failed to post PDF url to iframe",C)}};if(j.dataset.loaded==="true"){E();return}try{const R=((T=j.contentDocument)==null?void 0:T.readyState)||((I=(N=j.contentWindow)==null?void 0:N.document)==null?void 0:I.readyState);if(R==="complete"||R==="interactive"){j.dataset.loaded="true",E();return}}catch{}const A=()=>{j.dataset.loaded="true",E()};j.addEventListener("load",A,{once:!0})},[]),g=w.useCallback(k=>{if(!k)return k||"";if(/^https?:/i.test(k))return k;const S=k.startsWith("/")?k:`/${k}`;return`${kl}${S}`},[]),y=w.useCallback(async()=>{if(!t||!t.trim()){r("error"),i("Paper does not have LaTeX content yet."),o([]);return}f.current+=1;const k=f.current;if(r("compiling"),i(null),o([]),d.current)try{d.current.abort()}catch{}const S=new AbortController;d.current=S;let j=!1,E=!1;try{const A=await fetch(sn("/latex/compile/stream"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("access_token")||""}`},body:JSON.stringify({latex_source:t,paper_id:e??null,include_bibtex:!0,job_label:`viewer-${Date.now()}`}),signal:S.signal});if(!A.ok||!A.body)throw new Error(`Compilation failed (${A.status})`);const T=A.body.getReader(),N=new TextDecoder;let I="";for(;;){const{value:R,done:C}=await T.read();if(C)break;I+=N.decode(R,{stream:!0});const _=I.split(`

`);I=_.pop()||"";for(const M of _){const z=M.trim();if(!z.startsWith("data:"))continue;const q=z.replace(/^data:\s*/,"");let F=null;try{F=JSON.parse(q)}catch(V){console.warn("[LatexPdfViewer] Failed to parse SSE payload",V);continue}if(F.type==="log"){const V=typeof F.line=="string"?F.line:"";V&&o(P=>{const H=P.length>=200?P.slice(-199):P.slice();return H.push(V),H})}else if(F.type==="cache")o(V=>[...V,"[cache] Using cached PDF"]);else if(F.type==="error"){j=!0;const V=typeof F.message=="string"?F.message:"Compilation error";r("error"),i(V)}else if(F.type==="final"){if(!F.pdf_url)continue;try{const V=localStorage.getItem("access_token")||"",P=g(F.pdf_url),H=await fetch(P,{headers:V?{Authorization:`Bearer ${V}`}:void 0});if(!H.ok)throw new Error(`Failed to fetch PDF (${H.status})`);const Y=await H.blob();if(k!==f.current)continue;const L=URL.createObjectURL(Y);x(),p.current=L,m.current=k,v(L,k),E=!0}catch(V){j=!0;const P=(V==null?void 0:V.message)||"Failed to load compiled PDF";r("error"),i(P)}}}}!j&&E?r("success"):j&&!E&&r("error")}catch(A){if(S.signal.aborted)return;j=!0,r("error"),i((A==null?void 0:A.message)||"Failed to compile LaTeX")}finally{d.current===S&&(d.current=null),!j&&E&&i(null)}},[x,t,e,v,g]);w.useEffect(()=>(y(),()=>{if(d.current){try{d.current.abort()}catch{}d.current=null}x()}),[y,x]),w.useEffect(()=>{const k=h.current;if(!k)return;const S=()=>{k.dataset.loaded="true";const j=p.current,E=m.current;j&&E&&v(j,E)};return k.addEventListener("load",S),()=>{k.removeEventListener("load",S)}},[v]),w.useEffect(()=>{const k=S=>{const j=S.data;if(!j||j.type!=="viewer-ready")return;const E=h.current;if(!E||S.source!==E.contentWindow)return;const A=p.current,T=m.current;!A||!T||v(A,T)};return window.addEventListener("message",k),()=>{window.removeEventListener("message",k)}},[v]);const b=n==="compiling"?"Compiling LaTeX":n==="success"?"Preview ready":n==="error"?s?`Error: ${s}`:"Compilation failed":"Idle";return a.jsxs("div",{className:"flex-1 min-h-0 flex flex-col bg-gray-100",children:[a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b bg-white",children:[a.jsx("div",{className:`text-sm ${n==="error"?"text-red-600":"text-gray-700"}`,children:b}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm rounded-md border border-gray-300 hover:bg-gray-50",onClick:()=>{y()},disabled:n==="compiling",children:n==="compiling"?"Compiling":"Recompile"}),(l.length>0||n==="error")&&a.jsx("button",{type:"button",className:"px-3 py-1.5 text-sm rounded-md border border-gray-300 hover:bg-gray-50",onClick:()=>u(k=>!k),children:c?"Hide logs":"Show logs"})]})]}),a.jsx("div",{className:"flex-1 min-h-0 bg-gray-200",children:a.jsx("iframe",{ref:h,title:"LaTeX PDF Preview",src:"/pdf-viewer.html",className:"w-full h-full border-0 bg-gray-200","data-loaded":"false"})}),c&&a.jsxs("div",{className:"max-h-60 overflow-auto border-t border-gray-200 bg-white font-mono text-xs text-gray-700 p-3 space-y-1",children:[l.length===0&&n!=="error"&&a.jsx("div",{children:"No logs yet."}),l.map((k,S)=>a.jsx("div",{children:k},S)),n==="error"&&s&&a.jsx("div",{className:"text-red-600",children:s})]})]})},X9=Wc.memo(G9),J9=()=>{const{projectId:t,paperId:e}=$i(),n=Qn(),[r,s]=w.useState(null),[i,l]=w.useState(!0),[o,c]=w.useState(null),u=(m="")=>{const x=t||(r==null?void 0:r.project_id);return x?`/projects/${x}${m}`:`/projects${m}`},h=w.useMemo(()=>{const m=r==null?void 0:r.content_json;if(!m)return null;if(typeof m=="string")try{return JSON.parse(m)}catch(x){return console.warn("Failed to parse paper.content_json",x),null}return m},[r==null?void 0:r.content_json]);w.useEffect(()=>{e&&d()},[e]);const d=async()=>{if(e)try{l(!0),c(null);const m=await rt.getPaper(e);s(m.data)}catch(m){console.error("Error loading paper:",m),c("Failed to load paper")}finally{l(!1)}};if(i)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto h-16 w-16 animate-spin rounded-full border-4 border-blue-200 border-t-blue-600"}),a.jsx("p",{className:"mt-6 text-lg font-medium text-gray-600",children:"Loading paper..."})]})});if(o)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center max-w-md",children:[a.jsxs("div",{className:"mb-4 rounded border border-red-300 bg-red-100 px-4 py-3 text-red-700",children:[a.jsx("p",{className:"font-semibold",children:"Error loading paper"}),a.jsx("p",{className:"text-sm",children:o})]}),a.jsxs("div",{className:"space-x-3",children:[a.jsx("button",{onClick:d,className:"rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:"Try again"}),a.jsx("button",{onClick:()=>n(u()),className:"rounded-md bg-gray-600 px-4 py-2 text-white hover:bg-gray-700",children:"Back to papers"})]})]})});if(!r)return a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("h2",{className:"mb-2 text-xl font-semibold text-gray-900",children:"Paper not found"}),a.jsx("p",{className:"mb-4 text-gray-600",children:"The paper you're looking for doesn't exist."}),a.jsx("button",{onClick:()=>n(u()),className:"rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700",children:"Back to papers"})]})});const f=!!(h&&typeof h=="object"&&h.authoring_mode==="latex"),p=f?String((h==null?void 0:h.latex_source)||""):"";return f?a.jsxs("div",{className:"fixed inset-0 flex flex-col bg-gray-50",children:[a.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b bg-white",children:[a.jsxs("button",{className:"px-2 py-1 border border-gray-300 rounded-md text-xs hover:bg-gray-50 flex items-center gap-1",onClick:()=>n(u(`/papers/${r.id}`)),title:"Back to Paper Details",children:[a.jsx(p0,{className:"w-4 h-4"}),a.jsx("span",{children:"Back"})]}),a.jsx("div",{className:"text-sm font-medium text-gray-700 truncate max-w-md",title:r.title,children:r.title}),a.jsx("div",{className:"w-24"})]}),a.jsx(X9,{latexSource:p,paperId:r.id})]}):a.jsx("div",{className:"fixed inset-0",children:a.jsx(af,{paperId:r.id,paperTitle:r.title,content:r.content||"",contentJson:h,onContentChange:()=>{},onSelectionChange:()=>{},className:"h-full w-full",readOnly:!0,onNavigateBack:()=>n(u())})})},Y9=({onSelectTemplate:t})=>{const e=[{id:"research-paper",name:"Research Paper",description:"Standard research paper with introduction, methodology, results, and discussion",icon:a.jsx(MT,{size:24,className:"text-blue-600"}),structure:`
        <h1>Title</h1>
        <h2>Abstract</h2>
        <p>Brief summary of the research...</p>
        
        <h2>1. Introduction</h2>
        <p>Background and context...</p>
        <p>Research question and objectives...</p>
        
        <h2>2. Literature Review</h2>
        <p>Previous research and findings...</p>
        
        <h2>3. Methodology</h2>
        <p>Research design and methods...</p>
        
        <h2>4. Results</h2>
        <p>Findings and data analysis...</p>
        
        <h2>5. Discussion</h2>
        <p>Interpretation of results...</p>
        
        <h2>6. Conclusion</h2>
        <p>Summary and implications...</p>
        
        <h2>References</h2>
        <p>List of cited sources...</p>
      `,category:"research"},{id:"literature-review",name:"Literature Review",description:"Comprehensive review of existing research in a specific field",icon:a.jsx(hs,{size:24,className:"text-green-600"}),structure:`
        <h1>Title</h1>
        <h2>Abstract</h2>
        <p>Overview of the review...</p>
        
        <h2>1. Introduction</h2>
        <p>Scope and objectives...</p>
        
        <h2>2. Methodology</h2>
        <p>Search strategy and inclusion criteria...</p>
        
        <h2>3. Theoretical Framework</h2>
        <p>Underlying theories and concepts...</p>
        
        <h2>4. Review of Literature</h2>
        <h3>4.1 Theme 1</h3>
        <p>Analysis of first theme...</p>
        <h3>4.2 Theme 2</h3>
        <p>Analysis of second theme...</p>
        
        <h2>5. Synthesis</h2>
        <p>Integration of findings...</p>
        
        <h2>6. Conclusion</h2>
        <p>Summary and future directions...</p>
        
        <h2>References</h2>
        <p>List of reviewed sources...</p>
      `,category:"review"},{id:"methodology-paper",name:"Methodology Paper",description:"Detailed description of research methods and procedures",icon:a.jsx(rg,{size:24,className:"text-purple-600"}),structure:`
        <h1>Title</h1>
        <h2>Abstract</h2>
        <p>Method overview...</p>
        
        <h2>1. Introduction</h2>
        <p>Methodological context...</p>
        
        <h2>2. Method Description</h2>
        <h3>2.1 Participants</h3>
        <p>Sample description...</p>
        <h3>2.2 Materials</h3>
        <p>Instruments and tools...</p>
        <h3>2.3 Procedure</h3>
        <p>Step-by-step process...</p>
        
        <h2>3. Validation</h2>
        <p>Reliability and validity...</p>
        
        <h2>4. Applications</h2>
        <p>Use cases and limitations...</p>
        
        <h2>References</h2>
        <p>Methodological sources...</p>
      `,category:"methodology"},{id:"case-study",name:"Case Study",description:"In-depth analysis of a specific instance or phenomenon",icon:a.jsx(tu,{size:24,className:"text-orange-600"}),structure:`
        <h1>Title</h1>
        <h2>Abstract</h2>
        <p>Case overview...</p>
        
        <h2>1. Introduction</h2>
        <p>Case background and significance...</p>
        
        <h2>2. Case Description</h2>
        <h3>2.1 Context</h3>
        <p>Setting and circumstances...</p>
        <h3>2.2 Participants</h3>
        <p>Key individuals involved...</p>
        <h3>2.3 Timeline</h3>
        <p>Sequence of events...</p>
        
        <h2>3. Analysis</h2>
        <p>Critical examination...</p>
        
        <h2>4. Discussion</h2>
        <p>Implications and lessons...</p>
        
        <h2>5. Conclusion</h2>
        <p>Summary and recommendations...</p>
        
        <h2>References</h2>
        <p>Supporting sources...</p>
      `,category:"case_study"}],n=s=>{switch(s){case"research":return"bg-blue-50 border-blue-200 text-blue-800";case"review":return"bg-green-50 border-green-200 text-green-800";case"methodology":return"bg-purple-50 border-purple-200 text-purple-800";case"case_study":return"bg-orange-50 border-orange-200 text-orange-800";default:return"bg-gray-50 border-gray-200 text-gray-800"}},r=s=>{switch(s){case"research":return"Research";case"review":return"Literature Review";case"methodology":return"Methodology";case"case_study":return"Case Study";default:return"Other"}};return a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:[a.jsxs("div",{className:"mb-6",children:[a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Choose a Paper Template"}),a.jsx("p",{className:"text-gray-600",children:"Select a template to get started with your academic paper. Each template includes a structured outline that follows academic writing standards."})]}),a.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:e.map(s=>a.jsx("div",{className:"border border-gray-200 rounded-lg p-6 hover:shadow-md transition-shadow cursor-pointer group",onClick:()=>t(s),children:a.jsxs("div",{className:"flex items-start gap-4",children:[a.jsx("div",{className:"flex-shrink-0",children:s.icon}),a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[a.jsx("h3",{className:"text-lg font-semibold text-gray-900 group-hover:text-blue-600 transition-colors",children:s.name}),a.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full border ${n(s.category)}`,children:r(s.category)})]}),a.jsx("p",{className:"text-gray-600 text-sm mb-4 leading-relaxed",children:s.description}),a.jsxs("div",{className:"flex items-center gap-2 text-blue-600 text-sm font-medium group-hover:text-blue-700 transition-colors",children:[a.jsx(xn,{size:16}),a.jsx("span",{children:"Use this template"})]})]})]})},s.id))}),a.jsx("div",{className:"mt-8 p-4 bg-gray-50 rounded-lg",children:a.jsxs("div",{className:"flex items-center gap-2 text-gray-600",children:[a.jsx(Ec,{size:16}),a.jsxs("span",{className:"text-sm",children:[a.jsx("strong",{children:"Tip:"})," You can always modify the template structure after selecting it. These templates are designed to help you get started with proper academic formatting."]})]})})]})},Z9=()=>{const t=Qn(),{projectId:e}=$i(),{currentRole:n}=qr(),[r,s]=w.useState(null),[i,l]=w.useState(""),[o,c]=w.useState(""),[u,h]=w.useState(!1),[d,f]=w.useState("rich"),[p,m]=w.useState(null),x=y=>{s(y),l(y.name),c(y.description)},v=async()=>{if(!i.trim()||!r){alert("Please provide a paper title and select a template");return}h(!0);try{const y={title:i.trim(),abstract:o.trim(),paper_type:r.category,status:"draft",keywords:[],references:"",is_public:!1};d==="latex"?y.content_json={authoring_mode:"latex",latex_source:""}:(y.content=r.structure,y.content_json={authoring_mode:"rich"}),e&&(y.project_id=e);const k=(await rt.createPaper(y)).data;m(k),setTimeout(()=>{const S=e||k.project_id;t(S?`/projects/${S}/papers/${k.id}/editor`:"/projects")},2e3)}catch(y){console.error("Error creating paper:",y),alert("Failed to create paper. Please try again.")}finally{h(!1)}},g=()=>{t(e?`/projects/${e}`:"/projects")};return n==="viewer"?a.jsx(l0,{to:e?`/projects/${e}/papers`:"/projects",replace:!0}):p?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 max-w-md w-full text-center",children:[a.jsx(sS,{size:64,className:"text-green-500 mx-auto mb-4"}),a.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Paper Created Successfully!"}),a.jsxs("p",{className:"text-gray-600 mb-6",children:['Your paper "',p.title,'" has been created and is ready for editing.']}),a.jsx("div",{className:"animate-pulse text-blue-600",children:"Redirecting to editor..."})]})}):a.jsxs("div",{className:"min-h-screen bg-gray-50",children:[a.jsx("div",{className:"bg-white shadow-sm border-b",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsx("div",{className:"flex items-center justify-between h-16",children:a.jsxs("div",{className:"flex items-center space-x-4",children:[a.jsx("button",{onClick:g,className:"text-gray-400 hover:text-gray-600 transition-colors",children:a.jsx(p0,{size:24})}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(ln,{size:24,className:"text-blue-600"}),a.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Create New Paper"})]})]})})})}),a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:r?a.jsxs("div",{className:"max-w-4xl mx-auto",children:[a.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Configure Your Paper"}),a.jsx("button",{onClick:()=>s(null),className:"text-gray-500 hover:text-gray-700 text-sm",children:"Change Template"})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Paper Title *"}),a.jsx("input",{type:"text",value:i,onChange:y=>l(y.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your paper title..."})]}),a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Abstract"}),a.jsx("textarea",{value:o,onChange:y=>c(y.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Brief description of your paper..."})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Selected Template"}),a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("div",{className:"text-blue-600",children:r.icon}),a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900",children:r.name}),a.jsx("p",{className:"text-sm text-gray-600",children:r.description})]})]})]}),a.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[a.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Authoring Mode"}),a.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.jsxs("label",{className:"inline-flex items-center gap-2",children:[a.jsx("input",{type:"radio",name:"authoring_mode",checked:d==="rich",onChange:()=>f("rich")}),"Rich Text"]}),a.jsxs("label",{className:"inline-flex items-center gap-2",children:[a.jsx("input",{type:"radio",name:"authoring_mode",checked:d==="latex",onChange:()=>f("latex")}),"LaTeX"]})]}),a.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Papers are locked to one mode. No autoconversion between modes."})]})]})]}),a.jsxs("div",{className:"flex justify-end gap-3",children:[a.jsx("button",{onClick:g,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors",children:"Cancel"}),a.jsx("button",{onClick:v,disabled:u||!i.trim(),className:"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:u?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Creating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(ln,{size:16}),"Create Paper"]})})]})]}):a.jsx(Y9,{onSelectTemplate:x})})]})},eU=[{index:!0,element:a.jsx(gw,{})},{path:"projects",children:[{index:!0,element:a.jsx(gw,{})},{path:":projectId",element:a.jsx(OL,{}),children:[{index:!0,element:a.jsx(zL,{})},{path:"discussion",element:a.jsx(R7,{})},{path:"sync-space",element:a.jsx(D7,{})},{path:"papers",element:a.jsx(L7,{})},{path:"discovery",element:a.jsx(B7,{})},{path:"papers/new",element:a.jsx(Z9,{})},{path:"papers/:paperId",children:[{index:!0,element:a.jsx(H7,{})},{path:"view",element:a.jsx(J9,{})},{path:"editor",element:a.jsx(O1,{})},{path:"collaborate",element:a.jsx(O1,{})}]},{path:"related-papers",element:a.jsx($7,{})},{path:"updates",element:a.jsx(U7,{})}]}]}],tU={"/edit":"/editor","/collaborate":"/editor"},nU=()=>{const{paperId:t}=$i(),e=Hs(),n=Qn(),{data:r,isLoading:s,isError:i}=Tt({queryKey:["legacy-paper-redirect",t],queryFn:async()=>{if(!t)throw new Error("Missing paper id");return(await rt.getPaper(t)).data},enabled:!!t});return w.useEffect(()=>{if(!r)return;const l=r.project_id,o=l?`/projects/${l}/papers/${r.id}`:"/projects",c=e.pathname.replace(`/papers/${r.id}`,""),u=tU[c]??c,h=`${o}${u||""}${e.search||""}`;n(h,{replace:!0})},[r,e.pathname,e.search,n]),s?a.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:a.jsx("p",{className:"text-sm text-gray-500",children:"Redirecting to the new paper workspace"})}):((i||!r)&&n("/projects",{replace:!0}),null)},rU=[...XT,{path:"/",element:a.jsx(wM,{children:a.jsx(KT,{})}),children:[...eU,{path:"papers/:paperId/*",element:a.jsx(nU,{})},...YT,...rR,...lR,...TL,...DL]}];function sU(){const t=$P(rU);return a.jsx("div",{className:"min-h-screen bg-gray-50 text-gray-900 font-sans",children:a.jsx(yM,{children:a.jsx(vM,{children:t})})})}try{const t=()=>{};console.log=t,console.info=t,console.debug=t}catch{}const iU=new R4({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}});zp.createRoot(document.getElementById("root")).render(a.jsx(Wc.StrictMode,{children:a.jsx(F4,{client:iU,children:a.jsx(u4,{children:a.jsx(sU,{})})})}));
//# sourceMappingURL=index-BuQPz-gI.js.map
